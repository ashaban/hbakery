import{_ as et,a1 as tt,r as k,a0 as ae,e as J,l as lt,s as v,v as u,x as o,i as l,y as m,O as I,H as _,C as i,B as p,I as f,$,af as ot,aM as at,a3 as ye,D as ne,a5 as nt,E as y,ay as E,Q as W,F as q,G as h,j as st,A as ve}from"./index-DjOEAoKG.js";import{c as _e,u as it,m as rt,r as se}from"./index-Bo6p8uHi.js";import{V as U,b as N,a as H,c as ge}from"./VCard-DBo8W4Of.js";import{V as g}from"./VCol-jPMT2cT0.js";import{V as x}from"./VTextField-D7ZdN6jE.js";import{V as L}from"./VAlert-J1YXwmpZ.js";import{a as dt,b as ut,V as mt}from"./VDataTable-CssJi5_9.js";import{V as ie}from"./VDialog-D-5jawNd.js";import{V as ct}from"./VForm-DhQx-1tv.js";import{V as be}from"./VAutocomplete-DnUB3J3Q.js";import{V as Ve}from"./VCheckbox-DYPIqHJJ.js";import{V as T}from"./VChip-DHkUtbZ-.js";import{V as ft,a as ke,b as pt,c as Ce}from"./VTabs-D0GOZQg2.js";import{V as yt}from"./VContainer-D5OHvee2.js";import"./dialog-transition-CZeN_weD.js";import"./VSlideGroup-BiXttYga.js";const vt={class:"d-flex justify-space-between mb-4"},_t={class:"d-flex justify-end align-center mt-4"},gt={class:"d-flex align-center flex-wrap"},bt={class:"text-white font-weight-bold text-h6"},Vt={class:"d-flex justify-end mt-2"},kt={class:"d-flex justify-space-between align-center mb-4"},Ct={class:"text-caption text-grey mt-1"},wt={class:"d-flex justify-end mt-2"},xt={class:"d-flex justify-space-between align-center mb-2"},$t={key:2,class:"text-center py-4"},qt={key:3},ht={class:"flex-grow-1"},At={class:"font-weight-medium"},Et={key:0,class:"text-center py-2 text-grey"},Ut={key:1,class:"text-caption text-grey mt-2"},Mt={class:"bg-primary pa-6 rounded-t-xl"},Nt={class:"d-flex align-center"},Ot={class:"text-h5 font-weight-bold text-white"},Pt={class:"pa-4"},Tt={key:0,class:"text-center py-8"},zt={key:1,class:"ingredients-grid"},Dt={class:"d-flex align-center"},St={class:"flex-grow-1"},Gt={class:"text-body-1 font-weight-medium"},jt={class:"d-flex align-center mt-2"},It={class:"text-primary text-caption font-weight-bold"},Lt={class:"pa-4"},Ft={key:0,class:"text-center py-8"},Bt={key:1},Qt={key:0,class:"text-body-2 mb-3"},Rt={class:"mb-3"},Yt=10,Xt={__name:"Products",setup(Jt){const K=tt(),C=k(!1),re=k([]),O=k(!1),z=k(!1),Y=k(!1),F=k("mandatory"),M=k(!1),Z=k(null),de=k(null),ee=k([]),te=k([]),D=k([]),B=k(1),ue=k(1),me=ae({total_products:""}),S=ae({search:""}),we=[{title:"Name",key:"name"},{title:"Description",key:"description"},{title:"Unit",key:"unit"},{title:"Price",key:"price"},{title:"Actions",key:"actions"}],xe=[{text:"Any Combination",value:"ANY"},{text:"Exactly One",value:"EXACTLY_ONE"},{text:"At Least One",value:"AT_LEAST_ONE"}],r=ae({name:"",description:"",unit:"",price:"",items:[],groups:[]}),$e=_e.withMessage("At least one mandatory ingredient is required",n=>Array.isArray(n)&&n.length>0),qe=_e.withMessage("Each mandatory ingredient must have item and quantity",n=>Array.isArray(n)&&n.every(e=>e.item_id&&e.quantity_per_unit&&Number(e.quantity_per_unit)>0)),he={name:{required:se},unit:{required:se},price:{required:se,minValue:rt(1)},items:{hasAtLeastOneItem:$e,validItems:qe}},w=it(he,r),Ae=J(()=>{const n=r.items.length,e=r.groups.length,t=r.items.filter(d=>!d.item_id||!d.quantity_per_unit).length,s=r.groups.filter(d=>!d.name||d.options.length===0).length;if(n===0&&e===0)return"No ingredients configured.";let a=`${n} mandatory ingredient(s)`;return e>0&&(a+=`, ${e} group(s)`),(t>0||s>0)&&(a+=` - ${t+s} incomplete`),a}),ce=J(()=>{const n=r.items.some(t=>!t.item_id||!t.quantity_per_unit),e=r.groups.some(t=>!t.name||t.options.length===0);return n||e?"error":"success"}),le=J(()=>{for(const n of r.groups){if(!n.name)return"All groups must have a name";if(n.options.length===0)return`Group "${n.name}" must have at least one option`;for(const e of n.combinations){const t=G(n,e);for(const s of t){const a=Oe(n,e,s.item_id);if(!a||a<=0)return`Combination "${e.name}" must have quantity for ${oe(s.item_id)}`}}if(n.is_mandatory&&!n.combinations.some(e=>e.is_default))return`Mandatory group "${n.name}" must have a default combination`}return null}),fe=J(()=>!!le.value),Ee=n=>({ANY:"Any combination of options allowed",EXACTLY_ONE:"Must select exactly one option",AT_LEAST_ONE:"Must select at least one option"})[n]||"",Ue=n=>{const e=n.options.filter(t=>t.item_id).length;return n.selection_mode==="EXACTLY_ONE"?e:(n.selection_mode==="AT_LEAST_ONE",Math.pow(2,e)-1)},oe=n=>{const e=D.value.find(t=>t.id===n);return e?e.name:"Unknown Item"},Me=(n,e)=>{const t=n.find(s=>s.item_id===e);return t?t.item_name:"Unknown Item"},G=(n,e)=>n.options.filter((t,s)=>e.combination_mask&1<<s),pe=(n,e)=>n.options.length-G(n,e).length,Q=n=>{const e=r.groups[n],t=e.options.filter(c=>c.item_id);if(t.length===0){e.combinations=[];return}const s=[],a=Math.pow(2,t.length);for(let c=1;c<a;c++){const b=c,A=[];for(let V=0;V<t.length;V++)b&1<<V&&A.push(t[V]);const X=A.map(V=>oe(V.item_id)).join(" + "),P=e.combinations.find(V=>V.combination_mask===b);if(P)P.name=X,A.forEach(V=>{P.quantities.find(R=>R.item_id===V.item_id)||P.quantities.push({item_id:V.item_id,quantity_per_unit:""})}),P.quantities=P.quantities.filter(V=>A.some(R=>R.item_id===V.item_id)),s.push(P);else{const V=A.map(R=>({item_id:R.item_id,quantity_per_unit:""}));s.push({name:X,combination_mask:b,is_default:s.length===0&&e.is_mandatory,notes:"",quantities:V})}}let d=s;e.selection_mode==="EXACTLY_ONE"?d=s.filter(c=>G(e,c).length===1):e.selection_mode==="AT_LEAST_ONE"&&(d=s.filter(c=>G(e,c).length>=1)),e.is_mandatory&&d.length>0&&!d.some(c=>c.is_default)&&(d[0].is_default=!0),e.combinations=d},Ne=(n,e,t)=>{const a=r.groups[n].combinations[e].quantities.find(d=>d.item_id===t);return a?a.quantity_per_unit:""},Oe=(n,e,t)=>{const s=e.quantities.find(a=>a.item_id===t);return s?s.quantity_per_unit:""},Pe=(n,e,t,s)=>{const a=r.groups[n].combinations[e],d=a.quantities.find(c=>c.item_id===t);d?d.quantity_per_unit=s:a.quantities.push({item_id:t,quantity_per_unit:s})};function Te(n){const e=r.items.map((a,d)=>d!==n?a.item_id:null).filter(Boolean),t=r.groups.flatMap(a=>a.options.map(d=>d.item_id)).filter(Boolean),s=[...e,...t];return D.value.filter(a=>!s.includes(a.id))}function ze(n,e){const s=r.groups[n].options.map((b,A)=>A!==e?b.item_id:null).filter(Boolean),a=r.groups.flatMap((b,A)=>A!==n?b.options.map(X=>X.item_id):[]).filter(Boolean),d=r.items.map(b=>b.item_id).filter(Boolean),c=[...s,...a,...d];return D.value.filter(b=>!c.includes(b.id))}function De(n){const e=D.value.find(t=>t.id===n.item_id);n.unit=e?e.unit:""}function Se(n,e){const t=r.groups[n].options[e],s=D.value.find(a=>a.id===t.item_id);t.item_name=s?s.name:"",t.unit=s?s.unit:"",t.item_id&&Q(n)}function Ge(){r.items.push({item_id:"",quantity_per_unit:"",unit:""})}function je(n){r.items.splice(n,1)}function Ie(){r.groups.push({name:"",description:"",is_mandatory:!0,selection_mode:"ANY",options:[],combinations:[]})}function Le(n){r.groups.splice(n,1)}function Fe(n){r.groups[n].options.push({item_id:"",item_name:"",position:r.groups[n].options.length+1,unit:""})}function Be(n,e){r.groups[n].options.splice(e,1),Q(n)}function Qe(n,e){r.groups[n].combinations.splice(e,1)}async function Re(){const n=await fetch("/items");D.value=await n.json()}async function j(){C.value=!0;const n=new URLSearchParams({page:B.value,limit:Yt});S.search&&n.append("search",S.search);try{const t=await(await fetch(`/products?${n}`)).json();re.value=t.data||[],ue.value=t.totalPages||1,me.total_products=t.totalRecords||0}finally{C.value=!1}}function Ye(){B.value=1,j()}function Xe(){S.search="",B.value=1,j()}function Je(){M.value=!1,Object.assign(r,{name:"",description:"",unit:"",price:"",items:[],groups:[]}),O.value=!0,w.value.$reset()}async function We(n){M.value=!0,Z.value=n.id,C.value=!0;try{const t=await(await fetch(`/products/${n.id}`)).json(),s=t.product||t;Object.assign(r,{name:s.name,description:s.description,unit:s.unit,price:s.price,items:(t.items||[]).map(a=>({item_id:a.item_id,quantity_per_unit:a.quantity_per_unit,unit:a.unit})),groups:(t.groups||[]).map(a=>({name:a.name,description:a.description,is_mandatory:a.is_mandatory,selection_mode:a.selection_mode,options:a.options||[],combinations:a.combinations||[]}))}),O.value=!0}finally{C.value=!1}}async function He(n){de.value=n;const t=await(await fetch(`/products/${n.id}`)).json();ee.value=t.items||[],te.value=t.groups||[],F.value="mandatory",Y.value=!0}async function Ke(){if(w.value.$touch(),w.value.$invalid||fe.value)return;C.value=!0;const n=new FormData;n.append("name",r.name),n.append("description",r.description),n.append("unit",r.unit),n.append("price",r.price),n.append("items",JSON.stringify(r.items)),n.append("groups",JSON.stringify(r.groups));const e=M.value?`/products/${Z.value}`:"/products",t=M.value?"PUT":"POST";try{if(!(await fetch(e,{method:t,body:n})).ok)throw new Error("Failed to save");O.value=!1,j(),K.commit("setMessage",{type:"success",text:M.value?"Product updated!":"Product added!"})}catch{K.commit("setMessage",{type:"error",text:"Failed to save product"})}finally{C.value=!1}}async function Ze(){C.value=!0,await fetch(`/products/${Z.value}`,{method:"DELETE"}),z.value=!1,O.value=!1,j(),K.commit("setMessage",{type:"success",text:"Product deleted!"}),C.value=!1}return lt(()=>{j(),Re()}),(n,e)=>(u(),v(yt,{fluid:""},{default:o(()=>[l(U,{class:"pa-4 mb-4"},{default:o(()=>[l(I,{dense:""},{default:o(()=>[l(g,{cols:"12",sm:"4"},{default:o(()=>[l(x,{modelValue:S.search,"onUpdate:modelValue":e[0]||(e[0]=t=>S.search=t),"append-inner-icon":"mdi-close-circle",autocomplete:"off",autocorrect:"off",clearable:"",inputmode:"none",label:"Search Product Name",spellcheck:"false","onClick:appendInner":e[1]||(e[1]=t=>S.search="")},null,8,["modelValue"])]),_:1}),l(g,{class:"d-flex justify-end",cols:"12"},{default:o(()=>[l(_,{color:"primary",onClick:Ye},{default:o(()=>[l(p,{start:""},{default:o(()=>e[18]||(e[18]=[i("mdi-filter")])),_:1}),e[19]||(e[19]=i(" Apply "))]),_:1}),l(_,{class:"ml-2",color:"grey",onClick:Xe},{default:o(()=>[l(p,{start:""},{default:o(()=>e[20]||(e[20]=[i("mdi-refresh")])),_:1}),e[21]||(e[21]=i(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),l(L,{border:"start",class:"mb-4",type:"info",variant:"outlined"},{default:o(()=>[e[22]||(e[22]=m("strong",null,"Total Products:",-1)),i(" "+f(me.total_products||"0"),1)]),_:1}),m("div",vt,[e[25]||(e[25]=m("h3",null,"Products",-1)),n.$store.getters.hasTask("can_add_settings")?(u(),v(_,{key:0,class:"text-white",color:"primary",size:"small",onClick:Je},{default:o(()=>[l(p,{start:""},{default:o(()=>e[23]||(e[23]=[i("mdi-plus")])),_:1}),e[24]||(e[24]=i(" Add Product "))]),_:1})):$("",!0)]),l(ot,{active:C.value,indeterminate:C.value},null,8,["active","indeterminate"]),l(dt,{class:"elevation-1",dense:"",headers:we,height:"400",items:re.value,loading:C.value},at({_:2},[n.$store.getters.hasTask("can_add_settings")?{name:"item.actions",fn:o(({item:t})=>[l(p,{class:"mr-2",color:"primary",onClick:s=>We(t)},{default:o(()=>e[26]||(e[26]=[i(" mdi-square-edit-outline ")])),_:2},1032,["onClick"]),l(p,{color:"green",onClick:s=>He(t)},{default:o(()=>e[27]||(e[27]=[i(" mdi-eye ")])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["items","loading"]),m("div",_t,[l(ut,{modelValue:B.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>B.value=t),j],length:ue.value,"total-visible":"7"},null,8,["modelValue","length"])]),l(ie,{modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=t=>O.value=t),"max-width":"1200",scrollable:"",transition:"dialog-top-transition"},{default:o(()=>[l(U,{class:"rounded-xl pa-4",elevation:"10"},{default:o(()=>[l(ye,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:o(()=>[m("div",gt,[l(p,{class:"mr-2 text-white"},{default:o(()=>e[28]||(e[28]=[i("mdi-package-variant")])),_:1}),m("span",bt,f(M.value?"Edit Product":"Add Product"),1)]),l(ne),l(_,{color:"white",icon:"mdi-close",onClick:e[3]||(e[3]=t=>O.value=!1)})]),_:1}),l(N,{class:"pt-6"},{default:o(()=>[l(ct,{onSubmit:e[8]||(e[8]=nt(()=>{},["prevent"]))},{default:o(()=>[l(I,{dense:""},{default:o(()=>[l(g,{cols:"12",sm:"6"},{default:o(()=>[l(x,{modelValue:r.name,"onUpdate:modelValue":e[4]||(e[4]=t=>r.name=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0","error-messages":E(w).name.$errors.map(t=>t.$message),inputmode:"none",label:"Product Name",required:"",spellcheck:"false"},null,8,["modelValue","error-messages"])]),_:1}),l(g,{cols:"12",sm:"6"},{default:o(()=>[l(x,{modelValue:r.unit,"onUpdate:modelValue":e[5]||(e[5]=t=>r.unit=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0","error-messages":E(w).unit.$errors.map(t=>t.$message),inputmode:"none",label:"Unit (e.g. Loaf, Pack)",required:"",spellcheck:"false"},null,8,["modelValue","error-messages"])]),_:1}),l(g,{cols:"12"},{default:o(()=>[l(x,{modelValue:r.description,"onUpdate:modelValue":e[6]||(e[6]=t=>r.description=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0",inputmode:"none",label:"Description",spellcheck:"false"},null,8,["modelValue"])]),_:1}),l(g,{cols:"12",sm:"4"},{default:o(()=>[l(x,{modelValue:r.price,"onUpdate:modelValue":e[7]||(e[7]=t=>r.price=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0","error-messages":E(w).price.$errors.map(t=>t.$message),inputmode:"none",label:"Price",prefix:"TSh ",required:"",spellcheck:"false",type:"number"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),l(W,{class:"my-4"}),e[51]||(e[51]=m("h4",null,"Mandatory Ingredients (Fixed Requirements)",-1)),E(w).items.$error?(u(),v(L,{key:0,border:"start",class:"mb-2",type:"error",variant:"outlined"},{default:o(()=>e[29]||(e[29]=[i(" Each ingredient must have Item and Quantity. ")])),_:1})):$("",!0),(u(!0),y(q,null,h(r.items,(t,s)=>(u(),v(I,{key:"mandatory-"+s,align:"center",class:"mb-2",dense:""},{default:o(()=>[l(g,{cols:"12",sm:"6"},{default:o(()=>[l(be,{modelValue:t.item_id,"onUpdate:modelValue":[a=>t.item_id=a,a=>De(t)],autocomplete:"off",autocorrect:"off",clearable:"",dense:"",error:E(w).items.$dirty&&!t.item_id,"error-messages":E(w).items.$dirty&&!t.item_id?["Item required"]:[],inputmode:"none","item-title":"name","item-value":"id",items:Te(s),label:"Item",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue","error","error-messages","items"])]),_:2},1024),l(g,{cols:"12",sm:"5"},{default:o(()=>[l(x,{modelValue:t.quantity_per_unit,"onUpdate:modelValue":a=>t.quantity_per_unit=a,autocomplete:"off",autocorrect:"off",dense:"",error:E(w).items.$dirty&&(!t.quantity_per_unit||t.quantity_per_unit<=0),"error-messages":E(w).items.$dirty&&(!t.quantity_per_unit||t.quantity_per_unit<=0)?["Quantity > 0 required"]:[],inputmode:"none",label:`Quantity in ${t.unit||""}`,spellcheck:"false",type:"number"},null,8,["modelValue","onUpdate:modelValue","error","error-messages","label"])]),_:2},1024),l(g,{class:"d-flex justify-end",cols:"12",sm:"1"},{default:o(()=>[l(_,{color:"error",icon:"",size:"small",onClick:a=>je(s)},{default:o(()=>[l(p,null,{default:o(()=>e[30]||(e[30]=[i("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),m("div",Vt,[l(_,{color:"primary",size:"small",onClick:Ge},{default:o(()=>[l(p,{start:""},{default:o(()=>e[31]||(e[31]=[i("mdi-plus")])),_:1}),e[32]||(e[32]=i(" Add Mandatory Ingredient "))]),_:1})]),l(W,{class:"my-4"}),m("div",kt,[e[35]||(e[35]=m("h4",null,"Ingredient Groups (Flexible Combinations)",-1)),l(_,{color:"primary",size:"small",onClick:Ie},{default:o(()=>[l(p,{start:""},{default:o(()=>e[33]||(e[33]=[i("mdi-plus")])),_:1}),e[34]||(e[34]=i(" Add Group "))]),_:1})]),le.value?(u(),v(L,{key:1,border:"start",class:"mb-2",type:"error",variant:"outlined"},{default:o(()=>[i(f(le.value),1)]),_:1})):$("",!0),(u(!0),y(q,null,h(r.groups,(t,s)=>(u(),v(U,{key:"group-"+s,class:"mb-4",variant:"outlined"},{default:o(()=>[l(H,{class:"d-flex align-center bg-grey-lighten-3"},{default:o(()=>[l(x,{modelValue:t.name,"onUpdate:modelValue":[a=>t.name=a,a=>Q(s)],autocomplete:"off",autocorrect:"off",class:"mr-2",density:"compact","hide-details":"",inputmode:"none",label:"Group Name",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue"]),l(ne),l(_,{color:"error",icon:"",size:"small",onClick:a=>Le(s)},{default:o(()=>[l(p,null,{default:o(()=>e[36]||(e[36]=[i("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024),l(N,null,{default:o(()=>[l(I,{dense:""},{default:o(()=>[l(g,{cols:"12",sm:"6"},{default:o(()=>[l(x,{modelValue:t.description,"onUpdate:modelValue":a=>t.description=a,autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:"Description",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(g,{cols:"12",sm:"3"},{default:o(()=>[l(Ve,{modelValue:t.is_mandatory,"onUpdate:modelValue":a=>t.is_mandatory=a,density:"compact","hide-details":"",label:"Mandatory"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(g,{cols:"12",sm:"3"},{default:o(()=>[l(mt,{modelValue:t.selection_mode,"onUpdate:modelValue":[a=>t.selection_mode=a,a=>Q(s)],density:"compact","hide-details":"","item-title":"text","item-value":"value",items:xe,label:"Selection Mode"},null,8,["modelValue","onUpdate:modelValue"]),m("div",Ct,f(Ee(t.selection_mode)),1)]),_:2},1024)]),_:2},1024),l(W,{class:"my-3"}),e[49]||(e[49]=m("h5",{class:"mb-2"},"Available Options",-1)),t.options.length>=5?(u(),v(L,{key:0,class:"mb-2",density:"compact",type:"warning"},{default:o(()=>[i(f(t.options.length)+" options will generate "+f(Ue(t))+" combinations ",1)]),_:2},1024)):$("",!0),(u(!0),y(q,null,h(t.options,(a,d)=>(u(),v(I,{key:"option-"+s+"-"+d,align:"center",class:"mb-2",dense:""},{default:o(()=>[l(g,{cols:"12",sm:"6"},{default:o(()=>[l(be,{modelValue:a.item_id,"onUpdate:modelValue":[c=>a.item_id=c,c=>Se(s,d)],autocomplete:"off",autocorrect:"off",clearable:"",density:"compact",inputmode:"none","item-title":"name","item-value":"id",items:ze(s,d),label:"Item",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(g,{cols:"12",sm:"5"},{default:o(()=>[l(x,{modelValue:a.position,"onUpdate:modelValue":c=>a.position=c,autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:"Position",max:t.options.length,min:"1",spellcheck:"false",type:"number"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024),l(g,{class:"d-flex justify-end",cols:"12",sm:"1"},{default:o(()=>[l(_,{color:"error",icon:"",size:"small",onClick:c=>Be(s,d)},{default:o(()=>[l(p,null,{default:o(()=>e[37]||(e[37]=[i("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),m("div",wt,[l(_,{color:"primary",size:"small",onClick:a=>Fe(s)},{default:o(()=>[l(p,{start:""},{default:o(()=>e[38]||(e[38]=[i("mdi-plus")])),_:1}),e[39]||(e[39]=i(" Add Option "))]),_:2},1032,["onClick"])]),l(W,{class:"my-3"}),m("div",xt,[e[42]||(e[42]=m("h5",null,"Combinations (Auto-generated)",-1)),l(_,{color:"primary",disabled:t.options.length<1,size:"small",onClick:a=>Q(s)},{default:o(()=>[l(p,{start:""},{default:o(()=>e[40]||(e[40]=[i("mdi-autorenew")])),_:1}),e[41]||(e[41]=i(" Regenerate "))]),_:2},1032,["disabled","onClick"])]),t.options.length===0?(u(),v(L,{key:1,class:"mb-2",density:"compact",type:"info"},{default:o(()=>e[43]||(e[43]=[i(" Add options above to generate combinations automatically ")])),_:1})):t.combinations.length===0?(u(),y("div",$t,[l(p,{class:"mb-2",color:"grey",size:"48"},{default:o(()=>e[44]||(e[44]=[i("mdi-cog-refresh")])),_:1}),e[45]||(e[45]=m("div",{class:"text-grey"},' Click "Regenerate" to create combinations ',-1))])):(u(),y("div",qt,[l(L,{class:"mb-2",density:"compact",type:"info"},{default:o(()=>[i(f(t.combinations.length)+" combination(s) generated. Set quantities for included items. ",1)]),_:2},1024),(u(!0),y(q,null,h(t.combinations,(a,d)=>(u(),v(U,{key:"comb-"+s+"-"+d,class:"mb-3",variant:"outlined"},{default:o(()=>[l(H,{class:"d-flex align-center bg-grey-lighten-2"},{default:o(()=>[m("div",ht,[m("span",At,f(a.name),1),a.is_default?(u(),v(T,{key:0,class:"ml-2",color:"green",size:"small"},{default:o(()=>e[46]||(e[46]=[i(" Default ")])),_:1})):$("",!0)]),l(Ve,{modelValue:a.is_default,"onUpdate:modelValue":c=>a.is_default=c,class:"mr-2",density:"compact","hide-details":"",label:"Default"},null,8,["modelValue","onUpdate:modelValue"]),l(_,{color:"error",icon:"",size:"small",onClick:c=>Qe(s,d)},{default:o(()=>[l(p,null,{default:o(()=>e[47]||(e[47]=[i("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024),l(N,null,{default:o(()=>[G(t,a).length===0?(u(),y("div",Et," No items included in this combination ")):$("",!0),(u(!0),y(q,null,h(G(t,a),c=>(u(),v(I,{key:"qty-"+s+"-"+d+"-"+c.item_id,align:"center",class:"mb-2",dense:""},{default:o(()=>[l(g,{cols:"12",sm:"4"},{default:o(()=>[l(x,{autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:"Item","model-value":oe(c.item_id),readonly:"",spellcheck:"false",variant:"outlined"},null,8,["model-value"])]),_:2},1024),l(g,{cols:"12",sm:"4"},{default:o(()=>[l(x,{autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:`Quantity (${c.unit||""})`,min:"0","model-value":Ne(s,d,c.item_id),spellcheck:"false",step:"0.001",type:"number","onUpdate:modelValue":b=>Pe(s,d,c.item_id,b)},null,8,["label","model-value","onUpdate:modelValue"])]),_:2},1024),l(g,{cols:"12",sm:"4"},{default:o(()=>[l(T,{color:"primary",size:"small",variant:"flat"},{default:o(()=>e[48]||(e[48]=[i(" Required ")])),_:1})]),_:1})]),_:2},1024))),128)),pe(t,a)>0?(u(),y("div",Ut,f(pe(t,a))+" item(s) excluded from this combination ",1)):$("",!0),l(x,{modelValue:a.notes,"onUpdate:modelValue":c=>a.notes=c,autocomplete:"off",autocorrect:"off",class:"mt-2",density:"compact",inputmode:"none",label:"Notes (Optional)",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]))]),_:2},1024)]),_:2},1024))),128)),m("div",{class:st(["mt-4 text-caption font-weight-medium d-flex align-center",ce.value])},[l(p,{class:"mr-1",color:ce.value,size:"small"},{default:o(()=>e[50]||(e[50]=[i(" mdi-information ")])),_:1},8,["color"]),i(" "+f(Ae.value),1)],2)]),_:1})]),_:1}),l(ge,{class:"d-flex justify-end mt-2"},{default:o(()=>[l(_,{color:"success",disabled:E(w).$invalid||fe.value,loading:C.value,onClick:Ke},{default:o(()=>[l(p,{start:""},{default:o(()=>e[52]||(e[52]=[i("mdi-content-save")])),_:1}),i(" "+f(M.value?"Save Changes":"Add Product"),1)]),_:1},8,["disabled","loading"]),M.value?(u(),v(_,{key:0,color:"error",onClick:e[9]||(e[9]=t=>z.value=!0)},{default:o(()=>[l(p,{start:""},{default:o(()=>e[53]||(e[53]=[i("mdi-delete")])),_:1}),e[54]||(e[54]=i(" Delete "))]),_:1})):$("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(ie,{modelValue:Y.value,"onUpdate:modelValue":e[14]||(e[14]=t=>Y.value=t),"max-width":"800"},{default:o(()=>[l(U,{border:"",elevation:"0",rounded:"xl"},{default:o(()=>{var t;return[m("div",Mt,[m("div",Nt,[l(ve,{class:"mr-4",color:"white",size:"48"},{default:o(()=>[l(p,{color:"primary",icon:"mdi-silverware-fork-knife",size:"24"})]),_:1}),m("div",null,[m("div",Ot,f((t=de.value)==null?void 0:t.name),1),e[55]||(e[55]=m("div",{class:"text-body-2 text-white mt-1"}," Ingredients & Combinations ",-1))]),l(ne),l(_,{color:"white",icon:"mdi-close",size:"small",variant:"text",onClick:e[11]||(e[11]=s=>Y.value=!1)})])]),l(N,{class:"pa-0"},{default:o(()=>[l(ft,{modelValue:F.value,"onUpdate:modelValue":e[12]||(e[12]=s=>F.value=s),grow:""},{default:o(()=>[l(ke,{value:"mandatory"},{default:o(()=>e[56]||(e[56]=[i("Mandatory Ingredients")])),_:1}),l(ke,{value:"groups"},{default:o(()=>e[57]||(e[57]=[i("Ingredient Groups")])),_:1})]),_:1},8,["modelValue"]),l(pt,{modelValue:F.value,"onUpdate:modelValue":e[13]||(e[13]=s=>F.value=s)},{default:o(()=>[l(Ce,{value:"mandatory"},{default:o(()=>{var s;return[m("div",Pt,[(s=ee.value)!=null&&s.length?(u(),y("div",zt,[(u(!0),y(q,null,h(ee.value,(a,d)=>(u(),v(U,{key:a.id||d,border:"",class:"mb-3 rounded-lg",hover:"",variant:"outlined"},{default:o(()=>[l(N,{class:"pa-4"},{default:o(()=>[m("div",Dt,[m("div",St,[m("div",Gt,f(a.item_name),1),m("div",jt,[l(T,{class:"mr-2",color:"primary",size:"small",variant:"flat"},{default:o(()=>[i(f(a.quantity_per_unit)+" "+f(a.unit),1)]),_:2},1024),l(p,{class:"mr-1",color:"orange",icon:"mdi-alert-circle",size:"16"}),e[59]||(e[59]=m("span",{class:"text-caption text-grey"},"Mandatory",-1))])]),l(ve,{color:"primary",size:"32",variant:"tonal"},{default:o(()=>[m("span",It,f(d+1),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))])):(u(),y("div",Tt,[l(p,{class:"mb-3",color:"grey",icon:"mdi-food-off",size:"48"}),e[58]||(e[58]=m("div",{class:"text-h6 text-grey"},"No Mandatory Ingredients",-1))]))])]}),_:1}),l(Ce,{value:"groups"},{default:o(()=>{var s;return[m("div",Lt,[(s=te.value)!=null&&s.length?(u(),y("div",Bt,[(u(!0),y(q,null,h(te.value,a=>(u(),v(U,{key:a.id,class:"mb-4",variant:"outlined"},{default:o(()=>[l(H,{class:"bg-grey-lighten-3"},{default:o(()=>[i(f(a.name)+" ",1),l(T,{class:"ml-2",color:a.is_mandatory?"orange":"grey",size:"small"},{default:o(()=>[i(f(a.is_mandatory?"Mandatory":"Optional"),1)]),_:2},1032,["color"]),l(T,{class:"ml-2",color:"primary",size:"small"},{default:o(()=>[i(f(a.selection_mode),1)]),_:2},1024)]),_:2},1024),l(N,null,{default:o(()=>[a.description?(u(),y("div",Qt,f(a.description),1)):$("",!0),m("div",Rt,[e[61]||(e[61]=m("strong",null,"Available Options:",-1)),(u(!0),y(q,null,h(a.options,d=>(u(),v(T,{key:d.id,class:"ml-1",size:"small",variant:"outlined"},{default:o(()=>[i(f(d.item_name),1)]),_:2},1024))),128))]),m("div",null,[e[63]||(e[63]=m("strong",null,"Combinations:",-1)),(u(!0),y(q,null,h(a.combinations,d=>(u(),v(U,{key:d.id,class:"mt-2",variant:"outlined"},{default:o(()=>[l(H,{class:"text-body-2 bg-grey-lighten-4"},{default:o(()=>[i(f(d.name)+" ",1),d.is_default?(u(),v(T,{key:0,class:"ml-2",color:"green",size:"small"},{default:o(()=>e[62]||(e[62]=[i(" Default ")])),_:1})):$("",!0)]),_:2},1024),l(N,null,{default:o(()=>[(u(!0),y(q,null,h(d.quantities,c=>(u(),y("div",{key:c.option_id,class:"text-caption"}," â€¢ "+f(Me(a.options,c.item_id))+": "+f(c.quantity_per_unit),1))),128))]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024))),128))])):(u(),y("div",Ft,[l(p,{class:"mb-3",color:"grey",icon:"mdi-group",size:"48"}),e[60]||(e[60]=m("div",{class:"text-h6 text-grey"},"No Ingredient Groups",-1))]))])]}),_:1})]),_:1},8,["modelValue"])]),_:1})]}),_:1})]),_:1},8,["modelValue"]),l(ie,{modelValue:z.value,"onUpdate:modelValue":e[17]||(e[17]=t=>z.value=t),persistent:"",width:"400"},{default:o(()=>[l(U,null,{default:o(()=>[l(ye,{color:"warning",title:"Confirm Deleting "+r.name},{default:o(()=>[l(_,{color:"white",icon:"mdi-close",onClick:e[15]||(e[15]=t=>z.value=!1)})]),_:1},8,["title"]),l(N,null,{default:o(()=>[i("Are you sure you want to delete "+f(r.name)+"?",1)]),_:1}),l(ge,{class:"d-flex justify-end"},{default:o(()=>[l(_,{color:"grey",onClick:e[16]||(e[16]=t=>z.value=!1)},{default:o(()=>e[64]||(e[64]=[i("Cancel")])),_:1}),l(_,{color:"error",onClick:Ze},{default:o(()=>e[65]||(e[65]=[i("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},cl=et(Xt,[["__scopeId","data-v-17121f58"]]);export{cl as default};
