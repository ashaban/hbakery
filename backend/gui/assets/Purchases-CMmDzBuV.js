import{_ as te,r as m,$ as B,l as ae,s as C,x as l,a0 as le,a1 as oe,v as D,i as t,y as b,O as se,a2 as j,H as p,C as i,B as f,I as A,a3 as re,a4 as I,a5 as S,D as O,a6 as L,a7 as u}from"./index-Bnk5GYx6.js";import{u as de,r as w,n as ie,i as ue}from"./index-BgPRxr-N.js";import{V as ne}from"./VContainer-koWnkz3S.js";import{V as M,b as N,c as Q}from"./VCard-CKmrYMwT.js";import{V as E}from"./VCol-DN7Y7Grr.js";import{V as U}from"./VAutocomplete-GgNWZZY1.js";import{V as me,a as pe,b as fe}from"./VDataTable-DEKetQXu.js";import{V as ye}from"./VAlert-D8keRpz3.js";import{V as R}from"./VDialog-GawDINYk.js";import{V as G}from"./VForm-CZoIHhKk.js";import{V as $}from"./VTextField--7_D2srZ.js";import"./VChip-CYyzfqzx.js";import"./VSlideGroup-DPO1REek.js";import"./dialog-transition-BvwwzNa3.js";const ve={class:"d-flex align-center"},ge={class:"d-flex justify-space-between mb-4"},Ve={class:"d-flex justify-end align-center mt-4"},ce=10,be={__name:"Purchases",setup($e){const v=le(),_=m(!1),y=m(!1),T=m([]),q=m([]),V=m(!1),c=m(!1),k=m(null),x=m(1),F=m(1),P=B({total_quantity:"",total_amount:""}),s=B({item_id:"",quantity:"",price:"",date:""}),d=de({item_id:{required:w},quantity:{required:w,integer:ue},price:{required:w,numeric:ie},date:{required:w}},s),z=[{label:"Equals (=)",value:"="},{label:"Greater Than (>)",value:">"},{label:"Less Than (<)",value:"<"},{label:"Greater or Equal (>=)",value:">="},{label:"Less or Equal (<=)",value:"<="},{label:"In Range",value:"in"}],r=B({item_id:"",date_operator:"",date:"",date_from:"",date_to:""}),H=[{title:"Item",key:"item_name"},{title:"Quantity",key:"quantity"},{title:"Unit Price",key:"price"},{title:"Amount",key:"total"},{title:"Date",key:"date"},{title:"Edit",key:"edit"}];async function g(){_.value=!0;const o=new URLSearchParams({page:x.value,limit:ce});if(r.item_id&&o.append("item_id",r.item_id),r.date_operator&&r.date_operator!=="in"&&r.date){const e={"=":"date",">":"date_gt","<":"date_lt",">=":"date_from","<=":"date_to"};o.append(e[r.date_operator],r.date)}r.date_operator==="in"&&r.date_from&&r.date_to&&(o.append("date_from",r.date_from),o.append("date_to",r.date_to));try{const n=await(await fetch(`/purchases?${o}`)).json();T.value=n.data,F.value=n.totalPages,P.total_quantity=n.total_quantity,P.total_amount=n.total_amount}catch{v.commit("setMessage",{type:"error",text:"Failed to load purchases"})}finally{_.value=!1}}async function J(){const o=await fetch("/items");q.value=await o.json()}function K(){x.value=1,g()}function W(){Object.assign(r,{item_id:"",date_operator:"",date:"",date_from:"",date_to:""}),x.value=1,g()}function X(){Object.assign(s,{item_id:"",quantity:"",price:"",date:""}),d.value.$reset(),V.value=!0}function Y(o){var e,n,a;Object.assign(s,{item_id:o.item_id,quantity:o.quantity.replace(/,/g,""),price:o.price.replace(/,/g,""),date:(a=(n=(e=o==null?void 0:o.date)==null?void 0:e.split("-"))==null?void 0:n.reverse())==null?void 0:a.join("-")}),k.value=o.id,d.value.$reset(),c.value=!0}async function Z(){if(d.value.$touch(),d.value.$invalid)return;y.value=!0;const o=new FormData;o.append("item_id",s.item_id),o.append("quantity",s.quantity),o.append("price",s.price),o.append("date",s.date);try{await fetch("/purchases",{method:"POST",body:o}),v.commit("setMessage",{type:"success",text:"Purchase added successfully!"}),V.value=!1,g()}catch{v.commit("setMessage",{type:"error",text:"Failed to add purchase"})}finally{y.value=!1}}async function h(){if(d.value.$touch(),d.value.$invalid)return;y.value=!0;const o=new FormData;o.append("item_id",s.item_id),o.append("quantity",s.quantity),o.append("price",s.price),o.append("date",s.date);try{await fetch(`/purchases/${k.value}`,{method:"PUT",body:o}),v.commit("setMessage",{type:"success",text:"Purchase updated!"}),c.value=!1,g()}catch{v.commit("setMessage",{type:"error",text:"Failed to update purchase"})}finally{y.value=!1}}async function ee(){if(confirm("Are you sure you want to delete this purchase?")){y.value=!0;try{await fetch(`/purchases/${k.value}`,{method:"DELETE"}),v.commit("setMessage",{type:"success",text:"Purchase deleted!"}),c.value=!1,g()}catch{v.commit("setMessage",{type:"error",text:"Failed to delete purchase"})}finally{y.value=!1}}}return ae(()=>{g(),J()}),(o,e)=>{const n=oe("VueDatePicker");return D(),C(ne,{fluid:""},{default:l(()=>[t(M,{class:"pa-4 mb-4"},{default:l(()=>[t(se,{dense:""},{default:l(()=>[t(E,{cols:"12",sm:"3"},{default:l(()=>[t(U,{modelValue:r.item_id,"onUpdate:modelValue":e[0]||(e[0]=a=>r.item_id=a),items:q.value,"item-title":"name","item-value":"id",label:"Filter by Item",clearable:""},null,8,["modelValue","items"])]),_:1}),t(E,{cols:"12",sm:"2"},{default:l(()=>[t(me,{modelValue:r.date_operator,"onUpdate:modelValue":e[1]||(e[1]=a=>r.date_operator=a),items:z,"item-title":"label","item-value":"value",label:"Date Filter",clearable:""},null,8,["modelValue"])]),_:1}),r.date_operator&&r.date_operator!=="in"?(D(),C(E,{key:0,cols:"12",sm:"3"},{default:l(()=>[t(n,{modelValue:r.date,"onUpdate:modelValue":e[2]||(e[2]=a=>r.date=a),"auto-apply":"",teleport:!0,class:"rounded-lg border px-4 py-2",placeholder:"Select Date","model-type":"yyyy-MM-dd",format:"dd-MM-yyyy"},null,8,["modelValue"])]),_:1})):j("",!0),r.date_operator==="in"?(D(),C(E,{key:1,cols:"12",sm:"4"},{default:l(()=>[b("div",ve,[t(n,{modelValue:r.date_from,"onUpdate:modelValue":e[3]||(e[3]=a=>r.date_from=a),"auto-apply":"",teleport:!0,class:"rounded-lg border px-4 py-2",placeholder:"From Date","model-type":"yyyy-MM-dd",format:"dd-MM-yyyy"},null,8,["modelValue"]),t(n,{modelValue:r.date_to,"onUpdate:modelValue":e[4]||(e[4]=a=>r.date_to=a),"auto-apply":"",teleport:!0,class:"rounded-lg border px-4 py-2",placeholder:"To Date","model-type":"yyyy-MM-dd",format:"dd-MM-yyyy"},null,8,["modelValue"])])]),_:1})):j("",!0),t(E,{cols:"12",class:"d-flex justify-end"},{default:l(()=>[t(p,{color:"primary",onClick:K},{default:l(()=>[t(f,{start:""},{default:l(()=>e[21]||(e[21]=[i("mdi-filter")])),_:1}),e[22]||(e[22]=i(" Apply "))]),_:1}),t(p,{class:"ml-2",color:"grey",onClick:W},{default:l(()=>[t(f,{start:""},{default:l(()=>e[23]||(e[23]=[i("mdi-refresh")])),_:1}),e[24]||(e[24]=i(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),t(ye,{type:"info",class:"mb-4",border:"start",variant:"outlined"},{default:l(()=>[e[25]||(e[25]=b("strong",null,"Total Quantity:",-1)),i(" "+A(P.total_quantity||"0")+" | ",1),e[26]||(e[26]=b("strong",null,"Total Amount:",-1)),i(" "+A(P.total_amount||"0.00"),1)]),_:1}),b("div",ge,[e[29]||(e[29]=b("h3",null,"Items Purchased",-1)),t(p,{color:"primary",size:"large",onClick:X,class:"px-6",elevation:"2"},{default:l(()=>[t(f,{start:""},{default:l(()=>e[27]||(e[27]=[i("mdi-plus")])),_:1}),e[28]||(e[28]=i(" Add Purchase "))]),_:1})]),t(re,{active:_.value,indeterminate:_.value},null,8,["active","indeterminate"]),t(pe,{class:"elevation-1",dense:"",headers:H,items:T.value,loading:_.value,height:"400"},{"item.edit":l(({item:a})=>[t(f,{color:"primary",onClick:xe=>Y(a)},{default:l(()=>e[30]||(e[30]=[i("mdi-square-edit-outline")])),_:2},1032,["onClick"])]),_:1},8,["items","loading"]),b("div",Ve,[t(fe,{modelValue:x.value,"onUpdate:modelValue":[e[5]||(e[5]=a=>x.value=a),g],length:F.value,"total-visible":"7"},null,8,["modelValue","length"])]),t(R,{modelValue:V.value,"onUpdate:modelValue":e[13]||(e[13]=a=>V.value=a),"max-width":"600",transition:"dialog-top-transition"},{default:l(()=>[t(M,{class:"pa-4 rounded-xl",elevation:"10"},{default:l(()=>[t(I,{color:"primary",flat:"",class:"rounded-lg"},{default:l(()=>[t(S,{class:"text-white font-weight-bold"},{default:l(()=>[t(f,{start:"",class:"mr-2 text-white"},{default:l(()=>e[31]||(e[31]=[i("mdi-cart-plus")])),_:1}),e[32]||(e[32]=i(" Add Purchase "))]),_:1}),t(O),t(p,{icon:"mdi-close",color:"white",onClick:e[6]||(e[6]=a=>V.value=!1)})]),_:1}),t(N,{class:"pt-6"},{default:l(()=>[t(G,{onSubmit:e[11]||(e[11]=L(()=>{},["prevent"]))},{default:l(()=>[t(U,{modelValue:s.item_id,"onUpdate:modelValue":e[7]||(e[7]=a=>s.item_id=a),items:q.value,"item-title":"name","item-value":"id",label:"Item","bg-color":"#E0E0E0","error-messages":u(d).item_id.$errors.map(a=>a.$message),onBlur:u(d).item_id.$touch},null,8,["modelValue","items","error-messages","onBlur"]),t($,{modelValue:s.quantity,"onUpdate:modelValue":e[8]||(e[8]=a=>s.quantity=a),label:"Quantity",type:"number","bg-color":"#E0E0E0","error-messages":u(d).quantity.$errors.map(a=>a.$message),onBlur:u(d).quantity.$touch},null,8,["modelValue","error-messages","onBlur"]),t($,{modelValue:s.price,"onUpdate:modelValue":e[9]||(e[9]=a=>s.price=a),label:"Unit Price",type:"number","bg-color":"#E0E0E0","error-messages":u(d).price.$errors.map(a=>a.$message),onBlur:u(d).price.$touch},null,8,["modelValue","error-messages","onBlur"]),t($,{modelValue:s.date,"onUpdate:modelValue":e[10]||(e[10]=a=>s.date=a),label:"Purchase Date",type:"date","bg-color":"#E0E0E0","error-messages":u(d).date.$errors.map(a=>a.$message),onBlur:u(d).date.$touch},null,8,["modelValue","error-messages","onBlur"])]),_:1})]),_:1}),t(Q,{class:"d-flex justify-end"},{default:l(()=>[t(p,{color:"grey",onClick:e[12]||(e[12]=a=>V.value=!1)},{default:l(()=>e[33]||(e[33]=[i("Cancel")])),_:1}),t(p,{color:"success",loading:y.value,disabled:u(d).$invalid,onClick:Z},{default:l(()=>[t(f,{start:""},{default:l(()=>e[34]||(e[34]=[i("mdi-plus")])),_:1}),e[35]||(e[35]=i(" Add "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:c.value,"onUpdate:modelValue":e[20]||(e[20]=a=>c.value=a),"max-width":"600",transition:"dialog-top-transition"},{default:l(()=>[t(M,{class:"pa-4 rounded-xl",elevation:"10"},{default:l(()=>[t(I,{color:"primary",flat:"",class:"rounded-lg"},{default:l(()=>[t(S,{class:"text-white font-weight-bold"},{default:l(()=>[t(f,{start:"",class:"mr-2 text-white"},{default:l(()=>e[36]||(e[36]=[i("mdi-cart-edit")])),_:1}),e[37]||(e[37]=i(" Edit Purchase "))]),_:1}),t(O),t(p,{icon:"mdi-close",color:"white",onClick:e[14]||(e[14]=a=>c.value=!1)})]),_:1}),t(N,{class:"pt-6"},{default:l(()=>[t(G,{onSubmit:e[19]||(e[19]=L(()=>{},["prevent"]))},{default:l(()=>[t(U,{modelValue:s.item_id,"onUpdate:modelValue":e[15]||(e[15]=a=>s.item_id=a),items:q.value,"item-title":"name","item-value":"id",label:"Item","bg-color":"#E0E0E0","error-messages":u(d).item_id.$errors.map(a=>a.$message),onBlur:u(d).item_id.$touch},null,8,["modelValue","items","error-messages","onBlur"]),t($,{modelValue:s.quantity,"onUpdate:modelValue":e[16]||(e[16]=a=>s.quantity=a),label:"Quantity",type:"number","bg-color":"#E0E0E0","error-messages":u(d).quantity.$errors.map(a=>a.$message),onBlur:u(d).quantity.$touch},null,8,["modelValue","error-messages","onBlur"]),t($,{modelValue:s.price,"onUpdate:modelValue":e[17]||(e[17]=a=>s.price=a),label:"Unit Price",type:"number","bg-color":"#E0E0E0","error-messages":u(d).price.$errors.map(a=>a.$message),onBlur:u(d).price.$touch},null,8,["modelValue","error-messages","onBlur"]),t($,{modelValue:s.date,"onUpdate:modelValue":e[18]||(e[18]=a=>s.date=a),label:"Purchase Date",type:"date","bg-color":"#E0E0E0","error-messages":u(d).date.$errors.map(a=>a.$message),onBlur:u(d).date.$touch},null,8,["modelValue","error-messages","onBlur"])]),_:1})]),_:1}),t(Q,{class:"d-flex justify-end"},{default:l(()=>[t(p,{color:"error",onClick:ee},{default:l(()=>[t(f,{start:""},{default:l(()=>e[38]||(e[38]=[i("mdi-delete")])),_:1}),e[39]||(e[39]=i(" Delete "))]),_:1}),t(p,{color:"success",loading:y.value,disabled:u(d).$invalid,onClick:h},{default:l(()=>[t(f,{start:""},{default:l(()=>e[40]||(e[40]=[i("mdi-content-save")])),_:1}),e[41]||(e[41]=i(" Save "))]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},Ie=te(be,[["__scopeId","data-v-5be4cba2"]]);export{Ie as default};
