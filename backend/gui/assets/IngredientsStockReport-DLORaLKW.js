import{_ as E,r as V,d as N,$,k as q,a1 as G,q as H,t as v,v as a,h as l,x as n,G as I,B as r,A as p,N as F,z as B,H as i,ae as Q,D as k,Z as h}from"./index-CFxNg9uJ.js";import{V as w,b as R}from"./VCard-BQ-DhCkd.js";import{V as y}from"./VCol-C0ldTlhK.js";import{V as Y}from"./VAutocomplete-CzTBzbuU.js";import{V as Z}from"./VSwitch-K3VFLXq9.js";import{e as J}from"./VDataTable-IMEHFo_q.js";import{V as j}from"./VChip-rVt3DcTt.js";import{V as K}from"./VContainer-B8YNpke-.js";import"./VTextField-CnoLtJNk.js";import"./dialog-transition-uascmPkt.js";import"./VSlideGroup-Bq37CusN.js";const W={class:"d-flex align-center justify-space-between"},X={class:"d-flex gap-2"},ee={class:"d-flex align-center gap-2"},te={class:"d-flex align-center"},ae={class:"text-h6"},le={class:"d-flex align-center"},ne={class:"text-h6 text-success"},se={class:"d-flex align-center"},oe={class:"text-h6 text-error"},ie={class:"d-flex align-center"},re={class:"text-h6"},de={class:"d-flex flex-column"},ue={class:"font-weight-medium"},ce={class:"d-flex align-center mt-1"},me={key:2,class:"text-caption text-grey"},_e={class:"d-flex flex-column align-end"},pe={key:0,class:"text-caption text-grey"},ge={class:"d-flex flex-column align-end"},fe={class:"text-success"},be={key:0,class:"text-caption text-grey"},ve={class:"d-flex flex-column align-end"},ye={class:"text-error"},we={key:0,class:"text-caption text-grey"},xe={class:"d-flex flex-column align-end"},Ve={key:0,class:"text-caption text-grey"},ke={class:"text-center py-8"},he={__name:"IngredientsStockReport",setup(Ce){const m=V(!1),C=V(!1),_=V([]),g=V(!0),A=[{title:"Ingredient",key:"item_name",sortable:!0},{title:"Opening",key:"opening_balance",align:"end",sortable:!0},{title:"Inwards",key:"inwards",align:"end",sortable:!0},{title:"Outwards",key:"outwards",align:"end",sortable:!0},{title:"Closing",key:"closing_balance",align:"end",sortable:!0},{title:"Opening Value",key:"total_price_opening",align:"end",sortable:!0},{title:"Inwards Value",key:"total_price_inwards",align:"end",sortable:!0},{title:"Outwards Value",key:"total_price_outwards",align:"end",sortable:!0},{title:"Closing Value",key:"total_price_closing",align:"end",sortable:!0}],L=N(()=>g.value?[{title:"Ingredient",key:"item_name",sortable:!0},{title:"Opening (Base/Human)",key:"opening_balance",align:"end",sortable:!0},{title:"Inwards (Base/Human)",key:"inwards",align:"end",sortable:!0},{title:"Outwards (Base/Human)",key:"outwards",align:"end",sortable:!0},{title:"Closing (Base/Human)",key:"closing_balance",align:"end",sortable:!0},{title:"Opening Value",key:"total_price_opening",align:"end",sortable:!0},{title:"Inwards Value",key:"total_price_inwards",align:"end",sortable:!0},{title:"Outwards Value",key:"total_price_outwards",align:"end",sortable:!0},{title:"Closing Value",key:"total_price_closing",align:"end",sortable:!0}]:A),x=$({items:[]}),c=$({start:new Date().toISOString().split("T")[0],end:new Date().toISOString().split("T")[0]}),D=V([]),S=N(()=>{const s=t=>_.value.reduce((u,o)=>u+(Number(o[t])||0),0),e=t=>_.value.reduce((u,o)=>u+(Number(o[`${t}_human`])||0),0),d=t=>_.value.reduce((u,o)=>u+(Number(o[`total_price_${t}`])||0),0);return{opening:s("opening_balance"),opening_human:e("opening_balance"),inwards:s("inwards"),inwards_human:e("inwards"),outwards:s("outwards"),outwards_human:e("outwards"),closing:s("closing_balance"),closing_human:e("closing_balance"),opening_value:d("opening"),inwards_value:d("inwards"),outwards_value:d("outwards"),closing_value:d("closing")}});function f(s){return Number(s??0).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6})}function b(s){return`TSh ${Number(s??0).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}`}async function z(){C.value=!0;try{const e=await(await fetch("/items?limit=10000&page=1")).json();D.value=Array.isArray(e)?e:e.data||[]}catch(s){console.error("Failed to load items",s),D.value=[]}finally{C.value=!1}}function T(){const s=new URLSearchParams;if(c.start&&s.append("start_date",U(c.start)),c.end&&s.append("end_date",U(c.end)),x.items&&x.items.length)for(const e of x.items)s.append("items",e);return s.toString()}function U(s){const e=new Date(s),d=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${d}-${t}-${u}`}async function O(){m.value=!0;try{const s=T(),d=await(await fetch(`/reports/stockStatus?${s}`)).json();_.value=d.data||[]}catch(s){console.error("Failed to load report",s),_.value=[]}finally{m.value=!1}}function M(){x.items=[],c.start=null,c.end=null,O()}function P(){if(!_.value.length)return;const e=[["Ingredient","Base Unit","Human Readable Unit","Opening Balance","Opening Balance (Human)","Inwards","Inwards (Human)","Outwards","Outwards (Human)","Closing Balance","Closing Balance (Human)","Opening Value","Inwards Value","Outwards Value","Closing Value"].join(",")];for(const o of _.value)e.push([`"${(o.item_name||"").replace(/"/g,'""')}"`,`"${o.base_unit||""}"`,`"${o.human_readable_unit||""}"`,o.opening_balance??0,o.opening_balance_human??0,o.inwards??0,o.inwards_human??0,o.outwards??0,o.outwards_human??0,o.closing_balance??0,o.closing_balance_human??0,o.total_price_opening??0,o.total_price_inwards??0,o.total_price_outwards??0,o.total_price_closing??0].join(","));const d=new Blob([e.join(`
`)],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(d),u=document.createElement("a");u.href=t,u.download=`stock_status_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(t)}return q(async()=>{await z(),await O()}),(s,e)=>{const d=G("VueDatePicker");return v(),H(K,{class:"stock-report",fluid:""},{default:a(()=>[l(w,{class:"mb-6",elevation:"2",rounded:"lg"},{default:a(()=>[l(R,{class:"pa-6"},{default:a(()=>[n("div",W,[e[8]||(e[8]=n("div",null,[n("h1",{class:"text-h5 text-primary font-weight-bold mb-1"}," Stock Status Report "),n("div",{class:"text-body-2 text-grey"}," Opening balance, inwards, outwards & closing by ingredient ")],-1)),n("div",X,[l(I,{color:"primary",disabled:!_.value.length||m.value,variant:"outlined",onClick:P},{default:a(()=>[l(p,{start:""},{default:a(()=>e[4]||(e[4]=[r("mdi-file-delimited-outline")])),_:1}),e[5]||(e[5]=r(" Export CSV "))]),_:1},8,["disabled"]),l(I,{color:"primary",loading:m.value,onClick:O},{default:a(()=>[l(p,{start:""},{default:a(()=>e[6]||(e[6]=[r("mdi-filter")])),_:1}),e[7]||(e[7]=r(" Apply "))]),_:1},8,["loading"])])])]),_:1})]),_:1}),l(w,{class:"mb-4",elevation:"1",rounded:"lg"},{default:a(()=>[l(R,null,{default:a(()=>[l(F,{dense:""},{default:a(()=>[l(y,{cols:"12",md:"6"},{default:a(()=>[e[9]||(e[9]=n("div",{class:"text-caption text-grey mb-1"},"Date Range",-1)),n("div",ee,[l(d,{modelValue:c.start,"onUpdate:modelValue":e[0]||(e[0]=t=>c.start=t),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100",format:"dd-MM-yyyy",placeholder:"From date",teleport:!0},null,8,["modelValue"]),l(d,{modelValue:c.end,"onUpdate:modelValue":e[1]||(e[1]=t=>c.end=t),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100",format:"dd-MM-yyyy",placeholder:"To date",teleport:!0},null,8,["modelValue"])])]),_:1}),l(y,{cols:"12",md:"6"},{default:a(()=>[l(Y,{modelValue:x.items,"onUpdate:modelValue":e[2]||(e[2]=t=>x.items=t),chips:"",clearable:"","closable-chips":"",color:"primary",disabled:C.value,"item-title":"name","item-value":"id",items:D.value,label:"Ingredients",loading:C.value,multiple:"",variant:"outlined"},null,8,["modelValue","disabled","items","loading"])]),_:1}),l(y,{cols:"12",md:"6"},{default:a(()=>[l(Z,{modelValue:g.value,"onUpdate:modelValue":e[3]||(e[3]=t=>g.value=t),color:"primary","hide-details":"",label:"Show Human Readable Units"},null,8,["modelValue"])]),_:1}),l(y,{class:"d-flex justify-end",cols:"12"},{default:a(()=>[l(I,{color:"primary",loading:m.value,onClick:O},{default:a(()=>[l(p,{start:""},{default:a(()=>e[10]||(e[10]=[r("mdi-filter")])),_:1}),e[11]||(e[11]=r(" Apply "))]),_:1},8,["loading"]),l(I,{class:"ml-2",color:"grey",disabled:m.value,variant:"tonal",onClick:M},{default:a(()=>[l(p,{start:""},{default:a(()=>e[12]||(e[12]=[r("mdi-refresh")])),_:1}),e[13]||(e[13]=r(" Reset "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(F,{class:"mb-4"},{default:a(()=>[l(y,{cols:"12",md:"3",sm:"6"},{default:a(()=>[l(w,{border:"",class:"pa-3",elevation:"1"},{default:a(()=>[n("div",te,[l(B,{class:"mr-3",color:"blue-lighten-5",size:"44"},{default:a(()=>[l(p,{color:"blue"},{default:a(()=>e[14]||(e[14]=[r("mdi-database-arrow-left")])),_:1})]),_:1}),n("div",null,[e[15]||(e[15]=n("div",{class:"text-caption text-grey"},"Opening Value",-1)),n("div",ae,i(b(S.value.opening_value)),1)])])]),_:1})]),_:1}),l(y,{cols:"12",md:"3",sm:"6"},{default:a(()=>[l(w,{border:"",class:"pa-3",elevation:"1"},{default:a(()=>[n("div",le,[l(B,{class:"mr-3",color:"green-lighten-5",size:"44"},{default:a(()=>[l(p,{color:"green"},{default:a(()=>e[16]||(e[16]=[r("mdi-tray-arrow-down")])),_:1})]),_:1}),n("div",null,[e[17]||(e[17]=n("div",{class:"text-caption text-grey"},"Inwards Value",-1)),n("div",ne,i(b(S.value.inwards_value)),1)])])]),_:1})]),_:1}),l(y,{cols:"12",md:"3",sm:"6"},{default:a(()=>[l(w,{border:"",class:"pa-3",elevation:"1"},{default:a(()=>[n("div",se,[l(B,{class:"mr-3",color:"red-lighten-5",size:"44"},{default:a(()=>[l(p,{color:"red"},{default:a(()=>e[18]||(e[18]=[r("mdi-tray-arrow-up")])),_:1})]),_:1}),n("div",null,[e[19]||(e[19]=n("div",{class:"text-caption text-grey"},"Outwards Value",-1)),n("div",oe,i(b(S.value.outwards_value)),1)])])]),_:1})]),_:1}),l(y,{cols:"12",md:"3",sm:"6"},{default:a(()=>[l(w,{border:"",class:"pa-3",elevation:"1"},{default:a(()=>[n("div",ie,[l(B,{class:"mr-3",color:"purple-lighten-5",size:"44"},{default:a(()=>[l(p,{color:"purple"},{default:a(()=>e[20]||(e[20]=[r("mdi-scale-balance")])),_:1})]),_:1}),n("div",null,[e[21]||(e[21]=n("div",{class:"text-caption text-grey"},"Closing Value",-1)),n("div",re,i(b(S.value.closing_value)),1)])])]),_:1})]),_:1})]),_:1}),l(Q,{active:m.value,color:"primary",height:"3",indeterminate:m.value},null,8,["active","indeterminate"]),l(w,{elevation:"1",rounded:"lg"},{default:a(()=>[l(R,{class:"pa-0"},{default:a(()=>[l(J,{class:"elevation-0",density:"comfortable",headers:L.value,"item-key":"item_id",items:_.value,loading:m.value},{"item.item_name":a(({item:t})=>[n("div",de,[n("span",ue,i(t.item_name),1),n("div",ce,[t.human_readable_unit?(v(),H(j,{key:0,class:"mr-1",color:"primary",size:"x-small",variant:"outlined"},{default:a(()=>[r(i(t.base_unit),1)]),_:2},1024)):h("",!0),t.human_readable_unit&&g.value?(v(),H(j,{key:1,color:"green",size:"x-small",variant:"outlined"},{default:a(()=>[r(i(t.human_readable_unit),1)]),_:2},1024)):(v(),k("span",me,i(t.unit_label||t.base_unit),1))])])]),"item.opening_balance":a(({item:t})=>[n("div",_e,[n("span",null,i(f(t.opening_balance)),1),g.value&&t.human_readable_unit?(v(),k("span",pe,i(f(t.opening_balance_human)),1)):h("",!0)])]),"item.inwards":a(({item:t})=>[n("div",ge,[n("span",fe,i(f(t.inwards)),1),g.value&&t.human_readable_unit?(v(),k("span",be,i(f(t.inwards_human)),1)):h("",!0)])]),"item.outwards":a(({item:t})=>[n("div",ve,[n("span",ye,i(f(t.outwards)),1),g.value&&t.human_readable_unit?(v(),k("span",we,i(f(t.outwards_human)),1)):h("",!0)])]),"item.closing_balance":a(({item:t})=>[n("div",xe,[n("strong",null,i(f(t.closing_balance)),1),g.value&&t.human_readable_unit?(v(),k("span",Ve,i(f(t.closing_balance_human)),1)):h("",!0)])]),"item.total_price_opening":a(({item:t})=>[r(i(b(t.total_price_opening)),1)]),"item.total_price_inwards":a(({item:t})=>[r(i(b(t.total_price_inwards)),1)]),"item.total_price_outwards":a(({item:t})=>[r(i(b(t.total_price_outwards)),1)]),"item.total_price_closing":a(({item:t})=>[r(i(b(t.total_price_closing)),1)]),"no-data":a(()=>[n("div",ke,[l(p,{class:"mb-2",color:"grey-lighten-2",size:"64"},{default:a(()=>e[22]||(e[22]=[r("mdi-database-off")])),_:1}),e[23]||(e[23]=n("div",{class:"text-subtitle-1 text-grey"}," No data for selected filters ",-1)),e[24]||(e[24]=n("div",{class:"text-body-2 text-grey"}," Adjust filters and try again. ",-1))])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1})}}},je=E(he,[["__scopeId","data-v-8a7cd9dd"]]);export{je as default};
