import{_ as $,r as V,$ as j,e as B,l as M,a1 as h,s as z,v as P,x as t,i as a,y as l,H as k,C as n,B as m,O as D,A as C,I as i,aH as T}from"./index-Bm_1tDB1.js";import{V as v,b as O}from"./VCard-rPQh7TtY.js";import{V as y}from"./VCol-Cxhy3hua.js";import{V as E}from"./VAutocomplete-BZ1xi2_X.js";import{a as H}from"./VDataTable-BBB9e339.js";import{V as S}from"./VChip-BaMa1hN2.js";import{V as q}from"./VContainer-BKK7VQkU.js";import"./VTextField-CkPOq7cJ.js";import"./dialog-transition-DpdgYHbX.js";import"./VSlideGroup-BuwiiylY.js";const Q={class:"d-flex align-center justify-space-between"},Y={class:"d-flex gap-2"},G={class:"d-flex align-center gap-2"},J={class:"d-flex align-center"},K={class:"text-h6"},W={class:"d-flex align-center"},X={class:"text-h6 text-success"},Z={class:"d-flex align-center"},ee={class:"text-h6 text-error"},te={class:"d-flex align-center"},ae={class:"text-h6"},le={class:"text-success"},se={class:"text-error"},oe={class:"px-4 py-3 d-flex justify-end"},ne={class:"text-center py-8"},re={__name:"IngredientsStockReport",setup(ie){const c=V(!1),x=V(!1),f=V([]),A=[{title:"Ingredient",key:"item_name",sortable:!0},{title:"Opening",key:"opening_balance",align:"end",sortable:!0},{title:"Inwards",key:"inwards",align:"end",sortable:!0},{title:"Outwards",key:"outwards",align:"end",sortable:!0},{title:"Closing",key:"closing_balance",align:"end",sortable:!0}],b=j({items:[]}),d=j({start:null,end:null}),I=V([]),p=B(()=>{const s=e=>f.value.reduce((u,o)=>u+(Number(o[e])||0),0);return{opening:s("opening_balance"),inwards:s("inwards"),outwards:s("outwards"),closing:s("closing_balance")}});function r(s){return Number(s??0).toLocaleString(void 0,{maximumFractionDigits:3})}async function F(){x.value=!0;try{const e=await(await fetch("/items?limit=10000&page=1")).json();I.value=Array.isArray(e)?e:e.data||[]}catch(s){console.error("Failed to load items",s),I.value=[]}finally{x.value=!1}}function L(){const s=new URLSearchParams;if(d.start&&s.append("start_date",R(d.start)),d.end&&s.append("end_date",R(d.end)),b.items&&b.items.length)for(const e of b.items)s.append("items",e);return s.toString()}function R(s){const e=new Date(s),u=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),g=String(e.getDate()).padStart(2,"0");return`${u}-${o}-${g}`}async function w(){c.value=!0;try{const s=L(),u=await(await fetch(`/reports/stockStatus?${s}`)).json();f.value=u.data||[]}catch(s){console.error("Failed to load report",s),f.value=[]}finally{c.value=!1}}function U(){b.items=[],d.start=null,d.end=null,w()}function N(){if(!f.value.length)return;const e=[["Ingredient","Opening","Inwards","Outwards","Closing"].join(",")];for(const _ of f.value)e.push([`"${(_.item_name||"").replace(/"/g,'""')}"`,_.opening_balance??0,_.inwards??0,_.outwards??0,_.closing_balance??0].join(","));const u=new Blob([e.join(`
`)],{type:"text/csv;charset=utf-8;"}),o=URL.createObjectURL(u),g=document.createElement("a");g.href=o,g.download=`stock_status_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(o)}return M(async()=>{await F(),await w()}),(s,e)=>{const u=h("VueDatePicker");return P(),z(q,{fluid:"",class:"stock-report"},{default:t(()=>[a(v,{class:"mb-6",elevation:"2",rounded:"lg"},{default:t(()=>[a(O,{class:"pa-6"},{default:t(()=>[l("div",Q,[e[7]||(e[7]=l("div",null,[l("h1",{class:"text-h5 text-primary font-weight-bold mb-1"},"Stock Status Report"),l("div",{class:"text-body-2 text-grey"},"Opening balance, inwards, outwards & closing by ingredient")],-1)),l("div",Y,[a(k,{variant:"outlined",color:"primary",onClick:N,disabled:!f.value.length||c.value},{default:t(()=>[a(m,{start:""},{default:t(()=>e[3]||(e[3]=[n("mdi-file-delimited-outline")])),_:1}),e[4]||(e[4]=n(" Export CSV "))]),_:1},8,["disabled"]),a(k,{color:"primary",onClick:w,loading:c.value},{default:t(()=>[a(m,{start:""},{default:t(()=>e[5]||(e[5]=[n("mdi-filter")])),_:1}),e[6]||(e[6]=n(" Apply "))]),_:1},8,["loading"])])])]),_:1})]),_:1}),a(v,{class:"mb-4",elevation:"1",rounded:"lg"},{default:t(()=>[a(O,null,{default:t(()=>[a(D,{dense:""},{default:t(()=>[a(y,{cols:"12",md:"6"},{default:t(()=>[e[8]||(e[8]=l("div",{class:"text-caption text-grey mb-1"},"Date Range",-1)),l("div",G,[a(u,{modelValue:d.start,"onUpdate:modelValue":e[0]||(e[0]=o=>d.start=o),teleport:!0,"auto-apply":"",format:"dd-MM-yyyy",placeholder:"From date",class:"rounded-lg border px-4 py-2 w-100"},null,8,["modelValue"]),a(u,{modelValue:d.end,"onUpdate:modelValue":e[1]||(e[1]=o=>d.end=o),teleport:!0,"auto-apply":"",format:"dd-MM-yyyy",placeholder:"To date",class:"rounded-lg border px-4 py-2 w-100"},null,8,["modelValue"])])]),_:1}),a(y,{cols:"12",md:"6"},{default:t(()=>[a(E,{modelValue:b.items,"onUpdate:modelValue":e[2]||(e[2]=o=>b.items=o),items:I.value,"item-title":"name","item-value":"id",label:"Ingredients",variant:"outlined",color:"primary",chips:"","closable-chips":"",multiple:"",clearable:"",loading:x.value,disabled:x.value},null,8,["modelValue","items","loading","disabled"])]),_:1}),a(y,{cols:"12",class:"d-flex justify-end"},{default:t(()=>[a(k,{color:"primary",onClick:w,loading:c.value},{default:t(()=>[a(m,{start:""},{default:t(()=>e[9]||(e[9]=[n("mdi-filter")])),_:1}),e[10]||(e[10]=n(" Apply "))]),_:1},8,["loading"]),a(k,{class:"ml-2",color:"grey",variant:"tonal",onClick:U,disabled:c.value},{default:t(()=>[a(m,{start:""},{default:t(()=>e[11]||(e[11]=[n("mdi-refresh")])),_:1}),e[12]||(e[12]=n(" Reset "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),a(D,{class:"mb-4"},{default:t(()=>[a(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[a(v,{border:"",elevation:"1",class:"pa-3"},{default:t(()=>[l("div",J,[a(C,{color:"blue-lighten-5",size:"44",class:"mr-3"},{default:t(()=>[a(m,{color:"blue"},{default:t(()=>e[13]||(e[13]=[n("mdi-database-arrow-left")])),_:1})]),_:1}),l("div",null,[e[14]||(e[14]=l("div",{class:"text-caption text-grey"},"Opening",-1)),l("div",K,i(r(p.value.opening)),1)])])]),_:1})]),_:1}),a(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[a(v,{border:"",elevation:"1",class:"pa-3"},{default:t(()=>[l("div",W,[a(C,{color:"green-lighten-5",size:"44",class:"mr-3"},{default:t(()=>[a(m,{color:"green"},{default:t(()=>e[15]||(e[15]=[n("mdi-tray-arrow-down")])),_:1})]),_:1}),l("div",null,[e[16]||(e[16]=l("div",{class:"text-caption text-grey"},"Inwards",-1)),l("div",X,i(r(p.value.inwards)),1)])])]),_:1})]),_:1}),a(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[a(v,{border:"",elevation:"1",class:"pa-3"},{default:t(()=>[l("div",Z,[a(C,{color:"red-lighten-5",size:"44",class:"mr-3"},{default:t(()=>[a(m,{color:"red"},{default:t(()=>e[17]||(e[17]=[n("mdi-tray-arrow-up")])),_:1})]),_:1}),l("div",null,[e[18]||(e[18]=l("div",{class:"text-caption text-grey"},"Outwards",-1)),l("div",ee,i(r(p.value.outwards)),1)])])]),_:1})]),_:1}),a(y,{cols:"12",sm:"6",md:"3"},{default:t(()=>[a(v,{border:"",elevation:"1",class:"pa-3"},{default:t(()=>[l("div",te,[a(C,{color:"purple-lighten-5",size:"44",class:"mr-3"},{default:t(()=>[a(m,{color:"purple"},{default:t(()=>e[19]||(e[19]=[n("mdi-scale-balance")])),_:1})]),_:1}),l("div",null,[e[20]||(e[20]=l("div",{class:"text-caption text-grey"},"Closing",-1)),l("div",ae,i(r(p.value.closing)),1)])])]),_:1})]),_:1})]),_:1}),a(T,{active:c.value,indeterminate:c.value,color:"primary",height:"3"},null,8,["active","indeterminate"]),a(v,{elevation:"1",rounded:"lg"},{default:t(()=>[a(O,{class:"pa-0"},{default:t(()=>[a(H,{headers:A,items:f.value,loading:c.value,density:"comfortable",class:"elevation-0","item-key":"item_id"},{"item.opening_balance":t(({item:o})=>[n(i(r(o.opening_balance)),1)]),"item.inwards":t(({item:o})=>[l("span",le,i(r(o.inwards)),1)]),"item.outwards":t(({item:o})=>[l("span",se,i(r(o.outwards)),1)]),"item.closing_balance":t(({item:o})=>[l("strong",null,i(r(o.closing_balance)),1)]),bottom:t(()=>[l("div",oe,[a(S,{variant:"tonal",color:"blue",class:"mr-2"},{default:t(()=>[n(" Opening: "+i(r(p.value.opening)),1)]),_:1}),a(S,{variant:"tonal",color:"green",class:"mr-2"},{default:t(()=>[n(" Inwards: "+i(r(p.value.inwards)),1)]),_:1}),a(S,{variant:"tonal",color:"red",class:"mr-2"},{default:t(()=>[n(" Outwards: "+i(r(p.value.outwards)),1)]),_:1}),a(S,{variant:"tonal",color:"purple"},{default:t(()=>[n(" Closing: "+i(r(p.value.closing)),1)]),_:1})])]),"no-data":t(()=>[l("div",ne,[a(m,{size:"64",color:"grey-lighten-2",class:"mb-2"},{default:t(()=>e[21]||(e[21]=[n("mdi-database-off")])),_:1}),e[22]||(e[22]=l("div",{class:"text-subtitle-1 text-grey"},"No data for selected filters",-1)),e[23]||(e[23]=l("div",{class:"text-body-2 text-grey"},"Adjust filters and try again.",-1))])]),_:1},8,["items","loading"])]),_:1})]),_:1})]),_:1})}}},_e=$(re,[["__scopeId","data-v-b6104a62"]]);export{_e as default};
