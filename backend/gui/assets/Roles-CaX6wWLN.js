import{_ as Q,s as p,v as d,x as s,i as a,y as r,a3 as h,B as f,C as n,D as F,H as k,E as g,$ as b,F as V,G as T,I as x,a4 as W,aD as X,a$ as Y,r as v,a0 as Z,e as j,l as $}from"./index-Hv2mhWCg.js";import{V as S}from"./VDialog-CSQI0hJx.js";import{V as c,b as E}from"./VCard-CYRuZxjU.js";import{V as N}from"./VTextField-Cx5gfnvz.js";import{V as C}from"./VChip-Df1CGvfC.js";import{a as ee}from"./VDataTable-Br-2x4VM.js";import{V as le}from"./VContainer-9ajDumgj.js";import"./dialog-transition-DIP2spr7.js";import"./VSlideGroup-BYkN-FDY.js";const ae={name:"RolesManagement",setup(){const w=v([]),e=v([]),u=v(!1),l=v(!1),D=v(!1),R=v(!1),t=v([]),m=v([]),i=Z({id:null,name:"",display:"",tasks:[]}),_=[{title:"ID",key:"id"},{title:"Technical Name",key:"name"},{title:"Display Name",key:"display"},{title:"Assigned Tasks",key:"tasks"},{title:"Edit",key:"edit",sortable:!1}],O=j(()=>e.value.filter(o=>!i.tasks.find(y=>y.id===o.id))),A=j(()=>i.name.trim()!==""&&i.display.trim()!==""&&t.value.length===0&&m.value.length===0);function U(){t.value=[],i.name.trim()||t.value.push("Technical name is required"),i.name.includes(" ")&&t.value.push("Technical name should not contain spaces")}function z(){m.value=[],i.display.trim()||m.value.push("Display name is required")}async function B(){u.value=!0;try{const o=await fetch("/roles");o.ok?w.value=await o.json():console.error("Failed to load roles")}catch(o){console.error("Error loading roles:",o)}finally{u.value=!1}}async function P(){try{const o=await fetch("/tasks");o.ok?e.value=await o.json():console.error("Failed to load tasks")}catch(o){console.error("Error loading tasks:",o)}}function I(){i.id=null,i.name="",i.display="",i.tasks=[],t.value=[],m.value=[],l.value=!0}async function J(){if(A.value){u.value=!0;try{const o=await fetch("/roles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.name.trim(),display:i.display.trim()})});if(!o.ok)throw new Error("Failed to create role");const y=await o.json();i.tasks.length>0&&await fetch(`/roles/${y.id}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:i.tasks.map(K=>K.id)})}),l.value=!1,await B()}catch(o){console.error("Error creating role:",o)}finally{u.value=!1}}}function q(o){i.id=o.id,i.name=o.name,i.display=o.display,i.tasks=[...o.tasks||[]],t.value=[],m.value=[],D.value=!0}async function L(){if(A.value){u.value=!0;try{await fetch(`/roles/${i.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i.name.trim(),display:i.display.trim()})}),await fetch(`/roles/${i.id}/tasks`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({tasks:i.tasks.map(o=>o.id)})}),D.value=!1,await B()}catch(o){console.error("Error updating role:",o)}finally{u.value=!1}}}async function M(){u.value=!0;try{await fetch(`/roles/${i.id}`,{method:"DELETE"}),R.value=!1,D.value=!1,await B()}catch(o){console.error("Error deleting role:",o)}finally{u.value=!1}}function G(o){i.tasks.find(y=>y.id===o.id)||i.tasks.push(o)}function H(o){i.tasks=i.tasks.filter(y=>y.id!==o.id)}return $(()=>{B(),P()}),{roles:w,allTasks:e,headers:_,loading:u,addDialog:l,editDialog:D,confirmDelete:R,roleForm:i,unassignedTasks:O,nameErrors:t,displayErrors:m,isFormValid:A,openAddDialog:I,openEditDialog:q,createRole:J,saveRoleEdit:L,deleteRole:M,assignTask:G,removeTask:H,validateName:U,validateDisplay:z}}},se={class:"d-flex flex-row ga-4"},te={class:"tasks-container"},oe={key:0,class:"text-caption text-grey text-center pa-4"},ie={class:"tasks-container"},ne={key:0,class:"text-caption text-grey text-center pa-4"},re={class:"d-flex justify-end pr-3 pb-3"},de={class:"text-white font-weight-bold text-h6"},me={class:"d-flex flex-row ga-4"},fe={class:"tasks-container"},ue={key:0,class:"text-caption text-grey text-center pa-4"},ge={class:"tasks-container"},ke={key:0,class:"text-caption text-grey text-center pa-4"},ve={class:"d-flex justify-space-between pr-3 pb-3"},ce={class:"d-flex justify-end px-4 pb-4"},ye={class:"d-flex flex-wrap"},pe={key:0,class:"text-caption text-grey"};function xe(w,e,u,l,D,R){return d(),p(le,{fluid:""},{default:s(()=>[a(S,{modelValue:l.addDialog,"onUpdate:modelValue":e[3]||(e[3]=t=>l.addDialog=t),transition:"dialog-bottom-transition",width:"750"},{default:s(()=>[a(c,{class:"rounded-xl pa-4",elevation:"10"},{default:s(()=>[a(h,{class:"rounded-lg px-4",color:"primary",flat:""},{default:s(()=>[a(f,{class:"mr-2 text-white"},{default:s(()=>e[12]||(e[12]=[n("mdi-shield-plus")])),_:1}),e[14]||(e[14]=r("span",{class:"text-white font-weight-bold text-h6"},"Add Role",-1)),a(F),a(k,{class:"text-white",icon:"",onClick:e[0]||(e[0]=t=>l.addDialog=!1)},{default:s(()=>[a(f,null,{default:s(()=>e[13]||(e[13]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),a(E,{class:"pt-6"},{default:s(()=>[a(N,{modelValue:l.roleForm.name,"onUpdate:modelValue":e[1]||(e[1]=t=>l.roleForm.name=t),"bg-color":"#BDBDBD","error-messages":l.nameErrors,label:"Role technical name (admin, cashier)",onBlur:l.validateName},null,8,["modelValue","error-messages","onBlur"]),a(N,{modelValue:l.roleForm.display,"onUpdate:modelValue":e[2]||(e[2]=t=>l.roleForm.display=t),"bg-color":"#BDBDBD","error-messages":l.displayErrors,label:"Display name (Administrator, Sales Officer)",onBlur:l.validateDisplay},null,8,["modelValue","error-messages","onBlur"]),e[17]||(e[17]=r("h4",{class:"mt-6 mb-2 text-h6 font-weight-bold"},"Tasks Assignment",-1)),r("div",se,[a(c,{class:"flex-1 pa-3",elevation:"3"},{default:s(()=>[e[15]||(e[15]=r("h4",{class:"font-weight-bold mb-3"},"Available Tasks",-1)),r("div",te,[(d(!0),g(V,null,T(l.unassignedTasks,t=>(d(),p(C,{key:t.id,class:"ma-1",color:"primary",size:"small",variant:"outlined",onClick:m=>l.assignTask(t)},{default:s(()=>[n(x(t.display),1)]),_:2},1032,["onClick"]))),128)),l.unassignedTasks.length===0?(d(),g("div",oe," No available tasks ")):b("",!0)])]),_:1}),a(c,{class:"flex-1 pa-3",elevation:"3"},{default:s(()=>[e[16]||(e[16]=r("h4",{class:"font-weight-bold mb-3"},"Assigned Tasks",-1)),r("div",ie,[(d(!0),g(V,null,T(l.roleForm.tasks,t=>(d(),p(C,{key:t.id,class:"ma-1",closable:"",color:"primary",size:"small",variant:"flat","onClick:close":m=>l.removeTask(t)},{default:s(()=>[n(x(t.display),1)]),_:2},1032,["onClick:close"]))),128)),l.roleForm.tasks.length===0?(d(),g("div",ne," No tasks assigned ")):b("",!0)])]),_:1})])]),_:1}),r("div",re,[a(k,{color:"success",disabled:!l.isFormValid,loading:l.loading,variant:"elevated",onClick:l.createRole},{default:s(()=>[a(f,{start:""},{default:s(()=>e[18]||(e[18]=[n("mdi-check")])),_:1}),e[19]||(e[19]=n(" Save Role "))]),_:1},8,["disabled","loading","onClick"])])]),_:1})]),_:1},8,["modelValue"]),a(S,{modelValue:l.editDialog,"onUpdate:modelValue":e[8]||(e[8]=t=>l.editDialog=t),transition:"dialog-bottom-transition",width:"750"},{default:s(()=>[a(c,{class:"rounded-xl pa-4",elevation:"10"},{default:s(()=>[a(h,{class:"rounded-lg px-4",color:"primary",flat:""},{default:s(()=>[a(f,{class:"mr-2 text-white"},{default:s(()=>e[20]||(e[20]=[n("mdi-shield-edit")])),_:1}),r("span",de," Edit Role â€“ "+x(l.roleForm.display),1),a(F),a(k,{class:"text-white",icon:"",onClick:e[4]||(e[4]=t=>l.editDialog=!1)},{default:s(()=>[a(f,null,{default:s(()=>e[21]||(e[21]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),a(E,{class:"pt-6"},{default:s(()=>[a(N,{modelValue:l.roleForm.name,"onUpdate:modelValue":e[5]||(e[5]=t=>l.roleForm.name=t),"bg-color":"#BDBDBD","error-messages":l.nameErrors,label:"Role Technical Name",onBlur:l.validateName},null,8,["modelValue","error-messages","onBlur"]),a(N,{modelValue:l.roleForm.display,"onUpdate:modelValue":e[6]||(e[6]=t=>l.roleForm.display=t),"bg-color":"#BDBDBD","error-messages":l.displayErrors,label:"Role Display Name",onBlur:l.validateDisplay},null,8,["modelValue","error-messages","onBlur"]),e[24]||(e[24]=r("h4",{class:"mt-6 mb-2 text-h6 font-weight-bold"},"Tasks Assignment",-1)),r("div",me,[a(c,{class:"flex-1 pa-3",elevation:"3"},{default:s(()=>[e[22]||(e[22]=r("h4",{class:"font-weight-bold mb-3"},"Available Tasks",-1)),r("div",fe,[(d(!0),g(V,null,T(l.unassignedTasks,t=>(d(),p(C,{key:t.id,class:"ma-1",color:"primary",size:"small",variant:"outlined",onClick:m=>l.assignTask(t)},{default:s(()=>[n(x(t.display),1)]),_:2},1032,["onClick"]))),128)),l.unassignedTasks.length===0?(d(),g("div",ue," No available tasks ")):b("",!0)])]),_:1}),a(c,{class:"flex-1 pa-3",elevation:"3"},{default:s(()=>[e[23]||(e[23]=r("h4",{class:"font-weight-bold mb-3"},"Assigned Tasks",-1)),r("div",ge,[(d(!0),g(V,null,T(l.roleForm.tasks,t=>(d(),p(C,{key:t.id,class:"ma-1",closable:"",color:"primary",size:"small",variant:"flat","onClick:close":m=>l.removeTask(t)},{default:s(()=>[n(x(t.display),1)]),_:2},1032,["onClick:close"]))),128)),l.roleForm.tasks.length===0?(d(),g("div",ke," No tasks assigned ")):b("",!0)])]),_:1})])]),_:1}),r("div",ve,[a(k,{color:"success",disabled:!l.isFormValid,loading:l.loading,variant:"elevated",onClick:l.saveRoleEdit},{default:s(()=>[a(f,{start:""},{default:s(()=>e[25]||(e[25]=[n("mdi-content-save")])),_:1}),e[26]||(e[26]=n(" Save "))]),_:1},8,["disabled","loading","onClick"]),a(k,{color:"error",variant:"elevated",onClick:e[7]||(e[7]=t=>l.confirmDelete=!0)},{default:s(()=>[a(f,{start:""},{default:s(()=>e[27]||(e[27]=[n("mdi-delete")])),_:1}),e[28]||(e[28]=n(" Delete "))]),_:1})])]),_:1})]),_:1},8,["modelValue"]),a(S,{modelValue:l.confirmDelete,"onUpdate:modelValue":e[11]||(e[11]=t=>l.confirmDelete=t),width:"450"},{default:s(()=>[a(c,{class:"rounded-xl"},{default:s(()=>[a(h,{class:"px-4",color:"warning",flat:""},{default:s(()=>[a(f,{class:"mr-2 text-white"},{default:s(()=>e[29]||(e[29]=[n("mdi-alert")])),_:1}),e[31]||(e[31]=r("span",{class:"text-white font-weight-bold"},"Delete Role",-1)),a(F),a(k,{class:"text-white",icon:"",onClick:e[9]||(e[9]=t=>l.confirmDelete=!1)},{default:s(()=>[a(f,null,{default:s(()=>e[30]||(e[30]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),a(E,{class:"pt-4"},{default:s(()=>[e[32]||(e[32]=n(" Are you sure you want to delete role ")),r("strong",null,x(l.roleForm.display),1),e[33]||(e[33]=n("? ")),e[34]||(e[34]=r("div",{class:"text-caption text-warning mt-2"}," Note: This action cannot be undone. ",-1))]),_:1}),r("div",ce,[a(k,{variant:"text",onClick:e[10]||(e[10]=t=>l.confirmDelete=!1)},{default:s(()=>e[35]||(e[35]=[n("Cancel")])),_:1}),a(k,{color:"error",loading:l.loading,variant:"elevated",onClick:l.deleteRole},{default:s(()=>e[36]||(e[36]=[n(" Delete ")])),_:1},8,["loading","onClick"])])]),_:1})]),_:1},8,["modelValue"]),a(h,{class:"rounded-lg mb-4 px-4",color:"primary",flat:"",height:"60"},{default:s(()=>[a(W,{class:"text-white font-weight-bold text-h6"},{default:s(()=>[a(f,{class:"mr-2",color:"white"},{default:s(()=>e[37]||(e[37]=[n("mdi-shield-account")])),_:1}),e[38]||(e[38]=n(" Roles & Permissions "))]),_:1}),a(F),w.$store.getters.hasTask("can_add_settings")?(d(),p(k,{key:0,class:"text-white",color:"#1A237E",size:"small",onClick:l.openAddDialog},{default:s(()=>[a(f,{start:""},{default:s(()=>e[39]||(e[39]=[n("mdi-plus")])),_:1}),e[40]||(e[40]=n(" Add Role "))]),_:1},8,["onClick"])):b("",!0)]),_:1}),a(c,{class:"rounded-lg"},{default:s(()=>[a(E,null,{default:s(()=>[a(X,{active:l.loading,indeterminate:""},null,8,["active"]),a(ee,{class:"elevation-1",dense:"",headers:l.headers,items:l.roles,loading:l.loading},Y({"item.tasks":s(({item:t})=>[r("div",ye,[(d(!0),g(V,null,T(t.tasks,m=>(d(),p(C,{key:m.id,class:"ma-1",color:"primary",size:"small",variant:"outlined"},{default:s(()=>[n(x(m.display),1)]),_:2},1024))),128)),!t.tasks||t.tasks.length===0?(d(),g("span",pe," No tasks assigned ")):b("",!0)])]),_:2},[w.$store.getters.hasTask("can_add_settings")?{name:"item.edit",fn:s(({item:t})=>[a(f,{color:"#3F51B5",onClick:m=>l.openEditDialog(t)},{default:s(()=>e[41]||(e[41]=[n(" mdi-square-edit-outline ")])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["headers","items","loading"])]),_:1})]),_:1})]),_:1})}const Ee=Q(ae,[["render",xe],["__scopeId","data-v-0e8bd648"]]);export{Ee as default};
