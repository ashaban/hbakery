import{_ as et,a0 as tt,r as k,$ as ne,d as J,k as ot,q as _,t as u,v as l,h as o,x as m,N as I,G as g,B as r,A as p,H as f,Z as $,ae as lt,aM as at,a2 as ye,C as se,a4 as nt,D as y,ay as q,O as W,F as E,E as h,i as st,z as ve}from"./index-QxhlWP4e.js";import{c as _e,u as it,m as rt,r as H}from"./index-CymgRIr1.js";import{V as U,b as N,a as Z,c as ge}from"./VCard-BsQTw5ky.js";import{V as v}from"./VCol-BREXiIXo.js";import{V as w}from"./VTextField-B9B5J07o.js";import{V as L}from"./VAlert-id8KV4Rc.js";import{a as dt,b as ut,V as mt}from"./VDataTable-BolYUsKL.js";import{V as ie}from"./VDialog-2ZVz6-p5.js";import{V as ct}from"./VForm-BjTnbGkt.js";import{V as be}from"./VAutocomplete-BWlgo7Uj.js";import{V as Ve}from"./VCheckbox-BTMM1qEY.js";import{V as T}from"./VChip-eiQx3szG.js";import{V as ft,a as ke,b as pt,c as Ce}from"./VTabs-B882XoXa.js";import{V as yt}from"./VContainer-D-5tKOqy.js";import"./dialog-transition-DgUn6fLh.js";import"./VSlideGroup-CwbbKapO.js";const vt={class:"d-flex justify-space-between mb-4"},_t={class:"d-flex justify-end align-center mt-4"},gt={class:"d-flex align-center flex-wrap"},bt={class:"text-white font-weight-bold text-h6"},Vt={class:"d-flex justify-end mt-2"},kt={class:"d-flex justify-space-between align-center mb-4"},Ct={class:"text-caption text-grey mt-1"},wt={class:"d-flex justify-end mt-2"},xt={class:"d-flex justify-space-between align-center mb-2"},$t={key:2,class:"text-center py-4"},qt={key:3},Et={class:"flex-grow-1"},ht={class:"font-weight-medium"},At={key:0,class:"text-center py-2 text-grey"},Ut={key:1,class:"text-caption text-grey mt-2"},Mt={class:"bg-primary pa-6 rounded-t-xl"},Nt={class:"d-flex align-center"},Ot={class:"text-h5 font-weight-bold text-white"},Pt={class:"pa-4"},Tt={key:0,class:"text-center py-8"},zt={key:1,class:"ingredients-grid"},Dt={class:"d-flex align-center"},St={class:"flex-grow-1"},Gt={class:"text-body-1 font-weight-medium"},jt={class:"d-flex align-center mt-2"},It={class:"text-primary text-caption font-weight-bold"},Lt={class:"pa-4"},Bt={key:0,class:"text-center py-8"},Ft={key:1},Rt={key:0,class:"text-body-2 mb-3"},Qt={class:"mb-3"},Yt=10,Xt={__name:"Products",setup(Jt){const K=tt(),x=k(!1),re=k([]),O=k(!1),z=k(!1),Y=k(!1),B=k("mandatory"),M=k(!1),ee=k(null),de=k(null),te=k([]),oe=k([]),D=k([]),F=k(1),ue=k(1),me=ne({total_products:""}),S=ne({search:""}),we=[{title:"Name",key:"name"},{title:"Description",key:"description"},{title:"Unit",key:"unit"},{title:"Bar Code",key:"barcode"},{title:"Price",key:"price"},{title:"Actions",key:"actions"}],xe=[{text:"Any Combination",value:"ANY"},{text:"Exactly One",value:"EXACTLY_ONE"},{text:"At Least One",value:"AT_LEAST_ONE"}],i=ne({name:"",description:"",unit:"",price:"",barcode:"",items:[],groups:[]}),$e=_e.withMessage("At least one mandatory ingredient is required",a=>Array.isArray(a)&&a.length>0),qe=_e.withMessage("Each mandatory ingredient must have item and quantity",a=>Array.isArray(a)&&a.every(e=>e.item_id&&e.quantity_per_unit&&Number(e.quantity_per_unit)>0)),Ee={name:{required:H},unit:{required:H},barcode:{required:H},price:{required:H,minValue:rt(1)},items:{hasAtLeastOneItem:$e,validItems:qe}},C=it(Ee,i),he=J(()=>{const a=i.items.length,e=i.groups.length,t=i.items.filter(d=>!d.item_id||!d.quantity_per_unit).length,s=i.groups.filter(d=>!d.name||d.options.length===0).length;if(a===0&&e===0)return"No ingredients configured.";let n=`${a} mandatory ingredient(s)`;return e>0&&(n+=`, ${e} group(s)`),(t>0||s>0)&&(n+=` - ${t+s} incomplete`),n}),ce=J(()=>{const a=i.items.some(t=>!t.item_id||!t.quantity_per_unit),e=i.groups.some(t=>!t.name||t.options.length===0);return a||e?"error":"success"}),le=J(()=>{for(const a of i.groups){if(!a.name)return"All groups must have a name";if(a.options.length===0)return`Group "${a.name}" must have at least one option`;for(const e of a.combinations){const t=G(a,e);for(const s of t){const n=Oe(a,e,s.item_id);if(!n||n<=0)return`Combination "${e.name}" must have quantity for ${ae(s.item_id)}`}}if(a.is_mandatory&&!a.combinations.some(e=>e.is_default))return`Mandatory group "${a.name}" must have a default combination`}return null}),fe=J(()=>!!le.value),Ae=a=>({ANY:"Any combination of options allowed",EXACTLY_ONE:"Must select exactly one option",AT_LEAST_ONE:"Must select at least one option"})[a]||"",Ue=a=>{const e=a.options.filter(t=>t.item_id).length;return a.selection_mode==="EXACTLY_ONE"?e:(a.selection_mode==="AT_LEAST_ONE",Math.pow(2,e)-1)},ae=a=>{const e=D.value.find(t=>t.id===a);return e?e.name:"Unknown Item"},Me=(a,e)=>{const t=a.find(s=>s.item_id===e);return t?t.item_name:"Unknown Item"},G=(a,e)=>a.options.filter((t,s)=>e.combination_mask&1<<s),pe=(a,e)=>a.options.length-G(a,e).length,R=a=>{const e=i.groups[a],t=e.options.filter(c=>c.item_id);if(t.length===0){e.combinations=[];return}const s=[],n=Math.pow(2,t.length);for(let c=1;c<n;c++){const b=c,A=[];for(let V=0;V<t.length;V++)b&1<<V&&A.push(t[V]);const X=A.map(V=>ae(V.item_id)).join(" + "),P=e.combinations.find(V=>V.combination_mask===b);if(P)P.name=X,A.forEach(V=>{P.quantities.find(Q=>Q.item_id===V.item_id)||P.quantities.push({item_id:V.item_id,quantity_per_unit:""})}),P.quantities=P.quantities.filter(V=>A.some(Q=>Q.item_id===V.item_id)),s.push(P);else{const V=A.map(Q=>({item_id:Q.item_id,quantity_per_unit:""}));s.push({name:X,combination_mask:b,is_default:s.length===0&&e.is_mandatory,notes:"",quantities:V})}}let d=s;e.selection_mode==="EXACTLY_ONE"?d=s.filter(c=>G(e,c).length===1):e.selection_mode==="AT_LEAST_ONE"&&(d=s.filter(c=>G(e,c).length>=1)),e.is_mandatory&&d.length>0&&!d.some(c=>c.is_default)&&(d[0].is_default=!0),e.combinations=d},Ne=(a,e,t)=>{const n=i.groups[a].combinations[e].quantities.find(d=>d.item_id===t);return n?n.quantity_per_unit:""},Oe=(a,e,t)=>{const s=e.quantities.find(n=>n.item_id===t);return s?s.quantity_per_unit:""},Pe=(a,e,t,s)=>{const n=i.groups[a].combinations[e],d=n.quantities.find(c=>c.item_id===t);d?d.quantity_per_unit=s:n.quantities.push({item_id:t,quantity_per_unit:s})};function Te(a){const e=i.items.map((n,d)=>d!==a?n.item_id:null).filter(Boolean),t=i.groups.flatMap(n=>n.options.map(d=>d.item_id)).filter(Boolean),s=[...e,...t];return D.value.filter(n=>!s.includes(n.id))}function ze(a,e){const s=i.groups[a].options.map((b,A)=>A!==e?b.item_id:null).filter(Boolean),n=i.groups.flatMap((b,A)=>A!==a?b.options.map(X=>X.item_id):[]).filter(Boolean),d=i.items.map(b=>b.item_id).filter(Boolean),c=[...s,...n,...d];return D.value.filter(b=>!c.includes(b.id))}function De(a){const e=D.value.find(t=>t.id===a.item_id);a.unit=e?e.unit:""}function Se(a,e){const t=i.groups[a].options[e],s=D.value.find(n=>n.id===t.item_id);t.item_name=s?s.name:"",t.unit=s?s.unit:"",t.item_id&&R(a)}function Ge(){i.items.push({item_id:"",quantity_per_unit:"",unit:""})}function je(a){i.items.splice(a,1)}function Ie(){i.groups.push({name:"",description:"",is_mandatory:!0,selection_mode:"ANY",options:[],combinations:[]})}function Le(a){i.groups.splice(a,1)}function Be(a){i.groups[a].options.push({item_id:"",item_name:"",position:i.groups[a].options.length+1,unit:""})}function Fe(a,e){i.groups[a].options.splice(e,1),R(a)}function Re(a,e){i.groups[a].combinations.splice(e,1)}async function Qe(){const a=await fetch("/items");D.value=await a.json()}async function j(){x.value=!0;const a=new URLSearchParams({page:F.value,limit:Yt});S.search&&a.append("search",S.search);try{const t=await(await fetch(`/products?${a}`)).json();re.value=t.data||[],ue.value=t.totalPages||1,me.total_products=t.totalRecords||0}finally{x.value=!1}}function Ye(){F.value=1,j()}function Xe(){S.search="",F.value=1,j()}function Je(){M.value=!1,Object.assign(i,{name:"",description:"",unit:"",price:"",barcode:"",items:[],groups:[]}),O.value=!0,C.value.$reset()}async function We(a){M.value=!0,ee.value=a.id,x.value=!0;try{const t=await(await fetch(`/products/${a.id}`)).json(),s=t.product||t;Object.assign(i,{name:s.name,description:s.description,unit:s.unit,price:s.price,barcode:s.barcode,items:(t.items||[]).map(n=>({item_id:n.item_id,quantity_per_unit:n.quantity_per_unit,unit:n.unit})),groups:(t.groups||[]).map(n=>({name:n.name,description:n.description,is_mandatory:n.is_mandatory,selection_mode:n.selection_mode,options:n.options||[],combinations:n.combinations||[]}))}),O.value=!0}finally{x.value=!1}}async function He(a){de.value=a;const t=await(await fetch(`/products/${a.id}`)).json();te.value=t.items||[],oe.value=t.groups||[],B.value="mandatory",Y.value=!0}async function Ze(){if(C.value.$touch(),C.value.$invalid||fe.value)return;x.value=!0;const a=new FormData;a.append("name",i.name),a.append("description",i.description),a.append("unit",i.unit),a.append("price",i.price),a.append("barcode",i.barcode),a.append("items",JSON.stringify(i.items)),a.append("groups",JSON.stringify(i.groups));const e=M.value?`/products/${ee.value}`:"/products",t=M.value?"PUT":"POST";try{if(!(await fetch(e,{method:t,body:a})).ok)throw new Error("Failed to save");O.value=!1,j(),K.commit("setMessage",{type:"success",text:M.value?"Product updated!":"Product added!"})}catch{K.commit("setMessage",{type:"error",text:"Failed to save product"})}finally{x.value=!1}}async function Ke(){x.value=!0,await fetch(`/products/${ee.value}`,{method:"DELETE"}),z.value=!1,O.value=!1,j(),K.commit("setMessage",{type:"success",text:"Product deleted!"}),x.value=!1}return ot(()=>{j(),Qe()}),(a,e)=>(u(),_(yt,{fluid:""},{default:l(()=>[o(U,{class:"pa-4 mb-4"},{default:l(()=>[o(I,{dense:""},{default:l(()=>[o(v,{cols:"12",sm:"4"},{default:l(()=>[o(w,{modelValue:S.search,"onUpdate:modelValue":e[0]||(e[0]=t=>S.search=t),"append-inner-icon":"mdi-close-circle",autocomplete:"off",autocorrect:"off",clearable:"",inputmode:"none",label:"Search Product Name",spellcheck:"false","onClick:appendInner":e[1]||(e[1]=t=>S.search="")},null,8,["modelValue"])]),_:1}),o(v,{class:"d-flex justify-end",cols:"12"},{default:l(()=>[o(g,{color:"primary",onClick:Ye},{default:l(()=>[o(p,{start:""},{default:l(()=>e[19]||(e[19]=[r("mdi-filter")])),_:1}),e[20]||(e[20]=r(" Apply "))]),_:1}),o(g,{class:"ml-2",color:"grey",onClick:Xe},{default:l(()=>[o(p,{start:""},{default:l(()=>e[21]||(e[21]=[r("mdi-refresh")])),_:1}),e[22]||(e[22]=r(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),o(L,{border:"start",class:"mb-4",type:"info",variant:"outlined"},{default:l(()=>[e[23]||(e[23]=m("strong",null,"Total Products:",-1)),r(" "+f(me.total_products||"0"),1)]),_:1}),m("div",vt,[e[26]||(e[26]=m("h3",null,"Products",-1)),a.$store.getters.hasTask("can_add_settings")?(u(),_(g,{key:0,class:"text-white",color:"primary",size:"small",onClick:Je},{default:l(()=>[o(p,{start:""},{default:l(()=>e[24]||(e[24]=[r("mdi-plus")])),_:1}),e[25]||(e[25]=r(" Add Product "))]),_:1})):$("",!0)]),o(lt,{active:x.value,indeterminate:x.value},null,8,["active","indeterminate"]),o(dt,{class:"elevation-1",dense:"",headers:we,height:"400",items:re.value,loading:x.value},at({_:2},[a.$store.getters.hasTask("can_add_settings")?{name:"item.actions",fn:l(({item:t})=>[o(p,{class:"mr-2",color:"primary",onClick:s=>We(t)},{default:l(()=>e[27]||(e[27]=[r(" mdi-square-edit-outline ")])),_:2},1032,["onClick"]),o(p,{color:"green",onClick:s=>He(t)},{default:l(()=>e[28]||(e[28]=[r(" mdi-eye ")])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["items","loading"]),m("div",_t,[o(ut,{modelValue:F.value,"onUpdate:modelValue":[e[2]||(e[2]=t=>F.value=t),j],length:ue.value,"total-visible":"7"},null,8,["modelValue","length"])]),o(ie,{modelValue:O.value,"onUpdate:modelValue":e[11]||(e[11]=t=>O.value=t),"max-width":"1200",scrollable:"",transition:"dialog-top-transition"},{default:l(()=>[o(U,{class:"rounded-xl pa-4",elevation:"10"},{default:l(()=>[o(ye,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:l(()=>[m("div",gt,[o(p,{class:"mr-2 text-white"},{default:l(()=>e[29]||(e[29]=[r("mdi-package-variant")])),_:1}),m("span",bt,f(M.value?"Edit Product":"Add Product"),1)]),o(se),o(g,{color:"white",icon:"mdi-close",onClick:e[3]||(e[3]=t=>O.value=!1)})]),_:1}),o(N,{class:"pt-6"},{default:l(()=>[o(ct,{onSubmit:e[9]||(e[9]=nt(()=>{},["prevent"]))},{default:l(()=>[o(I,{dense:""},{default:l(()=>[o(v,{cols:"12",sm:"6"},{default:l(()=>[o(w,{modelValue:i.name,"onUpdate:modelValue":e[4]||(e[4]=t=>i.name=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0","error-messages":q(C).name.$errors.map(t=>t.$message),inputmode:"none",label:"Product Name",required:"",spellcheck:"false"},null,8,["modelValue","error-messages"])]),_:1}),o(v,{cols:"12",sm:"6"},{default:l(()=>[o(w,{modelValue:i.unit,"onUpdate:modelValue":e[5]||(e[5]=t=>i.unit=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0","error-messages":q(C).unit.$errors.map(t=>t.$message),inputmode:"none",label:"Unit (e.g. Loaf, Pack)",required:"",spellcheck:"false"},null,8,["modelValue","error-messages"])]),_:1}),o(v,{cols:"12"},{default:l(()=>[o(w,{modelValue:i.description,"onUpdate:modelValue":e[6]||(e[6]=t=>i.description=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0",inputmode:"none",label:"Description",spellcheck:"false"},null,8,["modelValue"])]),_:1}),o(v,{cols:"12",sm:"4"},{default:l(()=>[o(w,{modelValue:i.price,"onUpdate:modelValue":e[7]||(e[7]=t=>i.price=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0","error-messages":q(C).price.$errors.map(t=>t.$message),inputmode:"none",label:"Price",prefix:"TSh ",required:"",spellcheck:"false",type:"number"},null,8,["modelValue","error-messages"])]),_:1}),o(v,{cols:"12",sm:"4"},{default:l(()=>[o(w,{modelValue:i.barcode,"onUpdate:modelValue":e[8]||(e[8]=t=>i.barcode=t),autocomplete:"off",autocorrect:"off","bg-color":"#E0E0E0","error-messages":q(C).barcode.$errors.map(t=>t.$message),inputmode:"none",label:"Bar Code",required:"",spellcheck:"false"},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),o(W,{class:"my-4"}),e[52]||(e[52]=m("h4",null,"Mandatory Ingredients (Fixed Requirements)",-1)),q(C).items.$error?(u(),_(L,{key:0,border:"start",class:"mb-2",type:"error",variant:"outlined"},{default:l(()=>e[30]||(e[30]=[r(" Each ingredient must have Item and Quantity. ")])),_:1})):$("",!0),(u(!0),y(E,null,h(i.items,(t,s)=>(u(),_(I,{key:"mandatory-"+s,align:"center",class:"mb-2",dense:""},{default:l(()=>[o(v,{cols:"12",sm:"6"},{default:l(()=>[o(be,{modelValue:t.item_id,"onUpdate:modelValue":[n=>t.item_id=n,n=>De(t)],autocomplete:"off",autocorrect:"off",clearable:"",dense:"",error:q(C).items.$dirty&&!t.item_id,"error-messages":q(C).items.$dirty&&!t.item_id?["Item required"]:[],inputmode:"none","item-title":"name","item-value":"id",items:Te(s),label:"Item",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue","error","error-messages","items"])]),_:2},1024),o(v,{cols:"12",sm:"5"},{default:l(()=>[o(w,{modelValue:t.quantity_per_unit,"onUpdate:modelValue":n=>t.quantity_per_unit=n,autocomplete:"off",autocorrect:"off",dense:"",error:q(C).items.$dirty&&(!t.quantity_per_unit||t.quantity_per_unit<=0),"error-messages":q(C).items.$dirty&&(!t.quantity_per_unit||t.quantity_per_unit<=0)?["Quantity > 0 required"]:[],inputmode:"none",label:`Quantity in ${t.unit||""}`,spellcheck:"false",type:"number"},null,8,["modelValue","onUpdate:modelValue","error","error-messages","label"])]),_:2},1024),o(v,{class:"d-flex justify-end",cols:"12",sm:"1"},{default:l(()=>[o(g,{color:"error",icon:"",size:"small",onClick:n=>je(s)},{default:l(()=>[o(p,null,{default:l(()=>e[31]||(e[31]=[r("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),m("div",Vt,[o(g,{color:"primary",size:"small",onClick:Ge},{default:l(()=>[o(p,{start:""},{default:l(()=>e[32]||(e[32]=[r("mdi-plus")])),_:1}),e[33]||(e[33]=r(" Add Mandatory Ingredient "))]),_:1})]),o(W,{class:"my-4"}),m("div",kt,[e[36]||(e[36]=m("h4",null,"Ingredient Groups (Flexible Combinations)",-1)),o(g,{color:"primary",size:"small",onClick:Ie},{default:l(()=>[o(p,{start:""},{default:l(()=>e[34]||(e[34]=[r("mdi-plus")])),_:1}),e[35]||(e[35]=r(" Add Group "))]),_:1})]),le.value?(u(),_(L,{key:1,border:"start",class:"mb-2",type:"error",variant:"outlined"},{default:l(()=>[r(f(le.value),1)]),_:1})):$("",!0),(u(!0),y(E,null,h(i.groups,(t,s)=>(u(),_(U,{key:"group-"+s,class:"mb-4",variant:"outlined"},{default:l(()=>[o(Z,{class:"d-flex align-center bg-grey-lighten-3"},{default:l(()=>[o(w,{modelValue:t.name,"onUpdate:modelValue":[n=>t.name=n,n=>R(s)],autocomplete:"off",autocorrect:"off",class:"mr-2",density:"compact","hide-details":"",inputmode:"none",label:"Group Name",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue"]),o(se),o(g,{color:"error",icon:"",size:"small",onClick:n=>Le(s)},{default:l(()=>[o(p,null,{default:l(()=>e[37]||(e[37]=[r("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024),o(N,null,{default:l(()=>[o(I,{dense:""},{default:l(()=>[o(v,{cols:"12",sm:"6"},{default:l(()=>[o(w,{modelValue:t.description,"onUpdate:modelValue":n=>t.description=n,autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:"Description",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(v,{cols:"12",sm:"3"},{default:l(()=>[o(Ve,{modelValue:t.is_mandatory,"onUpdate:modelValue":n=>t.is_mandatory=n,density:"compact","hide-details":"",label:"Mandatory"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),o(v,{cols:"12",sm:"3"},{default:l(()=>[o(mt,{modelValue:t.selection_mode,"onUpdate:modelValue":[n=>t.selection_mode=n,n=>R(s)],density:"compact","hide-details":"","item-title":"text","item-value":"value",items:xe,label:"Selection Mode"},null,8,["modelValue","onUpdate:modelValue"]),m("div",Ct,f(Ae(t.selection_mode)),1)]),_:2},1024)]),_:2},1024),o(W,{class:"my-3"}),e[50]||(e[50]=m("h5",{class:"mb-2"},"Available Options",-1)),t.options.length>=5?(u(),_(L,{key:0,class:"mb-2",density:"compact",type:"warning"},{default:l(()=>[r(f(t.options.length)+" options will generate "+f(Ue(t))+" combinations ",1)]),_:2},1024)):$("",!0),(u(!0),y(E,null,h(t.options,(n,d)=>(u(),_(I,{key:"option-"+s+"-"+d,align:"center",class:"mb-2",dense:""},{default:l(()=>[o(v,{cols:"12",sm:"6"},{default:l(()=>[o(be,{modelValue:n.item_id,"onUpdate:modelValue":[c=>n.item_id=c,c=>Se(s,d)],autocomplete:"off",autocorrect:"off",clearable:"",density:"compact",inputmode:"none","item-title":"name","item-value":"id",items:ze(s,d),label:"Item",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),o(v,{cols:"12",sm:"5"},{default:l(()=>[o(w,{modelValue:n.position,"onUpdate:modelValue":c=>n.position=c,autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:"Position",max:t.options.length,min:"1",spellcheck:"false",type:"number"},null,8,["modelValue","onUpdate:modelValue","max"])]),_:2},1024),o(v,{class:"d-flex justify-end",cols:"12",sm:"1"},{default:l(()=>[o(g,{color:"error",icon:"",size:"small",onClick:c=>Fe(s,d)},{default:l(()=>[o(p,null,{default:l(()=>e[38]||(e[38]=[r("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),m("div",wt,[o(g,{color:"primary",size:"small",onClick:n=>Be(s)},{default:l(()=>[o(p,{start:""},{default:l(()=>e[39]||(e[39]=[r("mdi-plus")])),_:1}),e[40]||(e[40]=r(" Add Option "))]),_:2},1032,["onClick"])]),o(W,{class:"my-3"}),m("div",xt,[e[43]||(e[43]=m("h5",null,"Combinations (Auto-generated)",-1)),o(g,{color:"primary",disabled:t.options.length<1,size:"small",onClick:n=>R(s)},{default:l(()=>[o(p,{start:""},{default:l(()=>e[41]||(e[41]=[r("mdi-autorenew")])),_:1}),e[42]||(e[42]=r(" Regenerate "))]),_:2},1032,["disabled","onClick"])]),t.options.length===0?(u(),_(L,{key:1,class:"mb-2",density:"compact",type:"info"},{default:l(()=>e[44]||(e[44]=[r(" Add options above to generate combinations automatically ")])),_:1})):t.combinations.length===0?(u(),y("div",$t,[o(p,{class:"mb-2",color:"grey",size:"48"},{default:l(()=>e[45]||(e[45]=[r("mdi-cog-refresh")])),_:1}),e[46]||(e[46]=m("div",{class:"text-grey"},' Click "Regenerate" to create combinations ',-1))])):(u(),y("div",qt,[o(L,{class:"mb-2",density:"compact",type:"info"},{default:l(()=>[r(f(t.combinations.length)+" combination(s) generated. Set quantities for included items. ",1)]),_:2},1024),(u(!0),y(E,null,h(t.combinations,(n,d)=>(u(),_(U,{key:"comb-"+s+"-"+d,class:"mb-3",variant:"outlined"},{default:l(()=>[o(Z,{class:"d-flex align-center bg-grey-lighten-2"},{default:l(()=>[m("div",Et,[m("span",ht,f(n.name),1),n.is_default?(u(),_(T,{key:0,class:"ml-2",color:"green",size:"small"},{default:l(()=>e[47]||(e[47]=[r(" Default ")])),_:1})):$("",!0)]),o(Ve,{modelValue:n.is_default,"onUpdate:modelValue":c=>n.is_default=c,class:"mr-2",density:"compact","hide-details":"",label:"Default"},null,8,["modelValue","onUpdate:modelValue"]),o(g,{color:"error",icon:"",size:"small",onClick:c=>Re(s,d)},{default:l(()=>[o(p,null,{default:l(()=>e[48]||(e[48]=[r("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024),o(N,null,{default:l(()=>[G(t,n).length===0?(u(),y("div",At," No items included in this combination ")):$("",!0),(u(!0),y(E,null,h(G(t,n),c=>(u(),_(I,{key:"qty-"+s+"-"+d+"-"+c.item_id,align:"center",class:"mb-2",dense:""},{default:l(()=>[o(v,{cols:"12",sm:"4"},{default:l(()=>[o(w,{autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:"Item","model-value":ae(c.item_id),readonly:"",spellcheck:"false",variant:"outlined"},null,8,["model-value"])]),_:2},1024),o(v,{cols:"12",sm:"4"},{default:l(()=>[o(w,{autocomplete:"off",autocorrect:"off",density:"compact",inputmode:"none",label:`Quantity (${c.unit||""})`,min:"0","model-value":Ne(s,d,c.item_id),spellcheck:"false",step:"0.001",type:"number","onUpdate:modelValue":b=>Pe(s,d,c.item_id,b)},null,8,["label","model-value","onUpdate:modelValue"])]),_:2},1024),o(v,{cols:"12",sm:"4"},{default:l(()=>[o(T,{color:"primary",size:"small",variant:"flat"},{default:l(()=>e[49]||(e[49]=[r(" Required ")])),_:1})]),_:1})]),_:2},1024))),128)),pe(t,n)>0?(u(),y("div",Ut,f(pe(t,n))+" item(s) excluded from this combination ",1)):$("",!0),o(w,{modelValue:n.notes,"onUpdate:modelValue":c=>n.notes=c,autocomplete:"off",autocorrect:"off",class:"mt-2",density:"compact",inputmode:"none",label:"Notes (Optional)",spellcheck:"false"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]))]),_:2},1024)]),_:2},1024))),128)),m("div",{class:st(["mt-4 text-caption font-weight-medium d-flex align-center",ce.value])},[o(p,{class:"mr-1",color:ce.value,size:"small"},{default:l(()=>e[51]||(e[51]=[r(" mdi-information ")])),_:1},8,["color"]),r(" "+f(he.value),1)],2)]),_:1})]),_:1}),o(ge,{class:"d-flex justify-end mt-2"},{default:l(()=>[o(g,{color:"success",disabled:q(C).$invalid||fe.value,loading:x.value,onClick:Ze},{default:l(()=>[o(p,{start:""},{default:l(()=>e[53]||(e[53]=[r("mdi-content-save")])),_:1}),r(" "+f(M.value?"Save Changes":"Add Product"),1)]),_:1},8,["disabled","loading"]),M.value?(u(),_(g,{key:0,color:"error",onClick:e[10]||(e[10]=t=>z.value=!0)},{default:l(()=>[o(p,{start:""},{default:l(()=>e[54]||(e[54]=[r("mdi-delete")])),_:1}),e[55]||(e[55]=r(" Delete "))]),_:1})):$("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ie,{modelValue:Y.value,"onUpdate:modelValue":e[15]||(e[15]=t=>Y.value=t),"max-width":"800"},{default:l(()=>[o(U,{border:"",elevation:"0",rounded:"xl"},{default:l(()=>{var t;return[m("div",Mt,[m("div",Nt,[o(ve,{class:"mr-4",color:"white",size:"48"},{default:l(()=>[o(p,{color:"primary",icon:"mdi-silverware-fork-knife",size:"24"})]),_:1}),m("div",null,[m("div",Ot,f((t=de.value)==null?void 0:t.name),1),e[56]||(e[56]=m("div",{class:"text-body-2 text-white mt-1"}," Ingredients & Combinations ",-1))]),o(se),o(g,{color:"white",icon:"mdi-close",size:"small",variant:"text",onClick:e[12]||(e[12]=s=>Y.value=!1)})])]),o(N,{class:"pa-0"},{default:l(()=>[o(ft,{modelValue:B.value,"onUpdate:modelValue":e[13]||(e[13]=s=>B.value=s),grow:""},{default:l(()=>[o(ke,{value:"mandatory"},{default:l(()=>e[57]||(e[57]=[r("Mandatory Ingredients")])),_:1}),o(ke,{value:"groups"},{default:l(()=>e[58]||(e[58]=[r("Ingredient Groups")])),_:1})]),_:1},8,["modelValue"]),o(pt,{modelValue:B.value,"onUpdate:modelValue":e[14]||(e[14]=s=>B.value=s)},{default:l(()=>[o(Ce,{value:"mandatory"},{default:l(()=>{var s;return[m("div",Pt,[(s=te.value)!=null&&s.length?(u(),y("div",zt,[(u(!0),y(E,null,h(te.value,(n,d)=>(u(),_(U,{key:n.id||d,border:"",class:"mb-3 rounded-lg",hover:"",variant:"outlined"},{default:l(()=>[o(N,{class:"pa-4"},{default:l(()=>[m("div",Dt,[m("div",St,[m("div",Gt,f(n.item_name),1),m("div",jt,[o(T,{class:"mr-2",color:"primary",size:"small",variant:"flat"},{default:l(()=>[r(f(n.quantity_per_unit)+" "+f(n.unit),1)]),_:2},1024),o(p,{class:"mr-1",color:"orange",icon:"mdi-alert-circle",size:"16"}),e[60]||(e[60]=m("span",{class:"text-caption text-grey"},"Mandatory",-1))])]),o(ve,{color:"primary",size:"32",variant:"tonal"},{default:l(()=>[m("span",It,f(d+1),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))])):(u(),y("div",Tt,[o(p,{class:"mb-3",color:"grey",icon:"mdi-food-off",size:"48"}),e[59]||(e[59]=m("div",{class:"text-h6 text-grey"},"No Mandatory Ingredients",-1))]))])]}),_:1}),o(Ce,{value:"groups"},{default:l(()=>{var s;return[m("div",Lt,[(s=oe.value)!=null&&s.length?(u(),y("div",Ft,[(u(!0),y(E,null,h(oe.value,n=>(u(),_(U,{key:n.id,class:"mb-4",variant:"outlined"},{default:l(()=>[o(Z,{class:"bg-grey-lighten-3"},{default:l(()=>[r(f(n.name)+" ",1),o(T,{class:"ml-2",color:n.is_mandatory?"orange":"grey",size:"small"},{default:l(()=>[r(f(n.is_mandatory?"Mandatory":"Optional"),1)]),_:2},1032,["color"]),o(T,{class:"ml-2",color:"primary",size:"small"},{default:l(()=>[r(f(n.selection_mode),1)]),_:2},1024)]),_:2},1024),o(N,null,{default:l(()=>[n.description?(u(),y("div",Rt,f(n.description),1)):$("",!0),m("div",Qt,[e[62]||(e[62]=m("strong",null,"Available Options:",-1)),(u(!0),y(E,null,h(n.options,d=>(u(),_(T,{key:d.id,class:"ml-1",size:"small",variant:"outlined"},{default:l(()=>[r(f(d.item_name),1)]),_:2},1024))),128))]),m("div",null,[e[64]||(e[64]=m("strong",null,"Combinations:",-1)),(u(!0),y(E,null,h(n.combinations,d=>(u(),_(U,{key:d.id,class:"mt-2",variant:"outlined"},{default:l(()=>[o(Z,{class:"text-body-2 bg-grey-lighten-4"},{default:l(()=>[r(f(d.name)+" ",1),d.is_default?(u(),_(T,{key:0,class:"ml-2",color:"green",size:"small"},{default:l(()=>e[63]||(e[63]=[r(" Default ")])),_:1})):$("",!0)]),_:2},1024),o(N,null,{default:l(()=>[(u(!0),y(E,null,h(d.quantities,c=>(u(),y("div",{key:c.option_id,class:"text-caption"}," â€¢ "+f(Me(n.options,c.item_id))+": "+f(c.quantity_per_unit),1))),128))]),_:2},1024)]),_:2},1024))),128))])]),_:2},1024)]),_:2},1024))),128))])):(u(),y("div",Bt,[o(p,{class:"mb-3",color:"grey",icon:"mdi-group",size:"48"}),e[61]||(e[61]=m("div",{class:"text-h6 text-grey"},"No Ingredient Groups",-1))]))])]}),_:1})]),_:1},8,["modelValue"])]),_:1})]}),_:1})]),_:1},8,["modelValue"]),o(ie,{modelValue:z.value,"onUpdate:modelValue":e[18]||(e[18]=t=>z.value=t),persistent:"",width:"400"},{default:l(()=>[o(U,null,{default:l(()=>[o(ye,{color:"warning",title:"Confirm Deleting "+i.name},{default:l(()=>[o(g,{color:"white",icon:"mdi-close",onClick:e[16]||(e[16]=t=>z.value=!1)})]),_:1},8,["title"]),o(N,null,{default:l(()=>[r("Are you sure you want to delete "+f(i.name)+"?",1)]),_:1}),o(ge,{class:"d-flex justify-end"},{default:l(()=>[o(g,{color:"grey",onClick:e[17]||(e[17]=t=>z.value=!1)},{default:l(()=>e[65]||(e[65]=[r("Cancel")])),_:1}),o(g,{color:"error",onClick:Ke},{default:l(()=>e[66]||(e[66]=[r("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},fo=et(Xt,[["__scopeId","data-v-bf582d5f"]]);export{fo as default};
