import{_ as X,r as m,a0 as w,l as Y,s as $,x as l,a1 as Z,v as E,i as t,y as b,O as _,H as d,C as r,B as v,$ as F,aD as ee,a$ as te,I as S,a3 as P,D as ae,a5 as le,aV as k}from"./index-Hv2mhWCg.js";import{u as se,m as oe,r as B}from"./index-DZO4t4qf.js";import{V as re}from"./VContainer-9ajDumgj.js";import{V as D,b as N,c as j}from"./VCard-CYRuZxjU.js";import{V as T}from"./VCol-Dfno0pw1.js";import{V as x}from"./VTextField-Cx5gfnvz.js";import{V as M,a as ne,b as ie}from"./VDataTable-Br-2x4VM.js";import{V as ue}from"./VChip-Df1CGvfC.js";import{V as R}from"./VDialog-CSQI0hJx.js";import{V as de}from"./VForm-D-cJ6m4Y.js";import"./dialog-transition-DIP2spr7.js";import"./VSlideGroup-BYkN-FDY.js";const fe={class:"d-flex justify-space-between mb-4"},me={class:"d-flex justify-end align-center mt-4"},pe={class:"d-flex align-center flex-wrap"},ve={class:"text-white font-weight-bold text-h6"},Ve=10,ge={__name:"Staffs",setup(ce){const c=Z(),i=m(!1),p=m(!1),V=m(!1),f=m(!1),C=m(null),y=m(1),U=m(1),A=m([]),q=w({total_staff:""}),n=w({search:"",status:""}),I=[{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Position",key:"position"},{title:"Salary",key:"salary"},{title:"Hired Date",key:"hired_at"},{title:"Status",key:"status"},{title:"Edit",key:"edit"}],o=w({name:"",phone:"",position:"",salary:"",status:"Active"}),h={name:{required:B},salary:{required:B,minValue:oe(0)}},u=se(h,o),L=s=>s?Number(s).toLocaleString("en-US",{minimumFractionDigits:0})+" TSh":"0 TSh",O=s=>{switch(s){case"Active":return"green";case"Resigned":return"orange";case"Terminated":return"red";default:return"grey"}};async function g(){i.value=!0;const s=new URLSearchParams({page:y.value,limit:Ve});n.search&&s.append("search",n.search),n.status&&s.append("status",n.status);try{const a=await(await fetch(`/staffs?${s.toString()}`)).json();A.value=a.data||[],U.value=a.totalPages||1,q.total_staff=a.totalRecords||0}catch(e){console.error(e),c.commit("setMessage",{type:"error",text:"Failed to load staff"})}finally{i.value=!1}}function z(){y.value=1,g()}function H(){n.search="",n.status="",y.value=1,g()}function G(){f.value=!1,Object.assign(o,{name:"",phone:"",position:"",salary:"",status:"Active"}),p.value=!0,u.value.$reset()}function J(s){f.value=!0,C.value=s.id,Object.assign(o,s),p.value=!0,u.value.$reset()}async function K(){if(u.value.$touch(),u.value.$invalid)return;i.value=!0;const s=new FormData;s.append("name",o.name),s.append("phone",o.phone),s.append("position",o.position),s.append("salary",o.salary),s.append("status",o.status);const e=f.value?`/staffs/${C.value}`:"/staffs",a=f.value?"PUT":"POST";try{if(!(await fetch(e,{method:a,body:s})).ok)throw new Error("Failed to save");p.value=!1,g(),c.commit("setMessage",{type:"success",text:f.value?"Staff updated!":"Staff added!"})}catch{c.commit("setMessage",{type:"error",text:"Failed to save staff"})}finally{i.value=!1}}async function Q(){i.value=!0;try{await fetch(`/staffs/${C.value}`,{method:"DELETE"}),V.value=!1,p.value=!1,g(),c.commit("setMessage",{type:"success",text:"Staff deleted!"})}catch{c.commit("setMessage",{type:"error",text:"Failed to delete staff"})}finally{i.value=!1}}return Y(()=>g()),(s,e)=>(E(),$(re,{fluid:""},{default:l(()=>[t(D,{class:"pa-4 mb-4"},{default:l(()=>[t(_,{dense:""},{default:l(()=>[t(T,{cols:"12",sm:"4"},{default:l(()=>[t(x,{modelValue:n.search,"onUpdate:modelValue":e[0]||(e[0]=a=>n.search=a),"append-inner-icon":"mdi-close-circle",clearable:"",label:"Search Staff Name","onClick:appendInner":e[1]||(e[1]=a=>n.search="")},null,8,["modelValue"])]),_:1}),t(T,{cols:"12",sm:"3"},{default:l(()=>[t(M,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=a=>n.status=a),clearable:"",items:["Active","Resigned","Terminated"],label:"Filter by Status"},null,8,["modelValue"])]),_:1}),t(T,{class:"d-flex justify-end",cols:"12"},{default:l(()=>[t(d,{color:"primary",onClick:z},{default:l(()=>[t(v,{start:""},{default:l(()=>e[16]||(e[16]=[r("mdi-filter")])),_:1}),e[17]||(e[17]=r(" Apply "))]),_:1}),t(d,{class:"ml-2",color:"grey",onClick:H},{default:l(()=>[t(v,{start:""},{default:l(()=>e[18]||(e[18]=[r("mdi-refresh")])),_:1}),e[19]||(e[19]=r(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),b("div",fe,[e[22]||(e[22]=b("h3",null,"Staff Management",-1)),s.$store.getters.hasTask("can_add_staffs")?(E(),$(d,{key:0,class:"text-white",color:"primary",size:"small",onClick:G},{default:l(()=>[t(v,{start:""},{default:l(()=>e[20]||(e[20]=[r("mdi-plus")])),_:1}),e[21]||(e[21]=r(" Add Staff "))]),_:1})):F("",!0)]),t(ee,{active:i.value,indeterminate:i.value},null,8,["active","indeterminate"]),t(ne,{class:"elevation-1",dense:"",headers:I,height:"420",items:A.value,loading:i.value},te({"item.salary":l(({item:a})=>[r(S(L(a.salary)),1)]),"item.status":l(({item:a})=>[t(ue,{color:O(a.status),label:"",size:"small"},{default:l(()=>[r(S(a.status),1)]),_:2},1032,["color"])]),_:2},[s.$store.getters.hasTask("can_edit_staffs")?{name:"item.edit",fn:l(({item:a})=>[t(v,{color:"primary",onClick:W=>J(a)},{default:l(()=>e[23]||(e[23]=[r(" mdi-square-edit-outline ")])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["items","loading"]),b("div",me,[t(ie,{modelValue:y.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>y.value=a),g],length:U.value,"total-visible":"7"},null,8,["modelValue","length"])]),t(R,{modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=a=>p.value=a),"max-width":"600",transition:"dialog-top-transition"},{default:l(()=>[t(D,{class:"rounded-xl pa-4",elevation:"10"},{default:l(()=>[t(P,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:l(()=>[b("div",pe,[t(v,{class:"mr-2 text-white"},{default:l(()=>e[24]||(e[24]=[r("mdi-account")])),_:1}),b("span",ve,S(f.value?"Edit Staff":"Add Staff"),1)]),t(ae),t(d,{color:"white",icon:"mdi-close",onClick:e[4]||(e[4]=a=>p.value=!1)})]),_:1}),t(N,{class:"pt-6"},{default:l(()=>[t(de,{onSubmit:e[10]||(e[10]=le(()=>{},["prevent"]))},{default:l(()=>[t(x,{modelValue:o.name,"onUpdate:modelValue":e[5]||(e[5]=a=>o.name=a),"bg-color":"#E0E0E0","error-messages":k(u).name.$errors.map(a=>a.$message),label:"Full Name",required:"",onBlur:k(u).name.$touch},null,8,["modelValue","error-messages","onBlur"]),t(x,{modelValue:o.phone,"onUpdate:modelValue":e[6]||(e[6]=a=>o.phone=a),"bg-color":"#E0E0E0",label:"Phone Number"},null,8,["modelValue"]),t(x,{modelValue:o.position,"onUpdate:modelValue":e[7]||(e[7]=a=>o.position=a),"bg-color":"#E0E0E0",label:"Position"},null,8,["modelValue"]),t(x,{modelValue:o.salary,"onUpdate:modelValue":e[8]||(e[8]=a=>o.salary=a),"bg-color":"#E0E0E0","error-messages":k(u).salary.$errors.map(a=>a.$message),label:"Salary (TSh)",required:"",type:"number",onBlur:k(u).salary.$touch},null,8,["modelValue","error-messages","onBlur"]),t(M,{modelValue:o.status,"onUpdate:modelValue":e[9]||(e[9]=a=>o.status=a),"bg-color":"#E0E0E0",items:["Active","Resigned","Terminated"],label:"Status",required:""},null,8,["modelValue"])]),_:1})]),_:1}),t(j,{class:"d-flex justify-end"},{default:l(()=>[t(d,{color:"success",disabled:k(u).$invalid,loading:i.value,onClick:K},{default:l(()=>[t(v,{start:""},{default:l(()=>e[25]||(e[25]=[r("mdi-content-save")])),_:1}),r(" "+S(f.value?"Save Changes":"Add Staff"),1)]),_:1},8,["disabled","loading"]),f.value?(E(),$(d,{key:0,color:"error",onClick:e[11]||(e[11]=a=>V.value=!0)},{default:l(()=>[t(v,{start:""},{default:l(()=>e[26]||(e[26]=[r("mdi-delete")])),_:1}),e[27]||(e[27]=r(" Delete "))]),_:1})):F("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(R,{modelValue:V.value,"onUpdate:modelValue":e[15]||(e[15]=a=>V.value=a),persistent:"",width:"400"},{default:l(()=>[t(D,null,{default:l(()=>[t(P,{color:"warning",title:"Confirm Deleting "+o.name},{default:l(()=>[t(d,{color:"white",icon:"mdi-close",onClick:e[13]||(e[13]=a=>V.value=!1)})]),_:1},8,["title"]),t(N,null,{default:l(()=>[r("Are you sure you want to delete "+S(o.name)+"?",1)]),_:1}),t(j,{class:"d-flex justify-end"},{default:l(()=>[t(d,{color:"grey",onClick:e[14]||(e[14]=a=>V.value=!1)},{default:l(()=>e[28]||(e[28]=[r("Cancel")])),_:1}),t(d,{color:"error",onClick:Q},{default:l(()=>e[29]||(e[29]=[r("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ae=X(ge,[["__scopeId","data-v-ffd1d9f2"]]);export{Ae as default};
