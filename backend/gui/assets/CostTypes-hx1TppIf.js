import{_ as ee,r as u,$ as E,k as te,q as k,t as w,v as a,h as t,x as i,N as Y,G as f,B as o,A as g,H as c,Z as T,ae,aM as le,a2 as q,C as se,a4 as oe,ay as $}from"./index-D9cZNx3d.js";import{u as re,r as D}from"./index-C16oOmSc.js";import{V as N,b as B,c as I}from"./VCard-BjfRmh3q.js";import{V as m}from"./VCol-CkxF1Ihr.js";import{V as R}from"./VTextField-BbL5CjgL.js";import{V as A,a as ne,b as ie}from"./VDataTable-CEOIylXn.js";import{V as S}from"./VAlert-Dm1Y7Iwi.js";import{V as z}from"./VChip-BuGryoYn.js";import{V as L}from"./VDialog-7c1Isxk_.js";import{V as de}from"./VForm-BWpc7Lay.js";import{V as ue}from"./VContainer-CCsgfsl3.js";import"./dialog-transition-DrLwMtH5.js";import"./VSlideGroup-C0nbVrpN.js";const fe={class:"d-flex justify-space-between flex-wrap"},me={class:"d-flex justify-space-between mb-4"},ge={class:"d-flex justify-end align-center mt-4"},ce={class:"d-flex align-center flex-wrap"},pe={class:"text-white font-weight-bold text-h6"},ye=10,ve={__name:"CostTypes",setup(Ve){const d=u(!1),j=u([]),V=u(!1),p=u(!1),y=u(!1),M=u(null),x=u(1),U=u(1),C=E({total_types:0,affects_margin:0,no_affect_margin:0}),n=E({search:"",category:"",affects_margin:""}),F=["Production Cost","Sale Cost","Administrative Cost","Other Cost"],O=[{text:"Yes - Affects Margin",value:"Yes"},{text:"No - Doesn't Affect Margin",value:"No"}],G=[{title:"Name",key:"name"},{title:"Category",key:"category"},{title:"Affects Margin",key:"affects_margin",align:"center"},{title:"Created Date",key:"created_at"},{title:"Actions",key:"actions",sortable:!1,align:"center"}],r=E({name:"",category:"",affects_margin:"Yes"}),v=re({name:{required:D},category:{required:D},affects_margin:{required:D}},r),H=s=>({"Production Cost":"blue","Sale Cost":"green","Administrative Cost":"orange","Other Cost":"grey"})[s]||"grey";async function _(){d.value=!0;const s=new URLSearchParams({page:x.value,limit:ye});n.search&&s.append("search",n.search),n.category&&s.append("category",n.category),n.affects_margin&&s.append("affects_margin",n.affects_margin);try{const l=await(await fetch(`/expenditures/types?${s}`)).json();j.value=l.data||[],U.value=l.totalPages||1,C.total_types=l.totalRecords||0,l.data&&(C.affects_margin=l.data.filter(b=>b.affects_margin==="Yes").length,C.no_affect_margin=l.data.filter(b=>b.affects_margin==="No").length)}catch(e){console.error("Failed to load cost types",e)}finally{d.value=!1}}function J(){x.value=1,_()}function Z(){n.search="",n.category="",n.affects_margin="",x.value=1,_()}function K(){y.value=!1,Object.assign(r,{name:"",category:"",affects_margin:"Yes"}),V.value=!0,v.value.$reset()}async function Q(s){y.value=!0,M.value=s.id,Object.assign(r,{name:s.name,category:s.category,affects_margin:s.affects_margin}),V.value=!0}async function W(){if(v.value.$touch(),!v.value.$invalid){d.value=!0;try{const s={name:r.name,category:r.category,affects_margin:r.affects_margin},e=y.value?"PUT":"POST",l=y.value?`/expenditures/types/${M.value}`:"/expenditures/types";if(!(await fetch(l,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to save");V.value=!1,_()}finally{d.value=!1}}}const P=u(null);function X(s){P.value=s,Object.assign(r,{name:s.name,category:s.category,affects_margin:s.affects_margin}),p.value=!0}async function h(){d.value=!0;try{await fetch(`/expenditures/types/${P.value.id}`,{method:"DELETE"}),p.value=!1,_()}catch(s){console.error("Failed to delete",s)}finally{d.value=!1}}return te(()=>{_()}),(s,e)=>(w(),k(ue,{fluid:""},{default:a(()=>[t(N,{class:"pa-4 mb-4"},{default:a(()=>[t(Y,{dense:""},{default:a(()=>[t(m,{cols:"12",sm:"4"},{default:a(()=>[t(R,{modelValue:n.search,"onUpdate:modelValue":e[0]||(e[0]=l=>n.search=l),"append-inner-icon":"mdi-close-circle",clearable:"",label:"Search Cost Type","onClick:appendInner":e[1]||(e[1]=l=>n.search="")},null,8,["modelValue"])]),_:1}),t(m,{cols:"12",sm:"4"},{default:a(()=>[t(A,{modelValue:n.category,"onUpdate:modelValue":e[2]||(e[2]=l=>n.category=l),clearable:"",items:F,label:"Filter by Category"},null,8,["modelValue"])]),_:1}),t(m,{cols:"12",sm:"4"},{default:a(()=>[t(A,{modelValue:n.affects_margin,"onUpdate:modelValue":e[3]||(e[3]=l=>n.affects_margin=l),clearable:"","item-title":"text","item-value":"value",items:O,label:"Filter by Margin Effect"},null,8,["modelValue"])]),_:1}),t(m,{class:"d-flex justify-end",cols:"12"},{default:a(()=>[t(f,{color:"primary",onClick:J},{default:a(()=>[t(g,{start:""},{default:a(()=>e[15]||(e[15]=[o("mdi-filter")])),_:1}),e[16]||(e[16]=o(" Apply "))]),_:1}),t(f,{class:"ml-2",color:"grey",onClick:Z},{default:a(()=>[t(g,{start:""},{default:a(()=>e[17]||(e[17]=[o("mdi-refresh")])),_:1}),e[18]||(e[18]=o(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),t(S,{border:"start",class:"mb-4",type:"info",variant:"outlined"},{default:a(()=>[i("div",fe,[i("div",null,[e[19]||(e[19]=i("strong",null,"Total Cost Types:",-1)),o(" "+c(C.total_types||"0"),1)]),i("div",null,[e[20]||(e[20]=i("strong",null,"Affects Margin:",-1)),o(" "+c(C.affects_margin||"0"),1)]),i("div",null,[e[21]||(e[21]=i("strong",null,"Doesn't Affect Margin:",-1)),o(" "+c(C.no_affect_margin||"0"),1)])])]),_:1}),i("div",me,[e[24]||(e[24]=i("h3",null,"Cost Types",-1)),s.$store.getters.hasTask("can_add_settings")?(w(),k(f,{key:0,class:"text-white",color:"primary",size:"small",onClick:K},{default:a(()=>[t(g,{start:""},{default:a(()=>e[22]||(e[22]=[o("mdi-plus")])),_:1}),e[23]||(e[23]=o(" Add Cost Type "))]),_:1})):T("",!0)]),t(ae,{active:d.value,indeterminate:d.value},null,8,["active","indeterminate"]),t(ne,{class:"elevation-1",dense:"",headers:G,height:"400",items:j.value,loading:d.value},le({"item.affects_margin":a(({item:l})=>[t(z,{color:l.affects_margin==="Yes"?"success":"grey",size:"small"},{default:a(()=>[o(c(l.affects_margin==="Yes"?"Affects Margin":"No Effect"),1)]),_:2},1032,["color"])]),"item.category":a(({item:l})=>[t(z,{color:H(l.category),size:"small",variant:"outlined"},{default:a(()=>[o(c(l.category),1)]),_:2},1032,["color"])]),_:2},[s.$store.getters.hasTask("can_add_settings")?{name:"item.actions",fn:a(({item:l})=>[t(g,{class:"mr-2",color:"primary",onClick:b=>Q(l)},{default:a(()=>e[25]||(e[25]=[o(" mdi-square-edit-outline ")])),_:2},1032,["onClick"]),t(g,{color:"error",onClick:b=>X(l)},{default:a(()=>e[26]||(e[26]=[o(" mdi-delete ")])),_:2},1032,["onClick"])]),key:"0"}:void 0]),1032,["items","loading"]),i("div",ge,[t(ie,{modelValue:x.value,"onUpdate:modelValue":[e[4]||(e[4]=l=>x.value=l),_],length:U.value,"total-visible":"7"},null,8,["modelValue","length"])]),t(L,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=l=>V.value=l),"max-width":"600",transition:"dialog-top-transition"},{default:a(()=>[t(N,{class:"rounded-xl pa-4",elevation:"10"},{default:a(()=>[t(q,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:a(()=>[i("div",ce,[t(g,{class:"mr-2 text-white"},{default:a(()=>e[27]||(e[27]=[o("mdi-tag-text")])),_:1}),i("span",pe,c(y.value?"Edit Cost Type":"Add Cost Type"),1)]),t(se),t(f,{color:"white",icon:"mdi-close",onClick:e[5]||(e[5]=l=>V.value=!1)})]),_:1}),t(B,{class:"pt-6"},{default:a(()=>[t(de,{onSubmit:e[9]||(e[9]=oe(()=>{},["prevent"]))},{default:a(()=>[t(Y,{dense:""},{default:a(()=>[t(m,{cols:"12",sm:"6"},{default:a(()=>[t(R,{modelValue:r.name,"onUpdate:modelValue":e[6]||(e[6]=l=>r.name=l),"bg-color":"#E0E0E0","error-messages":$(v).name.$errors.map(l=>l.$message),label:"Cost Type Name",required:""},null,8,["modelValue","error-messages"])]),_:1}),t(m,{cols:"12",sm:"6"},{default:a(()=>[t(A,{modelValue:r.category,"onUpdate:modelValue":e[7]||(e[7]=l=>r.category=l),"bg-color":"#E0E0E0","error-messages":$(v).category.$errors.map(l=>l.$message),items:F,label:"Category",required:""},null,8,["modelValue","error-messages"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[t(A,{modelValue:r.affects_margin,"onUpdate:modelValue":e[8]||(e[8]=l=>r.affects_margin=l),"bg-color":"#E0E0E0","error-messages":$(v).affects_margin.$errors.map(l=>l.$message),hint:"Select 'Yes' if this cost type should be deducted from gross margin","item-title":"text","item-value":"value",items:O,label:"Affects Margin Calculation","persistent-hint":"",required:""},null,8,["modelValue","error-messages"])]),_:1}),r.affects_margin==="Yes"?(w(),k(m,{key:0,cols:"12"},{default:a(()=>[t(S,{density:"compact",type:"info",variant:"outlined"},{default:a(()=>e[28]||(e[28]=[i("small",null,"This cost type will be included in net margin calculations and deducted from gross margin.",-1)])),_:1})]),_:1})):T("",!0),r.affects_margin==="No"?(w(),k(m,{key:1,cols:"12"},{default:a(()=>[t(S,{density:"compact",type:"warning",variant:"outlined"},{default:a(()=>e[29]||(e[29]=[i("small",null,"This cost type will NOT affect margin calculations and will be excluded from net margin.",-1)])),_:1})]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1}),t(I,{class:"d-flex justify-end mt-2"},{default:a(()=>[t(f,{color:"success",disabled:$(v).$invalid,loading:d.value,onClick:W},{default:a(()=>[t(g,{start:""},{default:a(()=>e[30]||(e[30]=[o("mdi-content-save")])),_:1}),o(" "+c(y.value?"Save Changes":"Add Cost Type"),1)]),_:1},8,["disabled","loading"]),y.value?(w(),k(f,{key:0,color:"error",onClick:e[10]||(e[10]=l=>p.value=!0)},{default:a(()=>[t(g,{start:""},{default:a(()=>e[31]||(e[31]=[o("mdi-delete")])),_:1}),e[32]||(e[32]=o(" Delete "))]),_:1})):T("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:p.value,"onUpdate:modelValue":e[14]||(e[14]=l=>p.value=l),persistent:"",width:"400"},{default:a(()=>[t(N,null,{default:a(()=>[t(q,{color:"warning",title:"Confirm Deleting "+r.name},{default:a(()=>[t(f,{color:"white",icon:"mdi-close",onClick:e[12]||(e[12]=l=>p.value=!1)})]),_:1},8,["title"]),t(B,null,{default:a(()=>[o('Are you sure you want to delete "'+c(r.name)+'"? This action cannot be undone.',1)]),_:1}),t(I,{class:"d-flex justify-end"},{default:a(()=>[t(f,{color:"grey",onClick:e[13]||(e[13]=l=>p.value=!1)},{default:a(()=>e[33]||(e[33]=[o("Cancel")])),_:1}),t(f,{color:"error",onClick:h},{default:a(()=>e[34]||(e[34]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Me=ee(ve,[["__scopeId","data-v-65a33562"]]);export{Me as default};
