import{E as T}from"./index-DhHccx1m.js";import{_ as ee,r as k,$ as H,d as I,k as te,q as le,v as l,a1 as ae,t as oe,h as t,N as h,B as o,A as m,x as f,H as s,i as re,ay as $,G as D,C as j,ae as O}from"./index-AufZmc18.js";import{u as ie,i as ne,a as se,b as de,c as ue,d as me,e as fe,f as ce,g as pe}from"./install-_nF_yPR_.js";import{V as ge}from"./VContainer-B7y45AGF.js";import{V as d}from"./VCol-qt5Pa_73.js";import{V as p,a as V,b as x}from"./VCard-gCB2bKvl.js";import{V as B}from"./VAutocomplete-BDItiCEQ.js";import{V as C}from"./VChip-BDEO4N76.js";import{a as F}from"./VDataTable-srb2EwFM.js";import"./VTextField-CslDACNS.js";import"./VSlideGroup-BhO_YnhD.js";import"./dialog-transition-TuGUUa7Q.js";const ve={class:"text-h5 font-weight-bold text-green-darken-2"},ye={class:"text-h5 font-weight-bold text-orange-darken-2"},be={class:"text-h5 font-weight-bold text-blue-darken-2"},xe={class:"text-h5 font-weight-bold text-purple-darken-2"},_e={class:"text-h5 font-weight-bold text-red-darken-2"},ke={class:"d-flex gap-2"},Ce={__name:"ProfitProjection",setup(he){ie([ne,se,de,ue,me,fe,ce,pe]);const g=k(!1),i=H({totalRevenue:0,totalIngredientCost:0,totalLabourCost:0,totalExpenditure:0,totalCost:0,margin:0}),P=k([]),L=k([]),S=k([]),R=k([]),A=k([]),E=k([]),_=k(null),u=H({ingredients:[],products:[],team_leader:""}),W=[{title:"Ingredient",key:"ingredient_name",sortable:!0},{title:"Qty Consumed",key:"total_consumed",sortable:!0,align:"end"},{title:"Unit Price",key:"avg_price",sortable:!0,align:"end"},{title:"Total Cost",key:"total_cost",sortable:!0,align:"end"}],G=[{title:"Product",key:"product_name",sortable:!0},{title:"Qty Produced",key:"total_produced",sortable:!0,align:"end"},{title:"Selling Price",key:"selling_price",sortable:!0,align:"end"},{title:"Total Amount",key:"total_value",sortable:!0,align:"end"},{title:"Team Leader",key:"team_leader",sortable:!0}],Q=[{title:"Cost Type",key:"cost_type",sortable:!0},{title:"Amount",key:"amount",sortable:!0,align:"end"}],q=I(()=>({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"Cost Distribution",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:18,fontWeight:"bold"}},labelLine:{show:!1},data:[{value:i.totalIngredientCost,name:"Ingredients",itemStyle:{color:"#ff9800"}},{value:i.totalLabourCost,name:"Labour",itemStyle:{color:"#2196f3"}},{value:i.totalExpenditure,name:"Other Expenditures",itemStyle:{color:"#9c27b0"}},{value:i.margin,name:"Profit Margin",itemStyle:{color:i.margin>=0?"#4caf50":"#f44336"}}]}]})),Y=I(()=>{const n=i.totalRevenue>0?N(i.margin/i.totalRevenue*100):0;return{series:[{type:"gauge",startAngle:180,endAngle:0,min:-50,max:100,splitNumber:15,axisLine:{lineStyle:{width:6,color:[[.166,"#ff6b6b"],[.333,"#ffa726"],[.5,"#ffd93d"],[.666,"#d4e157"],[.833,"#9ccc65"],[1,"#6bcf7f"]]}},pointer:{icon:"path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",length:"12%",width:20,offsetCenter:[0,"-60%"],itemStyle:{color:"auto"}},axisTick:{length:12,lineStyle:{color:"auto",width:2}},splitLine:{length:20,lineStyle:{color:"auto",width:5}},axisLabel:{color:"#464646",fontSize:12,distance:-60,formatter(e){return e===-50?"Loss":e===0?"Break Even":e===50?"Good":e===100?"Excellent":""}},title:{offsetCenter:[0,"-20%"],fontSize:16,fontWeight:"bold"},detail:{fontSize:24,offsetCenter:[0,"0%"],valueAnimation:!0,formatter:"{value}%",color:"auto",fontWeight:"bold"},data:[{value:Math.max(-50,Math.min(100,n)),name:"Profit Margin %"}]}]}}),Z=I(()=>{const n=S.value.reduce((a,c)=>{const y=c.cost_type||"Other";return a[y]||(a[y]=0),a[y]+=Number(c.amount)||0,a},{}),e=Object.keys(n),b=e.map(a=>n[a]);return{tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:"{b}: {c}"},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",data:e,axisLabel:{rotate:45}},yAxis:{type:"value",axisLabel:{formatter:"{value} TZS"}},series:[{name:"Expenditure Amount",type:"bar",data:b,itemStyle:{color(a){const c=["#9c27b0","#673ab7","#3f51b5","#2196f3","#03a9f4"];return c[a.dataIndex%c.length]}},label:{show:!0,position:"top",formatter:"{c}"}}]}});function v(n){return Number(n||0).toLocaleString(void 0,{style:"currency",currency:"TZS",maximumFractionDigits:2})}function N(n){const e=Number(n||0);return parseFloat(e.toLocaleString(void 0,{maximumFractionDigits:3}))}function M(n){if(!n)return"";const e=new Date(n),b=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),c=String(e.getDate()).padStart(2,"0");return`${b}-${a}-${c}`}function J(){const n=new URLSearchParams;return Array.isArray(_.value)&&_.value[0]&&_.value[1]&&(n.append("start",M(_.value[0])),n.append("end",M(_.value[1]))),Array.isArray(u.ingredients)&&u.ingredients.length&&u.ingredients.forEach(e=>n.append("ingredients",e)),Array.isArray(u.products)&&u.products.length&&u.products.forEach(e=>n.append("products",e)),u.team_leader&&n.append("team_leader",String(u.team_leader)),n.toString()}async function z(){var n,e,b,a,c,y;g.value=!0;try{const w=J(),r=await(await fetch(`/reports/productionProfitability?${w}`)).json();i.totalRevenue=Number(((n=r==null?void 0:r.totals)==null?void 0:n.totalRevenue)||0),i.totalIngredientCost=Number(((e=r==null?void 0:r.totals)==null?void 0:e.totalIngredientCost)||0),i.totalLabourCost=Number(((b=r==null?void 0:r.totals)==null?void 0:b.totalLabourCost)||0),i.totalExpenditure=Number(((a=r==null?void 0:r.totals)==null?void 0:a.totalExpenditure)||0),i.totalCost=Number(((c=r==null?void 0:r.totals)==null?void 0:c.totalCost)||0),i.margin=Number(((y=r==null?void 0:r.totals)==null?void 0:y.margin)||0),P.value=(r==null?void 0:r.ingredients)||[],L.value=(r==null?void 0:r.products)||[],S.value=(r==null?void 0:r.expenditures)||[]}catch(w){console.error("Failed to load report:",w),P.value=[],L.value=[],S.value=[],Object.keys(i).forEach(U=>i[U]=0)}finally{g.value=!1}}async function K(){try{const[n,e,b]=await Promise.all([fetch("/items?limit=1000&page=1"),fetch("/products?limit=1000&page=1"),fetch("/staffs?status=Active&limit=1000&page=1")]),[a,c,y]=await Promise.all([n.json(),e.json(),b.json()]);R.value=(a==null?void 0:a.data)||a||[],A.value=(c==null?void 0:c.data)||c||[],E.value=((y==null?void 0:y.data)||y||[]).map(w=>({id:w.id,name:w.name}))}catch(n){console.error("Failed to load lookups:",n),R.value=[],A.value=[],E.value=[]}}function X(){_.value=null,u.ingredients=[],u.products=[],u.team_leader="",z()}return te(async()=>{await K(),await z()}),(n,e)=>{const b=ae("VueDatePicker");return oe(),le(ge,{class:"report-container",fluid:""},{default:l(()=>[t(h,null,{default:l(()=>[t(d,{cols:"12"},{default:l(()=>[t(p,{class:"pa-4",color:"primary",dark:""},{default:l(()=>[t(V,{class:"text-h4 font-weight-bold"},{default:l(()=>[t(m,{class:"mr-3",large:""},{default:l(()=>e[4]||(e[4]=[o("mdi-chart-arc")])),_:1}),e[5]||(e[5]=o(" Profit Projection Dashboard "))]),_:1})]),_:1})]),_:1})]),_:1}),t(h,{class:"mt-4"},{default:l(()=>[t(d,{cols:"12",md:"2",sm:"6"},{default:l(()=>[t(p,{class:"profit-card",color:"green-lighten-5",elevation:"4"},{default:l(()=>[t(x,{class:"text-center"},{default:l(()=>[t(m,{class:"mb-2",color:"green-darken-2",size:"48"},{default:l(()=>e[6]||(e[6]=[o("mdi-currency-usd")])),_:1}),f("div",ve,s(v(i.totalRevenue)),1),e[7]||(e[7]=f("div",{class:"text-caption text-grey"},"Total Revenue",-1))]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"2",sm:"6"},{default:l(()=>[t(p,{class:"cost-card",color:"orange-lighten-5",elevation:"4"},{default:l(()=>[t(x,{class:"text-center"},{default:l(()=>[t(m,{class:"mb-2",color:"orange-darken-2",size:"48"},{default:l(()=>e[8]||(e[8]=[o("mdi-sack")])),_:1}),f("div",ye,s(v(i.totalIngredientCost)),1),e[9]||(e[9]=f("div",{class:"text-caption text-grey"},"Ingredient Cost",-1))]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"2",sm:"6"},{default:l(()=>[t(p,{class:"cost-card",color:"blue-lighten-5",elevation:"4"},{default:l(()=>[t(x,{class:"text-center"},{default:l(()=>[t(m,{class:"mb-2",color:"blue-darken-2",size:"48"},{default:l(()=>e[10]||(e[10]=[o("mdi-account-hard-hat")])),_:1}),f("div",be,s(v(i.totalLabourCost)),1),e[11]||(e[11]=f("div",{class:"text-caption text-grey"},"Labour Cost",-1))]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"2",sm:"6"},{default:l(()=>[t(p,{class:"cost-card",color:"purple-lighten-5",elevation:"4"},{default:l(()=>[t(x,{class:"text-center"},{default:l(()=>[t(m,{class:"mb-2",color:"purple-darken-2",size:"48"},{default:l(()=>e[12]||(e[12]=[o("mdi-cash-multiple")])),_:1}),f("div",xe,s(v(i.totalExpenditure)),1),e[13]||(e[13]=f("div",{class:"text-caption text-grey"},"Other Expenditures",-1))]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"2",sm:"6"},{default:l(()=>[t(p,{class:"cost-card",color:"red-lighten-5",elevation:"4"},{default:l(()=>[t(x,{class:"text-center"},{default:l(()=>[t(m,{class:"mb-2",color:"red-darken-2",size:"48"},{default:l(()=>e[14]||(e[14]=[o("mdi-calculator")])),_:1}),f("div",_e,s(v(i.totalCost)),1),e[15]||(e[15]=f("div",{class:"text-caption text-grey"},"Total Cost",-1))]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"2",sm:"6"},{default:l(()=>[t(p,{class:"margin-card",color:i.margin>=0?"teal-lighten-5":"red-lighten-5",elevation:"4"},{default:l(()=>[t(x,{class:"text-center"},{default:l(()=>[t(m,{class:"mb-2",color:i.margin>=0?"teal-darken-2":"red-darken-2",size:"48"},{default:l(()=>[o(s(i.margin>=0?"mdi-trending-up":"mdi-trending-down"),1)]),_:1},8,["color"]),f("div",{class:re(["text-h5 font-weight-bold",i.margin>=0?"text-teal-darken-2":"text-red-darken-2"])},s(v(i.margin)),3),e[16]||(e[16]=f("div",{class:"text-caption text-grey"},"Profit Margin",-1))]),_:1})]),_:1},8,["color"])]),_:1})]),_:1}),t(h,{class:"mt-6"},{default:l(()=>[t(d,{cols:"12",md:"6"},{default:l(()=>[t(p,{class:"chart-card",elevation:"4"},{default:l(()=>[t(V,{class:"text-h6"},{default:l(()=>[t(m,{class:"mr-2"},{default:l(()=>e[17]||(e[17]=[o("mdi-chart-pie")])),_:1}),e[18]||(e[18]=o(" Cost Distribution "))]),_:1}),t(x,null,{default:l(()=>[t($(T),{autoresize:!0,option:q.value,style:{height:"300px"}},null,8,["option"])]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"6"},{default:l(()=>[t(p,{class:"chart-card",elevation:"4"},{default:l(()=>[t(V,{class:"text-h6"},{default:l(()=>[t(m,{class:"mr-2"},{default:l(()=>e[19]||(e[19]=[o("mdi-gauge")])),_:1}),e[20]||(e[20]=o(" Profitability Ratio "))]),_:1}),t(x,null,{default:l(()=>[t($(T),{autoresize:!0,option:Y.value,style:{height:"300px"}},null,8,["option"])]),_:1})]),_:1})]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(d,{cols:"12",md:"12"},{default:l(()=>[t(p,{class:"mb-6",elevation:"2",rounded:"lg"},{default:l(()=>[t(x,{class:"pa-4"},{default:l(()=>[t(h,{dense:""},{default:l(()=>[t(d,{cols:"12",md:"4"},{default:l(()=>[e[21]||(e[21]=f("div",{class:"mb-1 text-caption text-grey"}," Production Date Range ",-1)),t(b,{modelValue:_.value,"onUpdate:modelValue":e[0]||(e[0]=a=>_.value=a),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100","enable-time-picker":!1,placeholder:"Select date range",range:"",teleport:!0},null,8,["modelValue"])]),_:1}),t(d,{cols:"12",md:"3"},{default:l(()=>[t(B,{modelValue:u.ingredients,"onUpdate:modelValue":e[1]||(e[1]=a=>u.ingredients=a),autocomplete:"off",autocorrect:"off",chips:"",clearable:"","closable-chips":"",density:"comfortable",inputmode:"none","item-title":"name","item-value":"id",items:R.value,spellcheck:"false",label:"Ingredients",multiple:"","prepend-inner-icon":"mdi-food-apple",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(d,{cols:"12",md:"3"},{default:l(()=>[t(B,{modelValue:u.products,"onUpdate:modelValue":e[2]||(e[2]=a=>u.products=a),autocomplete:"off",autocorrect:"off",chips:"",clearable:"","closable-chips":"",density:"comfortable",inputmode:"none","item-title":"name","item-value":"id",items:A.value,spellcheck:"false",label:"Products",multiple:"","prepend-inner-icon":"mdi-package-variant",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(d,{cols:"12",md:"2"},{default:l(()=>[t(B,{modelValue:u.team_leader,"onUpdate:modelValue":e[3]||(e[3]=a=>u.team_leader=a),autocomplete:"off",autocorrect:"off",clearable:"",density:"comfortable",hint:u.team_leader?"Filtering by selected leader":"Leave empty to include all leaders",inputmode:"none","item-title":"name","item-value":"id",items:E.value,label:"Team Leader",spellcheck:"false","persistent-hint":"","prepend-inner-icon":"mdi-account-tie",variant:"outlined"},null,8,["modelValue","hint","items"])]),_:1}),t(d,{class:"d-flex justify-end",cols:"12"},{default:l(()=>[f("div",ke,[t(D,{color:"primary",loading:g.value,onClick:z},{default:l(()=>[t(m,{start:""},{default:l(()=>e[22]||(e[22]=[o("mdi-filter")])),_:1}),e[23]||(e[23]=o(" Apply Filters "))]),_:1},8,["loading"]),t(D,{color:"primary",loading:g.value,variant:"flat",onClick:z},{default:l(()=>[t(m,{start:""},{default:l(()=>e[24]||(e[24]=[o("mdi-refresh")])),_:1}),e[25]||(e[25]=o(" Refresh "))]),_:1},8,["loading"]),t(D,{color:"grey",disabled:g.value,variant:"outlined",onClick:X},{default:l(()=>[t(m,{start:""},{default:l(()=>e[26]||(e[26]=[o("mdi-broom")])),_:1}),e[27]||(e[27]=o(" Reset "))]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1}),t(h,null,{default:l(()=>[t(d,{cols:"12",md:"4"},{default:l(()=>[t(p,{elevation:"2",rounded:"lg"},{default:l(()=>[t(V,{class:"d-flex align-center"},{default:l(()=>[t(m,{class:"mr-2",color:"primary"},{default:l(()=>e[28]||(e[28]=[o("mdi-food-variant")])),_:1}),e[29]||(e[29]=o(" Ingredients Consumed ")),t(j),t(C,{color:"primary",size:"small",variant:"tonal"},{default:l(()=>[o(s(P.value.length)+" item(s) ",1)]),_:1})]),_:1}),t(O,{active:g.value,color:"primary",height:"3",indeterminate:g.value},null,8,["active","indeterminate"]),t(F,{class:"elevation-0",density:"comfortable",headers:W,hover:"",items:P.value},{"item.total_consumed":l(({item:a})=>[o(s(N(a.total_consumed)),1)]),"item.avg_price":l(({item:a})=>[o(s(v(a.avg_price)),1)]),"item.total_cost":l(({item:a})=>[t(C,{color:"orange",size:"small",variant:"flat"},{default:l(()=>[o(s(v(a.total_cost)),1)]),_:2},1024)]),"no-data":l(()=>e[30]||(e[30]=[f("div",{class:"text-center py-6 text-grey"}," No ingredients for selected filters. ",-1)])),_:1},8,["items"])]),_:1})]),_:1}),t(d,{cols:"12",md:"3"},{default:l(()=>[t(p,{elevation:"2",rounded:"lg"},{default:l(()=>[t(V,{class:"d-flex align-center"},{default:l(()=>[t(m,{class:"mr-2",color:"purple"},{default:l(()=>e[31]||(e[31]=[o("mdi-cash-multiple")])),_:1}),e[32]||(e[32]=o(" Other Expenditures ")),t(j),t(C,{color:"purple",size:"small",variant:"tonal"},{default:l(()=>[o(s(S.value.length)+" item(s) ",1)]),_:1})]),_:1}),t(O,{active:g.value,color:"purple",height:"3",indeterminate:g.value},null,8,["active","indeterminate"]),t(F,{class:"elevation-0",density:"comfortable",headers:Q,hover:"",items:S.value},{"item.amount":l(({item:a})=>[t(C,{color:"purple",size:"small",variant:"flat"},{default:l(()=>[o(s(v(a.amount)),1)]),_:2},1024)]),"item.cost_type":l(({item:a})=>[t(C,{color:"deep-purple",size:"small",variant:"outlined"},{default:l(()=>[o(s(a.cost_type),1)]),_:2},1024)]),"no-data":l(()=>e[33]||(e[33]=[f("div",{class:"text-center py-6 text-grey"}," No expenditures for selected filters. ",-1)])),_:1},8,["items"])]),_:1})]),_:1}),t(d,{cols:"12",md:"5"},{default:l(()=>[t(p,{elevation:"2",rounded:"lg"},{default:l(()=>[t(V,{class:"d-flex align-center"},{default:l(()=>[t(m,{class:"mr-2",color:"primary"},{default:l(()=>e[34]||(e[34]=[o("mdi-package-variant")])),_:1}),e[35]||(e[35]=o(" Products Produced ")),t(j),t(C,{color:"primary",size:"small",variant:"tonal"},{default:l(()=>[o(s(L.value.length)+" product(s) ",1)]),_:1})]),_:1}),t(O,{active:g.value,color:"primary",height:"3",indeterminate:g.value},null,8,["active","indeterminate"]),t(F,{class:"elevation-0",density:"comfortable",headers:G,hover:"",items:L.value},{"item.total_produced":l(({item:a})=>[o(s(N(a.total_produced)),1)]),"item.selling_price":l(({item:a})=>[o(s(v(a.selling_price)),1)]),"item.total_value":l(({item:a})=>[t(C,{color:"green",size:"small",variant:"flat"},{default:l(()=>[o(s(v(a.total_value)),1)]),_:2},1024)]),"item.team_leader":l(({item:a})=>[t(C,{color:"blue",size:"small",variant:"outlined"},{default:l(()=>[t(m,{size:"14",start:""},{default:l(()=>e[36]||(e[36]=[o("mdi-account-tie")])),_:1}),o(" "+s(a.team_leader),1)]),_:2},1024)]),"no-data":l(()=>e[37]||(e[37]=[f("div",{class:"text-center py-6 text-grey"}," No products for selected filters. ",-1)])),_:1},8,["items"])]),_:1})]),_:1})]),_:1}),t(h,{class:"mt-4"},{default:l(()=>[t(d,{cols:"12"},{default:l(()=>[t(p,{elevation:"2",rounded:"lg"},{default:l(()=>[t(V,{class:"d-flex align-center"},{default:l(()=>[t(m,{class:"mr-2",color:"deep-purple"},{default:l(()=>e[38]||(e[38]=[o("mdi-chart-bar")])),_:1}),e[39]||(e[39]=o(" Expenditure Breakdown by Category "))]),_:1}),t(x,null,{default:l(()=>[t($(T),{autoresize:!0,option:Z.value,style:{height:"400px"}},null,8,["option"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},$e=ee(Ce,[["__scopeId","data-v-55c50f82"]]);export{$e as default};
