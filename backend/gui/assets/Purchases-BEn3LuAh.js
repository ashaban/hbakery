import{_ as qe,r as f,$,e as ke,l as we,s as O,x as a,a0 as _e,a1 as Pe,v as _,i as t,y as i,H as y,C as n,O as Z,I as m,A as Q,B as c,E as I,a2 as D,F as h,Q as De,a3 as ee,a4 as te,D as E,a5 as ae,j as le,T as Ce}from"./index-CuMV6di3.js";import{h as oe}from"./moment-C5S46NFB.js";import{V as Ue}from"./VContainer-C4bV-9UQ.js";import{V as g,b as M,d as re,c as ie}from"./VCard-Bc391oxu.js";import{V as C}from"./VCol-CjmsdnHv.js";import{V as R}from"./VAutocomplete-D3zximuH.js";import{V as Fe,a as $e,b as Me}from"./VDataTable-ChORe5xA.js";import{V as se}from"./VChip-ZPEXUT-r.js";import{V as Te}from"./VSkeletonLoader-CC7RybwI.js";import{V as ne}from"./VDialog-CmVpAP_y.js";import{V as de}from"./VForm-YyT9asQ3.js";import{V as Y}from"./VTextField-CjsJoSZp.js";import"./dialog-transition-Cab09yLL.js";import"./VSlideGroup-Bd5aveAd.js";const Se={class:"d-flex align-center justify-space-between"},je={class:"text-h6 font-weight-bold"},Ie={class:"d-flex align-center justify-space-between"},Ee={class:"text-h6 font-weight-bold text-blue"},Ye={class:"d-flex align-center justify-space-between"},Ne={class:"text-h6 font-weight-bold text-green"},Ae={class:"d-flex gap-2"},Be={class:"d-flex justify-end mt-4"},Oe={class:"font-weight-medium"},Qe={class:"text-center py-6 text-grey"},Re={class:"d-flex justify-space-between align-center pa-4"},ze={class:"text-caption text-grey"},Le={class:"d-flex justify-space-between align-center"},Je={class:"text-h6 font-weight-bold text-green"},Ge={class:"d-flex flex-column"},He={key:0,class:"text-caption text-error mt-1"},Ke={class:"d-flex justify-space-between align-center"},We={class:"text-h6 font-weight-bold text-green"},Xe={class:"d-flex flex-column"},Ze={key:0,class:"text-caption text-error mt-1"},he={__name:"Purchases",setup(et){_e();const N=f([]),T=f([]),A=f(!1),b=f(!1),U=f(!1),q=f(!1),F=f(1),z=f(1),L=f(0),B=f(null),ue=f(null),me=f(null),V=$({total_quantity:0,total_amount:0}),r=$({item_id:"",quantity:"",price:"",date:""}),s=$({item_id:"",quantity:"",price:"",date:""}),k=$({show:!1,message:"",color:"success"}),d=$({item_id:"",date_operator:"",date:"",date_from:"",date_to:""}),pe=ke(()=>!V.total_amount||!V.total_quantity?0:V.total_amount/V.total_quantity),fe=[{title:"Item",key:"item_name"},{title:"Quantity",key:"quantity",align:"end"},{title:"Unit Price",key:"price",align:"end"},{title:"Total Amount",key:"total",align:"end"},{title:"Purchase Date",key:"date"},{title:"Actions",key:"actions",align:"center",sortable:!1}],ye=[{label:"Equals (=)",value:"="},{label:"Greater Than (>)",value:">"},{label:"Less Than (<)",value:"<"},{label:"Greater or Equal (>=)",value:">="},{label:"Less or Equal (<=)",value:"<="},{label:"In Range",value:"in"}];function P(o){return Number(o||0).toLocaleString(void 0,{minimumFractionDigits:2})}function v(o,e="success"){k.message=o,k.color=e,k.show=!0}function S(){return r.quantity&&r.price?r.quantity*r.price:0}function p(o){switch(o){case"item_id":s.item_id=r.item_id?"":"Item selection is required";break;case"quantity":!r.quantity&&r.quantity!==0?s.quantity="Quantity is required":Number.isInteger(Number(r.quantity))?r.quantity<=0?s.quantity="Quantity must be positive":s.quantity="":s.quantity="Quantity must be a whole number";break;case"price":!r.price&&r.price!==0?s.price="Unit price is required":isNaN(r.price)?s.price="Unit price must be a valid number":r.price<=0?s.price="Unit price must be positive":s.price="";break;case"date":s.date=r.date?"":"Purchase date is required";break}}function x(o){s[o]=""}function J(){return p("item_id"),p("quantity"),p("price"),p("date"),!s.item_id&&!s.quantity&&!s.price&&!s.date}async function ce(){try{const o=await fetch("/items");T.value=await o.json()}catch(o){console.error("Failed to load items:",o),v("Failed to load items","error")}}async function w(){A.value=!0;try{const o=new URLSearchParams({page:F.value,limit:10});if(d.item_id&&o.append("item_id",d.item_id),d.date_operator&&d.date_operator!=="in"&&d.date){const l={"=":"date",">":"date_gt","<":"date_lt",">=":"date_from","<=":"date_to"};o.append(l[d.date_operator],d.date)}d.date_operator==="in"&&d.date_from&&d.date_to&&(o.append("date_from",d.date_from),o.append("date_to",d.date_to));const u=await(await fetch(`/purchases?${o}`)).json();N.value=u.data||[],z.value=u.totalPages||1,L.value=u.totalRecords||0,V.total_quantity=u.total_quantity||0,V.total_amount=u.total_amount||0}catch(o){console.error("Failed to load purchases:",o),v("Failed to load purchases","error")}finally{A.value=!1}}function ve(){F.value=1,w()}function ge(){Object.assign(d,{item_id:"",date_operator:"",date:"",date_from:"",date_to:""}),F.value=1,w()}function be(){Object.assign(r,{item_id:"",quantity:"",price:"",date:""}),Object.keys(s).forEach(o=>s[o]=""),U.value=!0}function G(){U.value=!1,Object.keys(s).forEach(o=>s[o]="")}function Ve(o){var e,u,l,j;B.value=o,Object.assign(r,{item_id:o.item_id,quantity:((u=(e=o.quantity)==null?void 0:e.replace)==null?void 0:u.call(e,/,/g,""))||o.quantity,price:((j=(l=o.price)==null?void 0:l.replace)==null?void 0:j.call(l,/,/g,""))||o.price,date:o.date?o.date:""}),Object.keys(s).forEach(xe=>s[xe]=""),q.value=!0}function H(){q.value=!1,Object.keys(s).forEach(o=>s[o]="")}async function K(){if(!J()){v("Please fix the validation errors","error");return}b.value=!0;try{const o={...r,date:oe(r.date,"DD-MM-YYYY").format("YYYY-MM-DD")};if(console.log(JSON.stringify(o,0,2)),!(await fetch("/purchases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Save failed");U.value=!1,v("Purchase added successfully"),await w()}catch(o){console.error("Failed to create purchase:",o),v("Failed to add purchase","error")}finally{b.value=!1}}async function W(){if(!J()){v("Please fix the validation errors","error");return}b.value=!0;try{const o={...r,date:oe(r.date,"DD-MM-YYYY").format("YYYY-MM-DD")};if(!(await fetch(`/purchases/${B.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Update failed");q.value=!1,v("Purchase updated successfully"),await w()}catch(o){console.error("Failed to update purchase:",o),v("Failed to update purchase","error")}finally{b.value=!1}}async function X(o){if(confirm(`Are you sure you want to delete purchase of "${o.item_name}"?`)){b.value=!0;try{if(!(await fetch(`/purchases/${o.id}`,{method:"DELETE"})).ok)throw new Error("Delete failed");v("Purchase deleted successfully"),q.value&&(q.value=!1),await w()}catch(e){console.error("Failed to delete purchase:",e),v("Failed to delete purchase","error")}finally{b.value=!1}}}return we(async()=>{await ce(),await w()}),(o,e)=>{const u=Pe("VueDatePicker");return _(),O(Ue,{class:"py-6",fluid:""},{default:a(()=>[t(g,{class:"mb-6",elevation:"2",rounded:"lg"},{default:a(()=>[t(M,{class:"d-flex align-center justify-space-between"},{default:a(()=>[e[35]||(e[35]=i("div",null,[i("h2",{class:"text-h5 font-weight-bold text-primary mb-1"}," Purchase Management "),i("p",{class:"text-body-2 text-grey"}," Track and manage inventory purchases and costs ")],-1)),t(y,{color:"primary","prepend-icon":"mdi-cart-plus",onClick:be},{default:a(()=>e[34]||(e[34]=[n(" New Purchase ")])),_:1})]),_:1})]),_:1}),t(Z,{class:"mb-4"},{default:a(()=>[t(C,{cols:"12",md:"4"},{default:a(()=>[t(g,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[i("div",Se,[i("div",null,[e[36]||(e[36]=i("div",{class:"text-body-2 text-grey"},"Total Purchases",-1)),i("div",je,m(P(V.total_amount)),1)]),t(Q,{color:"primary",size:"40",variant:"tonal"},{default:a(()=>[t(c,{color:"primary"},{default:a(()=>e[37]||(e[37]=[n("mdi-cash")])),_:1})]),_:1})])]),_:1})]),_:1}),t(C,{cols:"12",md:"4"},{default:a(()=>[t(g,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[i("div",Ie,[i("div",null,[e[38]||(e[38]=i("div",{class:"text-body-2 text-grey"},"Total Quantity",-1)),i("div",Ee,m(parseFloat(V.total_quantity)||0),1)]),t(Q,{color:"blue",size:"40",variant:"tonal"},{default:a(()=>[t(c,{color:"blue"},{default:a(()=>e[39]||(e[39]=[n("mdi-package-variant")])),_:1})]),_:1})])]),_:1})]),_:1}),t(C,{cols:"12",md:"4"},{default:a(()=>[t(g,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[i("div",Ye,[i("div",null,[e[40]||(e[40]=i("div",{class:"text-body-2 text-grey"},"Avg. Unit Price",-1)),i("div",Ne,m(P(pe.value)),1)]),t(Q,{color:"green",size:"40",variant:"tonal"},{default:a(()=>[t(c,{color:"green"},{default:a(()=>e[41]||(e[41]=[n("mdi-tag")])),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),t(g,{class:"mb-4",elevation:"2",rounded:"lg"},{default:a(()=>[t(M,null,{default:a(()=>[t(Z,{dense:""},{default:a(()=>[t(C,{cols:"12",md:"4"},{default:a(()=>[t(R,{modelValue:d.item_id,"onUpdate:modelValue":e[0]||(e[0]=l=>d.item_id=l),autocomplete:"off",autocorrect:"off",clearable:"",color:"primary",inputmode:"none","item-title":"name","item-value":"id",items:T.value,label:"Filter by Item",spellcheck:"false",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(C,{cols:"12",md:"3"},{default:a(()=>[t(Fe,{modelValue:d.date_operator,"onUpdate:modelValue":e[1]||(e[1]=l=>d.date_operator=l),clearable:"","item-title":"label","item-value":"value",items:ye,label:"Date Filter",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(C,{cols:"12",md:"5"},{default:a(()=>[d.date_operator&&d.date_operator!=="in"?(_(),I(h,{key:0},[t(re,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[42]||(e[42]=[n(" Select Date ")])),_:1}),t(u,{modelValue:d.date,"onUpdate:modelValue":e[2]||(e[2]=l=>d.date=l),"auto-apply":"",class:"border rounded-lg px-4 py-2",format:"dd-MM-yyyy","model-type":"format",placeholder:"Select Date",teleport:!0},null,8,["modelValue"])],64)):D("",!0),d.date_operator==="in"?(_(),I(h,{key:1},[t(re,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[43]||(e[43]=[n(" Date Range ")])),_:1}),i("div",Ae,[t(u,{modelValue:d.date_from,"onUpdate:modelValue":e[3]||(e[3]=l=>d.date_from=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"From",teleport:!0},null,8,["modelValue"]),t(u,{modelValue:d.date_to,"onUpdate:modelValue":e[4]||(e[4]=l=>d.date_to=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"To",teleport:!0},null,8,["modelValue"])])],64)):D("",!0)]),_:1})]),_:1}),i("div",Be,[t(y,{color:"primary","prepend-icon":"mdi-filter",onClick:ve},{default:a(()=>e[44]||(e[44]=[n(" Apply Filters ")])),_:1}),t(y,{class:"ml-2","prepend-icon":"mdi-close-circle",variant:"outlined",onClick:ge},{default:a(()=>e[45]||(e[45]=[n(" Clear ")])),_:1})])]),_:1})]),_:1}),t(g,{elevation:"2",rounded:"lg"},{default:a(()=>[t(M,{class:"pa-0"},{default:a(()=>[t($e,{class:"rounded-lg",density:"comfortable",headers:fe,hover:"",items:N.value,loading:A.value},{loading:a(()=>[t(Te,{type:"table-row@10"})]),"item.quantity":a(({item:l})=>[t(se,{color:"blue",variant:"flat"},{default:a(()=>[n(m(parseFloat(l.quantity)),1)]),_:2},1024)]),"item.price":a(({item:l})=>[i("span",Oe,m(P(l.price)),1)]),"item.total":a(({item:l})=>[t(se,{color:"green",variant:"flat"},{default:a(()=>[n(m(P(l.total)),1)]),_:2},1024)]),"item.date":a(({item:l})=>[n(m(l.date),1)]),"item.actions":a(({item:l})=>[t(y,{color:"blue",icon:"",size:"small",variant:"text",onClick:j=>Ve(l)},{default:a(()=>[t(c,null,{default:a(()=>e[46]||(e[46]=[n("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),t(y,{color:"red",icon:"",size:"small",variant:"text",onClick:j=>X(l)},{default:a(()=>[t(c,null,{default:a(()=>e[47]||(e[47]=[n("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),"no-data":a(()=>[i("div",Qe,[t(c,{color:"grey-lighten-2",size:"48"},{default:a(()=>e[48]||(e[48]=[n("mdi-cart-remove")])),_:1}),e[49]||(e[49]=i("div",null,"No purchases found",-1))])]),_:1},8,["items","loading"]),t(De),i("div",Re,[i("span",ze," Showing "+m(N.value.length)+" of "+m(L.value)+" records ",1),t(Me,{modelValue:F.value,"onUpdate:modelValue":[e[5]||(e[5]=l=>F.value=l),w],color:"primary",length:z.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1}),t(ne,{modelValue:U.value,"onUpdate:modelValue":e[18]||(e[18]=l=>U.value=l),"max-width":"600px",persistent:""},{default:a(()=>[t(g,null,{default:a(()=>[t(ee,{class:"text-white",color:"primary",density:"comfortable"},{default:a(()=>[t(te,null,{default:a(()=>[t(c,{start:""},{default:a(()=>e[50]||(e[50]=[n("mdi-cart-plus")])),_:1}),e[51]||(e[51]=n(" Add New Purchase "))]),_:1}),t(E),t(y,{color:"white",icon:"mdi-close",variant:"text",onClick:G})]),_:1}),t(M,{class:"pa-4"},{default:a(()=>[t(de,{ref_key:"addFormRef",ref:ue,onSubmit:ae(K,["prevent"])},{default:a(()=>[t(R,{modelValue:r.item_id,"onUpdate:modelValue":e[6]||(e[6]=l=>r.item_id=l),autocomplete:"off",autocorrect:"off",color:"primary","error-messages":s.item_id,inputmode:"none","item-title":"name","item-value":"id",items:T.value,label:"Item *",required:"",spellcheck:"false",variant:"outlined",onBlur:e[7]||(e[7]=l=>p("item_id")),onInput:e[8]||(e[8]=l=>x("item_id"))},{label:a(()=>e[52]||(e[52]=[i("span",{class:"required-field"},"Item",-1)])),_:1},8,["modelValue","error-messages","items"]),t(Y,{modelValue:r.quantity,"onUpdate:modelValue":e[9]||(e[9]=l=>r.quantity=l),modelModifiers:{number:!0},autocomplete:"off",autocorrect:"off",color:"primary","error-messages":s.quantity,inputmode:"none",label:"Quantity *",required:"",spellcheck:"false",type:"number",variant:"outlined",onBlur:e[10]||(e[10]=l=>p("quantity")),onInput:e[11]||(e[11]=l=>{x("quantity"),S()})},{label:a(()=>e[53]||(e[53]=[i("span",{class:"required-field"},"Quantity",-1)])),_:1},8,["modelValue","error-messages"]),t(Y,{modelValue:r.price,"onUpdate:modelValue":e[12]||(e[12]=l=>r.price=l),modelModifiers:{number:!0},autocomplete:"off",autocorrect:"off",color:"primary","error-messages":s.price,inputmode:"none",label:"Unit Price *",prefix:"$",required:"",spellcheck:"false",type:"number",variant:"outlined",onBlur:e[13]||(e[13]=l=>p("price")),onInput:e[14]||(e[14]=l=>{x("price"),S()})},{label:a(()=>e[54]||(e[54]=[i("span",{class:"required-field"},"Unit Price",-1)])),_:1},8,["modelValue","error-messages"]),r.quantity&&r.price?(_(),O(g,{key:0,class:"mb-4 pa-3",color:"green-lighten-5",variant:"outlined"},{default:a(()=>[i("div",Le,[e[55]||(e[55]=i("span",{class:"font-weight-medium"},"Total Amount:",-1)),i("span",Je,m(P(r.quantity*r.price)),1)])]),_:1})):D("",!0),i("div",Ge,[e[56]||(e[56]=i("label",{class:"text-caption text-grey mb-1 required-field"},"Purchase Date *",-1)),t(u,{modelValue:r.date,"onUpdate:modelValue":[e[15]||(e[15]=l=>r.date=l),e[17]||(e[17]=l=>x("date"))],"auto-apply":"",class:le(["rounded-lg","border","px-4","py-2","w-100",s.date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"Purchase Date",teleport:!0,onBlur:e[16]||(e[16]=l=>p("date"))},null,8,["modelValue","class"]),s.date?(_(),I("div",He,m(s.date),1)):D("",!0)])]),_:1},512)]),_:1}),t(ie,{class:"pa-4"},{default:a(()=>[t(E),t(y,{color:"grey",variant:"outlined",onClick:G},{default:a(()=>e[57]||(e[57]=[n("Cancel")])),_:1}),t(y,{color:"primary",loading:b.value,onClick:K},{default:a(()=>[t(c,{start:""},{default:a(()=>e[58]||(e[58]=[n("mdi-content-save")])),_:1}),e[59]||(e[59]=n(" Save "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ne,{modelValue:q.value,"onUpdate:modelValue":e[32]||(e[32]=l=>q.value=l),"max-width":"600px",persistent:""},{default:a(()=>[t(g,null,{default:a(()=>[t(ee,{class:"text-white",color:"primary",density:"comfortable"},{default:a(()=>[t(te,null,{default:a(()=>[t(c,{start:""},{default:a(()=>e[60]||(e[60]=[n("mdi-cart-edit")])),_:1}),e[61]||(e[61]=n(" Edit Purchase "))]),_:1}),t(E),t(y,{color:"white",icon:"mdi-close",variant:"text",onClick:H})]),_:1}),t(M,{class:"pa-4"},{default:a(()=>[t(de,{ref_key:"editFormRef",ref:me,onSubmit:ae(W,["prevent"])},{default:a(()=>[t(R,{modelValue:r.item_id,"onUpdate:modelValue":e[19]||(e[19]=l=>r.item_id=l),autocomplete:"off",autocorrect:"off",color:"primary","error-messages":s.item_id,inputmode:"none","item-title":"name","item-value":"id",items:T.value,label:"Item *",required:"",spellcheck:"false",variant:"outlined",onBlur:e[20]||(e[20]=l=>p("item_id")),onInput:e[21]||(e[21]=l=>x("item_id"))},{label:a(()=>e[62]||(e[62]=[i("span",{class:"required-field"},"Item",-1)])),_:1},8,["modelValue","error-messages","items"]),t(Y,{modelValue:r.quantity,"onUpdate:modelValue":e[22]||(e[22]=l=>r.quantity=l),modelModifiers:{number:!0},autocomplete:"off",autocorrect:"off",color:"primary","error-messages":s.quantity,inputmode:"none",label:"Quantity *",required:"",spellcheck:"false",type:"number",variant:"outlined",onBlur:e[23]||(e[23]=l=>p("quantity")),onInput:e[24]||(e[24]=l=>{x("quantity"),S()})},{label:a(()=>e[63]||(e[63]=[i("span",{class:"required-field"},"Quantity",-1)])),_:1},8,["modelValue","error-messages"]),t(Y,{modelValue:r.price,"onUpdate:modelValue":e[25]||(e[25]=l=>r.price=l),modelModifiers:{number:!0},autocomplete:"off",autocorrect:"off",color:"primary","error-messages":s.price,inputmode:"none",label:"Unit Price *",prefix:"$",required:"",spellcheck:"false",type:"number",variant:"outlined",onBlur:e[26]||(e[26]=l=>p("price")),onInput:e[27]||(e[27]=l=>{x("price"),S()})},{label:a(()=>e[64]||(e[64]=[i("span",{class:"required-field"},"Unit Price",-1)])),_:1},8,["modelValue","error-messages"]),r.quantity&&r.price?(_(),O(g,{key:0,class:"mb-4 pa-3",color:"green-lighten-5",variant:"outlined"},{default:a(()=>[i("div",Ke,[e[65]||(e[65]=i("span",{class:"font-weight-medium"},"Total Amount:",-1)),i("span",We,m(P(r.quantity*r.price)),1)])]),_:1})):D("",!0),i("div",Xe,[e[66]||(e[66]=i("label",{class:"text-caption text-grey mb-1 required-field"},"Purchase Date *",-1)),t(u,{modelValue:r.date,"onUpdate:modelValue":[e[28]||(e[28]=l=>r.date=l),e[30]||(e[30]=l=>x("date"))],"auto-apply":"",class:le(["rounded-lg","border","px-4","py-2","w-100",s.date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"Purchase Date",teleport:!0,onBlur:e[29]||(e[29]=l=>p("date"))},null,8,["modelValue","class"]),s.date?(_(),I("div",Ze,m(s.date),1)):D("",!0)])]),_:1},512)]),_:1}),t(ie,{class:"pa-4"},{default:a(()=>[t(y,{color:"red",variant:"outlined",onClick:e[31]||(e[31]=l=>X(B.value))},{default:a(()=>[t(c,{start:""},{default:a(()=>e[67]||(e[67]=[n("mdi-delete")])),_:1}),e[68]||(e[68]=n(" Delete "))]),_:1}),t(E),t(y,{color:"grey",variant:"outlined",onClick:H},{default:a(()=>e[69]||(e[69]=[n("Cancel")])),_:1}),t(y,{color:"primary",loading:b.value,onClick:W},{default:a(()=>[t(c,{start:""},{default:a(()=>e[70]||(e[70]=[n("mdi-content-save")])),_:1}),e[71]||(e[71]=n(" Update "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ce,{modelValue:k.show,"onUpdate:modelValue":e[33]||(e[33]=l=>k.show=l),color:k.color,timeout:"3000"},{default:a(()=>[n(m(k.message),1)]),_:1},8,["modelValue","color"])]),_:1})}}},ct=qe(he,[["__scopeId","data-v-e1f9e222"]]);export{ct as default};
