import{g as wt,p as Ct,ag as ht,r as x,ah as Ne,ai as St,aj as Dt,a7 as rt,ak as It,d as j,al as Ue,am as fe,an as At,c as De,ao as dt,f as Pt,h as t,x as s,A as f,ap as qt,F as ve,a5 as oe,K as ft,L as Ie,O as Oe,aq as Et,z as me,ar as Tt,n as Nt,i as vt,as as Ut,B as n,a9 as zt,at as Ft,ab as Rt,au as ct,av as Ot,aw as $t,_ as Mt,$ as mt,k as Bt,q as le,v as l,a0 as Lt,t as w,N as _e,Z as ue,G as I,ae as jt,H as m,C as ce,a2 as Ke,a3 as Qe,D as F,ax as Gt,Q as Ht,E as ze,M as Je,af as Ye}from"./index-AufZmc18.js";import{V as Kt}from"./VContainer-B7y45AGF.js";import{V as N,b as L,a as he,c as Fe}from"./VCard-gCB2bKvl.js";import{V as C}from"./VCol-qt5Pa_73.js";import{u as Qt,h as Jt,i as Yt,f as Wt,j as Zt,k as Xt,l as el,n as tl,o as ll,V as Re,a as al,b as ol,g as nl}from"./VDataTable-srb2EwFM.js";import{u as ul,V as ae,c as sl}from"./VTextField-CslDACNS.js";import{V as st}from"./VTooltip-Dp2cEJll.js";import{V as Y}from"./VChip-BDEO4N76.js";import{V as We}from"./VDialog-FeWyYRdM.js";import{V as il}from"./VTextarea-C5VuRVbY.js";import{V as Se}from"./VAlert-M8Cz99WB.js";import{V as rl}from"./VAutocomplete-BDItiCEQ.js";import"./dialog-transition-TuGUUa7Q.js";import"./VSlideGroup-BhO_YnhD.js";const dl=Ct({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...ll({filterKeys:["title"]}),...tl({hideNoData:!0,returnObject:!0}),...Rt(sl({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Ft({transition:!1})},"VCombobox"),cl=wt()({name:"VCombobox",props:dl(),emits:{"update:focused":r=>!0,"update:modelValue":r=>!0,"update:search":r=>!0,"update:menu":r=>!0},setup(r,U){var Ge;let{emit:W,slots:y}=U;const{t:Ae}=ht(),R=x(),G=Ne(!1),Z=Ne(!0),de=Ne(!1),xe=x(),pe=x(),_=Ne(-1);let X=!1;const{items:ye,transformIn:se,transformOut:ge}=St(r),{textColorClasses:Ve,textColorStyles:be}=Dt(()=>{var i;return(i=R.value)==null?void 0:i.color}),g=rt(r,"modelValue",[],i=>se(It(i)),i=>{const v=ge(i);return r.multiple?v:v[0]??null}),ne=ul(r),T=j(()=>!!(r.chips||y.chip)),q=j(()=>T.value||!!y.selection),S=Ne(!r.multiple&&!q.value?((Ge=g.value[0])==null?void 0:Ge.title)??"":""),A=j({get:()=>S.value,set:async i=>{var v;if(S.value=i??"",!r.multiple&&!q.value&&(g.value=[Ue(r,i)],fe(()=>{var V;return(V=pe.value)==null?void 0:V.scrollToIndex(0)})),i&&r.multiple&&((v=r.delimiters)!=null&&v.length)){const V=r.delimiters.map(At).join("|"),b=i.split(new RegExp(`(?:${V})+`));if(b.length>1){for(let k of b)k=k.trim(),k&&(K(Ue(r,k)),await fe());S.value=""}}i||(_.value=-1),Z.value=!i}}),D=j(()=>typeof r.counterValue=="function"?r.counterValue(g.value):typeof r.counterValue=="number"?r.counterValue:r.multiple?g.value.length:A.value.length),{filteredItems:E,getMatches:$e}=Qt(r,ye,()=>r.alwaysFilter||!Z.value?A.value:""),O=j(()=>r.hideSelected?E.value.filter(i=>!g.value.some(v=>v.value===i.value)):E.value),d=j(()=>r.hideNoData&&!O.value.length||ne.isReadonly.value||ne.isDisabled.value),ie=rt(r,"menu"),h=j({get:()=>ie.value,set:i=>{var v;ie.value&&!i&&((v=xe.value)!=null&&v.Î¨openChildren.size)||i&&d.value||(ie.value=i)}}),{menuId:Ze,ariaExpanded:Xe,ariaControls:et,ariaLabel:re}=Jt(r,h);De(S,i=>{X?fe(()=>X=!1):G.value&&!h.value&&(h.value=!0),W("update:search",i)}),De(g,i=>{var v;!r.multiple&&!q.value&&(S.value=((v=i[0])==null?void 0:v.title)??"")});const tt=j(()=>g.value.map(i=>i.value)),ke=j(()=>{var v;return(r.autoSelectFirst===!0||r.autoSelectFirst==="exact"&&A.value===((v=O.value[0])==null?void 0:v.title))&&O.value.length>0&&!Z.value&&!de.value}),we=x(),Me=Yt(we,R);function H(i){X=!0,fe(()=>X=!1),r.openOnClear&&(h.value=!0)}function lt(){d.value||(h.value=!0)}function at(i){d.value||(G.value&&(i.preventDefault(),i.stopPropagation()),h.value=!h.value)}function ot(i){var v;(ct(i)||i.key==="Backspace")&&((v=R.value)==null||v.focus())}function $(i){var b,k,P,Q;if(Ot(i)||ne.isReadonly.value)return;const v=(b=R.value)==null?void 0:b.selectionStart,V=g.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(i.key)&&i.preventDefault(),["Enter","ArrowDown"].includes(i.key)&&(h.value=!0),["Escape"].includes(i.key)&&(h.value=!1),["Enter","Escape","Tab"].includes(i.key)&&(ke.value&&["Enter","Tab"].includes(i.key)&&!g.value.some(p=>{let{value:M}=p;return M===O.value[0].value})&&K(E.value[0]),Z.value=!0),i.key==="ArrowDown"&&ke.value&&((k=we.value)==null||k.focus("next")),i.key==="Enter"&&A.value&&(K(Ue(r,A.value)),q.value&&(S.value="")),["Backspace","Delete"].includes(i.key)){if(!r.multiple&&q.value&&g.value.length>0&&!A.value)return K(g.value[0],!1);if(~_.value){i.preventDefault();const p=_.value;K(g.value[_.value],!1),_.value=p>=V-1?V-2:p}else i.key==="Backspace"&&!A.value&&(_.value=V-1);return}if(r.multiple)if(i.key==="ArrowLeft"){if(_.value<0&&v&&v>0)return;const p=_.value>-1?_.value-1:V-1;g.value[p]?_.value=p:(_.value=-1,(P=R.value)==null||P.setSelectionRange(A.value.length,A.value.length))}else if(i.key==="ArrowRight"){if(_.value<0)return;const p=_.value+1;g.value[p]?_.value=p:(_.value=-1,(Q=R.value)==null||Q.setSelectionRange(0,0))}else~_.value&&ct(i)&&(_.value=-1)}function Ce(){var i;r.eager&&((i=pe.value)==null||i.calculateVisibleItems())}function Be(){var i;G.value&&(Z.value=!0,(i=R.value)==null||i.focus())}function K(i){let v=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!i||i.props.disabled))if(r.multiple){const V=g.value.findIndex(k=>(r.valueComparator||dt)(k.value,i.value)),b=v??!~V;if(~V){const k=b?[...g.value,i]:[...g.value];k.splice(V,1),g.value=k}else b&&(g.value=[...g.value,i]);r.clearOnSelect&&(A.value="")}else{const V=v!==!1;g.value=V?[i]:[],S.value=V&&!q.value?i.title:"",fe(()=>{h.value=!1,Z.value=!0})}}function Pe(i){G.value=!0,setTimeout(()=>{de.value=!0})}function Le(i){de.value=!1}function je(i){(i==null||i===""&&!r.multiple&&!q.value)&&(g.value=[])}return De(G,(i,v)=>{if(!(i||i===v)&&(_.value=-1,h.value=!1,A.value)){if(r.multiple){K(Ue(r,A.value));return}if(!q.value)return;g.value.some(V=>{let{title:b}=V;return b===A.value})?S.value="":K(Ue(r,A.value))}}),De(h,()=>{if(!r.hideSelected&&h.value&&g.value.length){const i=O.value.findIndex(v=>g.value.some(V=>(r.valueComparator||dt)(V.value,v.value)));$t&&window.requestAnimationFrame(()=>{var v;i>=0&&((v=pe.value)==null||v.scrollToIndex(i))})}}),De(ye,(i,v)=>{h.value||G.value&&!v.length&&i.length&&(h.value=!0)}),Pt(()=>{const i=!!(!r.hideNoData||O.value.length||y["prepend-item"]||y["append-item"]||y["no-data"]),v=g.value.length>0,V=ae.filterProps(r);return t(ae,oe({ref:R},V,{modelValue:A.value,"onUpdate:modelValue":[b=>A.value=b,je],focused:G.value,"onUpdate:focused":b=>G.value=b,validationValue:g.externalValue,counterValue:D.value,dirty:v,class:["v-combobox",{"v-combobox--active-menu":h.value,"v-combobox--chips":!!r.chips,"v-combobox--selection-slot":!!q.value,"v-combobox--selecting-index":_.value>-1,[`v-combobox--${r.multiple?"multiple":"single"}`]:!0},r.class],style:r.style,readonly:ne.isReadonly.value,placeholder:v?void 0:r.placeholder,"onClick:clear":H,"onMousedown:control":lt,onKeydown:$,"aria-expanded":Xe.value,"aria-controls":et.value}),{...y,default:()=>s(ve,null,[t(Wt,oe({id:Ze.value,ref:xe,modelValue:h.value,"onUpdate:modelValue":b=>h.value=b,activator:"parent",contentClass:"v-combobox__content",disabled:d.value,eager:r.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:r.transition,onAfterEnter:Ce,onAfterLeave:Be},r.menuProps),{default:()=>[i&&t(ft,oe({ref:we,filterable:!0,selected:tt.value,selectStrategy:r.multiple?"independent":"single-independent",onMousedown:b=>b.preventDefault(),selectable:!0,onKeydown:ot,onFocusin:Pe,onFocusout:Le,tabindex:"-1","aria-live":"polite",color:r.itemColor??r.color},Me,r.listProps),{default:()=>{var b,k,P;return[(b=y["prepend-item"])==null?void 0:b.call(y),!O.value.length&&!r.hideNoData&&(((k=y["no-data"])==null?void 0:k.call(y))??t(Ie,{key:"no-data",title:Ae(r.noDataText)},null)),t(Zt,{ref:pe,renderless:!0,items:O.value,itemKey:"value"},{default:Q=>{var He,B,Ee;let{item:p,index:M,itemRef:z}=Q;const qe=oe(p.props,{ref:z,key:p.value,active:ke.value&&M===0?!0:void 0,onClick:()=>K(p,null)});return p.type==="divider"?((He=y.divider)==null?void 0:He.call(y,{props:p.raw,index:M}))??t(Oe,oe(p.props,{key:`divider-${M}`}),null):p.type==="subheader"?((B=y.subheader)==null?void 0:B.call(y,{props:p.raw,index:M}))??t(Et,oe(p.props,{key:`subheader-${M}`}),null):((Ee=y.item)==null?void 0:Ee.call(y,{item:p,index:M,props:qe}))??t(Ie,oe(qe,{role:"option"}),{prepend:ee=>{let{isSelected:nt}=ee;return s(ve,null,[r.multiple&&!r.hideSelected?t(el,{key:p.value,modelValue:nt,ripple:!1,tabindex:"-1"},null):void 0,p.props.prependAvatar&&t(me,{image:p.props.prependAvatar},null),p.props.prependIcon&&t(f,{icon:p.props.prependIcon},null)])},title:()=>{var ee;return Z.value?p.title:Xt("v-combobox",p.title,(ee=$e(p))==null?void 0:ee.title)}})}}),(P=y["append-item"])==null?void 0:P.call(y)]}})]}),g.value.map((b,k)=>{function P(z){z.stopPropagation(),z.preventDefault(),K(b,!1)}const Q={"onClick:close":P,onKeydown(z){z.key!=="Enter"&&z.key!==" "||(z.preventDefault(),z.stopPropagation(),P(z))},onMousedown(z){z.preventDefault(),z.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},p=T.value?!!y.chip:!!y.selection,M=p?Tt(T.value?y.chip({item:b,index:k,props:Q}):y.selection({item:b,index:k})):void 0;if(!(p&&!M))return s("div",{key:b.value,class:vt(["v-combobox__selection",k===_.value&&["v-combobox__selection--selected",Ve.value]]),style:Nt(k===_.value?be.value:{})},[T.value?y.chip?t(Ut,{key:"chip-defaults",defaults:{VChip:{closable:r.closableChips,size:"small",text:b.title}}},{default:()=>[M]}):t(Y,oe({key:"chip",closable:r.closableChips,size:"small",text:b.title,disabled:b.props.disabled},Q),null):M??s("span",{class:"v-combobox__selection-text"},[b.title,r.multiple&&k<g.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[n(",")])])])})]),"append-inner":function(){var Q,p;for(var b=arguments.length,k=new Array(b),P=0;P<b;P++)k[P]=arguments[P];return s(ve,null,[(Q=y["append-inner"])==null?void 0:Q.call(y,...k),(!r.hideNoData||r.items.length)&&r.menuIcon?t(f,{class:"v-combobox__menu-icon",color:(p=R.value)==null?void 0:p.fieldIconColor,icon:r.menuIcon,onMousedown:at,onClick:qt,"aria-label":re.value,title:re.value,tabindex:"-1"},null):void 0])}})}),zt({isFocused:G,isPristine:Z,menu:h,search:A,selectionIndex:_,filteredItems:E,select:K},R)}}),ml={class:"d-flex align-center"},fl={class:"d-flex align-center"},vl={class:"font-weight-medium"},pl={class:"d-flex align-center"},yl={class:"font-weight-medium"},gl={class:"text-right font-weight-bold"},bl={class:"text-right"},_l={class:"d-flex justify-end"},xl={class:"d-flex align-center"},Vl={class:"d-flex align-center gap-2"},kl={key:0,class:"scanner-section"},wl={key:0,class:"scan-result mt-2"},Cl={key:1,class:"text-center py-4"},hl={class:"d-flex align-center"},Sl={key:0,class:"text-caption text-grey mt-1"},Dl={class:"text-h6 font-weight-bold text-blue-darken-3"},Il={key:1,class:"text-center py-8"},Al={class:"text-right"},Pl={class:"text-h6"},ql={class:"d-flex align-center"},El={class:"d-flex justify-end"},Tl={class:"text-right mr-6"},Nl={class:"text-error"},Ul={class:"d-flex align-center mb-4"},zl={class:"text-h5 font-weight-bold"},Fl={class:"d-flex align-center"},Rl={class:"text-body-1 font-weight-medium"},Ol={class:"d-flex align-center mb-4"},$l={class:"text-body-1 font-weight-medium"},Ml={class:"d-flex align-center"},Bl={class:"text-body-1 font-weight-medium"},Ll={class:"text-left"},jl={class:"text-center"},Gl={class:"text-center"},Hl={class:"text-right"},Kl={class:"text-right"},Ql={class:"text-right pa-4"},Jl={class:"mb-1"},Yl={class:"text-h6"},Wl={class:"text-error mt-1"},Zl={class:"text-body-1 text-grey mb-4"},Xl={class:"font-weight-bold text-error"},ea={__name:"Sales",setup(r){const U=Lt(),W=x(!1),y=x(!1),Ae=x(!1),R=x([]),G=x([]),Z=x([]),de=x([]),xe=x(1),pe=x(1),_=x(!1),X=x(""),ye=x(!1),se=x(null),ge=x(!1),Ve=x(null),be=x(!1),g=x(!1),ne=x(!1),T=x(!1),q=x(null),S=x(null),A=x([]),D=mt({outlet_id:[],start_date:"",end_date:"",payment_status:""}),E=x(null),$e=x(""),O=new Date().toISOString().split("T")[0],d=mt({outlet_id:"",sale_date:O,notes:"",items:[],payments:[]}),ie=x([]),h=x([]),Ze=[{title:"ID",key:"id"},{title:"Date",key:"sale_date"},{title:"Outlet",key:"outlet"},{title:"Customer",key:"customer_name"},{title:"Items",key:"items_count",align:"center"},{title:"Qty",key:"total_qty",align:"center"},{title:"Total",key:"total_amount",align:"end"},{title:"Paid",key:"paid_amount",align:"end"},{title:"Balance",key:"balance",align:"end"},{title:"Actions",key:"actions",sortable:!1}],Xe=[{title:"Good",value:"GOOD"},{title:"Damaged",value:"DAMAGED"},{title:"Reject",value:"REJECT"}],et=["CASH","MOBILE","CARD","BANK"],re=x(!0),tt=j(()=>d.items.reduce((o,e)=>o+Number(e.quantity||0)*Number(e.unit_price||0),0)),ke=j(()=>tt.value),we=j(()=>d.payments.reduce((o,e)=>o+Number(e.amount||0),0)),Me=j(()=>d.outlet_id&&d.sale_date&&d.items.length>0&&ie.value.length===0&&h.value.length===0),H=j(()=>{const o=d.items.reduce((c,u)=>c+v(u),0),e=d.payments.reduce((c,u)=>c+Number(u.amount||0),0),a=Math.max(o-e,0);return{total:o,paid:e,balance:a}});De(()=>H.value.total,o=>{d.payments.length>0&&re.value&&(d.payments[0].amount=o)});function lt(){_.value=!_.value,_.value?fe(()=>{var o;(o=Ve.value)==null||o.focus()}):(X.value="",se.value=null)}async function at(){var e;const o=(e=X.value)==null?void 0:e.trim();if(o){ye.value=!0;try{const a=de.value.find(u=>u.barcode===o||u.code===o);if(!a){U.commit("setMessage",{type:"error",text:`Product not found for code: ${o}`});return}const c=d.items.findIndex(u=>u.product_id===a.id&&u.quality==="GOOD");if(c!==-1){const u=d.items[c];u.quantity=String(Number(u.quantity)+1),se.value=a}else{const u={product_id:a.id,product_code:a.code,quality:"GOOD",quantity:"1",unit_price:a.price||"",stockData:null};d.items.push(u),se.value=a,await P(u)}X.value="",fe(()=>{var u;(u=Ve.value)==null||u.focus()}),B()}catch(a){console.error("Barcode scan error:",a),U.commit("setMessage",{type:"error",text:"Error processing barcode scan"})}finally{ye.value=!1}}}function ot(){_.value&&fe(()=>{var o;(o=Ve.value)==null||o.focus()})}function $(o){return Number(o||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function Ce(o){const e=Number(o||0);return new Intl.NumberFormat().format(e)}function Be(o){return new Date(o).toLocaleDateString()}function K(o){return{MAIN:"mdi-home",SHOP:"mdi-store",CAR:"mdi-truck"}[o]||"mdi-store"}function Pe(o){return{MAIN:"primary",SHOP:"success",CAR:"warning"}[o]||"grey"}function Le(o){return{GOOD:"success",DAMAGED:"warning",REJECT:"error"}[o]||"grey"}function je(){d.items.push({product_id:"",quality:"GOOD",quantity:"",unit_price:"",stockData:null}),B()}function Ge(o){d.items.splice(o,1),B()}function i(o){o===0&&(re.value=!1)}function v(o){return Number(o.quantity||0)*Number(o.unit_price||0)}function V(o){return o.stockData&&o.stockData[o.quality]||0}async function b(o){const e=de.value.find(a=>a.id===o.product_id);e&&(o.unit_price===""||o.unit_price==null)&&(o.unit_price=Number(e.price||0),o.product_code=e.code),await P(o),B()}async function k(o){await P(o),B()}async function P(o){if(!d.outlet_id||!o.product_id){o.stockData=null;return}try{const a=await(await fetch(`/stocktransfers/availableByQuality?outlet_id=${d.outlet_id}&product_id=${o.product_id}`)).json();o.stockData=a.stock||{GOOD:0,DAMAGED:0,REJECT:0}}catch(e){console.error("Stock check failed:",e),o.stockData=null}}function Q(o){return!o.product_id||!o.quality||!o.quantity?!1:Number(o.quantity)>Number(V(o)||0)}function p(o){return o.product_id?`Available: ${V(o)}`:"Pick a product"}function M(o){o.unit_price===""||o.unit_price==null||(o.unit_price=Number(o.unit_price),(isNaN(o.unit_price)||o.unit_price<0)&&(o.unit_price=0))}function z(o){if(typeof o=="string"){E.value=o.trim()||null;return}if(o&&typeof o=="object"){E.value={id:o.id??null,name:o.name??""};return}E.value=null}function qe(){d.payments.push({amount:"",method:"CASH",reference:"",payment_date:O}),d.payments.length===1&&(re.value=!0,H.value.total>0&&(d.payments[0].amount=H.value.total)),B()}function He(o){d.payments.splice(o,1),o===0&&(re.value=!0),B()}function B(){const o=[];d.outlet_id||o.push("Outlet is required."),d.sale_date||o.push("Sale date is required.");const e=new Set;d.items.forEach((a,c)=>{const u=c+1;if(a.product_id||o.push(`Item ${u}: product is required.`),a.quality||o.push(`Item ${u}: quality is required.`),(a.quantity===""||Number(a.quantity)<=0)&&o.push(`Item ${u}: quantity is required and must be > 0.`),(a.unit_price===""||Number(a.unit_price)<0)&&o.push(`Item ${u}: unit price is required and cannot be negative.`),Q(a)&&o.push(`Item ${u}: insufficient ${a.quality} stock.`),a.product_id&&a.quality){const J=`${a.product_id}|${a.quality}`;e.has(J)&&o.push(`Duplicate product and quality detected on item ${c+1}.`),e.add(J)}}),ie.value=o,Ee()}function Ee(){const o=[];let e=0;d.payments.forEach((a,c)=>{a.amount===""||Number(a.amount)<=0?o.push(`Payment ${c+1}: amount is required and must be > 0, or delete the row.`):e+=Number(a.amount)}),e>H.value.total&&o.push("Total payment amount cannot exceed sale total."),h.value=o}async function ee(){var e;W.value=!0;const o=new URLSearchParams({page:xe.value,limit:10});(e=D.outlet_id)!=null&&e.length?D.outlet_id.forEach(a=>o.append("outlet_id[]",a)):U.state.auth.outlets.length&&U.state.auth.outlets.forEach(a=>o.append("outlet_id[]",a.outlet_id)),D.start_date&&o.append("start_date",D.start_date),D.end_date&&o.append("end_date",D.end_date),D.payment_status&&o.append("payment_status",D.payment_status);try{const c=await(await fetch(`/sales?${o}`)).json();R.value=c.data||[],pe.value=c.totalPages||1}catch{U.commit("setMessage",{type:"error",text:"Failed to load sales"})}finally{W.value=!1}}function nt(){D.outlet_id="",D.start_date="",D.end_date="",D.payment_status="",ee()}function pt(){T.value=!1,q.value=null,it(),be.value=!0}async function yt(o){var e;T.value=!0,q.value=o.id,W.value=!0;try{const c=await(await fetch(`/sales/${o.id}`)).json();d.outlet_id=c.sale.outlet_id,d.sale_date=((e=c.sale.sale_date)==null?void 0:e.split("T")[0])||O,d.notes=c.sale.notes||"",E.value=c.sale.customer_id||null,$e.value=c.sale.customer_name||"",d.items=(c.items||[]).map(u=>({product_id:u.product_id,quality:u.quality,quantity:String(u.quantity),unit_price:Number(u.unit_price),stockData:null})),d.payments=(c.payments||[]).map(u=>{var J;return{amount:String(u.amount),method:u.method||"CASH",reference:u.reference||"",payment_date:((J=u.payment_date)==null?void 0:J.split("T")[0])||O}}),re.value=!1;for(const u of d.items)await P(u);B(),be.value=!0}catch{U.commit("setMessage",{type:"error",text:"Failed to load sale"})}finally{W.value=!1}}async function gt(o){q.value=o.id,W.value=!0;try{const a=await(await fetch(`/sales/${o.id}`)).json();S.value={...a.sale,outlet:a.sale.outlet_name,outlet_type:a.sale.outlet_type},A.value=a.items||[],g.value=!0}catch{U.commit("setMessage",{type:"error",text:"Failed to load sale details"})}finally{W.value=!1}}function ut(){be.value=!1,_.value=!1,it()}function it(){d.outlet_id="",d.sale_date=O,d.notes="",d.items=[],d.payments=[],qe(),E.value=null,$e.value="",ie.value=[],h.value=[],re.value=!0,X.value="",se.value=null,ye.value=!1}function bt(o){q.value=o.id,ne.value=!0}async function _t(){Ae.value=!0;try{if(!(await fetch(`/sales/${q.value}`,{method:"DELETE"})).ok)throw new Error("Failed to delete");U.commit("setMessage",{type:"success",text:"Sale deleted successfully"}),ne.value=!1,ee()}catch{U.commit("setMessage",{type:"error",text:"Failed to delete sale"})}finally{Ae.value=!1}}async function xt(){for(const o of d.items)await P(o);B()}async function Vt(){var c;if(B(),!Me.value)return;y.value=!0;const o={outlet_id:d.outlet_id,sale_date:d.sale_date,notes:d.notes||null,items:d.items.map(u=>({product_id:u.product_id,quality:u.quality,quantity:Number(u.quantity),unit_price:Number(u.unit_price)})),payments:d.payments.map(u=>({amount:Number(u.amount),method:u.method||null,reference:u.reference||null,payment_date:u.payment_date||d.sale_date}))};typeof E.value=="string"?(o.customer_id=null,o.customer_name=E.value):(c=E.value)!=null&&c.id?(o.customer_id=E.value.id,o.customer_name=E.value.name):(o.customer_id=null,o.customer_name=null);const e=T.value?`/sales/${q.value}`:"/sales",a=T.value?"PUT":"POST";try{const u=await fetch(e,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!u.ok)throw new Error("Failed to save sale");const J=await u.json();U.commit("setMessage",{type:"success",text:T.value?"Sale updated successfully":"Sale created successfully"}),ut(),ee()}catch{U.commit("setMessage",{type:"error",text:"Failed to save sale"})}finally{y.value=!1}}async function kt(){try{const o=new URLSearchParams({limit:1e3});U.state.auth.outlets.length?U.state.auth.outlets.forEach(u=>o.append("id[]",u.outlet_id)):o.append("id[]",-1);const[e,a,c]=await Promise.all([fetch(`/outlets?${o}`),fetch("/products?limit=1000"),fetch("/customers?limit=1000")]);G.value=(await e.json()).data||[],de.value=(await a.json()).data||[],Z.value=(await c.json()).data||[]}catch(o){console.error("Init data load failed:",o)}}return Bt(()=>{ee(),kt()}),(o,e)=>(w(),le(Kt,{class:"bg-grey-lighten-4 pa-6",fluid:""},{default:l(()=>[t(N,{class:"mb-6",elevation:"2"},{default:l(()=>[t(L,{class:"pa-6"},{default:l(()=>[t(_e,{align:"center"},{default:l(()=>[t(C,{cols:"12",md:"6"},{default:l(()=>[s("div",ml,[t(me,{class:"mr-4",color:"primary",size:"56"},{default:l(()=>[t(f,{color:"white",size:"32"},{default:l(()=>e[21]||(e[21]=[n("mdi-receipt-text")])),_:1})]),_:1}),e[22]||(e[22]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold text-primary"},"Sales"),s("p",{class:"text-body-1 text-grey mt-1"}," Create and manage posted sales per outlet with part payments ")],-1))])]),_:1}),t(C,{class:"text-right",cols:"12",md:"6"},{default:l(()=>[o.$store.getters.hasTask("can_add_sale")?(w(),le(I,{key:0,color:"primary",size:"large",onClick:pt},{default:l(()=>[t(f,{start:""},{default:l(()=>e[23]||(e[23]=[n("mdi-plus")])),_:1}),e[24]||(e[24]=n(" New Sale "))]),_:1})):ue("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"mb-6",elevation:"1"},{default:l(()=>[t(L,{class:"pa-4"},{default:l(()=>[t(_e,{align:"center",dense:""},{default:l(()=>[t(C,{cols:"12",sm:"3"},{default:l(()=>[t(Re,{modelValue:D.outlet_id,"onUpdate:modelValue":e[0]||(e[0]=a=>D.outlet_id=a),clearable:"",density:"comfortable","item-title":"name","item-value":"id",items:G.value,label:"Outlet",multiple:"","prepend-inner-icon":"mdi-store",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(C,{cols:"12",sm:"3"},{default:l(()=>[t(ae,{modelValue:D.start_date,"onUpdate:modelValue":e[1]||(e[1]=a=>D.start_date=a),autocomplete:"off",autocorrect:"off",clearable:"",density:"comfortable",inputmode:"none",label:"Start Date","prepend-inner-icon":"mdi-calendar",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(C,{cols:"12",sm:"3"},{default:l(()=>[t(ae,{modelValue:D.end_date,"onUpdate:modelValue":e[2]||(e[2]=a=>D.end_date=a),autocomplete:"off",autocorrect:"off",clearable:"",density:"comfortable",inputmode:"none",label:"End Date","prepend-inner-icon":"mdi-calendar",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(C,{cols:"12",sm:"3"},{default:l(()=>[t(Re,{modelValue:D.payment_status,"onUpdate:modelValue":e[3]||(e[3]=a=>D.payment_status=a),clearable:"",density:"comfortable",items:[{title:"All",value:""},{title:"Fully Paid",value:"PAID"},{title:"Part Paid",value:"PART"}],label:"Payment Status","prepend-inner-icon":"mdi-filter",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(C,{class:"d-flex justify-end",cols:"12"},{default:l(()=>[t(I,{class:"mr-2",color:"primary",variant:"flat",onClick:ee},{default:l(()=>[t(f,{start:""},{default:l(()=>e[25]||(e[25]=[n("mdi-magnify")])),_:1}),e[26]||(e[26]=n(" Search "))]),_:1}),t(I,{color:"grey",variant:"outlined",onClick:nt},{default:l(()=>[t(f,{start:""},{default:l(()=>e[27]||(e[27]=[n("mdi-refresh")])),_:1}),e[28]||(e[28]=n(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"rounded-lg",elevation:"2"},{default:l(()=>[t(jt,{active:W.value,color:"primary",height:"4",indeterminate:W.value},null,8,["active","indeterminate"]),t(al,{class:"elevation-0",headers:Ze,items:R.value,"items-per-page":10,loading:W.value,"loading-text":"Loading sales...","no-data-text":"No sales found"},{top:l(()=>[t(he,{class:"d-flex align-center pt-4"},{default:l(()=>[t(f,{class:"mr-2",color:"primary"},{default:l(()=>e[29]||(e[29]=[n("mdi-format-list-bulleted")])),_:1}),e[30]||(e[30]=n(" Recent Sales ")),t(Y,{class:"ml-3",color:"primary",size:"small",variant:"flat"},{default:l(()=>[n(m(R.value.length)+" total ",1)]),_:1})]),_:1}),t(Oe)]),"item.sale_date":l(({item:a})=>[s("div",fl,[t(f,{class:"mr-2",color:"grey",size:"16"},{default:l(()=>e[31]||(e[31]=[n("mdi-calendar")])),_:1}),s("span",vl,m(Be(a.sale_date)),1)])]),"item.outlet":l(({item:a})=>[s("div",pl,[t(me,{class:"mr-2",color:Pe(a.outlet_type),size:"28"},{default:l(()=>[t(f,{color:"white",size:"14"},{default:l(()=>[n(m(K(a.outlet_type)),1)]),_:2},1024)]),_:2},1032,["color"]),s("div",yl,m(a.outlet),1)])]),"item.customer_name":l(({item:a})=>[t(Y,{color:a.customer_name?"primary":"grey",size:"small",variant:"flat"},{default:l(()=>[n(m(a.customer_name||"Walk-in"),1)]),_:2},1032,["color"])]),"item.total_qty":l(({item:a})=>[t(Y,{color:"green",size:"small",variant:"flat"},{default:l(()=>[n(m(a.total_qty),1)]),_:2},1024)]),"item.total_amount":l(({item:a})=>[s("div",gl,m($(a.total_amount)),1)]),"item.paid_amount":l(({item:a})=>[s("div",bl,m($(a.paid_amount)),1)]),"item.balance":l(({item:a})=>[s("div",{class:vt(["text-right",Number(a.balance)>0?"text-error":"text-grey"])},m($(a.balance)),3)]),"item.actions":l(({item:a})=>[s("div",_l,[t(st,{location:"top"},{activator:l(({props:c})=>[t(I,oe(c,{color:"info",icon:"",size:"small",variant:"text",onClick:u=>gt(a)}),{default:l(()=>[t(f,null,{default:l(()=>e[32]||(e[32]=[n("mdi-eye-outline")])),_:1})]),_:2},1040,["onClick"])]),default:l(()=>[e[33]||(e[33]=s("span",null,"View",-1))]),_:2},1024),t(st,{location:"top"},{activator:l(({props:c})=>[o.$store.getters.hasTask("can_edit_sale")?(w(),le(I,oe({key:0},c,{color:"primary",icon:"",size:"small",variant:"text",onClick:u=>yt(a)}),{default:l(()=>[t(f,null,{default:l(()=>e[34]||(e[34]=[n("mdi-pencil-outline")])),_:1})]),_:2},1040,["onClick"])):ue("",!0)]),default:l(()=>[e[35]||(e[35]=s("span",null,"Edit",-1))]),_:2},1024),t(st,{location:"top"},{activator:l(({props:c})=>[o.$store.getters.hasTask("can_delete_sale")?(w(),le(I,oe({key:0},c,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>bt(a)}),{default:l(()=>[t(f,null,{default:l(()=>e[36]||(e[36]=[n("mdi-delete-outline")])),_:1})]),_:2},1040,["onClick"])):ue("",!0)]),default:l(()=>[e[37]||(e[37]=s("span",null,"Delete",-1))]),_:2},1024)])]),_:1},8,["items","loading"]),t(Fe,{class:"px-4 py-3 bg-grey-lighten-3"},{default:l(()=>[t(ce),t(ol,{modelValue:xe.value,"onUpdate:modelValue":[e[4]||(e[4]=a=>xe.value=a),ee],color:"primary",length:pe.value,"total-visible":"7"},null,8,["modelValue","length"])]),_:1})]),_:1}),t(We,{modelValue:be.value,"onUpdate:modelValue":e[12]||(e[12]=a=>be.value=a),"max-width":"1200",persistent:"",scrollable:""},{default:l(()=>[t(N,{class:"rounded-lg"},{default:l(()=>[t(Ke,{color:T.value?"warning":"primary",density:"comfortable"},{default:l(()=>[t(me,{class:"mr-3",color:T.value?"warning":"primary",size:"40"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>[n(m(T.value?"mdi-pencil":"mdi-plus"),1)]),_:1})]),_:1},8,["color"]),t(Qe,{class:"text-h6 font-weight-bold"},{default:l(()=>[n(m(T.value?"Edit Sale":"Create New Sale"),1)]),_:1}),t(ce),t(I,{icon:"",onClick:ut},{default:l(()=>[t(f,null,{default:l(()=>e[38]||(e[38]=[n("mdi-close")])),_:1})]),_:1})]),_:1},8,["color"]),t(L,{class:"pa-6"},{default:l(()=>[t(N,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(he,{class:"d-flex align-center bg-blue-lighten-5"},{default:l(()=>[t(f,{class:"mr-2",color:"primary"},{default:l(()=>e[39]||(e[39]=[n("mdi-information")])),_:1}),e[40]||(e[40]=n(" Sale Information "))]),_:1}),t(L,{class:"pa-4"},{default:l(()=>[t(_e,null,{default:l(()=>[t(C,{cols:"12",md:"4"},{default:l(()=>[t(Re,{modelValue:d.outlet_id,"onUpdate:modelValue":[e[5]||(e[5]=a=>d.outlet_id=a),xt],"item-title":"name","item-value":"id",items:G.value,label:"Outlet","prepend-inner-icon":"mdi-store",required:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(C,{cols:"12",md:"4"},{default:l(()=>[t(cl,{modelValue:E.value,"onUpdate:modelValue":[e[6]||(e[6]=a=>E.value=a),z],"auto-select-first":"false",clearable:"","hide-no-data":"","item-title":"name","item-value":"id",items:Z.value,label:"Customer (optional, type to add)","prepend-inner-icon":"mdi-account","return-object":"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(C,{cols:"12",md:"4"},{default:l(()=>[t(ae,{modelValue:d.sale_date,"onUpdate:modelValue":e[7]||(e[7]=a=>d.sale_date=a),autocomplete:"off",autocorrect:"off",inputmode:"none",label:"Sale Date","prepend-inner-icon":"mdi-calendar",required:"",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(C,{cols:"12"},{default:l(()=>[t(il,{modelValue:d.notes,"onUpdate:modelValue":e[8]||(e[8]=a=>d.notes=a),label:"Notes / Description",placeholder:"Add any notes about this saleâ€¦",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(N,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(he,{class:"d-flex align-center justify-space-between bg-orange-lighten-5"},{default:l(()=>[s("div",xl,[t(f,{class:"mr-2",color:"orange"},{default:l(()=>e[41]||(e[41]=[n("mdi-barcode-scan")])),_:1}),e[43]||(e[43]=n(" Barcode Scanner ")),t(Y,{class:"ml-3",color:"orange",size:"small",variant:"flat"},{default:l(()=>e[42]||(e[42]=[n(" Quick Product Entry ")])),_:1})]),s("div",Vl,[t(I,{color:"orange",size:"small",variant:"tonal",onClick:lt},{default:l(()=>[t(f,{start:""},{default:l(()=>[n(m(_.value?"mdi-stop":"mdi-barcode"),1)]),_:1}),n(" "+m(_.value?"Stop Scanner":"Start Scanner"),1)]),_:1}),t(I,{color:"grey",icon:"",size:"small",variant:"text",onClick:e[9]||(e[9]=a=>ge.value=!0)},{default:l(()=>[t(f,null,{default:l(()=>e[44]||(e[44]=[n("mdi-help-circle")])),_:1})]),_:1})])]),_:1}),t(L,{class:"pa-4"},{default:l(()=>[_.value?(w(),F("div",kl,[t(Se,{class:"mb-4",color:"info",icon:"mdi-barcode-scan",variant:"tonal"},{default:l(()=>e[45]||(e[45]=[s("strong",null,"Scanner Active",-1),n(" - Focus on the barcode input field below and scan products ")])),_:1}),t(ae,{ref_key:"barcodeInputRef",ref:Ve,modelValue:X.value,"onUpdate:modelValue":e[10]||(e[10]=a=>X.value=a),autocomplete:"off",autocorrect:"off",autofocus:"",clearable:"",density:"comfortable",label:"Scan Barcode or Enter Product Code",placeholder:"Scan barcode or type product code and press Enter","prepend-inner-icon":"mdi-barcode",spellcheck:"false",variant:"outlined",onBlur:ot,onKeydown:Gt(at,["enter"])},{append:l(()=>[ye.value?(w(),le(Ht,{key:0,indeterminate:"",size:"24",width:"2"})):(w(),le(f,{key:1,color:"green"},{default:l(()=>e[46]||(e[46]=[n("mdi-arrow-right")])),_:1}))]),_:1},8,["modelValue"]),se.value?(w(),F("div",wl,[t(Se,{color:"success",density:"compact",icon:"mdi-check",variant:"tonal"},{default:l(()=>[e[47]||(e[47]=n(" Added: ")),s("strong",null,m(se.value.name),1),n(" ("+m(se.value.code)+") ",1)]),_:1})])):ue("",!0)])):(w(),F("div",Cl,[t(f,{class:"mb-2",color:"grey",size:"48"},{default:l(()=>e[48]||(e[48]=[n("mdi-barcode-off")])),_:1}),e[49]||(e[49]=s("div",{class:"text-body-1 text-grey"},' Click "Start Scanner" to enable barcode scanning ',-1))]))]),_:1})]),_:1}),t(N,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(he,{class:"d-flex align-center justify-space-between bg-green-lighten-5"},{default:l(()=>[s("div",hl,[t(f,{class:"mr-2",color:"green"},{default:l(()=>e[50]||(e[50]=[n("mdi-package-variant")])),_:1}),e[51]||(e[51]=n(" Sale Items ")),t(Y,{class:"ml-3",color:"green",size:"small",variant:"flat"},{default:l(()=>[n(m(d.items.length)+" items ",1)]),_:1}),t(Y,{class:"ml-2",color:"indigo",size:"small",variant:"tonal"},{default:l(()=>[n(" Total: "+m(Ce(H.value.total)),1)]),_:1}),t(Y,{class:"ml-2",color:"teal",size:"small",variant:"tonal"},{default:l(()=>[n(" Paid: "+m(Ce(H.value.paid)),1)]),_:1}),t(Y,{class:"ml-2",color:H.value.balance>0?"warning":"success",size:"small",variant:"tonal"},{default:l(()=>[n(" Balance: "+m(Ce(H.value.balance)),1)]),_:1},8,["color"])]),t(I,{color:"green",disabled:!d.outlet_id,size:"small",onClick:je},{default:l(()=>[t(f,{start:""},{default:l(()=>e[52]||(e[52]=[n("mdi-plus")])),_:1}),e[53]||(e[53]=n(" Add Item "))]),_:1},8,["disabled"])]),_:1}),t(L,{class:"pa-4"},{default:l(()=>[ie.value.length?(w(),le(Se,{key:0,class:"mb-4",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:l(()=>[(w(!0),F(ve,null,ze(ie.value,a=>(w(),F("div",{key:a}," â€¢ "+m(a),1))),128))]),_:1})):ue("",!0),(w(!0),F(ve,null,ze(d.items,(a,c)=>(w(),F("div",{key:c,class:"mb-4"},[t(N,{class:"elevation-1"},{default:l(()=>[t(L,{class:"pa-4"},{default:l(()=>[t(_e,{align:"center",dense:""},{default:l(()=>[t(C,{cols:"12",md:"3"},{default:l(()=>[t(rl,{modelValue:a.product_id,"onUpdate:modelValue":[u=>a.product_id=u,()=>b(a)],autocomplete:"off",autocorrect:"off",inputmode:"none","item-title":"name","item-value":"id",items:de.value,label:"Product","prepend-inner-icon":"mdi-cube-outline",required:"",spellcheck:"false",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"]),a.product_code?(w(),F("div",Sl," Code: "+m(a.product_code),1)):ue("",!0)]),_:2},1024),t(C,{cols:"12",md:"2"},{default:l(()=>[t(Re,{modelValue:a.quality,"onUpdate:modelValue":[u=>a.quality=u,()=>k(a)],color:Le(a.quality),"item-title":"title","item-value":"value",items:Xe,label:"Quality",required:"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","color"])]),_:2},1024),t(C,{cols:"12",md:"2"},{default:l(()=>[t(ae,{modelValue:a.quantity,"onUpdate:modelValue":u=>a.quantity=u,autocomplete:"off",autocorrect:"off",density:"comfortable",error:Q(a),hint:p(a),inputmode:"none",label:"Quantity","persistent-hint":"",spellcheck:"false",type:"number",variant:"outlined",onInput:e[11]||(e[11]=()=>B())},null,8,["modelValue","onUpdate:modelValue","error","hint"])]),_:2},1024),t(C,{cols:"12",md:"2"},{default:l(()=>[t(ae,{modelValue:a.unit_price,"onUpdate:modelValue":u=>a.unit_price=u,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Unit Price",spellcheck:"false",type:"number",variant:"outlined",onBlur:u=>M(a)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024),t(C,{cols:"12",md:"2"},{default:l(()=>[t(N,{class:"pa-3 text-center",color:"blue-lighten-5",variant:"flat"},{default:l(()=>[e[54]||(e[54]=s("div",{class:"text-caption text-blue-darken-3 font-weight-bold"}," AVAILABLE ",-1)),s("div",Dl,m(V(a)),1)]),_:2},1024)]),_:2},1024),t(C,{class:"text-right",cols:"12",md:"1"},{default:l(()=>[t(I,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>Ge(c)},{default:l(()=>[t(f,null,{default:l(()=>e[55]||(e[55]=[n("mdi-delete-outline")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),t(_e,{class:"mt-1"},{default:l(()=>[t(C,{class:"text-right text-grey",cols:"12"},{default:l(()=>[e[56]||(e[56]=n(" Line total: ")),s("strong",null,m($(v(a))),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),d.items.length===0?(w(),F("div",Il,[t(f,{class:"mb-4",color:"grey",size:"64"},{default:l(()=>e[57]||(e[57]=[n("mdi-package-variant-plus")])),_:1}),e[60]||(e[60]=s("div",{class:"text-h6 text-grey mb-2"},"No Items Added",-1)),e[61]||(e[61]=s("div",{class:"text-body-1 text-grey mb-4"},' Click "Add Item" or use barcode scanner to add products ',-1)),t(I,{color:"primary",disabled:!d.outlet_id,onClick:je},{default:l(()=>[t(f,{start:""},{default:l(()=>e[58]||(e[58]=[n("mdi-plus")])),_:1}),e[59]||(e[59]=n(" Add Your First Item "))]),_:1},8,["disabled"])])):ue("",!0),t(Oe,{class:"my-4"}),H.value.balance>0?(w(),le(Se,{key:2,class:"mt-2",color:"warning",icon:"mdi-alert",variant:"tonal"},{default:l(()=>[e[62]||(e[62]=n(" Balance due: ")),s("strong",null,m(Ce(H.value.balance)),1)]),_:1})):H.value.total>0?(w(),le(Se,{key:3,class:"mt-2",color:"success",icon:"mdi-check",variant:"tonal"},{default:l(()=>e[63]||(e[63]=[n(" Fully paid ðŸŽ‰ ")])),_:1})):ue("",!0),s("div",Al,[s("div",Pl,[e[64]||(e[64]=n(" Total: ")),s("strong",null,m($(ke.value)),1)])])]),_:1})]),_:1}),t(N,{variant:"outlined"},{default:l(()=>[t(he,{class:"d-flex align-center justify-space-between bg-purple-lighten-5"},{default:l(()=>[s("div",ql,[t(f,{class:"mr-2",color:"purple"},{default:l(()=>e[65]||(e[65]=[n("mdi-cash")])),_:1}),e[66]||(e[66]=n(" Payments ")),t(Y,{class:"ml-3",color:"purple",size:"small",variant:"flat"},{default:l(()=>[n(m(d.payments.length)+" row(s) ",1)]),_:1})]),t(I,{color:"purple",size:"small",onClick:qe},{default:l(()=>[t(f,{start:""},{default:l(()=>e[67]||(e[67]=[n("mdi-plus")])),_:1}),e[68]||(e[68]=n(" Add Payment "))]),_:1})]),_:1}),t(L,{class:"pa-4"},{default:l(()=>[h.value.length?(w(),le(Se,{key:0,class:"mb-4",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:l(()=>[(w(!0),F(ve,null,ze(h.value,a=>(w(),F("div",{key:a},"â€¢ "+m(a),1))),128))]),_:1})):ue("",!0),(w(!0),F(ve,null,ze(d.payments,(a,c)=>(w(),F("div",{key:c,class:"mb-3"},[t(_e,{dense:""},{default:l(()=>[t(C,{cols:"12",md:"3"},{default:l(()=>[t(ae,{modelValue:a.amount,"onUpdate:modelValue":u=>a.amount=u,autocomplete:"off",autocorrect:"off",density:"comfortable",error:!a.amount,hint:"Required",inputmode:"none",label:"Amount","persistent-hint":"",spellcheck:"false",type:"number",variant:"outlined",onInput:()=>{Ee(),i(c)}},null,8,["modelValue","onUpdate:modelValue","error","onInput"])]),_:2},1024),t(C,{cols:"12",md:"3"},{default:l(()=>[t(Re,{modelValue:a.method,"onUpdate:modelValue":u=>a.method=u,density:"comfortable",items:et,label:"Method",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(C,{cols:"12",md:"3"},{default:l(()=>[t(ae,{modelValue:a.reference,"onUpdate:modelValue":u=>a.reference=u,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Reference",spellcheck:"false",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(C,{cols:"12",md:"2"},{default:l(()=>[t(ae,{modelValue:a.payment_date,"onUpdate:modelValue":u=>a.payment_date=u,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Payment Date",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(C,{class:"text-right",cols:"12",md:"1"},{default:l(()=>[t(I,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>He(c)},{default:l(()=>[t(f,null,{default:l(()=>e[69]||(e[69]=[n("mdi-delete-outline")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),t(Oe,{class:"my-4"}),s("div",El,[s("div",Tl,[s("div",null,[e[70]||(e[70]=n(" Paid: ")),s("strong",null,m($(we.value)),1)]),s("div",Nl,[e[71]||(e[71]=n(" Balance: ")),s("strong",null,m($(Math.max(ke.value-we.value,0))),1)])])])]),_:1})]),_:1})]),_:1}),t(Fe,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(ce),t(I,{size:"large",variant:"outlined",onClick:ut},{default:l(()=>e[72]||(e[72]=[n("Cancel")])),_:1}),t(I,{color:"primary",disabled:!Me.value,loading:y.value,size:"large",variant:"flat",onClick:Vt},{default:l(()=>[t(f,{start:""},{default:l(()=>[n(m(T.value?"mdi-content-save":"mdi-check"),1)]),_:1}),n(" "+m(T.value?"Update Sale":"Create Sale"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(We,{modelValue:ge.value,"onUpdate:modelValue":e[15]||(e[15]=a=>ge.value=a),"max-width":"600"},{default:l(()=>[t(N,null,{default:l(()=>[t(Ke,{color:"orange",density:"comfortable"},{default:l(()=>[t(f,{class:"mr-2",color:"white"},{default:l(()=>e[73]||(e[73]=[n("mdi-help-circle")])),_:1}),t(Qe,{class:"text-white"},{default:l(()=>e[74]||(e[74]=[n("Barcode Scanner Help")])),_:1}),t(ce),t(I,{icon:"",onClick:e[13]||(e[13]=a=>ge.value=!1)},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[75]||(e[75]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),t(L,{class:"pa-6"},{default:l(()=>[t(ft,null,{default:l(()=>[t(Ie,null,{prepend:l(()=>[t(f,{color:"orange"},{default:l(()=>e[76]||(e[76]=[n("mdi-barcode")])),_:1})]),default:l(()=>[t(Je,null,{default:l(()=>e[77]||(e[77]=[n("How to Use")])),_:1}),t(Ye,null,{default:l(()=>e[78]||(e[78]=[n(' Click "Start Scanner", focus on the barcode field, and scan products. The system will automatically find and add products. ')])),_:1})]),_:1}),t(Ie,null,{prepend:l(()=>[t(f,{color:"green"},{default:l(()=>e[79]||(e[79]=[n("mdi-keyboard")])),_:1})]),default:l(()=>[t(Je,null,{default:l(()=>e[80]||(e[80]=[n("Manual Entry")])),_:1}),t(Ye,null,{default:l(()=>e[81]||(e[81]=[n(" You can also type product codes manually and press Enter to add them. ")])),_:1})]),_:1}),t(Ie,null,{prepend:l(()=>[t(f,{color:"blue"},{default:l(()=>e[82]||(e[82]=[n("mdi-autorenew")])),_:1})]),default:l(()=>[t(Je,null,{default:l(()=>e[83]||(e[83]=[n("Auto-Increment")])),_:1}),t(Ye,null,{default:l(()=>e[84]||(e[84]=[n(" Scanning the same product multiple times will increase its quantity. ")])),_:1})]),_:1}),t(Ie,null,{prepend:l(()=>[t(f,{color:"red"},{default:l(()=>e[85]||(e[85]=[n("mdi-alert")])),_:1})]),default:l(()=>[t(Je,null,{default:l(()=>e[86]||(e[86]=[n("Troubleshooting")])),_:1}),t(Ye,null,{default:l(()=>e[87]||(e[87]=[n(" If a product isn't found, check that the outlet is selected and the product exists in the system. ")])),_:1})]),_:1})]),_:1})]),_:1}),t(Fe,{class:"pa-4"},{default:l(()=>[t(ce),t(I,{color:"orange",onClick:e[14]||(e[14]=a=>ge.value=!1)},{default:l(()=>e[88]||(e[88]=[n(" Got it! ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(We,{modelValue:g.value,"onUpdate:modelValue":e[18]||(e[18]=a=>g.value=a),"max-width":"900",scrollable:"",transition:"dialog-bottom-transition"},{default:l(()=>[t(N,{class:"rounded-lg"},{default:l(()=>[t(Ke,{color:"info",density:"comfortable"},{default:l(()=>[t(me,{class:"mr-3",color:"info",size:"40"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[89]||(e[89]=[n("mdi-eye")])),_:1})]),_:1}),t(Qe,{class:"text-h6 font-weight-bold"},{default:l(()=>e[90]||(e[90]=[n("Sale Details")])),_:1}),t(ce),t(I,{icon:"",onClick:e[16]||(e[16]=a=>g.value=!1)},{default:l(()=>[t(f,null,{default:l(()=>e[91]||(e[91]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),t(L,{class:"pa-6"},{default:l(()=>[t(N,{class:"mb-6 elevation-2"},{default:l(()=>[t(L,{class:"pa-4"},{default:l(()=>[t(_e,null,{default:l(()=>{var a;return[t(C,{class:"border-e",cols:"12",md:"6"},{default:l(()=>{var c,u;return[s("div",Ul,[t(me,{class:"mr-3",color:"primary",size:"48"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[92]||(e[92]=[n("mdi-identifier")])),_:1})]),_:1}),s("div",null,[e[93]||(e[93]=s("div",{class:"text-caption text-grey"},"SALE ID",-1)),s("div",zl," #"+m((c=S.value)==null?void 0:c.id),1)])]),s("div",Fl,[t(f,{class:"mr-3",color:"grey"},{default:l(()=>e[94]||(e[94]=[n("mdi-calendar")])),_:1}),s("div",null,[e[95]||(e[95]=s("div",{class:"text-caption text-grey"},"DATE",-1)),s("div",Rl,m(Be((u=S.value)==null?void 0:u.sale_date)),1)])])]}),_:1}),t(C,{cols:"12",md:"6"},{default:l(()=>{var c,u,J,te;return[s("div",Ol,[t(me,{class:"mr-3",color:Pe((c=S.value)==null?void 0:c.outlet_type),size:"48"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>{var Te;return[n(m(K((Te=S.value)==null?void 0:Te.outlet_type)),1)]}),_:1})]),_:1},8,["color"]),s("div",null,[e[96]||(e[96]=s("div",{class:"text-caption text-grey"},"OUTLET",-1)),s("div",$l,m((u=S.value)==null?void 0:u.outlet_name),1),t(Y,{class:"mt-1",color:Pe((J=S.value)==null?void 0:J.outlet_type),size:"small"},{default:l(()=>{var Te;return[n(m((Te=S.value)==null?void 0:Te.outlet_type),1)]}),_:1},8,["color"])])]),s("div",Ml,[t(f,{class:"mr-3",color:"grey"},{default:l(()=>e[97]||(e[97]=[n("mdi-account")])),_:1}),s("div",null,[e[98]||(e[98]=s("div",{class:"text-caption text-grey"},"CUSTOMER",-1)),s("div",Bl,m(((te=S.value)==null?void 0:te.customer_name)||"Walk-in"),1)])])]}),_:1}),(a=S.value)!=null&&a.notes?(w(),le(C,{key:0,cols:"12"},{default:l(()=>[t(Oe,{class:"my-3"}),e[99]||(e[99]=s("div",{class:"text-caption text-grey mb-1"},"NOTES",-1)),t(N,{variant:"outlined"},{default:l(()=>[t(L,{class:"pa-3"},{default:l(()=>{var c;return[n(m((c=S.value)==null?void 0:c.notes),1)]}),_:1})]),_:1})]),_:1})):ue("",!0)]}),_:1})]),_:1})]),_:1}),t(N,{class:"mb-6 elevation-2"},{default:l(()=>[t(he,{class:"d-flex align-center bg-teal-lighten-5"},{default:l(()=>[t(f,{class:"mr-2",color:"teal"},{default:l(()=>e[100]||(e[100]=[n("mdi-package-variant")])),_:1}),e[101]||(e[101]=n(" Items "))]),_:1}),t(L,{class:"pa-0"},{default:l(()=>{var a,c,u,J;return[t(nl,{density:"comfortable"},{default:l(()=>[e[102]||(e[102]=s("thead",null,[s("tr",{class:"bg-grey-lighten-4"},[s("th",{class:"text-left font-weight-bold text-grey"}," PRODUCT "),s("th",{class:"text-center font-weight-bold text-grey"}," QUALITY "),s("th",{class:"text-center font-weight-bold text-grey"},"QTY"),s("th",{class:"text-right font-weight-bold text-grey"}," UNIT PRICE "),s("th",{class:"text-right font-weight-bold text-grey"}," TOTAL PRICE ")])],-1)),s("tbody",null,[(w(!0),F(ve,null,ze(A.value,te=>(w(),F("tr",{key:te.id},[s("td",Ll,m(te.product_name),1),s("td",jl,[t(Y,{color:Le(te.quality),size:"small",variant:"flat"},{default:l(()=>[n(m(te.quality),1)]),_:2},1032,["color"])]),s("td",Gl,m(parseFloat(te.quantity)),1),s("td",Hl,m($(te.unit_price)),1),s("td",Kl,m($(te.quantity*te.unit_price)),1)]))),128))])]),_:1}),s("div",Ql,[s("div",Jl,[e[103]||(e[103]=n(" Paid: ")),s("strong",null,m($(((a=S.value)==null?void 0:a.total_paid)||0)),1)]),s("div",Yl,[e[104]||(e[104]=n(" Total: ")),s("strong",null,m($(((c=S.value)==null?void 0:c.total_amount)||0)),1)]),s("div",Wl,[e[105]||(e[105]=n(" Balance: ")),s("strong",null,m($((((u=S.value)==null?void 0:u.total_amount)||0)-(((J=S.value)==null?void 0:J.total_paid)||0))),1)])])]}),_:1})]),_:1})]),_:1}),t(Fe,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(ce),t(I,{color:"primary",size:"large",variant:"flat",onClick:e[17]||(e[17]=a=>g.value=!1)},{default:l(()=>[t(f,{start:""},{default:l(()=>e[106]||(e[106]=[n("mdi-close")])),_:1}),e[107]||(e[107]=n(" Close "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(We,{modelValue:ne.value,"onUpdate:modelValue":e[20]||(e[20]=a=>ne.value=a),"max-width":"500"},{default:l(()=>[t(N,{class:"rounded-lg"},{default:l(()=>[t(Ke,{color:"error",density:"comfortable"},{default:l(()=>[t(me,{class:"mr-3",color:"error",size:"40"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[108]||(e[108]=[n("mdi-alert")])),_:1})]),_:1}),t(Qe,{class:"text-h6 font-weight-bold"},{default:l(()=>e[109]||(e[109]=[n("Confirm Deletion")])),_:1})]),_:1}),t(L,{class:"pa-6 text-center"},{default:l(()=>[t(f,{class:"mb-4",color:"error",size:"64"},{default:l(()=>e[110]||(e[110]=[n("mdi-delete-alert")])),_:1}),e[113]||(e[113]=s("div",{class:"text-h5 font-weight-bold mb-2"},"Delete Sale?",-1)),s("div",Zl,[e[111]||(e[111]=n(" Are you sure you want to delete sale ")),s("span",Xl,"#"+m(q.value),1),e[112]||(e[112]=n("? This cannot be undone. "))])]),_:1}),t(Fe,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(ce),t(I,{size:"large",variant:"outlined",onClick:e[19]||(e[19]=a=>ne.value=!1)},{default:l(()=>e[114]||(e[114]=[n("Cancel")])),_:1}),t(I,{color:"error",loading:Ae.value,size:"large",variant:"flat",onClick:_t},{default:l(()=>[t(f,{start:""},{default:l(()=>e[115]||(e[115]=[n("mdi-delete")])),_:1}),e[116]||(e[116]=n(" Delete Sale "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},pa=Mt(ea,[["__scopeId","data-v-bebdde51"]]);export{pa as default};
