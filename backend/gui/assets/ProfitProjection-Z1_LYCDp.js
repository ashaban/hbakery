import{ey as me,bh as pe,bK as ge,es as ve,et as _e,eu as be,ew as ye,ev as he,ex as xe}from"./install-C5F6FHSf.js";import{aG as Oe,aH as we,ao as q,aI as W,aJ as Ce,a7 as L,aK as Pe,aq as Y,ap as re,o as se,ar as Ee,at as ke,aL as Ve,H as X,_ as Le,r as z,y as te,c as Se,w as a,A as ze,a as Ae,b as t,p as j,h as s,m as x,d as O,t as b,aa as Te,l as Z,i as ae,C as le}from"./index-BQ8odBfQ.js";import{V as Ie}from"./VContainer-Cg2hjJKQ.js";import{V as v}from"./VCol-DKQaH-HA.js";import{V as w,c as F,a as A}from"./VCard-qEl9eNMk.js";import{V as J}from"./VAutocomplete-GuftlyQF.js";import{d as B,a as ne}from"./VDataTable-CqlA4dDV.js";import"./VTextField-BKFXLdhM.js";import"./VSlideGroup-CunTsfWf.js";const De=["getWidth","getHeight","getDom","getOption","resize","dispatchAction","convertToPixel","convertFromPixel","containPixel","getDataURL","getConnectedDataURL","appendData","clear","isDisposed","dispose"];function Ne(n){function c(i){return(...p)=>{if(!n.value)throw new Error("ECharts is not initialized yet.");return n.value[i].apply(n.value,p)}}function l(){const i=Object.create(null);return De.forEach(p=>{i[p]=c(p)}),i}return l()}function Re(n,c,l){Y([l,n,c],([i,p,y],T,S)=>{let g=null;if(i&&p&&y){const{offsetWidth:m,offsetHeight:M}=i,U=y===!0?{}:y,{throttle:I=100,onResize:E}=U;let _=!1;const C=()=>{p.resize(),E==null||E()},D=I?pe(C,I):C;g=new ResizeObserver(()=>{!_&&(_=!0,i.offsetWidth===m&&i.offsetHeight===M)||D()}),g.observe(i)}S(()=>{g&&(g.disconnect(),g=null)})})}const je={autoresize:[Boolean,Object]},Me=/^on[^a-z]/,ue=n=>Me.test(n);function Ue(n){const c={};for(const l in n)ue(l)||(c[l]=n[l]);return c}function G(n,c){const l=Ve(n)?X(n):n;return l&&typeof l=="object"&&"value"in l?l.value||c:l||c}const $e="ecLoadingOptions";function He(n,c,l){const i=W($e,{}),p=L(()=>({...G(i,{}),...l==null?void 0:l.value}));re(()=>{const y=n.value;y&&(c.value?y.showLoading(p.value):y.hideLoading())})}const Fe={loading:Boolean,loadingOptions:Object};let K=null;const de="x-vue-echarts";function Be(){if(K!=null)return K;if(typeof HTMLElement>"u"||typeof customElements>"u")return K=!1;try{new Function("tag","class EChartsElement extends HTMLElement{__dispose=null;disconnectedCallback(){this.__dispose&&(this.__dispose(),this.__dispose=null)}}customElements.get(tag)==null&&customElements.define(tag,EChartsElement);")(de)}catch{return K=!1}return K=!0}document.head.appendChild(document.createElement("style")).textContent=`x-vue-echarts{display:block;width:100%;height:100%;min-width:0}
`;const Ke=Be(),We="ecTheme",Ye="ecInitOptions",Ge="ecUpdateOptions",oe=/(^&?~?!?)native:/;var ie=Oe({name:"echarts",props:{option:Object,theme:{type:[Object,String]},initOptions:Object,updateOptions:Object,group:String,manualUpdate:Boolean,...je,...Fe},emits:{},inheritAttrs:!1,setup(n,{attrs:c}){const l=q(),i=q(),p=q(),y=W(We,null),T=W(Ye,null),S=W(Ge,null),{autoresize:g,manualUpdate:m,loading:M,loadingOptions:U}=Ce(n),I=L(()=>p.value||n.option||null),E=L(()=>n.theme||G(y,{})),_=L(()=>n.initOptions||G(T,{})),C=L(()=>n.updateOptions||G(S,{})),D=L(()=>Ue(c)),$={},P=Pe().proxy.$listeners,N={};P?Object.keys(P).forEach(r=>{oe.test(r)?$[r.replace(oe,"$1")]=P[r]:N[r]=P[r]}):Object.keys(c).filter(r=>ue(r)).forEach(r=>{let u=r.charAt(2).toLowerCase()+r.slice(3);if(u.indexOf("native:")===0){const d=`on${u.charAt(7).toUpperCase()}${u.slice(8)}`;$[d]=c[r];return}u.substring(u.length-4)==="Once"&&(u=`~${u.substring(0,u.length-4)}`),N[u]=c[r]});function R(r){if(!l.value)return;const u=i.value=me(l.value,E.value,_.value);n.group&&(u.group=n.group),Object.keys(N).forEach(H=>{let k=N[H];if(!k)return;let V=H.toLowerCase();V.charAt(0)==="~"&&(V=V.substring(1),k.__once__=!0);let Q=u;if(V.indexOf("zr:")===0&&(Q=u.getZr(),V=V.substring(3)),k.__once__){delete k.__once__;const ce=k;k=(...fe)=>{ce(...fe),Q.off(V,k)}}Q.on(V,k)});function d(){u&&!u.isDisposed()&&u.resize()}function ee(){const H=r||I.value;H&&u.setOption(H,C.value)}g.value?ke(()=>{d(),ee()}):ee()}function f(r,u){n.manualUpdate&&(p.value=r),i.value?i.value.setOption(r,u||{}):R(r)}function e(){i.value&&(i.value.dispose(),i.value=void 0)}let h=null;Y(m,r=>{typeof h=="function"&&(h(),h=null),r||(h=Y(()=>n.option,(u,d)=>{u&&(i.value?i.value.setOption(u,{notMerge:u!==d,...C.value}):R())},{deep:!0}))},{immediate:!0}),Y([E,_],()=>{e(),R()},{deep:!0}),re(()=>{n.group&&i.value&&(i.value.group=n.group)});const o=Ne(i);return He(i,M,U),Re(i,g,l),se(()=>{R()}),Ee(()=>{Ke&&l.value?l.value.__dispose=e:e()}),{chart:i,root:l,setOption:f,nonEventAttrs:D,nativeListeners:$,...o}},render(){const n={...this.nonEventAttrs,...this.nativeListeners};return n.ref="root",n.class=n.class?["echarts"].concat(n.class):"echarts",we(de,n)}});const Qe={class:"text-h5 font-weight-bold text-green-darken-2"},qe={class:"text-h5 font-weight-bold text-orange-darken-2"},Ze={class:"text-h5 font-weight-bold text-blue-darken-2"},Je={class:"d-flex gap-2"},Xe={__name:"ProfitProjection",setup(n){ge([ve,_e,be,ye,he,xe]);const c=z(!1),l=te({total_ingredient_cost:0,total_labour_cost:0,total_production_value:0,margin:0}),i=z([]),p=z([]),y=z([]),T=z([]),S=z([]),g=z(null),m=te({ingredients:[],products:[],team_leader:""}),M=[{title:"Ingredient",key:"ingredient_name",sortable:!0},{title:"Qty Consumed",key:"total_consumed",sortable:!0,align:"end"},{title:"Unit Price",key:"avg_price",sortable:!0,align:"end"},{title:"Total Cost",key:"total_cost",sortable:!0,align:"end"}],U=[{title:"Product",key:"product_name",sortable:!0},{title:"Qty Produced",key:"total_produced",sortable:!0,align:"end"},{title:"Selling Price",key:"selling_price",sortable:!0,align:"end"},{title:"Total Amount",key:"total_value",sortable:!0,align:"end"}],I=L(()=>({tooltip:{trigger:"item",formatter:"{a} <br/>{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left"},series:[{name:"Cost Distribution",type:"pie",radius:["40%","70%"],avoidLabelOverlap:!1,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:18,fontWeight:"bold"}},labelLine:{show:!1},data:[{value:l.total_ingredient_cost,name:"Ingredients",itemStyle:{color:"#ff9800"}},{value:l.total_labour_cost,name:"Labour",itemStyle:{color:"#2196f3"}},{value:l.margin,name:"Profit Margin",itemStyle:{color:l.margin>=0?"#4caf50":"#f44336"}}]}]})),E=L(()=>{const f=C(l.margin/l.total_ingredient_cost*100);return{series:[{type:"gauge",startAngle:180,endAngle:0,min:0,max:100,splitNumber:10,axisLine:{lineStyle:{width:6,color:[[.3,"#ff6b6b"],[.7,"#ffd93d"],[1,"#6bcf7f"]]}},pointer:{icon:"path://M12.8,0.7l12,40.1H0.7L12.8,0.7z",length:"12%",width:20,offsetCenter:[0,"-60%"],itemStyle:{color:"auto"}},axisTick:{length:12,lineStyle:{color:"auto",width:2}},splitLine:{length:20,lineStyle:{color:"auto",width:5}},axisLabel:{color:"#464646",fontSize:14,distance:-60,formatter:function(e){return e===0?"Loss":e===50?"Break Even":e===100?"High Profit":""}},title:{offsetCenter:[0,"-20%"],fontSize:16,fontWeight:"bold"},detail:{fontSize:24,offsetCenter:[0,"0%"],valueAnimation:!0,formatter:"{value}%",color:"auto",fontWeight:"bold"},data:[{value:Math.max(0,Math.min(100,f)),name:"Profit Margin %"}]}]}});function _(f){return Number(f||0).toLocaleString(void 0,{style:"currency",currency:"TZS",maximumFractionDigits:2})}function C(f){const e=Number(f||0);return parseFloat(e.toLocaleString(void 0,{maximumFractionDigits:3}))}function D(f){if(!f)return"";const e=new Date(f),h=e.getFullYear(),o=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0");return`${h}-${o}-${r}`}function $(){const f=new URLSearchParams;return Array.isArray(g.value)&&g.value[0]&&g.value[1]&&(f.append("start",D(g.value[0])),f.append("end",D(g.value[1]))),Array.isArray(m.ingredients)&&m.ingredients.length&&m.ingredients.forEach(e=>f.append("ingredients",e)),Array.isArray(m.products)&&m.products.length&&m.products.forEach(e=>f.append("products",e)),m.team_leader&&f.append("team_leader",String(m.team_leader)),f.toString()}async function P(){var f,e,h,o;c.value=!0;try{const r=$(),d=await(await fetch(`/reports/productionProfitability?${r}`)).json();l.total_ingredient_cost=Number(((f=d==null?void 0:d.totals)==null?void 0:f.totalIngredientCost)||0),l.total_labour_cost=Number(((e=d==null?void 0:d.totals)==null?void 0:e.totalLabourCost)||0),l.total_production_value=Number(((h=d==null?void 0:d.totals)==null?void 0:h.totalCost)||0),l.margin=Number(((o=d==null?void 0:d.totals)==null?void 0:o.margin)||0),i.value=(d==null?void 0:d.ingredients)||[],p.value=(d==null?void 0:d.products)||[]}catch(r){console.error("Failed to load report:",r),i.value=[],p.value=[],l.total_ingredient_cost=0,l.total_labour_cost=0,l.total_production_value=0,l.margin=0}finally{c.value=!1}}async function N(){try{const[f,e,h]=await Promise.all([fetch("/items?limit=1000&page=1"),fetch("/products?limit=1000&page=1"),fetch("/staffs?status=Active&limit=1000&page=1")]),[o,r,u]=await Promise.all([f.json(),e.json(),h.json()]);y.value=(o==null?void 0:o.data)||o||[],T.value=(r==null?void 0:r.data)||r||[],S.value=((u==null?void 0:u.data)||u||[]).map(d=>({id:d.id,name:d.name}))}catch(f){console.error("Failed to load lookups:",f),y.value=[],T.value=[],S.value=[]}}function R(){g.value=null,m.ingredients=[],m.products=[],m.team_leader="",P()}return se(async()=>{await N(),await P()}),(f,e)=>{const h=ze("VueDatePicker");return Ae(),Se(Ie,{fluid:"",class:"report-container"},{default:a(()=>[t(j,null,{default:a(()=>[t(v,{cols:"12"},{default:a(()=>[t(w,{class:"pa-4",color:"primary",dark:""},{default:a(()=>[t(F,{class:"text-h4 font-weight-bold"},{default:a(()=>[t(x,{large:"",class:"mr-3"},{default:a(()=>e[4]||(e[4]=[s("mdi-chart-arc")])),_:1}),e[5]||(e[5]=s(" Profit Projection Dashboard "))]),_:1})]),_:1})]),_:1})]),_:1}),t(j,{class:"mt-4"},{default:a(()=>[t(v,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(w,{class:"profit-card",color:"green-lighten-5",elevation:"4"},{default:a(()=>[t(A,{class:"text-center"},{default:a(()=>[t(x,{color:"green-darken-2",size:"48",class:"mb-2"},{default:a(()=>e[6]||(e[6]=[s("mdi-currency-usd")])),_:1}),O("div",Qe,b(_(l.total_production_value)),1),e[7]||(e[7]=O("div",{class:"text-caption text-grey"},"Total Production Value",-1))]),_:1})]),_:1})]),_:1}),t(v,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(w,{class:"cost-card",color:"orange-lighten-5",elevation:"4"},{default:a(()=>[t(A,{class:"text-center"},{default:a(()=>[t(x,{color:"orange-darken-2",size:"48",class:"mb-2"},{default:a(()=>e[8]||(e[8]=[s("mdi-sack")])),_:1}),O("div",qe,b(_(l.total_ingredient_cost)),1),e[9]||(e[9]=O("div",{class:"text-caption text-grey"},"Ingredient Cost",-1))]),_:1})]),_:1})]),_:1}),t(v,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(w,{class:"cost-card",color:"blue-lighten-5",elevation:"4"},{default:a(()=>[t(A,{class:"text-center"},{default:a(()=>[t(x,{color:"blue-darken-2",size:"48",class:"mb-2"},{default:a(()=>e[10]||(e[10]=[s("mdi-account-hard-hat")])),_:1}),O("div",Ze,b(_(l.total_labour_cost)),1),e[11]||(e[11]=O("div",{class:"text-caption text-grey"},"Labour Cost",-1))]),_:1})]),_:1})]),_:1}),t(v,{cols:"12",sm:"6",md:"3"},{default:a(()=>[t(w,{class:"margin-card",color:l.margin>=0?"teal-lighten-5":"red-lighten-5",elevation:"4"},{default:a(()=>[t(A,{class:"text-center"},{default:a(()=>[t(x,{color:l.margin>=0?"teal-darken-2":"red-darken-2",size:"48",class:"mb-2"},{default:a(()=>[s(b(l.margin>=0?"mdi-trending-up":"mdi-trending-down"),1)]),_:1},8,["color"]),O("div",{class:Te(["text-h5 font-weight-bold",l.margin>=0?"text-teal-darken-2":"text-red-darken-2"])},b(_(l.margin)),3),e[12]||(e[12]=O("div",{class:"text-caption text-grey"},"Profit Margin",-1))]),_:1})]),_:1},8,["color"])]),_:1})]),_:1}),t(j,{class:"mt-6"},{default:a(()=>[t(v,{cols:"12",md:"6"},{default:a(()=>[t(w,{elevation:"4",class:"chart-card"},{default:a(()=>[t(F,{class:"text-h6"},{default:a(()=>[t(x,{class:"mr-2"},{default:a(()=>e[13]||(e[13]=[s("mdi-chart-pie")])),_:1}),e[14]||(e[14]=s(" Cost Distribution "))]),_:1}),t(A,null,{default:a(()=>[t(X(ie),{option:I.value,autoresize:!0,style:{height:"300px"}},null,8,["option"])]),_:1})]),_:1})]),_:1}),t(v,{cols:"12",md:"6"},{default:a(()=>[t(w,{elevation:"4",class:"chart-card"},{default:a(()=>[t(F,{class:"text-h6"},{default:a(()=>[t(x,{class:"mr-2"},{default:a(()=>e[15]||(e[15]=[s("mdi-gauge")])),_:1}),e[16]||(e[16]=s(" Profitability Ratio "))]),_:1}),t(A,null,{default:a(()=>[t(X(ie),{option:E.value,autoresize:!0,style:{height:"300px"}},null,8,["option"])]),_:1})]),_:1})]),_:1})]),_:1}),t(j,null,{default:a(()=>[t(v,{cols:"12",md:"12"},{default:a(()=>[t(w,{elevation:"2",rounded:"lg",class:"mb-6"},{default:a(()=>[t(A,{class:"pa-4"},{default:a(()=>[t(j,{dense:""},{default:a(()=>[t(v,{cols:"12",md:"4"},{default:a(()=>[e[17]||(e[17]=O("div",{class:"mb-1 text-caption text-grey"},"Production Date Range",-1)),t(h,{modelValue:g.value,"onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),range:"","enable-time-picker":!1,teleport:!0,"auto-apply":"",placeholder:"Select date range",class:"rounded-lg border px-4 py-2 w-100"},null,8,["modelValue"])]),_:1}),t(v,{cols:"12",md:"4"},{default:a(()=>[t(J,{modelValue:m.ingredients,"onUpdate:modelValue":e[1]||(e[1]=o=>m.ingredients=o),items:y.value,"item-title":"name","item-value":"id",label:"Ingredients",multiple:"",clearable:"",chips:"","closable-chips":"",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-food-apple"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",md:"4"},{default:a(()=>[t(J,{modelValue:m.products,"onUpdate:modelValue":e[2]||(e[2]=o=>m.products=o),items:T.value,"item-title":"name","item-value":"id",label:"Products",multiple:"",clearable:"",chips:"","closable-chips":"",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-package-variant"},null,8,["modelValue","items"])]),_:1}),t(v,{cols:"12",md:"4"},{default:a(()=>[t(J,{modelValue:m.team_leader,"onUpdate:modelValue":e[3]||(e[3]=o=>m.team_leader=o),items:S.value,"item-title":"name","item-value":"id",label:"Team Leader (name or ID)",clearable:"",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-account-tie",hint:m.team_leader?"Filtering by selected leader":"Leave empty to include all leaders","persistent-hint":""},null,8,["modelValue","items","hint"])]),_:1}),t(v,{cols:"12",class:"d-flex justify-end"},{default:a(()=>[O("div",Je,[t(Z,{color:"primary",onClick:P,loading:c.value},{default:a(()=>[t(x,{start:""},{default:a(()=>e[18]||(e[18]=[s("mdi-filter")])),_:1}),e[19]||(e[19]=s(" Apply Filters "))]),_:1},8,["loading"]),t(Z,{color:"primary",variant:"flat",onClick:P,loading:c.value},{default:a(()=>[t(x,{start:""},{default:a(()=>e[20]||(e[20]=[s("mdi-refresh")])),_:1}),e[21]||(e[21]=s(" Refresh "))]),_:1},8,["loading"]),t(Z,{variant:"outlined",color:"grey",onClick:R,disabled:c.value},{default:a(()=>[t(x,{start:""},{default:a(()=>e[22]||(e[22]=[s("mdi-broom")])),_:1}),e[23]||(e[23]=s(" Reset "))]),_:1},8,["disabled"])])]),_:1})]),_:1})]),_:1})]),_:1}),t(j,null,{default:a(()=>[t(v,{cols:"12",md:"6"},{default:a(()=>[t(w,{rounded:"lg",elevation:"2"},{default:a(()=>[t(F,{class:"d-flex align-center"},{default:a(()=>[t(x,{class:"mr-2",color:"primary"},{default:a(()=>e[24]||(e[24]=[s("mdi-food-variant")])),_:1}),e[25]||(e[25]=s(" Ingredients Consumed ")),t(ae),t(B,{size:"small",variant:"tonal",color:"primary"},{default:a(()=>[s(b(i.value.length)+" item(s) ",1)]),_:1})]),_:1}),t(le,{active:c.value,indeterminate:c.value,height:"3",color:"primary"},null,8,["active","indeterminate"]),t(ne,{headers:M,items:i.value,class:"elevation-0",density:"comfortable",hover:""},{"item.total_consumed":a(({item:o})=>[s(b(C(o.total_consumed)),1)]),"item.avg_price":a(({item:o})=>[s(b(_(o.avg_price)),1)]),"item.total_cost":a(({item:o})=>[t(B,{size:"small",color:"orange",variant:"flat"},{default:a(()=>[s(b(_(o.total_cost)),1)]),_:2},1024)]),"no-data":a(()=>e[26]||(e[26]=[O("div",{class:"text-center py-6 text-grey"},"No ingredients for selected filters.",-1)])),_:1},8,["items"])]),_:1})]),_:1}),t(v,{cols:"12",md:"6"},{default:a(()=>[t(w,{rounded:"lg",elevation:"2"},{default:a(()=>[t(F,{class:"d-flex align-center"},{default:a(()=>[t(x,{class:"mr-2",color:"primary"},{default:a(()=>e[27]||(e[27]=[s("mdi-package-variant")])),_:1}),e[28]||(e[28]=s(" Products Produced ")),t(ae),t(B,{size:"small",variant:"tonal",color:"primary"},{default:a(()=>[s(b(p.value.length)+" product(s) ",1)]),_:1})]),_:1}),t(le,{active:c.value,indeterminate:c.value,height:"3",color:"primary"},null,8,["active","indeterminate"]),t(ne,{headers:U,items:p.value,class:"elevation-0",density:"comfortable",hover:""},{"item.total_produced":a(({item:o})=>[s(b(C(o.total_produced)),1)]),"item.selling_price":a(({item:o})=>[s(b(_(o.selling_price)),1)]),"item.total_value":a(({item:o})=>[t(B,{size:"small",color:"green",variant:"flat"},{default:a(()=>[s(b(_(o.total_value)),1)]),_:2},1024)]),"item.team_leader":a(({item:o})=>[t(B,{size:"small",variant:"outlined",color:"blue"},{default:a(()=>[t(x,{start:"",size:"14"},{default:a(()=>e[29]||(e[29]=[s("mdi-account-tie")])),_:1}),s(" "+b(o.team_leader),1)]),_:2},1024)]),"no-data":a(()=>e[30]||(e[30]=[O("div",{class:"text-center py-6 text-grey"},"No products for selected filters.",-1)])),_:1},8,["items"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},ut=Le(Xe,[["__scopeId","data-v-4fc20b05"]]);export{ut as default};
