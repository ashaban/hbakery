import{_ as ne,r as p,$ as vt,e as O,l as ie,s as x,x as l,a0 as ue,v as _,i as e,O as I,y as s,A as C,B as m,C as r,H as v,aH as $t,av as pt,I as f,Q as zt,D as U,a2 as q,a3 as et,a4 as lt,E as j,F as gt,G as bt}from"./index-Bm_1tDB1.js";import{V as de}from"./VContainer-BKK7VQkU.js";import{V as g,b as V,a as at,c as Y}from"./VCard-rPQh7TtY.js";import{V as c}from"./VCol-Cxhy3hua.js";import{V as E,a as fe,b as me,g as ce}from"./VDataTable-BBB9e339.js";import{V as K}from"./VTextField-CkPOq7cJ.js";import{V as ot}from"./VTooltip-E8TzfLvY.js";import{V as w}from"./VChip-BaMa1hN2.js";import{V as rt}from"./VDialog-DDaebS9v.js";import{V as h}from"./VAlert-X55k89ft.js";import{V as It}from"./VTextarea-BDUNHhaR.js";import{V as _e}from"./VAutocomplete-BZ1xi2_X.js";import{V as ye}from"./VCheckbox-DK2p2T08.js";import"./dialog-transition-DpdgYHbX.js";import"./VSlideGroup-BuwiiylY.js";const ve={class:"d-flex align-center"},pe={class:"d-flex align-center"},ge={class:"font-weight-medium"},be={class:"text-caption text-grey"},ke={class:"d-flex align-center"},qe={class:"font-weight-medium"},xe={class:"text-caption text-grey"},Ve={class:"d-flex align-center"},we={class:"font-weight-medium"},Te={class:"text-center"},De={class:"d-flex justify-end"},Ae={class:"d-flex align-center"},Ce={class:"text-body-2 font-weight-bold text-blue-darken-3"},Oe={class:"text-caption text-blue-darken-2"},je={key:2,class:"text-center py-8"},Ee={class:"d-flex gap-4"},Se={class:"text-center"},$e={class:"text-h6 font-weight-bold text-green"},ze={class:"text-center"},Ie={class:"text-h6 font-weight-bold text-orange"},Ue={class:"text-center"},Re={class:"text-h6 font-weight-bold text-red"},Me={class:"d-flex align-center mb-4"},Fe={class:"text-h5 font-weight-bold"},Qe={class:"d-flex align-center"},Ge={class:"text-body-1 font-weight-medium"},Ne={class:"d-flex align-center mb-4"},he={class:"text-body-1 font-weight-medium"},Pe={class:"d-flex align-center"},Le={class:"text-body-1 font-weight-medium"},Je={class:"bg-grey-lighten-4"},Be={key:0,class:"text-center font-weight-bold text-grey"},He={class:"d-flex align-center"},Ye={class:"font-weight-medium"},Ke={class:"text-center"},We={class:"text-center"},Xe={class:"d-flex align-center justify-center"},Ze={class:"text-center"},tl={key:0,class:"text-center"},el={key:0,class:"text-center py-12"},ll={class:"text-body-1 text-grey mb-4"},al={class:"font-weight-bold text-error"},ol={__name:"StockTransfers",setup(rl){const S=ue(),$=p(!1),W=p(!1),st=p(!1),nt=p(!1),it=p([]),z=p([]),X=p([]),ut=p(1),kt=p(1),P=p(!1),L=p(!1),M=p(!1),J=p(!1),T=p(!1),R=p(null),b=p(null),F=p([]),k=vt({from_outlet_id:"",to_outlet_id:"",date:""}),n=vt({from_outlet_id:"",to_outlet_id:"",movement_date:new Date().toISOString().split("T")[0],remarks:"",items:[]}),i=vt({outlet_id:"",product_id:"",from_quality:"GOOD",to_quality:"DAMAGED",quantity:0,remarks:"",available:null}),B=p([]),Z=[{title:"Good",value:"GOOD"},{title:"Damaged",value:"DAMAGED"},{title:"Reject",value:"REJECT"}],Ut=[{title:"ID",key:"id"},{title:"From Outlet",key:"from_outlet"},{title:"To Outlet",key:"to_outlet"},{title:"Date",key:"transfer_date"},{title:"Items",key:"items_count",align:"center"},{title:"Total Qty",key:"total_quantity",align:"center"},{title:"Actions",key:"actions",sortable:!1}],Rt=O(()=>{const o=z.value.find(a=>a.id===n.from_outlet_id),t=z.value.find(a=>a.id===n.to_outlet_id);return(t==null?void 0:t.type)==="MAIN"&&(o==null?void 0:o.type)!=="MAIN"}),qt=O(()=>n.items.some(o=>o.from_quality!==o.to_quality)),Mt=O(()=>{const o=n.items.filter(d=>d.from_quality!==d.to_quality);if(o.length===0)return"";const t=o.reduce((d,u)=>{const y=`${u.from_quality}→${u.to_quality}`;return d[y]=(d[y]||0)+1,d},{}),a=Object.entries(t).map(([d,u])=>`${u} ${d}`).join(", ");return`${o.length} item(s) will undergo quality conversion: ${a}`}),xt=O(()=>n.from_outlet_id&&n.to_outlet_id&&n.movement_date&&n.items.length>0&&B.value.length===0),Vt=O(()=>n.from_outlet_id&&n.to_outlet_id&&n.movement_date),wt=O(()=>F.value.some(o=>o.is_replacement)),Ft=O(()=>F.value.reduce((o,t)=>o+Number(t.quantity),0)),Tt=O(()=>!i.available||!i.quantity?!1:i.quantity>(i.available[i.from_quality]||0)),Qt=O(()=>i.available?`Available: ${i.available[i.from_quality]||0}`:"Select product first"),Dt=O(()=>i.outlet_id&&i.product_id&&i.from_quality&&i.to_quality&&i.quantity>0&&i.remarks&&!Tt.value);function tt(o){return{MAIN:"mdi-home",SHOP:"mdi-store",CAR:"mdi-truck"}[o]||"mdi-store"}function Q(o){return{MAIN:"primary",SHOP:"success",CAR:"warning"}[o]||"grey"}function G(o){return{GOOD:"success",DAMAGED:"warning",REJECT:"error"}[o]||"grey"}function At(o){return new Date(o).toLocaleDateString()}function dt(o){return o.from_quality&&o.to_quality&&o.from_quality!==o.to_quality}function Gt(o){return o.from_quality||"GOOD"}function ft(o){return o.stockData&&o.stockData[o.from_quality]||0}function Nt(o){return o.product_id?`Available: ${ft(o)}`:"Select product first"}function ht(o){return o.from_quality?o.from_quality===o.to_quality?"Same quality":`Changing from ${o.from_quality}`:"Select from quality first"}function Pt(o){return!o.product_id||!o.from_quality?"":`Available: ${ft(o)}`}async function mt(o){if(!n.from_outlet_id||!o.product_id){o.availableStock=0,o.stockData=null;return}try{const a=await(await fetch(`/stocktransfers/availableByQuality?outlet_id=${n.from_outlet_id}&product_id=${o.product_id}`)).json();o.stockData=a.stock||{GOOD:0,DAMAGED:0,REJECT:0},o.availableStock=o.stockData[o.from_quality]||0}catch(t){console.error("Error fetching stock:",t),o.availableStock=0,o.stockData=null}}async function Lt(o){o.stockData&&(o.availableStock=o.stockData[o.from_quality]||0),await _t(o)}function ct(o){return!o.quantity||!o.product_id||!o.from_quality?!1:Number(o.quantity)>(o.availableStock||0)}function Ct(o){if(!o.product_id||!o.from_quality||!o.to_quality)return null;const t=`${o.product_id}_${o.from_quality}_${o.to_quality}`;return n.items.filter(d=>d.product_id&&d.from_quality&&d.to_quality&&`${d.product_id}_${d.from_quality}_${d.to_quality}`===t).length>1?"This product with same transfer quality is already added":ct(o)?`Insufficient ${o.from_quality} stock. Available: ${o.availableStock||0}`:null}function Jt(o){return X.value}function Ot(){n.items.push({product_id:"",from_quality:"GOOD",to_quality:"GOOD",quantity:"",is_replacement:!1,replacement_note:"",availableStock:0,stockData:null}),H()}function Bt(){Object.assign(i,{outlet_id:"",product_id:"",from_quality:"GOOD",to_quality:"DAMAGED",quantity:0,remarks:"",available:null}),M.value=!0}async function Ht(){if(!i.outlet_id||!i.product_id){i.available=null;return}try{const t=await(await fetch(`/stocktransfers/availableByQuality?outlet_id=${i.outlet_id}&product_id=${i.product_id}`)).json();i.available=t.stock||{GOOD:0,DAMAGED:0,REJECT:0}}catch(o){console.error("Error fetching adjustment stock:",o),i.available=null}}async function Yt(){if(Dt.value){nt.value=!0;try{const o={outlet_id:i.outlet_id,product_id:i.product_id,from_quality:i.from_quality,to_quality:i.to_quality,quantity:i.quantity,remarks:i.remarks,movement_date:new Date().toISOString().split("T")[0]},t=await fetch("/stocktransfers/adjust-quality",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!t.ok)throw new Error("Failed to adjust quality");const a=await t.json();S.commit("setMessage",{type:"success",text:`Quality adjusted successfully (Adjustment ID: ${a.adjustmentId})`}),M.value=!1}catch{S.commit("setMessage",{type:"error",text:"Failed to adjust quality"})}finally{nt.value=!1}}}async function Kt(){if(!xt.value)return;W.value=!0;const o=T.value?`/stocktransfers/${R.value}`:"/stocktransfers",t=T.value?"PUT":"POST";try{const a={from_outlet_id:n.from_outlet_id,to_outlet_id:n.to_outlet_id,movement_date:n.movement_date,remarks:n.remarks,items:n.items.map(D=>({product_id:D.product_id,quantity:Number(D.quantity),from_quality:D.from_quality,to_quality:D.to_quality,is_replacement:D.is_replacement,replacement_note:D.replacement_note}))},d=await fetch(o,{method:t,headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!d.ok)throw new Error("Failed to save transfer");const u=await d.json();let y=`Transfer ${T.value?"updated":"created"} successfully`;u.adjustmentIds&&u.adjustmentIds.length>0&&(y+=` (${u.adjustmentIds.length} quality adjustments processed)`),u.undoneAdjustments&&u.undoneAdjustments>0&&(y+=` (${u.undoneAdjustments} previous adjustments reversed)`),S.commit("setMessage",{type:"success",text:y}),yt(),N()}catch{S.commit("setMessage",{type:"error",text:"Failed to save transfer"})}finally{W.value=!1}}async function Wt(o){var t;T.value=!0,R.value=o.id,$.value=!0;try{const d=await(await fetch(`/stocktransfers/${o.id}`)).json();n.from_outlet_id=d.transfer.from_outlet_id,n.to_outlet_id=d.transfer.to_outlet_id,n.movement_date=((t=d.transfer.movement_date)==null?void 0:t.split("T")[0])||new Date().toISOString().split("T")[0],n.remarks=d.transfer.remarks,n.items=d.items.map(u=>({product_id:u.product_id,from_quality:u.from_quality||"GOOD",to_quality:u.to_quality||"GOOD",quantity:u.quantity,is_replacement:u.is_replacement||!1,replacement_note:u.replacement_note||"",availableStock:0,stockData:null}));for(const u of n.items)await mt(u);H(),P.value=!0}catch{S.commit("setMessage",{type:"error",text:"Failed to load transfer"})}finally{$.value=!1}}async function _t(o){await mt(o),H()}async function Xt(o){await _t(o)}function H(){const o=[];n.items.forEach((t,a)=>{if(!t.product_id||!t.from_quality||!t.to_quality||!t.quantity){o.push(`Item ${a+1} is incomplete`);return}const d=`${t.product_id}_${t.from_quality}_${t.to_quality}`;if(n.items.filter(y=>y.product_id&&y.from_quality&&y.to_quality&&`${y.product_id}_${y.from_quality}_${y.to_quality}`===d).length>1&&o.push("Duplicate product with same quality found"),ct(t)){const y=X.value.find(D=>D.id===t.product_id);o.push(`Insufficient ${t.from_quality} stock for ${y==null?void 0:y.name}`)}}),B.value=o}function Zt(o){n.items.splice(o,1),H()}async function te(){for(const o of n.items)await mt(o);H()}function ee(){T.value=!1,R.value=null,jt(),P.value=!0}async function le(o){R.value=o.id,$.value=!0;try{const a=await(await fetch(`/stocktransfers/${o.id}`)).json();b.value=a.transfer,F.value=a.items||[],L.value=!0}catch{S.commit("setMessage",{type:"error",text:"Failed to load transfer details"})}finally{$.value=!1}}function yt(){P.value=!1,jt()}function jt(){n.from_outlet_id="",n.to_outlet_id="",n.movement_date=new Date().toISOString().split("T")[0],n.remarks="",n.items=[],B.value=[]}async function N(){$.value=!0;const o=new URLSearchParams({page:ut.value,limit:10});k.from_outlet_id&&o.append("from_outlet_id",k.from_outlet_id),k.to_outlet_id&&o.append("to_outlet_id",k.to_outlet_id),k.date&&o.append("date",k.date);try{const a=await(await fetch(`/stocktransfers?${o}`)).json();it.value=a.data||[],kt.value=a.totalPages||1}catch{S.commit("setMessage",{type:"error",text:"Failed to load transfers"})}finally{$.value=!1}}function ae(o){R.value=o.id,J.value=!0}async function oe(){st.value=!0;try{const o=await fetch(`/stocktransfers/${R.value}`,{method:"DELETE"});if(!o.ok)throw new Error("Failed to delete transfer");const t=await o.json();let a="Transfer deleted successfully";t.undoneAdjustments&&t.undoneAdjustments>0&&(a+=` (${t.undoneAdjustments} quality adjustments reversed)`),S.commit("setMessage",{type:"success",text:a}),J.value=!1,N()}catch{S.commit("setMessage",{type:"error",text:"Failed to delete transfer"})}finally{st.value=!1}}function re(){k.from_outlet_id="",k.to_outlet_id="",k.date="",N()}async function se(){try{const[o,t]=await Promise.all([fetch("/outlets?limit=1000"),fetch("/products?limit=1000")]);z.value=(await o.json()).data||[],X.value=(await t.json()).data||[]}catch(o){console.error("Error loading initial data:",o)}}return ie(()=>{N(),se()}),(o,t)=>(_(),x(de,{class:"bg-grey-lighten-4 pa-6",fluid:""},{default:l(()=>[e(g,{class:"mb-6",elevation:"2"},{default:l(()=>[e(V,{class:"pa-6"},{default:l(()=>[e(I,{align:"center"},{default:l(()=>[e(c,{cols:"12",md:"6"},{default:l(()=>[s("div",ve,[e(C,{class:"mr-4",color:"primary",size:"56"},{default:l(()=>[e(m,{color:"white",size:"32"},{default:l(()=>t[23]||(t[23]=[r("mdi-truck-delivery")])),_:1})]),_:1}),t[24]||(t[24]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold text-primary"}," Stock Transfers "),s("p",{class:"text-body-1 text-grey mt-1"}," Manage inventory movements between outlets ")],-1))])]),_:1}),e(c,{class:"text-right",cols:"12",md:"6"},{default:l(()=>[e(v,{class:"mr-3 text-white",color:"secondary",size:"large",onClick:Bt},{default:l(()=>[e(m,{start:""},{default:l(()=>t[25]||(t[25]=[r("mdi-autorenew")])),_:1}),t[26]||(t[26]=r(" Adjust Quality "))]),_:1}),e(v,{color:"primary",size:"large",onClick:ee},{default:l(()=>[e(m,{start:""},{default:l(()=>t[27]||(t[27]=[r("mdi-plus")])),_:1}),t[28]||(t[28]=r(" New Transfer "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{class:"mb-6",elevation:"1"},{default:l(()=>[e(V,{class:"pa-4"},{default:l(()=>[e(I,{align:"center",dense:""},{default:l(()=>[e(c,{cols:"12",sm:"3"},{default:l(()=>[e(E,{modelValue:k.from_outlet_id,"onUpdate:modelValue":t[0]||(t[0]=a=>k.from_outlet_id=a),clearable:"",density:"comfortable","item-title":"name","item-value":"id",items:z.value,label:"From Outlet","prepend-inner-icon":"mdi-export",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"3"},{default:l(()=>[e(E,{modelValue:k.to_outlet_id,"onUpdate:modelValue":t[1]||(t[1]=a=>k.to_outlet_id=a),clearable:"",density:"comfortable","item-title":"name","item-value":"id",items:z.value,label:"To Outlet","prepend-inner-icon":"mdi-import",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",sm:"3"},{default:l(()=>[e(K,{modelValue:k.date,"onUpdate:modelValue":t[2]||(t[2]=a=>k.date=a),clearable:"",density:"comfortable",label:"Transfer Date","prepend-inner-icon":"mdi-calendar",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(c,{class:"d-flex justify-end",cols:"12",sm:"3"},{default:l(()=>[e(v,{class:"mr-2",color:"primary",variant:"flat",onClick:N},{default:l(()=>[e(m,{start:""},{default:l(()=>t[29]||(t[29]=[r("mdi-magnify")])),_:1}),t[30]||(t[30]=r(" Search "))]),_:1}),e(v,{color:"grey",variant:"outlined",onClick:re},{default:l(()=>[e(m,{start:""},{default:l(()=>t[31]||(t[31]=[r("mdi-refresh")])),_:1}),t[32]||(t[32]=r(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{class:"rounded-lg",elevation:"2"},{default:l(()=>[e($t,{active:$.value,color:"primary",height:"4",indeterminate:$.value},null,8,["active","indeterminate"]),e(fe,{class:"elevation-0",headers:Ut,items:it.value,"items-per-page":10,loading:$.value,"loading-text":"Loading transfers...","no-data-text":"No transfers found"},{top:l(()=>[e(at,{class:"d-flex align-center pt-4"},{default:l(()=>[e(m,{class:"mr-2",color:"primary"},{default:l(()=>t[33]||(t[33]=[r("mdi-format-list-bulleted")])),_:1}),t[34]||(t[34]=r(" Recent Transfers ")),e(w,{class:"ml-3",color:"primary",size:"small",variant:"flat"},{default:l(()=>[r(f(it.value.length)+" total ",1)]),_:1})]),_:1}),e(zt)]),"item.from_outlet":l(({item:a})=>[s("div",pe,[e(C,{class:"mr-2",color:Q(a.from_outlet_type),size:"32"},{default:l(()=>[e(m,{color:"white",size:"16"},{default:l(()=>[r(f(tt(a.from_outlet_type)),1)]),_:2},1024)]),_:2},1032,["color"]),s("div",null,[s("div",ge,f(a.from_outlet),1),s("div",be,f(a.from_outlet_type),1)])])]),"item.to_outlet":l(({item:a})=>[s("div",ke,[e(C,{class:"mr-2",color:Q(a.to_outlet_type),size:"32"},{default:l(()=>[e(m,{color:"white",size:"16"},{default:l(()=>[r(f(tt(a.to_outlet_type)),1)]),_:2},1024)]),_:2},1032,["color"]),s("div",null,[s("div",qe,f(a.to_outlet),1),s("div",xe,f(a.to_outlet_type),1)])])]),"item.transfer_date":l(({item:a})=>[s("div",Ve,[e(m,{class:"mr-2",color:"grey",size:"16"},{default:l(()=>t[35]||(t[35]=[r("mdi-calendar")])),_:1}),s("span",we,f(At(a.transfer_date)),1)])]),"item.items_count":l(({item:a})=>[e(w,{color:"primary",size:"small",variant:"outlined"},{default:l(()=>[r(f(a.items_count)+" items ",1)]),_:2},1024)]),"item.total_quantity":l(({item:a})=>[s("div",Te,[e(w,{color:"green",size:"small",variant:"flat"},{default:l(()=>[r(f(a.total_quantity),1)]),_:2},1024)])]),"item.actions":l(({item:a})=>[s("div",De,[e(ot,{location:"top"},{activator:l(({props:d})=>[e(v,pt(d,{color:"info",icon:"",size:"small",variant:"text",onClick:u=>le(a)}),{default:l(()=>[e(m,null,{default:l(()=>t[36]||(t[36]=[r("mdi-eye-outline")])),_:1})]),_:2},1040,["onClick"])]),default:l(()=>[t[37]||(t[37]=s("span",null,"View Details",-1))]),_:2},1024),e(ot,{location:"top"},{activator:l(({props:d})=>[e(v,pt(d,{color:"primary",icon:"",size:"small",variant:"text",onClick:u=>Wt(a)}),{default:l(()=>[e(m,null,{default:l(()=>t[38]||(t[38]=[r("mdi-pencil-outline")])),_:1})]),_:2},1040,["onClick"])]),default:l(()=>[t[39]||(t[39]=s("span",null,"Edit Transfer",-1))]),_:2},1024),e(ot,{location:"top"},{activator:l(({props:d})=>[e(v,pt(d,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>ae(a)}),{default:l(()=>[e(m,null,{default:l(()=>t[40]||(t[40]=[r("mdi-delete-outline")])),_:1})]),_:2},1040,["onClick"])]),default:l(()=>[t[41]||(t[41]=s("span",null,"Delete Transfer",-1))]),_:2},1024)])]),_:1},8,["items","loading"]),e(Y,{class:"px-4 py-3 bg-grey-lighten-3"},{default:l(()=>[e(U),e(me,{modelValue:ut.value,"onUpdate:modelValue":[t[3]||(t[3]=a=>ut.value=a),N],color:"primary",length:kt.value,"total-visible":"7"},null,8,["modelValue","length"])]),_:1})]),_:1}),e(rt,{modelValue:P.value,"onUpdate:modelValue":t[8]||(t[8]=a=>P.value=a),"max-width":"1200",persistent:"",scrollable:""},{default:l(()=>[e(g,{class:"rounded-lg"},{default:l(()=>[e(et,{color:T.value?"warning":"primary",density:"comfortable"},{default:l(()=>[e(C,{class:"mr-3",color:T.value?"warning":"primary",size:"40"},{default:l(()=>[e(m,{color:"white"},{default:l(()=>[r(f(T.value?"mdi-pencil":"mdi-plus"),1)]),_:1})]),_:1},8,["color"]),e(lt,{class:"text-h6 font-weight-bold"},{default:l(()=>[r(f(T.value?"Edit Transfer":"Create New Transfer"),1)]),_:1}),e(U),e(v,{icon:"",onClick:yt},{default:l(()=>[e(m,null,{default:l(()=>t[42]||(t[42]=[r("mdi-close")])),_:1})]),_:1})]),_:1},8,["color"]),W.value&&qt.value?(_(),x(h,{key:0,class:"mb-4",color:"info",icon:"mdi-autorenew",variant:"tonal"},{default:l(()=>[e($t,{class:"mb-2",color:"info",height:"4",indeterminate:""}),t[43]||(t[43]=r(" Processing quality adjustments... "))]),_:1})):q("",!0),e(V,{class:"pa-6"},{default:l(()=>[e(g,{class:"mb-6",variant:"outlined"},{default:l(()=>[e(at,{class:"d-flex align-center bg-blue-lighten-5"},{default:l(()=>[e(m,{class:"mr-2",color:"primary"},{default:l(()=>t[44]||(t[44]=[r("mdi-information")])),_:1}),t[45]||(t[45]=r(" Transfer Information "))]),_:1}),e(V,{class:"pa-4"},{default:l(()=>[e(I,null,{default:l(()=>[e(c,{cols:"12",md:"6"},{default:l(()=>[e(E,{modelValue:n.from_outlet_id,"onUpdate:modelValue":[t[4]||(t[4]=a=>n.from_outlet_id=a),te],"item-title":"name","item-value":"id",items:z.value,label:"From Outlet","prepend-inner-icon":"mdi-export",required:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",md:"6"},{default:l(()=>[e(E,{modelValue:n.to_outlet_id,"onUpdate:modelValue":t[5]||(t[5]=a=>n.to_outlet_id=a),"item-title":"name","item-value":"id",items:z.value,label:"To Outlet","prepend-inner-icon":"mdi-import",required:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",md:"6"},{default:l(()=>[e(K,{modelValue:n.movement_date,"onUpdate:modelValue":t[6]||(t[6]=a=>n.movement_date=a),label:"Transfer Date","prepend-inner-icon":"mdi-calendar",required:"",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(It,{modelValue:n.remarks,"onUpdate:modelValue":t[7]||(t[7]=a=>n.remarks=a),label:"Remarks",placeholder:"Add any notes about this transfer...",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),e(g,{variant:"outlined"},{default:l(()=>[e(at,{class:"d-flex align-center justify-space-between bg-green-lighten-5"},{default:l(()=>[s("div",Ae,[e(m,{class:"mr-2",color:"green"},{default:l(()=>t[46]||(t[46]=[r("mdi-package-variant")])),_:1}),t[47]||(t[47]=r(" Transfer Items ")),e(w,{class:"ml-3",color:"green",size:"small",variant:"flat"},{default:l(()=>[r(f(n.items.length)+" items ",1)]),_:1})]),e(v,{color:"green",disabled:!Vt.value,size:"small",onClick:Ot},{default:l(()=>[e(m,{start:""},{default:l(()=>t[48]||(t[48]=[r("mdi-plus")])),_:1}),t[49]||(t[49]=r(" Add Item "))]),_:1},8,["disabled"])]),_:1}),e(V,{class:"pa-4"},{default:l(()=>[qt.value?(_(),x(h,{key:0,class:"mb-4",color:"info",icon:"mdi-autorenew",variant:"tonal"},{default:l(()=>[r(f(Mt.value),1)]),_:1})):q("",!0),B.value.length?(_(),x(h,{key:1,class:"mb-4",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:l(()=>[(_(!0),j(gt,null,bt(B.value,a=>(_(),j("div",{key:a}," • "+f(a),1))),128))]),_:1})):q("",!0),(_(!0),j(gt,null,bt(n.items,(a,d)=>(_(),j("div",{key:d,class:"mb-4"},[e(g,{class:"elevation-2",color:dt(a)?"orange-lighten-5":""},{default:l(()=>[e(V,{class:"pa-4"},{default:l(()=>[e(I,{align:"center",dense:""},{default:l(()=>[e(c,{cols:"12",md:"3"},{default:l(()=>[e(_e,{modelValue:a.product_id,"onUpdate:modelValue":[u=>a.product_id=u,()=>Xt(a)],autocapitalize:"off",autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none","item-title":"name","item-value":"id",items:Jt(d),label:"Product","prepend-inner-icon":"mdi-cube-outline",required:"",spellcheck:"false",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),e(c,{cols:"12",md:"2"},{default:l(()=>[e(g,{class:"pa-3 text-center",color:"blue-lighten-5",variant:"flat"},{default:l(()=>[t[50]||(t[50]=s("div",{class:"text-caption text-blue-darken-3 font-weight-bold"}," STOCK INFO ",-1)),s("div",Ce,f(Gt(a)),1),s("div",Oe," Available: "+f(ft(a)),1)]),_:2},1024)]),_:2},1024),e(c,{cols:"12",md:"2"},{default:l(()=>[e(E,{modelValue:a.from_quality,"onUpdate:modelValue":[u=>a.from_quality=u,()=>Lt(a)],color:G(a.from_quality),density:"comfortable",hint:Nt(a),items:Z,label:"From Quality","persistent-hint":"",required:"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","color","hint"])]),_:2},1024),e(c,{cols:"12",md:"2"},{default:l(()=>[e(E,{modelValue:a.to_quality,"onUpdate:modelValue":u=>a.to_quality=u,color:G(a.to_quality),density:"comfortable",hint:ht(a),items:Z,label:"To Quality","persistent-hint":"",required:"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","color","hint"])]),_:2},1024),e(c,{cols:"12",md:"2"},{default:l(()=>[e(K,{modelValue:a.quantity,"onUpdate:modelValue":u=>a.quantity=u,density:"comfortable",error:ct(a),hint:Pt(a),label:"Quantity","persistent-hint":"",required:"",type:"number",variant:"outlined",onInput:()=>_t(a)},null,8,["modelValue","onUpdate:modelValue","error","hint","onInput"])]),_:2},1024),e(c,{cols:"12",md:"1"},{default:l(()=>[e(v,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>Zt(d)},{default:l(()=>[e(m,null,{default:l(()=>t[51]||(t[51]=[r("mdi-delete-outline")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),Rt.value&&a.to_quality==="REJECT"?(_(),x(I,{key:0,class:"mt-2"},{default:l(()=>[e(c,{cols:"12"},{default:l(()=>[e(g,{color:"orange-lighten-5",variant:"outlined"},{default:l(()=>[e(V,{class:"pa-3"},{default:l(()=>[e(I,{align:"center"},{default:l(()=>[e(c,{cols:"auto"},{default:l(()=>[e(ye,{modelValue:a.is_replacement,"onUpdate:modelValue":u=>a.is_replacement=u,color:"orange",density:"compact",label:"Mark as Replacement"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),e(c,null,{default:l(()=>[a.is_replacement?(_(),x(K,{key:0,modelValue:a.replacement_note,"onUpdate:modelValue":u=>a.replacement_note=u,density:"compact",label:"Replacement Reason",placeholder:"Explain why this is a replacement...",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])):q("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)):q("",!0),dt(a)?(_(),x(h,{key:1,class:"mt-2",color:"warning",density:"compact",icon:"mdi-autorenew",variant:"tonal"},{default:l(()=>[t[53]||(t[53]=r(" Quality conversion: ")),s("strong",null,f(a.from_quality),1),e(m,{color:"warning",small:""},{default:l(()=>t[52]||(t[52]=[r("mdi-arrow-right")])),_:1}),s("strong",null,f(a.to_quality),1)]),_:2},1024)):q("",!0),Ct(a)?(_(),x(h,{key:2,class:"mt-2",color:"error",density:"compact",icon:"mdi-alert",variant:"tonal"},{default:l(()=>[r(f(Ct(a)),1)]),_:2},1024)):q("",!0)]),_:2},1024)]),_:2},1032,["color"])]))),128)),n.items.length===0?(_(),j("div",je,[e(m,{class:"mb-4",color:"grey",size:"64"},{default:l(()=>t[54]||(t[54]=[r("mdi-package-variant-plus")])),_:1}),t[57]||(t[57]=s("div",{class:"text-h6 text-grey mb-2"},"No Items Added",-1)),t[58]||(t[58]=s("div",{class:"text-body-1 text-grey mb-4"},' Click "Add Item" to start adding products to this transfer ',-1)),e(v,{color:"primary",disabled:!Vt.value,onClick:Ot},{default:l(()=>[e(m,{start:""},{default:l(()=>t[55]||(t[55]=[r("mdi-plus")])),_:1}),t[56]||(t[56]=r(" Add Your First Item "))]),_:1},8,["disabled"])])):q("",!0)]),_:1})]),_:1})]),_:1}),e(Y,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[e(U),e(v,{size:"large",variant:"outlined",onClick:yt},{default:l(()=>t[59]||(t[59]=[r(" Cancel ")])),_:1}),e(v,{color:"primary",disabled:!xt.value,loading:W.value,size:"large",variant:"flat",onClick:Kt},{default:l(()=>[e(m,{start:""},{default:l(()=>[r(f(T.value?"mdi-content-save":"mdi-check"),1)]),_:1}),r(" "+f(T.value?"Update Transfer":"Create Transfer"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(rt,{modelValue:M.value,"onUpdate:modelValue":t[17]||(t[17]=a=>M.value=a),"max-width":"700"},{default:l(()=>[e(g,{class:"rounded-lg"},{default:l(()=>[e(et,{color:"secondary",density:"comfortable"},{default:l(()=>[e(C,{class:"mr-3",color:"secondary",size:"40"},{default:l(()=>[e(m,{color:"white"},{default:l(()=>t[60]||(t[60]=[r("mdi-autorenew")])),_:1})]),_:1}),e(lt,{class:"text-h6 font-weight-bold"},{default:l(()=>t[61]||(t[61]=[r(" Adjust Product Quality ")])),_:1}),e(U),e(v,{icon:"",onClick:t[9]||(t[9]=a=>M.value=!1)},{default:l(()=>[e(m,null,{default:l(()=>t[62]||(t[62]=[r("mdi-close")])),_:1})]),_:1})]),_:1}),e(V,{class:"pa-6"},{default:l(()=>[e(g,{class:"mb-4",variant:"outlined"},{default:l(()=>[e(V,{class:"pa-4"},{default:l(()=>[e(I,null,{default:l(()=>[e(c,{cols:"12",md:"6"},{default:l(()=>[e(E,{modelValue:i.outlet_id,"onUpdate:modelValue":t[10]||(t[10]=a=>i.outlet_id=a),"item-title":"name","item-value":"id",items:z.value,label:"Outlet","prepend-inner-icon":"mdi-store",required:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",md:"6"},{default:l(()=>[e(E,{modelValue:i.product_id,"onUpdate:modelValue":[t[11]||(t[11]=a=>i.product_id=a),Ht],"item-title":"name","item-value":"id",items:X.value,label:"Product","prepend-inner-icon":"mdi-cube-scan",required:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(c,{cols:"12",md:"6"},{default:l(()=>[e(E,{modelValue:i.from_quality,"onUpdate:modelValue":t[12]||(t[12]=a=>i.from_quality=a),color:G(i.from_quality),items:Z,label:"From Quality",required:"",variant:"outlined"},null,8,["modelValue","color"])]),_:1}),e(c,{cols:"12",md:"6"},{default:l(()=>[e(E,{modelValue:i.to_quality,"onUpdate:modelValue":t[13]||(t[13]=a=>i.to_quality=a),color:G(i.to_quality),items:Z,label:"To Quality",required:"",variant:"outlined"},null,8,["modelValue","color"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(K,{modelValue:i.quantity,"onUpdate:modelValue":t[14]||(t[14]=a=>i.quantity=a),modelModifiers:{number:!0},error:Tt.value,hint:Qt.value,label:"Quantity","persistent-hint":"","prepend-inner-icon":"mdi-scale",required:"",type:"number",variant:"outlined"},null,8,["modelValue","error","hint"])]),_:1}),e(c,{cols:"12"},{default:l(()=>[e(It,{modelValue:i.remarks,"onUpdate:modelValue":t[15]||(t[15]=a=>i.remarks=a),label:"Remarks",placeholder:"Reason for quality adjustment...",required:"",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1}),i.available?(_(),x(h,{key:0,class:"mt-4",color:"info",variant:"tonal"},{prepend:l(()=>[e(m,{color:"info"},{default:l(()=>t[63]||(t[63]=[r("mdi-information")])),_:1})]),default:l(()=>[t[67]||(t[67]=s("div",{class:"font-weight-bold mb-2"},"Current Stock Levels:",-1)),s("div",Ee,[s("div",Se,[t[64]||(t[64]=s("div",{class:"text-caption text-grey"},"GOOD",-1)),s("div",$e,f(i.available.GOOD||0),1)]),s("div",ze,[t[65]||(t[65]=s("div",{class:"text-caption text-grey"},"DAMAGED",-1)),s("div",Ie,f(i.available.DAMAGED||0),1)]),s("div",Ue,[t[66]||(t[66]=s("div",{class:"text-caption text-grey"},"REJECT",-1)),s("div",Re,f(i.available.REJECT||0),1)])])]),_:1})):q("",!0)]),_:1})]),_:1})]),_:1}),e(Y,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[e(U),e(v,{size:"large",variant:"outlined",onClick:t[16]||(t[16]=a=>M.value=!1)},{default:l(()=>t[68]||(t[68]=[r(" Cancel ")])),_:1}),e(v,{color:"secondary",disabled:!Dt.value,loading:nt.value,size:"large",variant:"flat",onClick:Yt},{default:l(()=>[e(m,{start:""},{default:l(()=>t[69]||(t[69]=[r("mdi-check")])),_:1}),t[70]||(t[70]=r(" Apply Adjustment "))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(rt,{modelValue:L.value,"onUpdate:modelValue":t[20]||(t[20]=a=>L.value=a),"max-width":"800",scrollable:"",transition:"dialog-bottom-transition"},{default:l(()=>[e(g,{class:"rounded-lg"},{default:l(()=>[e(et,{color:"info",density:"comfortable"},{default:l(()=>[e(C,{class:"mr-3",color:"info",size:"40"},{default:l(()=>[e(m,{color:"white"},{default:l(()=>t[71]||(t[71]=[r("mdi-eye")])),_:1})]),_:1}),e(lt,{class:"text-h6 font-weight-bold"},{default:l(()=>t[72]||(t[72]=[r(" Transfer Details ")])),_:1}),e(U),e(v,{icon:"",onClick:t[18]||(t[18]=a=>L.value=!1)},{default:l(()=>[e(m,null,{default:l(()=>t[73]||(t[73]=[r("mdi-close")])),_:1})]),_:1})]),_:1}),e(V,{class:"pa-6"},{default:l(()=>[e(g,{class:"mb-6 elevation-2"},{default:l(()=>[e(V,{class:"pa-4"},{default:l(()=>[e(I,null,{default:l(()=>{var a;return[e(c,{class:"border-e",cols:"12",md:"6"},{default:l(()=>{var d,u;return[s("div",Me,[e(C,{class:"mr-3",color:"primary",size:"48"},{default:l(()=>[e(m,{color:"white"},{default:l(()=>t[74]||(t[74]=[r("mdi-identifier")])),_:1})]),_:1}),s("div",null,[t[75]||(t[75]=s("div",{class:"text-caption text-grey"},"TRANSFER ID",-1)),s("div",Fe," #"+f((d=b.value)==null?void 0:d.id),1)])]),s("div",Qe,[e(m,{class:"mr-3",color:"grey"},{default:l(()=>t[76]||(t[76]=[r("mdi-calendar")])),_:1}),s("div",null,[t[77]||(t[77]=s("div",{class:"text-caption text-grey"},"TRANSFER DATE",-1)),s("div",Ge,f(At((u=b.value)==null?void 0:u.transfer_date)),1)])])]}),_:1}),e(c,{cols:"12",md:"6"},{default:l(()=>{var d,u,y,D,Et,St;return[s("div",Ne,[e(C,{class:"mr-3",color:Q((d=b.value)==null?void 0:d.from_outlet_type),size:"48"},{default:l(()=>[e(m,{color:"white"},{default:l(()=>{var A;return[r(f(tt((A=b.value)==null?void 0:A.from_outlet_type)),1)]}),_:1})]),_:1},8,["color"]),s("div",null,[t[78]||(t[78]=s("div",{class:"text-caption text-grey"},"FROM OUTLET",-1)),s("div",he,f((u=b.value)==null?void 0:u.from_outlet),1),e(w,{class:"mt-1",color:Q((y=b.value)==null?void 0:y.from_outlet_type),size:"small"},{default:l(()=>{var A;return[r(f((A=b.value)==null?void 0:A.from_outlet_type),1)]}),_:1},8,["color"])])]),s("div",Pe,[e(C,{class:"mr-3",color:Q((D=b.value)==null?void 0:D.to_outlet_type),size:"48"},{default:l(()=>[e(m,{color:"white"},{default:l(()=>{var A;return[r(f(tt((A=b.value)==null?void 0:A.to_outlet_type)),1)]}),_:1})]),_:1},8,["color"]),s("div",null,[t[79]||(t[79]=s("div",{class:"text-caption text-grey"},"TO OUTLET",-1)),s("div",Le,f((Et=b.value)==null?void 0:Et.to_outlet),1),e(w,{class:"mt-1",color:Q((St=b.value)==null?void 0:St.to_outlet_type),size:"small"},{default:l(()=>{var A;return[r(f((A=b.value)==null?void 0:A.to_outlet_type),1)]}),_:1},8,["color"])])])]}),_:1}),(a=b.value)!=null&&a.remarks?(_(),x(c,{key:0,cols:"12"},{default:l(()=>[e(zt,{class:"my-3"}),t[80]||(t[80]=s("div",{class:"text-caption text-grey mb-1"},"REMARKS",-1)),e(g,{color:"grey-lighten-4",variant:"outlined"},{default:l(()=>[e(V,{class:"pa-3"},{default:l(()=>[r(f(b.value.remarks),1)]),_:1})]),_:1})]),_:1})):q("",!0)]}),_:1})]),_:1})]),_:1}),e(g,{elevation:"2"},{default:l(()=>[e(at,{class:"d-flex align-center bg-teal-lighten-5"},{default:l(()=>[e(m,{class:"mr-2",color:"teal"},{default:l(()=>t[81]||(t[81]=[r("mdi-package-variant")])),_:1}),t[82]||(t[82]=r(" Transfer Items ")),e(w,{class:"ml-3",color:"teal",size:"small",variant:"flat"},{default:l(()=>[r(f(F.value.length)+" items ",1)]),_:1}),e(w,{class:"ml-2",color:"green",size:"small",variant:"flat"},{default:l(()=>[r(" Total: "+f(Ft.value)+" units ",1)]),_:1})]),_:1}),e(V,{class:"pa-0"},{default:l(()=>[e(ce,{density:"comfortable"},{default:l(()=>[s("thead",null,[s("tr",Je,[t[83]||(t[83]=s("th",{class:"text-left font-weight-bold text-grey"}," PRODUCT ",-1)),t[84]||(t[84]=s("th",{class:"text-center font-weight-bold text-grey"}," FROM QUALITY ",-1)),t[85]||(t[85]=s("th",{class:"text-center font-weight-bold text-grey"}," TO QUALITY ",-1)),t[86]||(t[86]=s("th",{class:"text-center font-weight-bold text-grey"}," QUANTITY ",-1)),wt.value?(_(),j("th",Be," REPLACEMENT ")):q("",!0)])]),s("tbody",null,[(_(!0),j(gt,null,bt(F.value,a=>(_(),j("tr",{key:a.id,class:"border-bottom"},[s("td",null,[s("div",He,[e(C,{class:"mr-3",color:"blue",size:"36"},{default:l(()=>[e(m,{color:"white",size:"18"},{default:l(()=>t[87]||(t[87]=[r("mdi-cube")])),_:1})]),_:1}),s("div",null,[s("div",Ye,f(a.product_name),1)])])]),s("td",Ke,[e(w,{color:G(a.from_quality),size:"small",variant:"flat"},{default:l(()=>[r(f(a.from_quality),1)]),_:2},1032,["color"])]),s("td",We,[s("div",Xe,[e(w,{color:G(a.to_quality),size:"small",variant:"flat"},{default:l(()=>[r(f(a.to_quality),1)]),_:2},1032,["color"]),dt({from_quality:a.from_quality,to_quality:a.to_quality})?(_(),x(m,{key:0,class:"ml-2",color:"orange",size:"16"},{default:l(()=>t[88]||(t[88]=[r(" mdi-arrow-right ")])),_:1})):q("",!0)])]),s("td",Ze,[e(w,{color:"green",size:"small",variant:"flat"},{default:l(()=>[s("strong",null,f(a.quantity),1)]),_:2},1024)]),wt.value?(_(),j("td",tl,[a.is_replacement?(_(),x(w,{key:0,color:"orange","prepend-icon":a.is_replacement?"mdi-autorenew":void 0,size:"small",variant:"flat"},{default:l(()=>[t[89]||(t[89]=r(" Replacement ")),a.replacement_note?(_(),x(ot,{key:0,activator:"parent",location:"top"},{default:l(()=>[r(f(a.replacement_note),1)]),_:2},1024)):q("",!0)]),_:2},1032,["prepend-icon"])):(_(),x(w,{key:1,color:"grey",size:"small",variant:"outlined"},{default:l(()=>t[90]||(t[90]=[r(" Regular ")])),_:1}))])):q("",!0)]))),128))])]),_:1}),F.value.length===0?(_(),j("div",el,[e(m,{class:"mb-4",color:"grey",size:"80"},{default:l(()=>t[91]||(t[91]=[r("mdi-package-variant-remove")])),_:1}),t[92]||(t[92]=s("div",{class:"text-h6 text-grey mb-2"},"No Transfer Items",-1)),t[93]||(t[93]=s("div",{class:"text-body-1 text-grey"}," This transfer doesn't contain any items ",-1))])):q("",!0)]),_:1})]),_:1})]),_:1}),e(Y,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[e(U),e(v,{color:"primary",size:"large",variant:"flat",onClick:t[19]||(t[19]=a=>L.value=!1)},{default:l(()=>[e(m,{start:""},{default:l(()=>t[94]||(t[94]=[r("mdi-close")])),_:1}),t[95]||(t[95]=r(" Close "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(rt,{modelValue:J.value,"onUpdate:modelValue":t[22]||(t[22]=a=>J.value=a),"max-width":"500"},{default:l(()=>[e(g,{class:"rounded-lg"},{default:l(()=>[e(et,{color:"error",density:"comfortable"},{default:l(()=>[e(C,{class:"mr-3",color:"error",size:"40"},{default:l(()=>[e(m,{color:"white"},{default:l(()=>t[96]||(t[96]=[r("mdi-alert")])),_:1})]),_:1}),e(lt,{class:"text-h6 font-weight-bold"},{default:l(()=>t[97]||(t[97]=[r(" Confirm Deletion ")])),_:1})]),_:1}),e(V,{class:"pa-6 text-center"},{default:l(()=>[e(m,{class:"mb-4",color:"error",size:"64"},{default:l(()=>t[98]||(t[98]=[r("mdi-delete-alert")])),_:1}),t[101]||(t[101]=s("div",{class:"text-h5 font-weight-bold mb-2"},"Delete Transfer?",-1)),s("div",ll,[t[99]||(t[99]=r(" Are you sure you want to delete transfer ")),s("span",al,"#"+f(R.value),1),t[100]||(t[100]=r("? This action cannot be undone. "))])]),_:1}),e(Y,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[e(U),e(v,{size:"large",variant:"outlined",onClick:t[21]||(t[21]=a=>J.value=!1)},{default:l(()=>t[102]||(t[102]=[r(" Cancel ")])),_:1}),e(v,{color:"error",loading:st.value,size:"large",variant:"flat",onClick:oe},{default:l(()=>[e(m,{start:""},{default:l(()=>t[103]||(t[103]=[r("mdi-delete")])),_:1}),t[104]||(t[104]=r(" Delete Transfer "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ql=ne(ol,[["__scopeId","data-v-17048eb9"]]);export{ql as default};
