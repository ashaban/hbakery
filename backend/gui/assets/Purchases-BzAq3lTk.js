import{_ as we,r as f,$ as U,e as _e,l as ke,s as Q,x as a,a0 as De,a1 as Pe,v as k,i as t,y as i,H as y,C as d,O as h,I as m,A as R,B as v,E as j,a2 as P,F as ee,Q as Me,a3 as te,a4 as ae,D as I,a5 as le,j as oe,T as Ce}from"./index-DM-_A7PE.js";import{h as E}from"./moment-C5S46NFB.js";import{V as Ye}from"./VContainer-iWuqtKcr.js";import{V as g,b as F,d as re,c as ie}from"./VCard-kZtgd9b4.js";import{V as M}from"./VCol-y2yuKi6R.js";import{V as z}from"./VAutocomplete-B0jwJp4m.js";import{V as Ue,a as Fe,b as $e}from"./VDataTable-BIUAbLMQ.js";import{V as se}from"./VChip-Cf2qyGJc.js";import{V as Te}from"./VSkeletonLoader-CHKKWuzU.js";import{V as de}from"./VDialog-GQb-W4Oh.js";import{V as ne}from"./VForm-voCIV_G4.js";import{V as N}from"./VTextField-DUiB6l3E.js";import"./dialog-transition-KjMsMB9n.js";import"./VSlideGroup-RbVq-RBL.js";const Se={class:"d-flex align-center justify-space-between"},je={class:"text-h6 font-weight-bold"},Ie={class:"d-flex align-center justify-space-between"},Ee={class:"text-h6 font-weight-bold text-blue"},Ne={class:"d-flex align-center justify-space-between"},Ae={class:"text-h6 font-weight-bold text-green"},Be={class:"d-flex gap-2"},Oe={class:"d-flex justify-end mt-4"},Qe={class:"font-weight-medium"},Re={class:"text-center py-6 text-grey"},ze={class:"d-flex justify-space-between align-center pa-4"},Le={class:"text-caption text-grey"},Je={class:"d-flex justify-space-between align-center"},Ge={class:"text-h6 font-weight-bold text-green"},He={class:"d-flex flex-column"},Ke={key:0,class:"text-caption text-error mt-1"},We={class:"d-flex justify-space-between align-center"},Xe={class:"text-h6 font-weight-bold text-green"},Ze={class:"d-flex flex-column"},he={key:0,class:"text-caption text-error mt-1"},et={__name:"Purchases",setup(tt){De();const A=f([]),$=f([]),B=f(!1),b=f(!1),C=f(!1),q=f(!1),Y=f(1),L=f(1),J=f(0),O=f(null),ue=f(null),me=f(null),V=U({total_quantity:0,total_amount:0}),r=U({item_id:"",quantity:"",price:"",date:""}),s=U({item_id:"",quantity:"",price:"",date:""}),w=U({show:!1,message:"",color:"success"}),n=U({item_id:"",date_operator:"",date:"",date_from:"",date_to:""}),pe=_e(()=>!V.total_amount||!V.total_quantity?0:V.total_amount/V.total_quantity),fe=[{title:"Item",key:"item_name"},{title:"Quantity",key:"quantity",align:"end"},{title:"Unit Price",key:"price",align:"end"},{title:"Total Amount",key:"total",align:"end"},{title:"Purchase Date",key:"date"},{title:"Actions",key:"actions",align:"center",sortable:!1}],ye=[{label:"Equals (=)",value:"="},{label:"Greater Than (>)",value:">"},{label:"Less Than (<)",value:"<"},{label:"Greater or Equal (>=)",value:">="},{label:"Less or Equal (<=)",value:"<="},{label:"In Range",value:"in"}];function D(o){return Number(o||0).toLocaleString(void 0,{minimumFractionDigits:2})}function ve(o){return o?E(o,"YYYY-MM-DD").format("DD-MM-YYYY"):""}function c(o,e="success"){w.message=o,w.color=e,w.show=!0}function T(){return r.quantity&&r.price?r.quantity*r.price:0}function p(o){switch(o){case"item_id":s.item_id=r.item_id?"":"Item selection is required";break;case"quantity":!r.quantity&&r.quantity!==0?s.quantity="Quantity is required":Number.isInteger(Number(r.quantity))?r.quantity<=0?s.quantity="Quantity must be positive":s.quantity="":s.quantity="Quantity must be a whole number";break;case"price":!r.price&&r.price!==0?s.price="Unit price is required":isNaN(r.price)?s.price="Unit price must be a valid number":r.price<=0?s.price="Unit price must be positive":s.price="";break;case"date":s.date=r.date?"":"Purchase date is required";break}}function x(o){s[o]=""}function G(){return p("item_id"),p("quantity"),p("price"),p("date"),!s.item_id&&!s.quantity&&!s.price&&!s.date}async function ce(){try{const o=await fetch("/items");$.value=await o.json()}catch(o){console.error("Failed to load items:",o),c("Failed to load items","error")}}async function _(){B.value=!0;try{const o=new URLSearchParams({page:Y.value,limit:10});if(n.item_id&&o.append("item_id",n.item_id),n.date_operator&&n.date_operator!=="in"&&n.date){const l={"=":"date",">":"date_gt","<":"date_lt",">=":"date_from","<=":"date_to"};o.append(l[n.date_operator],n.date)}n.date_operator==="in"&&n.date_from&&n.date_to&&(o.append("date_from",n.date_from),o.append("date_to",n.date_to));const u=await(await fetch(`/purchases?${o}`)).json();A.value=u.data||[],L.value=u.totalPages||1,J.value=u.totalRecords||0,V.total_quantity=u.total_quantity||0,V.total_amount=u.total_amount||0}catch(o){console.error("Failed to load purchases:",o),c("Failed to load purchases","error")}finally{B.value=!1}}function ge(){Y.value=1,_()}function be(){Object.assign(n,{item_id:"",date_operator:"",date:"",date_from:"",date_to:""}),Y.value=1,_()}function Ve(){Object.assign(r,{item_id:"",quantity:"",price:"",date:""}),Object.keys(s).forEach(o=>s[o]=""),C.value=!0}function H(){C.value=!1,Object.keys(s).forEach(o=>s[o]="")}function xe(o){var e,u,l,S;O.value=o,Object.assign(r,{item_id:o.item_id,quantity:((u=(e=o.quantity)==null?void 0:e.replace)==null?void 0:u.call(e,/,/g,""))||o.quantity,price:((S=(l=o.price)==null?void 0:l.replace)==null?void 0:S.call(l,/,/g,""))||o.price,date:o.date?E(o.date,"YYYY-MM-DD").format("DD-MM-YYYY"):""}),Object.keys(s).forEach(qe=>s[qe]=""),q.value=!0}function K(){q.value=!1,Object.keys(s).forEach(o=>s[o]="")}async function W(){if(!G()){c("Please fix the validation errors","error");return}b.value=!0;try{const o={...r,date:E(r.date,"DD-MM-YYYY").format("YYYY-MM-DD")};if(console.log(JSON.stringify(o,0,2)),!(await fetch("/purchases",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Save failed");C.value=!1,c("Purchase added successfully"),await _()}catch(o){console.error("Failed to create purchase:",o),c("Failed to add purchase","error")}finally{b.value=!1}}async function X(){if(!G()){c("Please fix the validation errors","error");return}b.value=!0;try{const o={...r,date:E(r.date,"DD-MM-YYYY").format("YYYY-MM-DD")};if(!(await fetch(`/purchases/${O.value.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).ok)throw new Error("Update failed");q.value=!1,c("Purchase updated successfully"),await _()}catch(o){console.error("Failed to update purchase:",o),c("Failed to update purchase","error")}finally{b.value=!1}}async function Z(o){if(confirm(`Are you sure you want to delete purchase of "${o.item_name}"?`)){b.value=!0;try{if(!(await fetch(`/purchases/${o.id}`,{method:"DELETE"})).ok)throw new Error("Delete failed");c("Purchase deleted successfully"),q.value&&(q.value=!1),await _()}catch(e){console.error("Failed to delete purchase:",e),c("Failed to delete purchase","error")}finally{b.value=!1}}}return ke(async()=>{await ce(),await _()}),(o,e)=>{const u=Pe("VueDatePicker");return k(),Q(Ye,{class:"py-6",fluid:""},{default:a(()=>[t(g,{class:"mb-6",elevation:"2",rounded:"lg"},{default:a(()=>[t(F,{class:"d-flex align-center justify-space-between"},{default:a(()=>[e[35]||(e[35]=i("div",null,[i("h2",{class:"text-h5 font-weight-bold text-primary mb-1"}," Purchase Management "),i("p",{class:"text-body-2 text-grey"}," Track and manage inventory purchases and costs ")],-1)),t(y,{color:"primary","prepend-icon":"mdi-cart-plus",onClick:Ve},{default:a(()=>e[34]||(e[34]=[d(" New Purchase ")])),_:1})]),_:1})]),_:1}),t(h,{class:"mb-4"},{default:a(()=>[t(M,{cols:"12",md:"4"},{default:a(()=>[t(g,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[i("div",Se,[i("div",null,[e[36]||(e[36]=i("div",{class:"text-body-2 text-grey"},"Total Purchases",-1)),i("div",je,m(D(V.total_amount)),1)]),t(R,{color:"primary",size:"40",variant:"tonal"},{default:a(()=>[t(v,{color:"primary"},{default:a(()=>e[37]||(e[37]=[d("mdi-cash")])),_:1})]),_:1})])]),_:1})]),_:1}),t(M,{cols:"12",md:"4"},{default:a(()=>[t(g,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[i("div",Ie,[i("div",null,[e[38]||(e[38]=i("div",{class:"text-body-2 text-grey"},"Total Quantity",-1)),i("div",Ee,m(parseFloat(V.total_quantity)||0),1)]),t(R,{color:"blue",size:"40",variant:"tonal"},{default:a(()=>[t(v,{color:"blue"},{default:a(()=>e[39]||(e[39]=[d("mdi-package-variant")])),_:1})]),_:1})])]),_:1})]),_:1}),t(M,{cols:"12",md:"4"},{default:a(()=>[t(g,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[i("div",Ne,[i("div",null,[e[40]||(e[40]=i("div",{class:"text-body-2 text-grey"},"Avg. Unit Price",-1)),i("div",Ae,m(D(pe.value)),1)]),t(R,{color:"green",size:"40",variant:"tonal"},{default:a(()=>[t(v,{color:"green"},{default:a(()=>e[41]||(e[41]=[d("mdi-tag")])),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),t(g,{class:"mb-4",elevation:"2",rounded:"lg"},{default:a(()=>[t(F,null,{default:a(()=>[t(h,{dense:""},{default:a(()=>[t(M,{cols:"12",md:"4"},{default:a(()=>[t(z,{modelValue:n.item_id,"onUpdate:modelValue":e[0]||(e[0]=l=>n.item_id=l),clearable:"",color:"primary","item-title":"name","item-value":"id",items:$.value,label:"Filter by Item",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(M,{cols:"12",md:"3"},{default:a(()=>[t(Ue,{modelValue:n.date_operator,"onUpdate:modelValue":e[1]||(e[1]=l=>n.date_operator=l),clearable:"","item-title":"label","item-value":"value",items:ye,label:"Date Filter",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(M,{cols:"12",md:"5"},{default:a(()=>[n.date_operator&&n.date_operator!=="in"?(k(),j(ee,{key:0},[t(re,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[42]||(e[42]=[d(" Select Date ")])),_:1}),t(u,{modelValue:n.date,"onUpdate:modelValue":e[2]||(e[2]=l=>n.date=l),"auto-apply":"",class:"border rounded-lg px-4 py-2",format:"dd-MM-yyyy","model-type":"format",placeholder:"Select Date",teleport:!0},null,8,["modelValue"])],64)):P("",!0),n.date_operator==="in"?(k(),j(ee,{key:1},[t(re,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[43]||(e[43]=[d(" Date Range ")])),_:1}),i("div",Be,[t(u,{modelValue:n.date_from,"onUpdate:modelValue":e[3]||(e[3]=l=>n.date_from=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"From",teleport:!0},null,8,["modelValue"]),t(u,{modelValue:n.date_to,"onUpdate:modelValue":e[4]||(e[4]=l=>n.date_to=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"To",teleport:!0},null,8,["modelValue"])])],64)):P("",!0)]),_:1})]),_:1}),i("div",Oe,[t(y,{color:"primary","prepend-icon":"mdi-filter",onClick:ge},{default:a(()=>e[44]||(e[44]=[d(" Apply Filters ")])),_:1}),t(y,{class:"ml-2","prepend-icon":"mdi-close-circle",variant:"outlined",onClick:be},{default:a(()=>e[45]||(e[45]=[d(" Clear ")])),_:1})])]),_:1})]),_:1}),t(g,{elevation:"2",rounded:"lg"},{default:a(()=>[t(F,{class:"pa-0"},{default:a(()=>[t(Fe,{class:"rounded-lg",density:"comfortable",headers:fe,hover:"",items:A.value,loading:B.value},{loading:a(()=>[t(Te,{type:"table-row@10"})]),"item.quantity":a(({item:l})=>[t(se,{color:"blue",variant:"flat"},{default:a(()=>[d(m(parseFloat(l.quantity)),1)]),_:2},1024)]),"item.price":a(({item:l})=>[i("span",Qe,m(D(l.price)),1)]),"item.total":a(({item:l})=>[t(se,{color:"green",variant:"flat"},{default:a(()=>[d(m(D(l.total)),1)]),_:2},1024)]),"item.date":a(({item:l})=>[d(m(ve(l.date)),1)]),"item.actions":a(({item:l})=>[t(y,{color:"blue",icon:"",size:"small",variant:"text",onClick:S=>xe(l)},{default:a(()=>[t(v,null,{default:a(()=>e[46]||(e[46]=[d("mdi-pencil")])),_:1})]),_:2},1032,["onClick"]),t(y,{color:"red",icon:"",size:"small",variant:"text",onClick:S=>Z(l)},{default:a(()=>[t(v,null,{default:a(()=>e[47]||(e[47]=[d("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),"no-data":a(()=>[i("div",Re,[t(v,{color:"grey-lighten-2",size:"48"},{default:a(()=>e[48]||(e[48]=[d("mdi-cart-remove")])),_:1}),e[49]||(e[49]=i("div",null,"No purchases found",-1))])]),_:1},8,["items","loading"]),t(Me),i("div",ze,[i("span",Le," Showing "+m(A.value.length)+" of "+m(J.value)+" records ",1),t($e,{modelValue:Y.value,"onUpdate:modelValue":[e[5]||(e[5]=l=>Y.value=l),_],color:"primary",length:L.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1}),t(de,{modelValue:C.value,"onUpdate:modelValue":e[18]||(e[18]=l=>C.value=l),"max-width":"600px",persistent:""},{default:a(()=>[t(g,null,{default:a(()=>[t(te,{class:"text-white",color:"primary",density:"comfortable"},{default:a(()=>[t(ae,null,{default:a(()=>[t(v,{start:""},{default:a(()=>e[50]||(e[50]=[d("mdi-cart-plus")])),_:1}),e[51]||(e[51]=d(" Add New Purchase "))]),_:1}),t(I),t(y,{color:"white",icon:"mdi-close",variant:"text",onClick:H})]),_:1}),t(F,{class:"pa-4"},{default:a(()=>[t(ne,{ref_key:"addFormRef",ref:ue,onSubmit:le(W,["prevent"])},{default:a(()=>[t(z,{modelValue:r.item_id,"onUpdate:modelValue":e[6]||(e[6]=l=>r.item_id=l),color:"primary","error-messages":s.item_id,"item-title":"name","item-value":"id",items:$.value,label:"Item *",required:"",variant:"outlined",onBlur:e[7]||(e[7]=l=>p("item_id")),onInput:e[8]||(e[8]=l=>x("item_id"))},{label:a(()=>e[52]||(e[52]=[i("span",{class:"required-field"},"Item",-1)])),_:1},8,["modelValue","error-messages","items"]),t(N,{modelValue:r.quantity,"onUpdate:modelValue":e[9]||(e[9]=l=>r.quantity=l),modelModifiers:{number:!0},color:"primary","error-messages":s.quantity,label:"Quantity *",required:"",type:"number",variant:"outlined",onBlur:e[10]||(e[10]=l=>p("quantity")),onInput:e[11]||(e[11]=l=>{x("quantity"),T()})},{label:a(()=>e[53]||(e[53]=[i("span",{class:"required-field"},"Quantity",-1)])),_:1},8,["modelValue","error-messages"]),t(N,{modelValue:r.price,"onUpdate:modelValue":e[12]||(e[12]=l=>r.price=l),modelModifiers:{number:!0},color:"primary","error-messages":s.price,label:"Unit Price *",prefix:"$",required:"",type:"number",variant:"outlined",onBlur:e[13]||(e[13]=l=>p("price")),onInput:e[14]||(e[14]=l=>{x("price"),T()})},{label:a(()=>e[54]||(e[54]=[i("span",{class:"required-field"},"Unit Price",-1)])),_:1},8,["modelValue","error-messages"]),r.quantity&&r.price?(k(),Q(g,{key:0,class:"mb-4 pa-3",color:"green-lighten-5",variant:"outlined"},{default:a(()=>[i("div",Je,[e[55]||(e[55]=i("span",{class:"font-weight-medium"},"Total Amount:",-1)),i("span",Ge,m(D(r.quantity*r.price)),1)])]),_:1})):P("",!0),i("div",He,[e[56]||(e[56]=i("label",{class:"text-caption text-grey mb-1 required-field"},"Purchase Date *",-1)),t(u,{modelValue:r.date,"onUpdate:modelValue":[e[15]||(e[15]=l=>r.date=l),e[17]||(e[17]=l=>x("date"))],"auto-apply":"",class:oe(["rounded-lg","border","px-4","py-2","w-100",s.date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"Purchase Date",teleport:!0,onBlur:e[16]||(e[16]=l=>p("date"))},null,8,["modelValue","class"]),s.date?(k(),j("div",Ke,m(s.date),1)):P("",!0)])]),_:1},512)]),_:1}),t(ie,{class:"pa-4"},{default:a(()=>[t(I),t(y,{color:"grey",variant:"outlined",onClick:H},{default:a(()=>e[57]||(e[57]=[d("Cancel")])),_:1}),t(y,{color:"primary",loading:b.value,onClick:W},{default:a(()=>[t(v,{start:""},{default:a(()=>e[58]||(e[58]=[d("mdi-content-save")])),_:1}),e[59]||(e[59]=d(" Save "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(de,{modelValue:q.value,"onUpdate:modelValue":e[32]||(e[32]=l=>q.value=l),"max-width":"600px",persistent:""},{default:a(()=>[t(g,null,{default:a(()=>[t(te,{class:"text-white",color:"primary",density:"comfortable"},{default:a(()=>[t(ae,null,{default:a(()=>[t(v,{start:""},{default:a(()=>e[60]||(e[60]=[d("mdi-cart-edit")])),_:1}),e[61]||(e[61]=d(" Edit Purchase "))]),_:1}),t(I),t(y,{color:"white",icon:"mdi-close",variant:"text",onClick:K})]),_:1}),t(F,{class:"pa-4"},{default:a(()=>[t(ne,{ref_key:"editFormRef",ref:me,onSubmit:le(X,["prevent"])},{default:a(()=>[t(z,{modelValue:r.item_id,"onUpdate:modelValue":e[19]||(e[19]=l=>r.item_id=l),color:"primary","error-messages":s.item_id,"item-title":"name","item-value":"id",items:$.value,label:"Item *",required:"",variant:"outlined",onBlur:e[20]||(e[20]=l=>p("item_id")),onInput:e[21]||(e[21]=l=>x("item_id"))},{label:a(()=>e[62]||(e[62]=[i("span",{class:"required-field"},"Item",-1)])),_:1},8,["modelValue","error-messages","items"]),t(N,{modelValue:r.quantity,"onUpdate:modelValue":e[22]||(e[22]=l=>r.quantity=l),modelModifiers:{number:!0},color:"primary","error-messages":s.quantity,label:"Quantity *",required:"",type:"number",variant:"outlined",onBlur:e[23]||(e[23]=l=>p("quantity")),onInput:e[24]||(e[24]=l=>{x("quantity"),T()})},{label:a(()=>e[63]||(e[63]=[i("span",{class:"required-field"},"Quantity",-1)])),_:1},8,["modelValue","error-messages"]),t(N,{modelValue:r.price,"onUpdate:modelValue":e[25]||(e[25]=l=>r.price=l),modelModifiers:{number:!0},color:"primary","error-messages":s.price,label:"Unit Price *",prefix:"$",required:"",type:"number",variant:"outlined",onBlur:e[26]||(e[26]=l=>p("price")),onInput:e[27]||(e[27]=l=>{x("price"),T()})},{label:a(()=>e[64]||(e[64]=[i("span",{class:"required-field"},"Unit Price",-1)])),_:1},8,["modelValue","error-messages"]),r.quantity&&r.price?(k(),Q(g,{key:0,class:"mb-4 pa-3",color:"green-lighten-5",variant:"outlined"},{default:a(()=>[i("div",We,[e[65]||(e[65]=i("span",{class:"font-weight-medium"},"Total Amount:",-1)),i("span",Xe,m(D(r.quantity*r.price)),1)])]),_:1})):P("",!0),i("div",Ze,[e[66]||(e[66]=i("label",{class:"text-caption text-grey mb-1 required-field"},"Purchase Date *",-1)),t(u,{modelValue:r.date,"onUpdate:modelValue":[e[28]||(e[28]=l=>r.date=l),e[30]||(e[30]=l=>x("date"))],"auto-apply":"",class:oe(["rounded-lg","border","px-4","py-2","w-100",s.date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"Purchase Date",teleport:!0,onBlur:e[29]||(e[29]=l=>p("date"))},null,8,["modelValue","class"]),s.date?(k(),j("div",he,m(s.date),1)):P("",!0)])]),_:1},512)]),_:1}),t(ie,{class:"pa-4"},{default:a(()=>[t(y,{color:"red",variant:"outlined",onClick:e[31]||(e[31]=l=>Z(O.value))},{default:a(()=>[t(v,{start:""},{default:a(()=>e[67]||(e[67]=[d("mdi-delete")])),_:1}),e[68]||(e[68]=d(" Delete "))]),_:1}),t(I),t(y,{color:"grey",variant:"outlined",onClick:K},{default:a(()=>e[69]||(e[69]=[d("Cancel")])),_:1}),t(y,{color:"primary",loading:b.value,onClick:X},{default:a(()=>[t(v,{start:""},{default:a(()=>e[70]||(e[70]=[d("mdi-content-save")])),_:1}),e[71]||(e[71]=d(" Update "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(Ce,{modelValue:w.show,"onUpdate:modelValue":e[33]||(e[33]=l=>w.show=l),color:w.color,timeout:"3000"},{default:a(()=>[d(m(w.message),1)]),_:1},8,["modelValue","color"])]),_:1})}}},ct=we(et,[["__scopeId","data-v-5f906d8c"]]);export{ct as default};
