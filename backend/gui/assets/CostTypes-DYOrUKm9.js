import{_ as ee,r as u,a0 as A,l as te,s as w,v as T,x as a,i as t,y as i,O as Y,H as f,C as o,B as g,I as c,aD as ae,a3 as q,D as le,a5 as se,$ as D,aV as k}from"./index-hRTnDxYa.js";import{u as oe,r as E}from"./index-DbPMBwVU.js";import{V as N,b as B,c as I}from"./VCard-B6ed0Y7W.js";import{V as m}from"./VCol-splMcheE.js";import{V as R}from"./VTextField-CLgfAQjx.js";import{V as $,a as re,b as ne}from"./VDataTable-Dp1-VZKU.js";import{V as S}from"./VAlert-CorEw9HQ.js";import{V as z}from"./VChip-BcwRWX4z.js";import{V as L}from"./VDialog-DYnows3y.js";import{V as ie}from"./VForm-C4r1Uo1a.js";import{V as de}from"./VContainer-D8XANYCL.js";import"./dialog-transition-_2eqseLT.js";import"./VSlideGroup-Dgb5Npm5.js";const ue={class:"d-flex justify-space-between flex-wrap"},fe={class:"d-flex justify-space-between mb-4"},me={class:"d-flex justify-end align-center mt-4"},ge={class:"d-flex align-center flex-wrap"},ce={class:"text-white font-weight-bold text-h6"},pe=10,ye={__name:"CostTypes",setup(ve){const d=u(!1),j=u([]),V=u(!1),p=u(!1),y=u(!1),U=u(null),x=u(1),M=u(1),C=A({total_types:0,affects_margin:0,no_affect_margin:0}),n=A({search:"",category:"",affects_margin:""}),O=["Production Cost","Sale Cost","Administrative Cost","Other Cost"],F=[{text:"Yes - Affects Margin",value:"Yes"},{text:"No - Doesn't Affect Margin",value:"No"}],H=[{title:"Name",key:"name"},{title:"Category",key:"category"},{title:"Affects Margin",key:"affects_margin",align:"center"},{title:"Created Date",key:"created_at"},{title:"Actions",key:"actions",sortable:!1,align:"center"}],r=A({name:"",category:"",affects_margin:"Yes"}),v=oe({name:{required:E},category:{required:E},affects_margin:{required:E}},r),J=s=>({"Production Cost":"blue","Sale Cost":"green","Administrative Cost":"orange","Other Cost":"grey"})[s]||"grey";async function b(){d.value=!0;const s=new URLSearchParams({page:x.value,limit:pe});n.search&&s.append("search",n.search),n.category&&s.append("category",n.category),n.affects_margin&&s.append("affects_margin",n.affects_margin);try{const l=await(await fetch(`/expenditures/types?${s}`)).json();j.value=l.data||[],M.value=l.totalPages||1,C.total_types=l.totalRecords||0,l.data&&(C.affects_margin=l.data.filter(_=>_.affects_margin==="Yes").length,C.no_affect_margin=l.data.filter(_=>_.affects_margin==="No").length)}catch(e){console.error("Failed to load cost types",e)}finally{d.value=!1}}function G(){x.value=1,b()}function K(){n.search="",n.category="",n.affects_margin="",x.value=1,b()}function Q(){y.value=!1,Object.assign(r,{name:"",category:"",affects_margin:"Yes"}),V.value=!0,v.value.$reset()}async function W(s){y.value=!0,U.value=s.id,Object.assign(r,{name:s.name,category:s.category,affects_margin:s.affects_margin}),V.value=!0}async function X(){if(v.value.$touch(),!v.value.$invalid){d.value=!0;try{const s={name:r.name,category:r.category,affects_margin:r.affects_margin},e=y.value?"PUT":"POST",l=y.value?`/expenditures/types/${U.value}`:"/expenditures/types";if(!(await fetch(l,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw new Error("Failed to save");V.value=!1,b()}finally{d.value=!1}}}const P=u(null);function Z(s){P.value=s,Object.assign(r,{name:s.name,category:s.category,affects_margin:s.affects_margin}),p.value=!0}async function h(){d.value=!0;try{await fetch(`/expenditures/types/${P.value.id}`,{method:"DELETE"}),p.value=!1,b()}catch(s){console.error("Failed to delete",s)}finally{d.value=!1}}return te(()=>{b()}),(s,e)=>(T(),w(de,{fluid:""},{default:a(()=>[t(N,{class:"pa-4 mb-4"},{default:a(()=>[t(Y,{dense:""},{default:a(()=>[t(m,{cols:"12",sm:"4"},{default:a(()=>[t(R,{modelValue:n.search,"onUpdate:modelValue":e[0]||(e[0]=l=>n.search=l),"append-inner-icon":"mdi-close-circle",clearable:"",label:"Search Cost Type","onClick:appendInner":e[1]||(e[1]=l=>n.search="")},null,8,["modelValue"])]),_:1}),t(m,{cols:"12",sm:"4"},{default:a(()=>[t($,{modelValue:n.category,"onUpdate:modelValue":e[2]||(e[2]=l=>n.category=l),clearable:"",items:O,label:"Filter by Category"},null,8,["modelValue"])]),_:1}),t(m,{cols:"12",sm:"4"},{default:a(()=>[t($,{modelValue:n.affects_margin,"onUpdate:modelValue":e[3]||(e[3]=l=>n.affects_margin=l),clearable:"","item-title":"text","item-value":"value",items:F,label:"Filter by Margin Effect"},null,8,["modelValue"])]),_:1}),t(m,{class:"d-flex justify-end",cols:"12"},{default:a(()=>[t(f,{color:"primary",onClick:G},{default:a(()=>[t(g,{start:""},{default:a(()=>e[15]||(e[15]=[o("mdi-filter")])),_:1}),e[16]||(e[16]=o(" Apply "))]),_:1}),t(f,{class:"ml-2",color:"grey",onClick:K},{default:a(()=>[t(g,{start:""},{default:a(()=>e[17]||(e[17]=[o("mdi-refresh")])),_:1}),e[18]||(e[18]=o(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),t(S,{border:"start",class:"mb-4",type:"info",variant:"outlined"},{default:a(()=>[i("div",ue,[i("div",null,[e[19]||(e[19]=i("strong",null,"Total Cost Types:",-1)),o(" "+c(C.total_types||"0"),1)]),i("div",null,[e[20]||(e[20]=i("strong",null,"Affects Margin:",-1)),o(" "+c(C.affects_margin||"0"),1)]),i("div",null,[e[21]||(e[21]=i("strong",null,"Doesn't Affect Margin:",-1)),o(" "+c(C.no_affect_margin||"0"),1)])])]),_:1}),i("div",fe,[e[24]||(e[24]=i("h3",null,"Cost Types",-1)),t(f,{class:"text-white",color:"primary",size:"small",onClick:Q},{default:a(()=>[t(g,{start:""},{default:a(()=>e[22]||(e[22]=[o("mdi-plus")])),_:1}),e[23]||(e[23]=o(" Add Cost Type "))]),_:1})]),t(ae,{active:d.value,indeterminate:d.value},null,8,["active","indeterminate"]),t(re,{class:"elevation-1",dense:"",headers:H,height:"400",items:j.value,loading:d.value},{"item.affects_margin":a(({item:l})=>[t(z,{color:l.affects_margin==="Yes"?"success":"grey",size:"small"},{default:a(()=>[o(c(l.affects_margin==="Yes"?"Affects Margin":"No Effect"),1)]),_:2},1032,["color"])]),"item.category":a(({item:l})=>[t(z,{color:J(l.category),size:"small",variant:"outlined"},{default:a(()=>[o(c(l.category),1)]),_:2},1032,["color"])]),"item.actions":a(({item:l})=>[t(g,{class:"mr-2",color:"primary",onClick:_=>W(l)},{default:a(()=>e[25]||(e[25]=[o(" mdi-square-edit-outline ")])),_:2},1032,["onClick"]),t(g,{color:"error",onClick:_=>Z(l)},{default:a(()=>e[26]||(e[26]=[o(" mdi-delete ")])),_:2},1032,["onClick"])]),_:1},8,["items","loading"]),i("div",me,[t(ne,{modelValue:x.value,"onUpdate:modelValue":[e[4]||(e[4]=l=>x.value=l),b],length:M.value,"total-visible":"7"},null,8,["modelValue","length"])]),t(L,{modelValue:V.value,"onUpdate:modelValue":e[11]||(e[11]=l=>V.value=l),"max-width":"600",transition:"dialog-top-transition"},{default:a(()=>[t(N,{class:"rounded-xl pa-4",elevation:"10"},{default:a(()=>[t(q,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:a(()=>[i("div",ge,[t(g,{class:"mr-2 text-white"},{default:a(()=>e[27]||(e[27]=[o("mdi-tag-text")])),_:1}),i("span",ce,c(y.value?"Edit Cost Type":"Add Cost Type"),1)]),t(le),t(f,{color:"white",icon:"mdi-close",onClick:e[5]||(e[5]=l=>V.value=!1)})]),_:1}),t(B,{class:"pt-6"},{default:a(()=>[t(ie,{onSubmit:e[9]||(e[9]=se(()=>{},["prevent"]))},{default:a(()=>[t(Y,{dense:""},{default:a(()=>[t(m,{cols:"12",sm:"6"},{default:a(()=>[t(R,{modelValue:r.name,"onUpdate:modelValue":e[6]||(e[6]=l=>r.name=l),"bg-color":"#E0E0E0","error-messages":k(v).name.$errors.map(l=>l.$message),label:"Cost Type Name",required:""},null,8,["modelValue","error-messages"])]),_:1}),t(m,{cols:"12",sm:"6"},{default:a(()=>[t($,{modelValue:r.category,"onUpdate:modelValue":e[7]||(e[7]=l=>r.category=l),"bg-color":"#E0E0E0","error-messages":k(v).category.$errors.map(l=>l.$message),items:O,label:"Category",required:""},null,8,["modelValue","error-messages"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[t($,{modelValue:r.affects_margin,"onUpdate:modelValue":e[8]||(e[8]=l=>r.affects_margin=l),"bg-color":"#E0E0E0","error-messages":k(v).affects_margin.$errors.map(l=>l.$message),hint:"Select 'Yes' if this cost type should be deducted from gross margin","item-title":"text","item-value":"value",items:F,label:"Affects Margin Calculation","persistent-hint":"",required:""},null,8,["modelValue","error-messages"])]),_:1}),r.affects_margin==="Yes"?(T(),w(m,{key:0,cols:"12"},{default:a(()=>[t(S,{density:"compact",type:"info",variant:"outlined"},{default:a(()=>e[28]||(e[28]=[i("small",null,"This cost type will be included in net margin calculations and deducted from gross margin.",-1)])),_:1})]),_:1})):D("",!0),r.affects_margin==="No"?(T(),w(m,{key:1,cols:"12"},{default:a(()=>[t(S,{density:"compact",type:"warning",variant:"outlined"},{default:a(()=>e[29]||(e[29]=[i("small",null,"This cost type will NOT affect margin calculations and will be excluded from net margin.",-1)])),_:1})]),_:1})):D("",!0)]),_:1})]),_:1})]),_:1}),t(I,{class:"d-flex justify-end mt-2"},{default:a(()=>[t(f,{color:"success",disabled:k(v).$invalid,loading:d.value,onClick:X},{default:a(()=>[t(g,{start:""},{default:a(()=>e[30]||(e[30]=[o("mdi-content-save")])),_:1}),o(" "+c(y.value?"Save Changes":"Add Cost Type"),1)]),_:1},8,["disabled","loading"]),y.value?(T(),w(f,{key:0,color:"error",onClick:e[10]||(e[10]=l=>p.value=!0)},{default:a(()=>[t(g,{start:""},{default:a(()=>e[31]||(e[31]=[o("mdi-delete")])),_:1}),e[32]||(e[32]=o(" Delete "))]),_:1})):D("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(L,{modelValue:p.value,"onUpdate:modelValue":e[14]||(e[14]=l=>p.value=l),persistent:"",width:"400"},{default:a(()=>[t(N,null,{default:a(()=>[t(q,{color:"warning",title:"Confirm Deleting "+r.name},{default:a(()=>[t(f,{color:"white",icon:"mdi-close",onClick:e[12]||(e[12]=l=>p.value=!1)})]),_:1},8,["title"]),t(B,null,{default:a(()=>[o('Are you sure you want to delete "'+c(r.name)+'"? This action cannot be undone.',1)]),_:1}),t(I,{class:"d-flex justify-end"},{default:a(()=>[t(f,{color:"grey",onClick:e[13]||(e[13]=l=>p.value=!1)},{default:a(()=>e[33]||(e[33]=[o("Cancel")])),_:1}),t(f,{color:"error",onClick:h},{default:a(()=>e[34]||(e[34]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},je=ee(ye,[["__scopeId","data-v-6558f8ed"]]);export{je as default};
