import{_ as ie,r as m,$ as M,l as ue,s as pe,x as a,a1 as me,v as A,i as t,y as d,H as c,C as i,O as N,I as p,A as P,B as g,av as J,Q as fe,a3 as ce,a4 as ye,D as H,a5 as _e,E as Q,a2 as G,j as K,T as ve}from"./index-CuMV6di3.js";import{h as x}from"./moment-C5S46NFB.js";import{V as ge}from"./VContainer-C4bV-9UQ.js";import{V,b as S,d as W,c as xe}from"./VCard-Bc391oxu.js";import{V as y}from"./VCol-CjmsdnHv.js";import{V as X}from"./VAutocomplete-D3zximuH.js";import{a as Ve,b as be}from"./VDataTable-ChORe5xA.js";import{V as Z}from"./VTooltip-imVvsKEt.js";import{V as h}from"./VChip-ZPEXUT-r.js";import{V as De}from"./VSkeletonLoader-CC7RybwI.js";import{V as we}from"./VDialog-CmVpAP_y.js";import{V as Ye}from"./VForm-YyT9asQ3.js";import{V as Me}from"./VTextField-CjsJoSZp.js";import{V as ke}from"./VTextarea-Ciq86fFP.js";import"./dialog-transition-Cab09yLL.js";import"./VSlideGroup-Bd5aveAd.js";const Ce={class:"d-flex align-center justify-space-between"},Ee={class:"text-h6 font-weight-bold"},Se={class:"d-flex align-center justify-space-between"},Te={class:"text-h6 font-weight-bold text-blue"},je={class:"d-flex align-center justify-space-between"},Fe={class:"text-h6 font-weight-bold text-green"},$e={class:"d-flex gap-2"},Ue={class:"d-flex gap-2"},Ae={class:"d-flex justify-end mt-4"},Ne={class:"d-flex justify-center"},Pe={class:"text-center py-6 text-grey"},Oe={class:"d-flex justify-space-between align-center pa-4"},Be={class:"text-caption text-grey"},qe={class:"d-flex flex-column"},Re={key:0,class:"text-caption text-error mt-1"},ze={class:"d-flex flex-column"},Ie={key:0,class:"text-caption text-error mt-1"},Le={__name:"Expenditures",setup(Je){const T=m([]),j=m([]),ee=m(null),r=M({type_ids:[],start_from:"",start_to:"",end_from:"",end_to:""}),k=M({total_expenditure:0,total_production_cost:0,total_sale_cost:0}),F=m(1),O=m(1),B=m(0),w=m(!1),b=m(!1),$=m(!1),U=m(!1),s=M({id:null,type_id:"",start_date:"",end_date:"",amount:"",description:""}),n=M({type_id:"",start_date:"",end_date:"",amount:""}),_=M({show:!1,message:"",color:"success"}),te=[{title:"Cost Type",key:"cost_type"},{title:"Category",key:"cost_category"},{title:"Start Date",key:"start_date"},{title:"End Date",key:"end_date"},{title:"Amount",key:"amount",align:"end"},{title:"Description",key:"description"},{title:"Actions",key:"actions",align:"center",sortable:!1}];function C(l){return Number(l||0).toLocaleString(void 0,{minimumFractionDigits:2})}function q(l){return l?x(l,"YYYY-MM-DD").format("DD-MM-YYYY"):""}function ae(){Object.assign(r,{type_ids:[],start_from:"",start_to:"",end_from:"",end_to:""}),D()}function oe(l){return{"Production Cost":"blue-lighten-1","Sale Cost":"green-lighten-1","Administrative Cost":"purple-lighten-4","Other Cost":"orange-lighten-4"}[l]||"grey-lighten-3"}function v(l,e="success"){_.message=l,_.color=e,_.show=!0}function f(l){switch(l){case"type_id":n.type_id=s.type_id?"":"Cost type is required";break;case"start_date":n.start_date=s.start_date?"":"Start date is required";break;case"end_date":n.end_date=s.end_date?"":"End date is required",s.start_date&&s.end_date&&R();break;case"amount":!s.amount&&s.amount!==0?n.amount="Amount is required":Number.isInteger(Number(s.amount))?s.amount<0?n.amount="Amount must be positive":n.amount="":n.amount="Amount must be a whole number";break}}function R(){if(s.start_date&&s.end_date){const l=x(s.start_date,"DD-MM-YYYY");x(s.end_date,"DD-MM-YYYY").isBefore(l)?n.end_date="End date cannot be before start date":E("end_date")}}function E(l){n[l]=""}function le(){return f("type_id"),f("start_date"),f("end_date"),f("amount"),!n.type_id&&!n.start_date&&!n.end_date&&!n.amount}async function re(){try{const e=await(await fetch("/expenditures/types")).json();j.value=e.data}catch(l){console.error("Failed to load cost types:",l),v("Failed to load cost types","error")}}async function de(){try{const l=new URLSearchParams;r.type_ids.length&&r.type_ids.forEach(o=>l.append("type_id",o)),r.start_from&&l.append("start_date_from",r.start_from),r.start_to&&l.append("start_date_to",r.start_to),r.end_from&&l.append("end_date_from",r.end_from),r.end_to&&l.append("end_date_to",r.end_to);const u=await(await fetch(`/expenditures/summary?${l.toString()}`)).json();Object.assign(k,u)}catch(l){console.error("Failed to load summary:",l)}}async function D(){$.value=!0;try{const l=new URLSearchParams;r.type_ids.length&&r.type_ids.forEach(o=>l.append("type_id",o)),r.start_from&&l.append("start_date_from",r.start_from),r.start_to&&l.append("start_date_to",r.start_to),r.end_from&&l.append("end_date_from",r.end_from),r.end_to&&l.append("end_date_to",r.end_to),l.append("page",F.value),l.append("limit",10);const u=await(await fetch(`/expenditures?${l.toString()}`)).json();T.value=u.data||[],O.value=u.totalPages||1,B.value=u.totalRecords||0,await de()}catch(l){console.error("Failed to load expenditures:",l),v("Failed to load expenditures","error")}finally{$.value=!1}}function z(l=!1,e=null){b.value=l,w.value=!0,Object.keys(n).forEach(u=>n[u]=""),l&&e?Object.assign(s,{id:e.id,type_id:e.type_id,start_date:x(e.start_date,"YYYY-MM-DD").format("DD-MM-YYYY"),end_date:x(e.end_date,"YYYY-MM-DD").format("DD-MM-YYYY"),amount:e.amount,description:e.description}):Object.assign(s,{id:null,type_id:"",start_date:"",end_date:"",amount:"",description:""})}function I(){w.value=!1,Object.keys(n).forEach(l=>n[l]="")}async function L(){if(!le()){v("Please fix the validation errors","error");return}U.value=!0;try{const l=b.value?"PUT":"POST",e=b.value?`/expenditures/${s.id}`:"/expenditures";console.log(JSON.stringify(s,0,2));const u={...s,start_date:x(s.start_date,"DD-MM-YYYY").format("YYYY-MM-DD"),end_date:x(s.end_date,"DD-MM-YYYY").format("YYYY-MM-DD")};console.log(JSON.stringify(u,0,2));const o=await fetch(e,{method:l,headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!o.ok){const Y=await o.json();throw new Error(Y.message||"Save failed")}w.value=!1,v(`Expenditure ${b.value?"updated":"created"} successfully`),await D()}catch(l){console.error("Failed to save expenditure:",l),v(l.message||"Failed to save expenditure","error")}finally{U.value=!1}}async function se(l){if(confirm(`Are you sure you want to delete expenditure "${l.cost_type}"?`))try{if(!(await fetch(`/expenditures/${l.id}`,{method:"DELETE"})).ok)throw new Error("Delete failed");v("Expenditure deleted successfully"),await D()}catch(e){console.error("Failed to delete expenditure:",e),v("Failed to delete expenditure","error")}}return ue(async()=>{await re(),await D()}),(l,e)=>{const u=me("VueDatePicker");return A(),pe(ge,{class:"py-6",fluid:""},{default:a(()=>[t(V,{class:"mb-6",elevation:"2",rounded:"lg"},{default:a(()=>[t(S,{class:"d-flex align-center justify-space-between"},{default:a(()=>[e[23]||(e[23]=d("div",null,[d("h2",{class:"text-h5 font-weight-bold text-primary mb-1"}," Expenditure Management "),d("p",{class:"text-body-2 text-grey"}," Monitor and manage operational and sales costs ")],-1)),t(c,{color:"primary","prepend-icon":"mdi-plus-circle",onClick:e[0]||(e[0]=o=>z(!1))},{default:a(()=>e[22]||(e[22]=[i(" New Expenditure ")])),_:1})]),_:1})]),_:1}),t(N,{class:"mb-4"},{default:a(()=>[t(y,{cols:"12",md:"4"},{default:a(()=>[t(V,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[d("div",Ce,[d("div",null,[e[24]||(e[24]=d("div",{class:"text-body-2 text-grey"},"Total Expenditure",-1)),d("div",Ee,p(C(k.total_expenditure)),1)]),t(P,{color:"primary",size:"40",variant:"tonal"},{default:a(()=>[t(g,{color:"primary"},{default:a(()=>e[25]||(e[25]=[i("mdi-cash")])),_:1})]),_:1})])]),_:1})]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(V,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[d("div",Se,[d("div",null,[e[26]||(e[26]=d("div",{class:"text-body-2 text-grey"},"Production Costs",-1)),d("div",Te,p(C(k.total_production_cost)),1)]),t(P,{color:"blue",size:"40",variant:"tonal"},{default:a(()=>[t(g,{color:"blue"},{default:a(()=>e[27]||(e[27]=[i("mdi-factory")])),_:1})]),_:1})])]),_:1})]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(V,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[d("div",je,[d("div",null,[e[28]||(e[28]=d("div",{class:"text-body-2 text-grey"},"Sale Costs",-1)),d("div",Fe,p(C(k.total_sale_cost)),1)]),t(P,{color:"green",size:"40",variant:"tonal"},{default:a(()=>[t(g,{color:"green"},{default:a(()=>e[29]||(e[29]=[i("mdi-sale")])),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),t(V,{class:"mb-4",elevation:"2",rounded:"lg"},{default:a(()=>[t(S,null,{default:a(()=>[t(N,{dense:""},{default:a(()=>[t(y,{cols:"12",md:"4"},{default:a(()=>[t(X,{modelValue:r.type_ids,"onUpdate:modelValue":e[1]||(e[1]=o=>r.type_ids=o),autocomplete:"off",autocorrect:"off",chips:"",clearable:"",color:"primary",inputmode:"none","item-title":"name","item-value":"id",items:j.value,label:"Filter by Cost Types",multiple:"",spellcheck:"false",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(W,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[30]||(e[30]=[i(" Start Date Range ")])),_:1}),d("div",$e,[t(u,{modelValue:r.start_from,"onUpdate:modelValue":e[2]||(e[2]=o=>r.start_from=o),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"From",teleport:!0},null,8,["modelValue"]),t(u,{modelValue:r.start_to,"onUpdate:modelValue":e[3]||(e[3]=o=>r.start_to=o),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"To",teleport:!0},null,8,["modelValue"])])]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(W,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[31]||(e[31]=[i("End Date Range")])),_:1}),d("div",Ue,[t(u,{modelValue:r.end_from,"onUpdate:modelValue":e[4]||(e[4]=o=>r.end_from=o),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"From",teleport:!0},null,8,["modelValue"]),t(u,{modelValue:r.end_to,"onUpdate:modelValue":e[5]||(e[5]=o=>r.end_to=o),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"To",teleport:!0},null,8,["modelValue"])])]),_:1})]),_:1}),d("div",Ae,[t(c,{color:"primary","prepend-icon":"mdi-filter",onClick:D},{default:a(()=>e[32]||(e[32]=[i(" Apply Filters ")])),_:1}),t(c,{class:"ml-2","prepend-icon":"mdi-close-circle",variant:"outlined",onClick:ae},{default:a(()=>e[33]||(e[33]=[i(" Clear ")])),_:1})])]),_:1})]),_:1}),t(V,{elevation:"2",rounded:"lg"},{default:a(()=>[t(S,{class:"pa-0"},{default:a(()=>[t(Ve,{class:"rounded-lg",density:"comfortable",headers:te,hover:"",items:T.value,loading:$.value},{loading:a(()=>[t(De,{type:"table-row@10"})]),"item.amount":a(({item:o})=>[t(h,{color:"green",variant:"flat"},{default:a(()=>[i(p(C(o.amount)),1)]),_:2},1024)]),"item.cost_category":a(({item:o})=>[t(h,{color:oe(o.cost_category),variant:"outlined"},{default:a(()=>[i(p(o.cost_category),1)]),_:2},1032,["color"])]),"item.start_date":a(({item:o})=>[i(p(q(o.start_date)),1)]),"item.end_date":a(({item:o})=>[i(p(q(o.end_date)),1)]),"item.actions":a(({item:o})=>[d("div",Ne,[t(Z,{location:"top"},{activator:a(({props:Y})=>[t(c,J(Y,{color:"blue",icon:"",size:"small",variant:"text",onClick:ne=>z(!0,o)}),{default:a(()=>[t(g,null,{default:a(()=>e[34]||(e[34]=[i("mdi-pencil")])),_:1})]),_:2},1040,["onClick"])]),default:a(()=>[e[35]||(e[35]=d("span",null,"Edit",-1))]),_:2},1024),t(Z,{location:"top"},{activator:a(({props:Y})=>[t(c,J(Y,{color:"red",icon:"",size:"small",variant:"text",onClick:ne=>se(o)}),{default:a(()=>[t(g,null,{default:a(()=>e[36]||(e[36]=[i("mdi-delete")])),_:1})]),_:2},1040,["onClick"])]),default:a(()=>[e[37]||(e[37]=d("span",null,"Delete",-1))]),_:2},1024)])]),"no-data":a(()=>[d("div",Pe,[t(g,{color:"grey-lighten-2",size:"48"},{default:a(()=>e[38]||(e[38]=[i("mdi-inbox")])),_:1}),e[39]||(e[39]=d("div",null,"No expenditures found",-1))])]),_:1},8,["items","loading"]),t(fe),d("div",Oe,[d("span",Be," Showing "+p(T.value.length)+" of "+p(B.value)+" records ",1),t(be,{modelValue:F.value,"onUpdate:modelValue":[e[6]||(e[6]=o=>F.value=o),D],color:"primary",length:O.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1}),t(we,{modelValue:w.value,"onUpdate:modelValue":e[20]||(e[20]=o=>w.value=o),"max-width":"600px",persistent:""},{default:a(()=>[t(V,null,{default:a(()=>[t(ce,{class:"text-white",color:"primary",density:"comfortable"},{default:a(()=>[t(ye,null,{default:a(()=>[i(p(b.value?"Edit Expenditure":"New Expenditure"),1)]),_:1}),t(H),t(c,{color:"white",icon:"mdi-close",variant:"text",onClick:I})]),_:1}),t(S,{class:"pa-4"},{default:a(()=>[t(Ye,{ref_key:"formRef",ref:ee,onSubmit:_e(L,["prevent"])},{default:a(()=>[t(X,{modelValue:s.type_id,"onUpdate:modelValue":e[7]||(e[7]=o=>s.type_id=o),autocomplete:"off",autocorrect:"off",color:"primary","error-messages":n.type_id,inputmode:"none","item-title":"name","item-value":"id",items:j.value,label:"Cost Type *",required:"",spellcheck:"false",variant:"outlined",onBlur:e[8]||(e[8]=o=>f("type_id")),onInput:e[9]||(e[9]=o=>E("type_id"))},{label:a(()=>e[40]||(e[40]=[d("span",{class:"required-field"},"Cost Type",-1)])),_:1},8,["modelValue","error-messages","items"]),t(N,{dense:""},{default:a(()=>[t(y,{cols:"12",md:"6"},{default:a(()=>[d("div",qe,[e[41]||(e[41]=d("label",{class:"text-caption text-grey mb-1 required-field"},"Start Date *",-1)),t(u,{modelValue:s.start_date,"onUpdate:modelValue":[e[10]||(e[10]=o=>s.start_date=o),e[12]||(e[12]=o=>E("start_date"))],"auto-apply":"",class:K(["rounded-lg","border","px-4","py-2","w-100",n.start_date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"Start Date",teleport:!0,onBlur:e[11]||(e[11]=o=>f("start_date"))},null,8,["modelValue","class"]),n.start_date?(A(),Q("div",Re,p(n.start_date),1)):G("",!0)])]),_:1}),t(y,{cols:"12",md:"6"},{default:a(()=>[d("div",ze,[e[42]||(e[42]=d("label",{class:"text-caption text-grey mb-1 required-field"},"End Date *",-1)),t(u,{modelValue:s.end_date,"onUpdate:modelValue":[e[13]||(e[13]=o=>s.end_date=o),e[15]||(e[15]=o=>R())],"auto-apply":"",class:K(["rounded-lg","border","px-4","py-2","w-100",n.end_date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"End Date",teleport:!0,onBlur:e[14]||(e[14]=o=>f("end_date"))},null,8,["modelValue","class"]),n.end_date?(A(),Q("div",Ie,p(n.end_date),1)):G("",!0)])]),_:1})]),_:1}),t(Me,{modelValue:s.amount,"onUpdate:modelValue":e[16]||(e[16]=o=>s.amount=o),modelModifiers:{number:!0},autocomplete:"off",autocorrect:"off",color:"primary","error-messages":n.amount,inputmode:"none",label:"Amount *",prefix:"$",required:"",spellcheck:"false",type:"number",variant:"outlined",onBlur:e[17]||(e[17]=o=>f("amount")),onInput:e[18]||(e[18]=o=>E("amount"))},{label:a(()=>e[43]||(e[43]=[d("span",{class:"required-field"},"Amount",-1)])),_:1},8,["modelValue","error-messages"]),t(ke,{modelValue:s.description,"onUpdate:modelValue":e[19]||(e[19]=o=>s.description=o),color:"primary",label:"Description",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1},512)]),_:1}),t(xe,{class:"pa-4"},{default:a(()=>[t(H),t(c,{color:"grey",variant:"outlined",onClick:I},{default:a(()=>e[44]||(e[44]=[i("Cancel")])),_:1}),t(c,{color:"primary",loading:U.value,onClick:L},{default:a(()=>[t(g,{start:""},{default:a(()=>e[45]||(e[45]=[i("mdi-content-save")])),_:1}),i(" "+p(b.value?"Update":"Save"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ve,{modelValue:_.show,"onUpdate:modelValue":e[21]||(e[21]=o=>_.show=o),color:_.color,timeout:"3000"},{default:a(()=>[i(p(_.message),1)]),_:1},8,["modelValue","color"])]),_:1})}}},nt=ie(Le,[["__scopeId","data-v-32f623e8"]]);export{nt as default};
