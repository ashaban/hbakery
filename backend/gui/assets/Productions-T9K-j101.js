import{g as Bt,p as Mt,f as Rt,h as l,a5 as he,a6 as Pl,d as E,a7 as Cl,r as A,a8 as Al,x as o,F as T,a9 as Ul,aa as ht,ab as Sl,_ as Il,$ as Se,k as Dl,q as y,v as t,a1 as jl,t as m,Z as b,B as d,G as h,A as c,H as n,N as j,z,C as le,O as pe,L as Y,ac as zt,ad as Pt,ae as Ct,i as ne,K as _e,M as K,af as L,D as C,a2 as Ie,a3 as De,E as H,a4 as At}from"./index-C1Tj7Gr4.js";import{h as Ft}from"./moment-C5S46NFB.js";import{V as Nl}from"./VContainer-DjHLodrw.js";import{V as ae}from"./VAlert-DPUzX-lz.js";import{V as v,b as x,a as qe,c as Ut}from"./VCard-BTVuuPde.js";import{V as p}from"./VCol-DviWLfXs.js";import{V as w}from"./VChip-BoOgafMF.js";import{V as ge}from"./VAutocomplete-DxxHVteM.js";import{a as Qe,m as Tl,b as $l,c as Bl,V as ue,d as St,e as je}from"./VDataTable-B2-JjakP.js";import{V as It}from"./VDataTableServer-DX--LLFj.js";import{V as Dt}from"./VSkeletonLoader-jHZeiKRN.js";import{V as Ml}from"./VBadge-BFhU4gJH.js";import{V as Ne}from"./VDialog-DXmIvNfP.js";import{V as jt}from"./VForm-CB7-a3w8.js";import{a as Nt,b as Rl,m as Fl,V as M}from"./VTextField-ByAT7d5t.js";import{V as Gl}from"./VSwitch-Dj9gh7oe.js";import{V as Tt,a as Te,b as $t,c as $e}from"./VTabs-DnmOmm9a.js";import{V as El}from"./VTooltip-BDAA4Qkl.js";import{V as Ol,a as Ll,b as Hl,c as Ql}from"./VExpansionPanels-BGPhGPZU.js";import"./VSlideGroup-CXfqPmJw.js";import"./dialog-transition-C6ql0rGP.js";const Le=I=>I?Ft(I).format("DD-MM-YYYY HH:mm"):"",He=I=>I?Ft(I,"DD-MM-YYYY HH:mm").format("YYYY-MM-DD HH:mm"):null,Yl=Mt({...Tl({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),Jl=Bt()({name:"VRadio",props:Yl(),setup(I,Z){let{slots:O}=Z;return Rt(()=>{const R=Qe.filterProps(I);return l(Qe,he(R,{class:["v-radio",I.class],style:I.style,type:"radio"}),O)}),{}}}),Kl=Mt({height:{type:[Number,String],default:"auto"},...Fl(),...Sl(Bl(),["multiple"]),trueIcon:{type:ht,default:"$radioOn"},falseIcon:{type:ht,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),Wl=Bt()({name:"VRadioGroup",inheritAttrs:!1,props:Kl(),emits:{"update:modelValue":I=>!0},setup(I,Z){let{attrs:O,slots:R}=Z;const X=Pl(),ee=E(()=>I.id||`radio-group-${X}`),F=Cl(I,"modelValue"),J=A();return Rt(()=>{const[ye,te]=Al(O),ve=Nt.filterProps(I),be=Qe.filterProps(I),oe=R.label?R.label({label:I.label,props:{for:ee.value}}):I.label;return l(Nt,he({ref:J,class:["v-radio-group",I.class],style:I.style},ye,ve,{modelValue:F.value,"onUpdate:modelValue":S=>F.value=S,id:ee.value}),{...R,default:S=>{let{id:G,messagesId:Q,isDisabled:ce,isReadonly:xe}=S;return o(T,null,[oe&&l(Rl,{id:G.value},{default:()=>[oe]}),l($l,he(be,{id:G.value,"aria-describedby":Q.value,defaultsTarget:"VRadio",trueIcon:I.trueIcon,falseIcon:I.falseIcon,type:I.type,disabled:ce.value,readonly:xe.value,"aria-labelledby":oe?G.value:void 0,multiple:!1},te,{modelValue:F.value,"onUpdate:modelValue":q=>F.value=q}),R)])}})}),Ul({},J)}}),Zl={class:"d-flex align-center justify-space-between"},Xl={class:"d-flex gap-2"},ea={class:"d-flex align-center"},ta={class:"text-h5 font-weight-bold text-blue"},la={class:"text-caption text-grey"},aa={class:"d-flex align-center"},oa={class:"text-h5 font-weight-bold text-green"},da={class:"d-flex align-center"},sa={class:"text-h5 font-weight-bold text-orange"},ia={class:"d-flex align-center"},na={class:"text-h5 font-weight-bold text-purple"},ra={class:"d-flex align-center pa-4 bg-grey-lighten-4 rounded-t-lg"},ua={class:"d-flex align-center mb-4"},ca={class:"d-flex align-center mb-2"},ma={class:"d-flex align-center mb-2"},fa={class:"d-flex align-center"},pa={class:"d-flex align-center mb-2"},_a={class:"d-flex align-center mb-2"},ga={class:"d-flex justify-space-between align-center"},ya={class:"text-caption text-grey"},va={class:"d-flex gap-2"},ba={class:"d-flex align-center"},xa={class:"font-weight-medium"},Va={class:"text-caption text-grey"},wa={class:"text-caption"},ka={class:"text-no-wrap"},qa={class:"text-no-wrap"},ha={class:"d-flex align-center"},za={class:"font-weight-medium"},Pa={class:"d-flex justify-end"},Ca={class:"d-flex align-center justify-space-between"},Aa={class:"d-flex align-center"},Ua={class:"text-white text-caption opacity-75"},Sa={class:"text-center py-8"},Ia={class:"d-flex align-center pa-4 bg-grey-lighten-4 rounded-t-lg"},Da={class:"d-flex align-center mb-4"},ja={class:"d-flex align-center mb-2"},Na={class:"d-flex align-center mb-2"},Ta={class:"d-flex align-center"},$a={class:"d-flex align-center mb-2"},Ba={class:"d-flex align-center mb-2"},Ma={class:"d-flex justify-space-between align-center"},Ra={class:"text-caption text-grey"},Fa={class:"d-flex gap-2"},Ga={class:"d-flex align-center"},Ea={class:"font-weight-medium"},Oa={class:"text-caption text-grey"},La={class:"d-flex align-center"},Ha={class:"font-weight-medium"},Qa={class:"text-no-wrap"},Ya={class:"text-no-wrap"},Ja={class:"d-flex align-center"},Ka={class:"font-weight-medium"},Wa={class:"d-flex justify-end"},Za={class:"d-flex align-center justify-space-between"},Xa={class:"d-flex align-center"},eo={class:"text-white text-caption opacity-75"},to={class:"text-center py-8"},lo={class:"text-h6 font-weight-bold"},ao={class:"text-body-1 font-weight-medium"},oo={class:"text-body-1 font-weight-medium"},so={class:"text-body-1 font-weight-medium"},io={class:"text-body-1 font-weight-medium"},no={class:"text-h6 font-weight-bold text-green"},ro={class:"text-h6 font-weight-bold text-orange"},uo={class:"text-h6 font-weight-bold text-red"},co={class:"text-h6 font-weight-bold text-primary"},mo={class:"d-flex align-center"},fo={class:"font-weight-medium"},po={class:"text-caption text-grey"},_o={key:0,class:"d-flex flex-column"},go={class:"font-weight-medium text-green"},yo={class:"text-caption text-orange"},vo={class:"text-caption text-red"},bo={key:1,class:"text-grey"},xo={class:"text-white text-caption font-weight-bold"},Vo={key:0,class:"text-caption"},wo={key:1,class:"text-caption text-grey"},ko={class:"d-flex align-center mb-4"},qo={class:"position-relative w-100"},ho={key:0,class:"datepicker-label"},zo={class:"d-flex align-center mb-4"},Po={class:"d-flex align-center mb-3"},Co={class:"font-weight-medium text-h6"},Ao={class:"text-caption text-grey"},Uo={class:"mb-2"},So={class:"d-flex align-center mb-3"},Io={class:"text-h6 font-weight-bold text-green"},Do={class:"text-h6 font-weight-bold text-orange"},jo={class:"text-h6 font-weight-bold text-red"},No={class:"text-h6 font-weight-bold text-primary"},To={class:"d-flex align-center mb-4"},$o={class:"position-relative w-100"},Bo={key:0,class:"datepicker-label"},Mo={class:"position-relative w-100"},Ro={key:0,class:"datepicker-label"},Fo={class:"d-flex align-center justify-space-between mb-4"},Go={class:"d-flex align-center"},Eo={class:"d-flex align-center mb-3"},Oo={class:"text-body-2 text-grey"},Lo={class:"d-flex align-center mb-3"},Ho={class:"d-flex align-center justify-space-between mb-4"},Qo={class:"d-flex align-center"},Yo={class:"d-flex align-center"},Jo={class:"d-flex align-center"},Ko={class:"d-flex align-center mb-4"},Wo={class:"text-h6 font-weight-medium"},Zo={class:"d-flex align-center justify-space-between w-100 pr-4"},Xo={class:"d-flex align-center"},ed={class:"d-flex align-center"},td={class:"text-caption text-grey mb-2"},ld={class:"d-flex align-center"},ad={class:"ml-2 flex-grow-1"},od={class:"font-weight-medium"},dd={key:0,class:"text-caption text-grey"},sd={class:"mt-2"},id={class:"d-flex align-center"},nd={class:"d-flex align-center justify-space-between mb-4"},rd={class:"d-flex align-center"},ud={class:"d-flex gap-2"},cd={class:"d-flex justify-space-between align-center"},md={class:"text-caption text-grey"},fd={class:"d-flex align-center mb-4"},pd={class:"text-h6 font-weight-bold"},_d={class:"text-body-1 font-weight-medium"},gd={class:"text-body-1 font-weight-medium"},yd={class:"text-body-1 font-weight-medium"},vd={class:"text-body-1 font-weight-medium"},bd={class:"text-body-1 font-weight-medium"},xd={class:"text-body-1 font-weight-medium"},Vd={class:"text-body-1 font-weight-medium"},wd={class:"text-body-1 font-weight-medium"},kd={class:"text-h6 font-weight-bold text-green"},qd={class:"text-h6 font-weight-bold text-blue"},hd={class:"text-h6 font-weight-bold text-green"},zd={class:"text-h6 font-weight-bold text-orange"},Pd={class:"text-h6 font-weight-bold text-red"},Cd={class:"text-body-1 font-weight-medium"},Ad={class:"text-white text-caption font-weight-bold"},Ud={class:"text-caption text-grey"},Sd={key:0,class:"text-caption text-grey ml-2"},Id={class:"text-caption text-grey ml-2"},Dd={class:"text-white text-caption font-weight-bold"},jd={key:0,class:"text-caption"},Nd={key:1,class:"text-caption text-grey"},Td={class:"text-caption text-grey"},$d={__name:"Productions",setup(I){const Z=A(10),O=A(!1),R=A(!1),X=A([]),ee=A([]),F=A(!0),J=A(1),ye=A(0),te=A(!1),ve=A(!1),be=A(!1),oe=A(!1),S=A(null),G=A(!0),Q=A(!1),ce=A(!1),xe=A(!1),q=A(null),Ye=A(""),W=A(0),de=A([]),Ve=A(!1),we=A([]),Be=A([]),ze=A([]),Je=A([]),Me=A([]),$=Se({product_id:"",status:"all",planned_at:"",planned_end:"",planned_at_op:"=",produced_at:"",produced_end:"",produced_at_op:"=",team_leader:"",discrepancy_reason:[]}),B=Se({product_id:"",status:"all",planned_at:"",planned_end:"",planned_at_op:"=",team_leader:""}),g=Se({id:null,planned_at:null,produced_at:null,notes:"",good_qty:null,damaged_qty:null,reject_qty:null,actual_qty:null,discrepancies:[],staff:[],products:[]}),D=Se({batch_id:null,produced_at:null,notes:"",products:[]}),Gt=[{label:"By Product",value:"by_product"},{label:"By Ingredient",value:"by_ingredient"}],Et=[{title:"All Status",value:"all",icon:"mdi-view-grid"},{title:"Pending",value:"pending",icon:"mdi-clock-outline",color:"orange"},{title:"Completed",value:"completed",icon:"mdi-check-circle",color:"green"}],Ot=[{title:"All Status",value:"all",icon:"mdi-view-grid"},{title:"Pending",value:"pending",icon:"mdi-clock-outline",color:"orange"},{title:"Completed",value:"completed",icon:"mdi-check-circle",color:"green"}],Ke=[{title:"On Date",value:"="},{title:"After",value:">"},{title:"Before",value:"<"},{title:"On or After",value:">="},{title:"On or Before",value:"<="},{title:"Between",value:"in"}],Lt=[{title:"Batch Code",key:"batch_code",sortable:!0},{title:"Status",key:"status",sortable:!0,align:"center"},{title:"Production Stats",key:"production_stats",sortable:!1},{title:"Planned Start",key:"planned_at",sortable:!0},{title:"Produced At",key:"produced_at",sortable:!0},{title:"Team Leader",key:"team_leader_name",sortable:!0},{title:"Planned By",key:"created_by_name",sortable:!0},{title:"Actions",key:"actions",sortable:!1,align:"end",width:"100px"}],Ht=[{title:"Product",key:"product_name",sortable:!0},{title:"Planned Qty",key:"qty_product",sortable:!0,align:"center"},{title:"Status",key:"produced",sortable:!0,align:"center"},{title:"Actual Output",key:"good_qty",sortable:!1},{title:"Actions",key:"actions",sortable:!1,align:"center"}],Qt=[{title:"Product / Batch",key:"product_name",sortable:!0},{title:"Quantity",key:"qty_product",sortable:!0,align:"center"},{title:"Staffs",key:"staff_count",sortable:!0,align:"center"},{title:"Mode",key:"mode",sortable:!0},{title:"Status",key:"status",sortable:!0},{title:"Planned At",key:"planned_at",sortable:!0},{title:"Produced At",key:"produced_at",sortable:!0},{title:"Team Leader",key:"team_leader_name",sortable:!0},{title:"Actions",key:"actions",sortable:!1,align:"end",width:"180px"}],We=[{title:"Ingredient",key:"item_name"},{title:"Quantity Required",key:"qty_required"},{title:"Available",key:"available",align:"center"},{title:"Balance",key:"balance",align:"center"},{title:"Unit",key:"unit",align:"center"}],Yt=[{title:"Staff Member",key:"staff_id",width:"250px"},{title:"Role",key:"role",width:"240px"},{title:"Notes",key:"notes",width:"240px"},{title:"Actions",key:"actions",align:"center",sortable:!1}],Ze=s=>({completed:"green",partial:"orange",pending:"red",cancelled:"grey"})[s]||"grey",Xe=s=>({completed:"Completed",partial:"Partial",pending:"Pending",cancelled:"Cancelled"})[s]||s,Jt=s=>({completed:"bg-green",partial:"bg-orange",pending:"bg-red",cancelled:"bg-grey"})[s]||"bg-primary",Kt=s=>({pending:"bg-orange",completed:"bg-green",active:"bg-primary",cancelled:"bg-red"})[s]||"bg-primary",Wt=E(()=>{let s=0;return Object.keys($).forEach(e=>{const u=$[e];(Array.isArray(u)&&u.length||u&&u!=="all")&&s++}),s}),Zt=E(()=>{let s=0;return Object.keys(B).forEach(e=>{const u=B[e];(Array.isArray(u)&&u.length||u&&u!=="all")&&s++}),s}),Xt=()=>{F.value=!F.value,J.value=1,me()},me=()=>{F.value?Pe():Vl()},Pe=async()=>{O.value=!0;try{const s=new URLSearchParams({page:J.value,limit:Z.value});Object.entries(B).forEach(([a,r])=>{r&&r!=="all"&&!(Array.isArray(r)&&!r.length)&&s.append(a,r)});const u=await(await fetch(`/productions/batches?${s.toString()}`)).json();ee.value=u.data||[],ye.value=u.totalRecords||0}catch(s){console.error("Failed to load batches:",s),ee.value=[]}finally{O.value=!1}},el=()=>{Object.assign(B,{product_id:"",status:"all",planned_at:"",planned_end:"",planned_at_op:"=",team_leader:""}),Pe()},tl=()=>{J.value=1,Pe()},et=async s=>{var e;try{const a=await(await fetch(`/productions/batches/${s.id}`)).json();S.value=a.batch,S.value.products=a.products||[],S.value.staff=((e=a.products.find(r=>r.staff.length))==null?void 0:e.staff)||[],be.value=!0}catch(u){console.error("Failed to load batch details:",u)}},ll=async s=>{try{const u=await(await fetch(`/productions/batches/${s.id}`)).json();S.value=u.batch,D.batch_id=s.id,D.produced_at=Le(new Date),D.notes="",D.products=u.products.map(a=>({production_id:a.production_id,product_id:a.product_id,product_name:a.product_name,planned_qty:a.qty_product,good_qty:a.good_qty||"",damaged_qty:a.damaged_qty||"",reject_qty:a.reject_qty||"",actual_qty:(a.good_qty||0)+(a.damaged_qty||0)+(a.reject_qty||0),hasDiscrepancy:parseFloat(a.good_qty)!==parseFloat(a.planned_qty),discrepancies:a.discrepancies||[]})),oe.value=!0}catch(e){console.error("Failed to load batch for actual production:",e)}},Re=()=>{oe.value=!1,D.batch_id=null,D.produced_at=null,D.notes="",D.products=[]},ke=s=>{s.actual_qty=(Number(s.good_qty)||0)+(Number(s.damaged_qty)||0)+(Number(s.reject_qty)||0),s.hasDiscrepancy=Number(s.good_qty)!==Number(s.planned_qty),s.hasDiscrepancy||(s.discrepancies=[]),s.hasDiscrepancy&&(!s.discrepancies||s.discrepancies.length===0)&&Fe(s)},Fe=s=>{s.discrepancies||(s.discrepancies=[]),s.discrepancies.push({reason_id:null,notes:""})},tt=(s,e)=>{s.discrepancies&&s.discrepancies.splice(e,1)},Ae=E(()=>{const s={good_qty:0,damaged_qty:0,reject_qty:0,actual_qty:0};return D.products.forEach(e=>{s.good_qty+=Number(e.good_qty)||0,s.damaged_qty+=Number(e.damaged_qty)||0,s.reject_qty+=Number(e.reject_qty)||0,s.actual_qty+=Number(e.actual_qty)||0}),s}),al=E(()=>!D.produced_at||D.products.length===0?!1:D.products.every(e=>(Number(e.good_qty)||0)>=0&&(Number(e.damaged_qty)||0)>=0&&(Number(e.reject_qty)||0)>=0)&&!R.value),lt=async()=>{R.value=!0;try{const s={produced_at:He(D.produced_at),notes:D.notes,products:D.products.map(a=>({production_id:a.production_id,good_qty:Number(a.good_qty)||0,damaged_qty:Number(a.damaged_qty)||0,reject_qty:Number(a.reject_qty)||0,actual_qty:Number(a.actual_qty)||0,discrepancies:(a.discrepancies||[]).filter(r=>r.reason_id)}))},e=await fetch(`/productions/batches/${D.batch_id}/actual`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}),u=await e.json();if(!e.ok){alert(u.message||"Failed to save actual production.");return}oe.value=!1,await Pe(),Re()}catch(s){console.error("Failed to save batch actual production:",s),alert("Failed to save actual production. Please try again.")}finally{R.value=!1}},ol=s=>{et(s)},dl=async s=>{if(confirm(`Are you sure you want to delete batch ${s.batch_code}? This will also delete all productions in this batch.`))try{await fetch(`/productions/batches/${s.id}`,{method:"DELETE"}),await Pe()}catch(e){console.error("Failed to delete batch:",e),alert("Failed to delete batch. Please try again.")}},sl=s=>{ft({id:s})};E(()=>F.value?ee.value.length:X.value.length);const il=E(()=>F.value?ee.value.reduce((s,e)=>s+Number(e.total_good_qty||0),0):X.value.reduce((s,e)=>s+Number(e.qty_product||e.total_qty||0),0)),nl=E(()=>F.value?ee.value.reduce((s,e)=>s+(e.staff?e.staff.length:0),0):X.value.reduce((s,e)=>s+Number(e.staff_count||0),0)),rl=E(()=>X.value.reduce((s,e)=>s+Number(e.total_pay||0),0).toFixed(2)),at=E(()=>g.products.flatMap(e=>e.ingredients||[]).some(e=>e.exceeds)),ot=E(()=>{const s=g.staff.map(e=>{var u;return typeof e.staff_id=="object"?(u=e.staff_id)==null?void 0:u.id:e.staff_id}).filter(Boolean);return ze.value.filter(e=>!s.includes(e.id))}),dt=E(()=>g.staff.filter(s=>s.staff_id).length),st=E(()=>g.products.reduce((s,e)=>s+Number(e.computed_qty_product||0),0)),it=E(()=>{const s=new Map;for(const e of g.products)for(const u of e.ingredients||[]){if(!u.item_id)continue;s.has(u.item_id)||s.set(u.item_id,{item_id:u.item_id,item_name:u.item_name,unit:u.unit,qty_required:0,available:u.available||0,exceeds:u.exceeds||!1});const a=s.get(u.item_id);a.qty_required+=Number(u.qty_required||0)}return Array.from(s.values()).sort((e,u)=>e.item_name.localeCompare(u.item_name))}),ul=E(()=>{if(!g.planned_at||!g.products.length)return!1;for(const u of g.products)if(!u.product_id||!u.mode||!u.computed_qty_product||u.computed_qty_product<=0||!u.ingredients||!u.ingredients.length)return!1;const s=g.staff.some(u=>u.staff_id),e=g.products.every(u=>(u.productGroups||[]).every(a=>!a.is_mandatory||u.group_choices[a.id]));return!(at.value||!e||!s||R.value)});function se(s){return s?new Date(s).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}function Ue(s){var e;return((e=we.value.find(u=>u.id===s))==null?void 0:e.name)||"Product"}function cl(s){const e=Ue(s.product_id);return s.product_id?s.computed_qty_product?`${e} • ${s.computed_qty_product} units`:e:"Select product & mode"}function ml(s,e){const u=Ue(s.product_id);return`${e+1}. ${u}`}const Ge=A(!1);function fl(){const s=st.value,e=Number(g.good_qty||0);Ge.value=!!(s&&e!==s),Ge.value&&!g.discrepancies.length&&pl()}function pl(){g.discrepancies.push({reason_id:null,notes:""})}function nt(){g.staff.push({staff_id:null,role:"",notes:""})}function _l(s){g.staff.splice(s,1)}function gl(){g.staff=[]}let yl=1;function rt(){return{uid:yl++,product_id:null,mode:"by_product",qty_product_input:null,base_ingredient_id:null,base_ingredient_qty:null,baseUnit:"",computed_qty_product:0,recipeItems:[],productGroups:[],group_choices:{},expandedGroups:[],ingredients:[],innerTab:"ingredients"}}function Ee(){g.products.push(rt()),W.value==="summary"&&(W.value=0),ie()}function vl(s){g.products.splice(s,1),typeof W.value=="number"&&W.value>=g.products.length&&(W.value=g.products.length?g.products.length-1:"summary"),ie()}async function ut(s){const e=Be.value.find(u=>u.product_id===s.product_id);if(e){Object.keys(e).forEach(u=>{s[u]=e[u]}),ie();return}if(s.recipeItems=[],s.productGroups=[],s.group_choices={},s.expandedGroups=[],s.ingredients=[],s.base_ingredient_id=null,s.base_ingredient_qty=null,s.baseUnit="",s.computed_qty_product=0,!!s.product_id)try{const a=await(await fetch(`/products/${s.product_id}/groups?active=true`)).json();s.recipeItems=a.fixed_items||[],s.productGroups=a.groups||[];const r=de.value.find(i=>i.product===s.product_id);if(!Ve.value&&r){s.productGroups=[];for(const i of de.value||[]){if(i.product!==s.product_id)continue;const f=await(await fetch(`/products/groups/${i.group}`)).json();f.deprecated=!0,s.productGroups.push(f)}}s.productGroups.forEach((i,_)=>{var U;const f=(U=i.combinations)==null?void 0:U.find(re=>re.is_default);f&&(s.group_choices[i.id]=f.id),s.expandedGroups.push(_)}),fe(s)}catch(u){console.error("Failed to load product details:",u)}}function fe(s){var a;if(!s.product_id||!s.mode){s.ingredients=[],s.computed_qty_product=0,ie();return}let e=0;if(s.mode==="by_product")e=Number(s.qty_product_input||0);else if(s.mode==="by_ingredient"){const r=s.recipeItems.find(i=>i.item_id===Number(s.base_ingredient_id));s.baseUnit=(r==null?void 0:r.unit)||"",r&&r.quantity_per_unit>0&&s.base_ingredient_qty>0&&(e=Number(s.base_ingredient_qty)/r.quantity_per_unit)}if(!e||e<=0){s.ingredients=[],s.computed_qty_product=0,ie();return}s.computed_qty_product=+e.toFixed(3);const u=[];for(const r of s.recipeItems){const i=+(r.quantity_per_unit*e).toFixed(3);u.push({item_id:r.item_id,item_name:r.item_name,unit_id:r.unit_id,unit:r.unit,qty_required:i,from_group:!1,group_id:null,group_name:null,combination_id:null})}for(const r of s.productGroups){const i=s.group_choices[r.id];if(!i)continue;const _=(a=r.combinations)==null?void 0:a.find(f=>f.id===i);if(!(!_||!_.options))for(const f of _.options){const U=+(f.quantity_per_unit*e).toFixed(3);u.push({item_id:f.item_id,item_name:f.item_name,unit:f.unit,qty_required:U,from_group:!0,group_id:r.id,group_name:r.name,combination_id:i})}}s.ingredients=u,ie()}function Oe(){te.value=!0,Q.value=!1,ce.value=!1,G.value=!0,Ce(),Ee(),nt()}function ct(){te.value=!1,Ge.value=!1,Q.value=!1,ce.value=!1,Ce()}function Ce(){Object.assign(g,{id:null,planned_at:null,produced_at:null,notes:"",good_qty:null,damaged_qty:null,reject_qty:null,actual_qty:null,discrepancies:[],staff:[],products:[]}),W.value=0,de.value=[],Ve.value=!1,Be.value=[],xe.value=!1}function bl(){Object.assign($,{product_id:"",status:"all",planned_at:"",planned_end:"",planned_at_op:"=",produced_at:"",produced_end:"",produced_at_op:"=",team_leader:"",discrepancy_reason:[]}),me()}function xl(){J.value=1,me()}async function Vl(){O.value=!0;try{const s=new URLSearchParams({page:J.value,limit:Z.value});Object.entries($).forEach(([a,r])=>{r&&r!=="all"&&!(Array.isArray(r)&&!r.length)&&s.append(a,r)});const u=await(await fetch(`/productions?${s.toString()}`)).json();X.value=u.data||[],ye.value=u.totalRecords||0}catch(s){console.error("Failed to load productions:",s),X.value=[]}finally{O.value=!1}}async function wl(){try{const e=await(await fetch("/products?limit=1000&page=1&active=true")).json();we.value=e.data||[]}catch(s){console.error("Failed to load products:",s)}}async function kl(){try{const e=await(await fetch("/staffs?status=Active&limit=1000&page=1")).json();ze.value=e.data||[]}catch(s){console.error("Failed to load staff:",s)}}async function mt(){try{const s=await fetch("/items/availableStock");Je.value=await s.json()}catch(s){console.error("Failed to load stock:",s)}}async function ql(){try{const e=await(await fetch("/productions/discrepancyReasons")).json();Me.value=e.data||[]}catch(s){console.error("Failed to load discrepancy reasons:",s)}}async function ft(s){try{const e=await fetch(`/productions/${s.id}`);q.value=await e.json(),ve.value=!0}catch(e){console.error("Failed to load production details:",e)}}const pt=s=>({"Team Leader":"blue",Assistant:"green",Support:"orange"})[s]||"grey";function hl(s,e){let u=0;for(const r of g.products)for(const i of r.ingredients||[])i.item_id===s&&(u+=Number(i.qty_required||0));if(u<=e)return;const a=e/u;for(const r of g.products)for(const i of r.ingredients||[])i.item_id===s&&(i.qty_required=+(Number(i.qty_required||0)*a).toFixed(3));ie()}function ie(){const s=new Map;for(const e of g.products)for(const u of e.ingredients||[]){if(!u.item_id)continue;const a=u.item_id;s.has(a)||s.set(a,{item_id:u.item_id,item_name:u.item_name,unit:u.unit,total_required:0,available:0,balance:0,exceeds:!1,previously_used:0});const r=s.get(a);r.total_required+=Number(u.qty_required||0)}for(const[e,u]of s){const a=Je.value.find(_=>_.item_id===e),r=a?Number(a.available_qty):0;let i=0;if(Q.value)for(const _ of g.products)for(const f of _.ingredients||[])f.item_id===e&&(f.previously_used!==void 0?i+=Number(f.previously_used||0):i+=Number(f.qty_required||0));u.available=r+i,u.previously_used=i,u.exceeds=u.total_required>u.available,u.balance=parseFloat((u.available-u.total_required).toFixed(6))}for(const e of g.products)for(const u of e.ingredients||[]){if(!u.item_id)continue;const a=s.get(u.item_id);a&&(u.available=a.available,u.exceeds=a.exceeds,u.balance=a.balance,u.previously_used=a.previously_used)}}const _t=s=>{Q.value=!0,ce.value=!1,te.value=!0,G.value=!0;const e=g.id;Ce(),Ve.value=s,gt(e)},zl=s=>{Q.value=!0,ce.value=!1,te.value=!0,G.value=!0,Ce(),gt(s.id)},gt=async s=>{try{const e=await fetch(`/productions/batches/${s}`),u=await e.json();if(!e.ok)throw new Error(u.message||"Failed to load batch for editing.");g.id=u.batch.id,g.notes=u.batch.notes||"",g.planned_at=Le(u.batch.planned_at),g.produced_at=Le(u.batch.produced_at),g.products=[],(u.products||[]).forEach(a=>{for(const i of we.value)i.id===a.product_id&&(i.editing=!0);const r=rt();r.production_id=a.production_id,r.product_id=a.product_id,r.product_name=a.product_name,r.planned_qty=a.qty_product||"",r.good_qty=a.good_qty||"",r.damaged_qty=a.damaged_qty||"",r.reject_qty=a.reject_qty||"",r.actual_qty=a.actual_qty||"",r.hasDiscrepancy=a.discrepancies.length>0,r.discrepancies=a.discrepancies||[],r.mode=a.mode||"by_product",g.staff=a.staff||[],(a.good_qty||a.damaged_qty||a.reject_qty)&&(xe.value=!0),r.mode==="by_product"?r.qty_product_input=Number(a.qty_product||0):(r.base_ingredient_id=a.base_ingredient_id||null,r.base_ingredient_qty=a.base_ingredient_qty||null),r.computed_qty_product=Number(a.qty_product||0)||0,g.products.push(r)}),g.products.length||Ee();for(const a of u.products||[]){de.value=a.ingredients.filter(f=>f.group_active===!1&&f.group_id!==null).map(f=>({product:a.product_id,group:f.group_id})),de.value.length&&(de.value=[...new Map(de.value.map(f=>[`${f.product}-${f.group}`,f])).values()]);const r=g.products.find(f=>f.production_id===a.production_id)||g.products.find(f=>f.product_id===a.product_id);if(!r||!r.product_id)continue;await ut(r);const i=a.group_choices||[];i.length?i.forEach(f=>{f.group_id&&f.combination_id&&(r.group_choices[f.group_id]=f.combination_id)}):Array.isArray(a.ingredients)&&a.ingredients.forEach(f=>{f.group_id&&f.combination_id&&(r.group_choices[f.group_id]=f.combination_id)});const _=JSON.parse(JSON.stringify(r.ingredients));if(Array.isArray(a.ingredients)&&a.ingredients.length){r.ingredients=[];for(const f of a.ingredients){if(Ve.value&&!_.find(re=>re.item_id===f.item_id))continue;const U=Number(f.qty_required||f.quantity||0);r.ingredients.push({item_id:f.item_id,item_name:f.item_name,unit:f.unit,qty_required:U,previously_used:U,from_group:!!f.group_id,group_id:f.group_id||null,group_name:f.group_name||null,combination_id:f.combination_id||null})}}Be.value.push(JSON.parse(JSON.stringify(r)))}W.value=g.products.length?0:"summary",fl(),ie()}catch(e){console.error("Failed to load batch for editing:",e),alert("Failed to load batch for editing."),te.value=!1}};async function yt(){R.value=!0;try{const s=g.products.map(_=>{const f=Object.entries(_.group_choices||{}).filter(([,U])=>U).map(([U,re])=>({group_id:Number(U),combination_id:re}));return{production_id:_.production_id||null,product_id:_.product_id,mode:_.mode,qty_product:_.computed_qty_product,good_qty:_.good_qty||0,damaged_qty:_.damaged_qty||0,reject_qty:_.reject_qty||0,actual_qty:_.actual_qty||0,discrepancies:_.discrepancies,base_ingredient_id:_.base_ingredient_id,base_ingredient_qty:_.base_ingredient_qty,ingredients:(_.ingredients||[]).map(U=>({item_id:U.item_id,qty_required:Number(U.qty_required||0),unit:U.unit,group_id:U.group_id||null,combination_id:U.combination_id||null})),group_choices:f}}),e={planned_at:He(g.planned_at),produced_at:g.produced_at?He(g.produced_at):null,notes:g.notes,products:s,staffs:g.staff.filter(_=>_.staff_id).map(_=>({staff_id:typeof _.staff_id=="object"?_.staff_id.id:_.staff_id,role:_.role||null,notes:_.notes||null}))},u=Q.value?`/productions/${g.id}`:"/productions",a=Q.value?"PUT":"POST",r=await fetch(u,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await r.json();if(!r.ok){i.error==="INSUFFICIENT_STOCK"?alert(`${i.message}
Available: ${i.details.available}
Required: ${i.details.required}`):alert(i.message||"Failed to save production.");return}te.value=!1,Ce(),await mt(),await me()}catch(s){console.error("Failed to save production:",s),alert("Failed to save production. Please try again.")}finally{R.value=!1}}return Dl(async()=>{await Promise.all([kl(),wl(),me(),ql(),mt()])}),(s,e)=>{const u=jl("VueDatePicker");return m(),y(Nl,{class:"production-container",fluid:""},{default:t(()=>[g.damaged_qty>0||g.reject_qty>0?(m(),y(ae,{key:0,border:"start",class:"mt-2",type:"warning",variant:"tonal"},{default:t(()=>e[32]||(e[32]=[d(" Some quantities were marked as damaged or reject — please ensure they're tracked in the ledger. ")])),_:1})):b("",!0),l(v,{class:"mb-6",elevation:"2",rounded:"lg"},{default:t(()=>[l(x,{class:"pa-6"},{default:t(()=>[o("div",Zl,[e[36]||(e[36]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold text-primary mb-2"}," Production Management "),o("p",{class:"text-body-1 text-grey"}," Manage production batches and individual productions ")],-1)),o("div",Xl,[s.$store.getters.hasTask("can_schedule_production")?(m(),y(h,{key:0,class:"px-6",color:"primary",elevation:"2",size:"large",onClick:Oe},{default:t(()=>[l(c,{size:"20",start:""},{default:t(()=>e[33]||(e[33]=[d("mdi-plus-circle")])),_:1}),e[34]||(e[34]=d(" New Production "))]),_:1})):b("",!0),l(h,{class:"px-6",color:"secondary",elevation:"2",size:"large",onClick:Xt},{default:t(()=>[l(c,{size:"20",start:""},{default:t(()=>e[35]||(e[35]=[d("mdi-view-grid")])),_:1}),d(" "+n(F.value?"Show Individual":"Show Batches"),1)]),_:1})])])]),_:1})]),_:1}),l(j,{class:"mb-6"},{default:t(()=>[l(p,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(v,{border:"",class:"stat-card",elevation:"2",rounded:"lg"},{default:t(()=>[l(x,{class:"pa-4"},{default:t(()=>[o("div",ea,[l(z,{class:"mr-3",color:"blue-lighten-5",size:"48"},{default:t(()=>[l(c,{color:"blue",size:"24"},{default:t(()=>e[37]||(e[37]=[d("mdi-factory")])),_:1})]),_:1}),o("div",null,[o("div",ta,n(F.value?ee.value.length:X.value.length),1),o("div",la,n(F.value?"Total Batches":"Total Productions"),1)])])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(v,{border:"",class:"stat-card",elevation:"2",rounded:"lg"},{default:t(()=>[l(x,{class:"pa-4"},{default:t(()=>[o("div",aa,[l(z,{class:"mr-3",color:"green-lighten-5",size:"48"},{default:t(()=>[l(c,{color:"green",size:"24"},{default:t(()=>e[38]||(e[38]=[d("mdi-account-group")])),_:1})]),_:1}),o("div",null,[o("div",oa,n(nl.value),1),e[39]||(e[39]=o("div",{class:"text-caption text-grey"},"Staff Assignments",-1))])])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(v,{border:"",class:"stat-card",elevation:"2",rounded:"lg"},{default:t(()=>[l(x,{class:"pa-4"},{default:t(()=>[o("div",da,[l(z,{class:"mr-3",color:"orange-lighten-5",size:"48"},{default:t(()=>[l(c,{color:"orange",size:"24"},{default:t(()=>e[40]||(e[40]=[d("mdi-chart-line")])),_:1})]),_:1}),o("div",null,[o("div",sa,n(il.value),1),e[41]||(e[41]=o("div",{class:"text-caption text-grey"},"Total Units (Planned)",-1))])])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(v,{border:"",class:"stat-card",elevation:"2",rounded:"lg"},{default:t(()=>[l(x,{class:"pa-4"},{default:t(()=>[o("div",ia,[l(z,{class:"mr-3",color:"purple-lighten-5",size:"48"},{default:t(()=>[l(c,{color:"purple",size:"24"},{default:t(()=>e[42]||(e[42]=[d("mdi-cash-multiple")])),_:1})]),_:1}),o("div",null,[o("div",na,n(rl.value),1),e[43]||(e[43]=o("div",{class:"text-caption text-grey"},"Labor Cost",-1))])])]),_:1})]),_:1})]),_:1})]),_:1}),F.value?(m(),y(v,{key:1,class:"mb-4",elevation:"2",rounded:"lg"},{default:t(()=>[l(x,{class:"pa-0"},{default:t(()=>[o("div",ra,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[44]||(e[44]=[d("mdi-view-grid")])),_:1}),e[45]||(e[45]=o("h3",{class:"text-h6 font-weight-medium"},"Production Batches",-1))]),l(v,{border:"",class:"pa-6 mb-6",elevation:"3",rounded:"lg"},{default:t(()=>[o("div",ua,[l(z,{class:"mr-3",color:"primary",size:"40",variant:"tonal"},{default:t(()=>[l(c,{color:"primary"},{default:t(()=>e[46]||(e[46]=[d("mdi-filter")])),_:1})]),_:1}),e[47]||(e[47]=o("div",null,[o("h3",{class:"text-h6 font-weight-bold text-primary"}," Batch Filters "),o("p",{class:"text-caption text-grey mt-1"}," Refine your batch records ")],-1)),l(le),l(w,{class:"mr-2",color:"primary",size:"small",variant:"flat"},{default:t(()=>[d(n(Zt.value)+" Active ",1)]),_:1})]),l(pe,{class:"mb-6"}),l(j,{class:"align-start",dense:""},{default:t(()=>[l(p,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[l(v,{border:"",class:"rounded-lg h-100",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",ca,[l(c,{class:"mr-2",color:"primary",size:"18"},{default:t(()=>e[48]||(e[48]=[d("mdi-package-variant")])),_:1}),e[49]||(e[49]=o("label",{class:"text-caption font-weight-medium text-primary"},"Product",-1))]),l(ge,{modelValue:B.product_id,"onUpdate:modelValue":e[0]||(e[0]=a=>B.product_id=a),clearable:"",color:"primary",density:"compact","hide-details":"","item-title":"name","item-value":"id",items:we.value,placeholder:"All Products",variant:"underlined"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[l(v,{border:"",class:"rounded-lg h-100",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",ma,[l(c,{class:"mr-2",color:"blue",size:"18"},{default:t(()=>e[50]||(e[50]=[d("mdi-progress-clock")])),_:1}),e[51]||(e[51]=o("label",{class:"text-caption font-weight-medium text-primary"},"Status",-1))]),l(ue,{modelValue:B.status,"onUpdate:modelValue":e[1]||(e[1]=a=>B.status=a),color:"primary",density:"compact","hide-details":"",items:Ot,placeholder:"Select Status",variant:"underlined"},{item:t(({item:a,props:r})=>[l(Y,zt(Pt(r)),{prepend:t(()=>[l(c,{color:a.raw.color||"grey"},{default:t(()=>[d(n(a.raw.icon),1)]),_:2},1032,["color"])]),_:2},1040)]),selection:t(({item:a})=>[o("div",fa,[l(c,{class:"mr-2",color:a.raw.color||"grey",size:"16"},{default:t(()=>[d(n(a.raw.icon),1)]),_:2},1032,["color"]),o("span",null,n(a.title),1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[l(v,{border:"",class:"rounded-lg h-100",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",pa,[l(c,{class:"mr-2",color:"purple",size:"18"},{default:t(()=>e[52]||(e[52]=[d("mdi-account-tie")])),_:1}),e[53]||(e[53]=o("label",{class:"text-caption font-weight-medium text-primary"},"Team Leader",-1))]),l(ge,{modelValue:B.team_leader,"onUpdate:modelValue":e[2]||(e[2]=a=>B.team_leader=a),clearable:"",color:"primary",density:"compact","hide-details":"","item-title":"name","item-value":"id",items:ze.value,placeholder:"All Leaders",variant:"underlined"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",lg:"6",md:"8"},{default:t(()=>[l(v,{border:"",class:"rounded-lg",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",_a,[l(c,{class:"mr-2",color:"green",size:"18"},{default:t(()=>e[54]||(e[54]=[d("mdi-calendar-clock")])),_:1}),e[55]||(e[55]=o("label",{class:"text-caption font-weight-medium text-primary"},"Planned Date Range",-1))]),l(j,{class:"align-center",dense:""},{default:t(()=>[l(p,{cols:"12",sm:"4"},{default:t(()=>[l(ue,{modelValue:B.planned_at_op,"onUpdate:modelValue":e[3]||(e[3]=a=>B.planned_at_op=a),color:"primary",density:"compact","hide-details":"",items:Ke,variant:"underlined"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",sm:"4"},{default:t(()=>[l(u,{modelValue:B.planned_at,"onUpdate:modelValue":e[4]||(e[4]=a=>B.planned_at=a),"auto-apply":"",format:"dd-MM-yyyy","model-type":"format",placeholder:"Start Date",teleport:!0},null,8,["modelValue"])]),_:1}),B.planned_at_op==="in"?(m(),y(p,{key:0,cols:"12",sm:"4"},{default:t(()=>[l(u,{modelValue:B.planned_end,"onUpdate:modelValue":e[5]||(e[5]=a=>B.planned_end=a),"auto-apply":"",format:"dd-MM-yyyy","model-type":"format",placeholder:"End Date",teleport:!0},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(pe,{class:"mt-4 mb-4"}),o("div",ga,[o("div",ya,[l(c,{class:"mr-1",size:"14"},{default:t(()=>e[56]||(e[56]=[d("mdi-information")])),_:1}),e[57]||(e[57]=d(" Use filters to find specific batch records "))]),o("div",va,[l(h,{class:"px-4",color:"grey",variant:"outlined",onClick:el},{default:t(()=>[l(c,{size:"18",start:""},{default:t(()=>e[58]||(e[58]=[d("mdi-refresh")])),_:1}),e[59]||(e[59]=d(" Reset All "))]),_:1}),l(h,{class:"px-4",color:"primary",elevation:"2",onClick:tl},{default:t(()=>[l(c,{size:"18",start:""},{default:t(()=>e[60]||(e[60]=[d("mdi-filter-check")])),_:1}),e[61]||(e[61]=d(" Apply Filters "))]),_:1})])])]),_:1}),l(Ct,{active:O.value,color:"primary",height:"4",indeterminate:O.value},null,8,["active","indeterminate"]),l(It,{"items-per-page":Z.value,"onUpdate:itemsPerPage":e[6]||(e[6]=a=>Z.value=a),page:J.value,"onUpdate:page":e[7]||(e[7]=a=>J.value=a),class:"elevation-0",density:"comfortable",headers:Lt,hover:"",items:ee.value,"items-length":ye.value,loading:O.value,search:Ye.value,"onUpdate:options":me},{loading:t(()=>[l(Dt,{type:"table-row@10"})]),"item.status":t(({item:a})=>[l(w,{class:"font-weight-bold text-uppercase",color:Ze(a.status),size:"small",variant:"flat"},{default:t(()=>[d(n(Xe(a.status)),1)]),_:2},1032,["color"])]),"item.batch_code":t(({item:a})=>[o("div",ba,[l(z,{class:"mr-3",color:"primary",size:"32",variant:"tonal"},{default:t(()=>[l(c,{color:"primary",size:"16"},{default:t(()=>e[62]||(e[62]=[d("mdi-package-variant")])),_:1})]),_:1}),o("div",null,[o("div",xa,n(a.batch_code),1),o("div",Va,n(a.total_products)+" products ",1)])])]),"item.production_stats":t(({item:a})=>[o("div",wa,[l(w,{class:"mr-1 mb-1",color:"green",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(a.total_good_qty||0)+" good ",1)]),_:2},1024),l(w,{class:"mr-1 mb-1",color:"orange",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(a.total_damaged_qty||0)+" damaged ",1)]),_:2},1024),l(w,{class:"mb-1",color:"red",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(a.total_reject_qty||0)+" reject ",1)]),_:2},1024)])]),"item.planned_at":t(({item:a})=>[o("div",ka,n(se(a.planned_at)),1)]),"item.produced_at":t(({item:a})=>[o("div",qa,n(se(a.produced_at)||"Not completed"),1)]),"item.team_leader_name":t(({item:a})=>[o("div",ha,[l(z,{class:"mr-2",color:"blue-grey-lighten-5",size:"28"},{default:t(()=>[l(c,{color:"blue-grey",size:"14"},{default:t(()=>e[63]||(e[63]=[d("mdi-account-tie")])),_:1})]),_:1}),o("span",za,n(a.team_leader_name),1)])]),"item.actions":t(({item:a})=>[o("div",Pa,[l(St,{"close-on-content-click":!1,location:"bottom end",transition:"scale-transition"},{activator:t(({props:r})=>[l(h,he(r,{class:"action-menu-btn",color:"primary",icon:"",size:"small",variant:"text"}),{default:t(()=>[l(c,null,{default:t(()=>e[64]||(e[64]=[d("mdi-dots-vertical")])),_:1})]),_:2},1040)]),default:t(()=>[l(v,{elevation:"8","min-width":"240",rounded:"lg"},{default:t(()=>[l(x,{class:ne(["pa-4",Jt(a.status)])},{default:t(()=>[o("div",Ca,[o("div",Aa,[l(z,{class:"mr-3",color:"white",size:"32",variant:"tonal"},{default:t(()=>[l(c,{color:"primary",size:"18"},{default:t(()=>e[65]||(e[65]=[d(" mdi-package-variant ")])),_:1})]),_:1}),o("div",null,[e[66]||(e[66]=o("div",{class:"text-white text-body-2 font-weight-bold"}," Batch Actions ",-1)),o("div",Ua,n(a.batch_code),1)])]),l(w,{color:"white",size:"small",variant:"flat"},{default:t(()=>[d(n(a.status),1)]),_:2},1024)])]),_:2},1032,["class"]),l(_e,{class:"pa-2",density:"compact"},{default:t(()=>[s.$store.getters.hasTask("can_see_production")?(m(),y(Y,{key:0,class:"rounded-lg mb-1 action-item",onClick:r=>et(a)},{prepend:t(()=>[l(z,{class:"mr-3",color:"blue-lighten-5",size:"36",variant:"flat"},{default:t(()=>[l(c,{color:"blue",size:"18"},{default:t(()=>e[67]||(e[67]=[d(" mdi-eye-outline ")])),_:1})]),_:1})]),default:t(()=>[l(K,{class:"text-body-2 font-weight-medium"},{default:t(()=>e[68]||(e[68]=[d(" View Batch Details ")])),_:1}),l(L,{class:"text-caption text-blue"},{default:t(()=>e[69]||(e[69]=[d(" Complete batch information ")])),_:1})]),_:2},1032,["onClick"])):b("",!0),a.produced_count>0&&s.$store.getters.hasTask("can_edit_actual_production")||a.produced_count<=0&&s.$store.getters.hasTask("can_add_actual_production")?(m(),y(Y,{key:1,class:"rounded-lg mb-1 action-item",onClick:r=>ll(a)},{prepend:t(()=>[l(z,{class:"mr-3",color:"green-lighten-5",size:"36",variant:"flat"},{default:t(()=>[l(c,{color:"green",size:"18"},{default:t(()=>e[70]||(e[70]=[d(" mdi-plus-circle ")])),_:1})]),_:1})]),default:t(()=>[a.produced_count>0?(m(),C(T,{key:0},[l(K,{class:"text-body-2 font-weight-medium"},{default:t(()=>e[71]||(e[71]=[d(" Edit Actual Production ")])),_:1}),l(L,{class:"text-caption text-green"},{default:t(()=>e[72]||(e[72]=[d(" Edit Recorded output for all products ")])),_:1})],64)):(m(),C(T,{key:1},[l(K,{class:"text-body-2 font-weight-medium"},{default:t(()=>e[73]||(e[73]=[d(" Add Actual Production ")])),_:1}),l(L,{class:"text-caption text-green"},{default:t(()=>e[74]||(e[74]=[d(" Record output for all products ")])),_:1})],64))]),_:2},1032,["onClick"])):b("",!0),s.$store.getters.hasTask("can_edit_production")?(m(),y(Y,{key:2,class:"rounded-lg mb-1 action-item",onClick:r=>zl(a)},{prepend:t(()=>[l(z,{class:"mr-3",color:"orange-lighten-5",size:"36",variant:"flat"},{default:t(()=>[l(c,{color:"orange",size:"18"},{default:t(()=>e[75]||(e[75]=[d(" mdi-pencil-outline ")])),_:1})]),_:1})]),default:t(()=>[l(K,{class:"text-body-2 font-weight-medium"},{default:t(()=>e[76]||(e[76]=[d(" Edit Batch ")])),_:1}),l(L,{class:"text-caption text-orange"},{default:t(()=>e[77]||(e[77]=[d(" Modify batch products & staff ")])),_:1})]),_:2},1032,["onClick"])):b("",!0),l(Y,{class:"rounded-lg mb-1 action-item",onClick:r=>ol(a)},{prepend:t(()=>[l(z,{class:"mr-3",color:"purple-lighten-5",size:"36",variant:"flat"},{default:t(()=>[l(c,{color:"purple",size:"18"},{default:t(()=>e[78]||(e[78]=[d(" mdi-format-list-bulleted ")])),_:1})]),_:1})]),default:t(()=>[l(K,{class:"text-body-2 font-weight-medium"},{default:t(()=>e[79]||(e[79]=[d(" View Products ")])),_:1}),l(L,{class:"text-caption text-purple"},{default:t(()=>e[80]||(e[80]=[d(" See all products in batch ")])),_:1})]),_:2},1032,["onClick"]),l(pe,{class:"my-2"}),s.$store.getters.hasTask("can_delete_production")?(m(),y(Y,{key:3,class:"rounded-lg action-item text-error",onClick:r=>dl(a)},{prepend:t(()=>[l(z,{class:"mr-3",color:"red-lighten-5",size:"36",variant:"flat"},{default:t(()=>[l(c,{color:"red",size:"18"},{default:t(()=>e[81]||(e[81]=[d(" mdi-delete-outline ")])),_:1})]),_:1})]),default:t(()=>[l(K,{class:"text-body-2 font-weight-medium text-error"},{default:t(()=>e[82]||(e[82]=[d(" Delete Batch ")])),_:1}),l(L,{class:"text-caption text-red"},{default:t(()=>e[83]||(e[83]=[d(" Remove permanently ")])),_:1})]),_:2},1032,["onClick"])):b("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[o("div",Sa,[l(c,{class:"mb-4",color:"grey-lighten-2",size:"64"},{default:t(()=>e[84]||(e[84]=[d(" mdi-inbox ")])),_:1}),e[87]||(e[87]=o("div",{class:"text-h6 text-grey"},"No batches found",-1)),e[88]||(e[88]=o("div",{class:"text-body-2 text-grey mt-2"}," Get started by creating your first production batch ",-1)),l(h,{class:"mt-4",color:"primary",onClick:Oe},{default:t(()=>[l(c,{start:""},{default:t(()=>e[85]||(e[85]=[d("mdi-plus")])),_:1}),e[86]||(e[86]=d(" Create Production "))]),_:1})])]),_:1},8,["items-per-page","page","items","items-length","loading","search"])]),_:1})]),_:1})):(m(),y(v,{key:2,class:"mb-4",elevation:"2",rounded:"lg"},{default:t(()=>[l(x,{class:"pa-0"},{default:t(()=>[o("div",Ia,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[89]||(e[89]=[d("mdi-table")])),_:1}),e[90]||(e[90]=o("h3",{class:"text-h6 font-weight-medium"},"Production Records",-1))]),l(v,{border:"",class:"pa-6 mb-6",elevation:"3",rounded:"lg"},{default:t(()=>[o("div",Da,[l(z,{class:"mr-3",color:"primary",size:"40",variant:"tonal"},{default:t(()=>[l(c,{color:"primary"},{default:t(()=>e[91]||(e[91]=[d("mdi-filter")])),_:1})]),_:1}),e[92]||(e[92]=o("div",null,[o("h3",{class:"text-h6 font-weight-bold text-primary"}," Production Filters "),o("p",{class:"text-caption text-grey mt-1"}," Refine your production records ")],-1)),l(le),l(w,{class:"mr-2",color:"primary",size:"small",variant:"flat"},{default:t(()=>[d(n(Wt.value)+" Active ",1)]),_:1})]),l(pe,{class:"mb-6"}),l(j,{class:"align-start",dense:""},{default:t(()=>[l(p,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[l(v,{border:"",class:"rounded-lg h-100",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",ja,[l(c,{class:"mr-2",color:"primary",size:"18"},{default:t(()=>e[93]||(e[93]=[d("mdi-package-variant")])),_:1}),e[94]||(e[94]=o("label",{class:"text-caption font-weight-medium text-primary"},"Product",-1))]),l(ge,{modelValue:$.product_id,"onUpdate:modelValue":e[8]||(e[8]=a=>$.product_id=a),clearable:"",color:"primary",density:"compact","hide-details":"","item-title":"name","item-value":"id",items:we.value,placeholder:"All Products",variant:"underlined"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[l(v,{border:"",class:"rounded-lg h-100",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",Na,[l(c,{class:"mr-2",color:"blue",size:"18"},{default:t(()=>e[95]||(e[95]=[d("mdi-progress-clock")])),_:1}),e[96]||(e[96]=o("label",{class:"text-caption font-weight-medium text-primary"},"Status",-1))]),l(ue,{modelValue:$.status,"onUpdate:modelValue":e[9]||(e[9]=a=>$.status=a),color:"primary",density:"compact","hide-details":"",items:Et,placeholder:"Select Status",variant:"underlined"},{item:t(({item:a,props:r})=>[l(Y,zt(Pt(r)),{prepend:t(()=>[l(c,{color:a.raw.color||"grey"},{default:t(()=>[d(n(a.raw.icon),1)]),_:2},1032,["color"])]),_:2},1040)]),selection:t(({item:a})=>[o("div",Ta,[l(c,{class:"mr-2",color:a.raw.color||"grey",size:"16"},{default:t(()=>[d(n(a.raw.icon),1)]),_:2},1032,["color"]),o("span",null,n(a.title),1)])]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",lg:"3",md:"4",sm:"6"},{default:t(()=>[l(v,{border:"",class:"rounded-lg h-100",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",$a,[l(c,{class:"mr-2",color:"purple",size:"18"},{default:t(()=>e[97]||(e[97]=[d("mdi-account-tie")])),_:1}),e[98]||(e[98]=o("label",{class:"text-caption font-weight-medium text-primary"},"Team Leader",-1))]),l(ge,{modelValue:$.team_leader,"onUpdate:modelValue":e[10]||(e[10]=a=>$.team_leader=a),clearable:"",color:"primary",density:"compact","hide-details":"","item-title":"name","item-value":"id",items:ze.value,placeholder:"All Leaders",variant:"underlined"},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",lg:"6",md:"8"},{default:t(()=>[l(v,{border:"",class:"rounded-lg",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",Ba,[l(c,{class:"mr-2",color:"green",size:"18"},{default:t(()=>e[99]||(e[99]=[d("mdi-calendar-clock")])),_:1}),e[100]||(e[100]=o("label",{class:"text-caption font-weight-medium text-primary"},"Planned Date Range",-1))]),l(j,{class:"align-center",dense:""},{default:t(()=>[l(p,{cols:"12",sm:"4"},{default:t(()=>[l(ue,{modelValue:$.planned_at_op,"onUpdate:modelValue":e[11]||(e[11]=a=>$.planned_at_op=a),color:"primary",density:"compact","hide-details":"",items:Ke,variant:"underlined"},null,8,["modelValue"])]),_:1}),l(p,{cols:"12",sm:"4"},{default:t(()=>[l(u,{modelValue:$.planned_at,"onUpdate:modelValue":e[12]||(e[12]=a=>$.planned_at=a),"auto-apply":"",format:"dd-MM-yyyy","model-type":"format",placeholder:"Start Date",teleport:!0},null,8,["modelValue"])]),_:1}),$.planned_at_op==="in"?(m(),y(p,{key:0,cols:"12",sm:"4"},{default:t(()=>[l(u,{modelValue:$.planned_end,"onUpdate:modelValue":e[13]||(e[13]=a=>$.planned_end=a),"auto-apply":"",format:"dd-MM-yyyy","model-type":"format",placeholder:"End Date",teleport:!0},null,8,["modelValue"])]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(pe,{class:"mt-4 mb-4"}),o("div",Ma,[o("div",Ra,[l(c,{class:"mr-1",size:"14"},{default:t(()=>e[101]||(e[101]=[d("mdi-information")])),_:1}),e[102]||(e[102]=d(" Use filters to find specific production records "))]),o("div",Fa,[l(h,{class:"px-4",color:"grey",variant:"outlined",onClick:bl},{default:t(()=>[l(c,{size:"18",start:""},{default:t(()=>e[103]||(e[103]=[d("mdi-refresh")])),_:1}),e[104]||(e[104]=d(" Reset All "))]),_:1}),l(h,{class:"px-4",color:"primary",elevation:"2",onClick:xl},{default:t(()=>[l(c,{size:"18",start:""},{default:t(()=>e[105]||(e[105]=[d("mdi-filter-check")])),_:1}),e[106]||(e[106]=d(" Apply Filters "))]),_:1})])])]),_:1}),l(Ct,{active:O.value,color:"primary",height:"4",indeterminate:O.value},null,8,["active","indeterminate"]),l(It,{"items-per-page":Z.value,"onUpdate:itemsPerPage":e[14]||(e[14]=a=>Z.value=a),page:J.value,"onUpdate:page":e[15]||(e[15]=a=>J.value=a),class:"elevation-0",density:"comfortable",headers:Qt,hover:"",items:X.value,"items-length":ye.value,loading:O.value,search:Ye.value,"onUpdate:options":me},{loading:t(()=>[l(Dt,{type:"table-row@10"})]),"item.status":t(({item:a})=>[l(w,{class:"font-weight-bold text-uppercase",color:a.produced_at?"green":"red",size:"small",variant:"flat"},{default:t(()=>[d(n(a.produced_at?"Completed":"Pending"),1)]),_:2},1032,["color"])]),"item.product_name":t(({item:a})=>[o("div",Ga,[l(z,{class:"mr-3",color:"primary",size:"32",variant:"tonal"},{default:t(()=>[l(c,{color:"primary",size:"16"},{default:t(()=>e[107]||(e[107]=[d("mdi-package")])),_:1})]),_:1}),o("div",null,[o("div",Ea,n(a.product_name||a.batch_label),1),o("div",Oa,n(a.mode||"Multiple Products"),1)])])]),"item.qty_product":t(({item:a})=>[l(w,{color:"green",size:"small",variant:"flat"},{default:t(()=>[l(c,{size:"16",start:""},{default:t(()=>e[108]||(e[108]=[d("mdi-counter")])),_:1}),d(" "+n(parseFloat(a.qty_product||a.total_qty||0)),1)]),_:2},1024)]),"item.staff_count":t(({item:a})=>[o("div",La,[l(z,{class:"mr-2",color:"blue-lighten-5",size:"28"},{default:t(()=>[l(c,{color:"blue",size:"14"},{default:t(()=>e[109]||(e[109]=[d("mdi-account-group")])),_:1})]),_:1}),o("span",Ha,n(a.staff_count||0),1)])]),"item.planned_at":t(({item:a})=>[o("div",Qa,n(a.planned_at),1)]),"item.produced_at":t(({item:a})=>[o("div",Ya,n(a.produced_at),1)]),"item.produced_by_name":t(({item:a})=>[o("div",Ja,[l(z,{class:"mr-2",color:"blue-grey-lighten-5",size:"28"},{default:t(()=>[l(c,{color:"blue-grey",size:"14"},{default:t(()=>e[110]||(e[110]=[d("mdi-account")])),_:1})]),_:1}),o("span",Ka,n(a.produced_by_name),1)])]),"item.actions":t(({item:a})=>[o("div",Wa,[l(St,{"close-on-content-click":!1,location:"bottom end",transition:"scale-transition"},{activator:t(({props:r})=>[l(h,he(r,{class:"action-menu-btn",color:"primary",icon:"",size:"small",variant:"text"}),{default:t(()=>[a.produced_at?(m(),y(c,{key:1},{default:t(()=>e[112]||(e[112]=[d("mdi-dots-vertical")])),_:1})):(m(),y(Ml,{key:0,color:"orange",dot:"",location:"top end","offset-x":"2","offset-y":"2"},{default:t(()=>[l(c,null,{default:t(()=>e[111]||(e[111]=[d("mdi-dots-vertical")])),_:1})]),_:1}))]),_:2},1040)]),default:t(()=>[l(v,{elevation:"8","min-width":"240",rounded:"lg"},{default:t(()=>[l(x,{class:ne(["pa-4",Kt(a.produced_at?"completed":"pending")])},{default:t(()=>[o("div",Za,[o("div",Xa,[l(z,{class:"mr-3",color:"white",size:"32",variant:"tonal"},{default:t(()=>[l(c,{color:"primary",size:"18"},{default:t(()=>e[113]||(e[113]=[d(" mdi-factory ")])),_:1})]),_:1}),o("div",null,[e[114]||(e[114]=o("div",{class:"text-white text-body-2 font-weight-bold"}," Production Actions ",-1)),o("div",eo,n(a.product_name||"Batch"),1)])]),l(w,{color:"white",size:"small",variant:"flat"},{default:t(()=>[d(n(a.produced_at?"completed":"pending"),1)]),_:2},1024)])]),_:2},1032,["class"]),l(_e,{class:"pa-2",density:"compact"},{default:t(()=>[l(Y,{class:"rounded-lg mb-1 action-item",onClick:r=>ft(a)},{prepend:t(()=>[l(z,{class:"mr-3",color:"blue-lighten-5",size:"36",variant:"flat"},{default:t(()=>[l(c,{color:"blue",size:"18"},{default:t(()=>e[115]||(e[115]=[d(" mdi-eye-outline ")])),_:1})]),_:1})]),default:t(()=>[l(K,{class:"text-body-2 font-weight-medium"},{default:t(()=>e[116]||(e[116]=[d(" View Details ")])),_:1}),l(L,{class:"text-caption text-blue"},{default:t(()=>e[117]||(e[117]=[d(" Complete information ")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)])]),"no-data":t(()=>[o("div",to,[l(c,{class:"mb-4",color:"grey-lighten-2",size:"64"},{default:t(()=>e[118]||(e[118]=[d(" mdi-inbox ")])),_:1}),e[121]||(e[121]=o("div",{class:"text-h6 text-grey"},"No productions found",-1)),e[122]||(e[122]=o("div",{class:"text-body-2 text-grey mt-2"}," Get started by creating your first production record ",-1)),l(h,{class:"mt-4",color:"primary",onClick:Oe},{default:t(()=>[l(c,{start:""},{default:t(()=>e[119]||(e[119]=[d("mdi-plus")])),_:1}),e[120]||(e[120]=d(" Create Production "))]),_:1})])]),_:1},8,["items-per-page","page","items","items-length","loading","search"])]),_:1})]),_:1})),l(Ne,{modelValue:be.value,"onUpdate:modelValue":e[17]||(e[17]=a=>be.value=a),"max-width":"1200",scrollable:"",transition:"dialog-bottom-transition"},{default:t(()=>[l(v,{class:"rounded-xl",elevation:"16"},{default:t(()=>[l(Ie,{class:"rounded-t-xl",color:"primary",density:"comfortable"},{default:t(()=>[l(z,{class:"mr-3",color:"white",size:"36"},{default:t(()=>[l(c,{color:"primary"},{default:t(()=>e[123]||(e[123]=[d("mdi-package-variant")])),_:1})]),_:1}),l(De,{class:"text-h5 font-weight-bold text-white"},{default:t(()=>{var a;return[d(" Batch Details - "+n((a=S.value)==null?void 0:a.batch_code),1)]}),_:1}),l(le),l(h,{color:"white",icon:"mdi-close",variant:"text",onClick:e[16]||(e[16]=a=>be.value=!1)})]),_:1}),l(x,{class:"pa-6"},{default:t(()=>{var a,r;return[l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>[l(j,null,{default:t(()=>[l(p,{cols:"12",md:"4"},{default:t(()=>{var i;return[e[124]||(e[124]=o("div",{class:"text-body-2 text-grey"},"Batch Code",-1)),o("div",lo,n((i=S.value)==null?void 0:i.batch_code),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var i;return[e[125]||(e[125]=o("div",{class:"text-body-2 text-grey"},"Status",-1)),l(w,{class:"mt-1",color:Ze((i=S.value)==null?void 0:i.status),size:"small"},{default:t(()=>{var _;return[d(n(Xe((_=S.value)==null?void 0:_.status)),1)]}),_:1},8,["color"])]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var i;return[e[126]||(e[126]=o("div",{class:"text-body-2 text-grey"},"Planned By",-1)),o("div",ao,n((i=S.value)==null?void 0:i.created_by_name),1)]}),_:1})]),_:1}),l(j,{class:"mt-2"},{default:t(()=>[l(p,{cols:"12",md:"4"},{default:t(()=>{var i;return[e[127]||(e[127]=o("div",{class:"text-body-2 text-grey"},"Planned At",-1)),o("div",oo,n(se((i=S.value)==null?void 0:i.planned_at)),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var i;return[e[128]||(e[128]=o("div",{class:"text-body-2 text-grey"},"Produced At",-1)),o("div",so,n(se((i=S.value)==null?void 0:i.produced_at)||"Not completed"),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var i;return[e[129]||(e[129]=o("div",{class:"text-body-2 text-grey"},"Team Leader",-1)),o("div",io,n((i=S.value)==null?void 0:i.team_leader_name),1)]}),_:1})]),_:1}),l(j,{class:"mt-4"},{default:t(()=>[l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var i;return[o("div",no,n(((i=S.value)==null?void 0:i.total_good_qty)||0),1),e[130]||(e[130]=o("div",{class:"text-caption text-grey"},"Good Quantity",-1))]}),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var i;return[o("div",ro,n(((i=S.value)==null?void 0:i.total_damaged_qty)||0),1),e[131]||(e[131]=o("div",{class:"text-caption text-grey"},"Damaged",-1))]}),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var i;return[o("div",uo,n(((i=S.value)==null?void 0:i.total_reject_qty)||0),1),e[132]||(e[132]=o("div",{class:"text-caption text-grey"},"Reject",-1))]}),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var i;return[o("div",co,n(((i=S.value)==null?void 0:i.total_products)||0),1),e[133]||(e[133]=o("div",{class:"text-caption text-grey"},"Total Products",-1))]}),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(v,{class:"rounded-lg",variant:"outlined"},{default:t(()=>[l(qe,{class:"d-flex align-center"},{default:t(()=>[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[134]||(e[134]=[d("mdi-format-list-bulleted")])),_:1}),e[135]||(e[135]=d(" Products in Batch "))]),_:1}),l(x,{class:"pa-0"},{default:t(()=>{var i;return[l(je,{class:"elevation-0",headers:Ht,items:((i=S.value)==null?void 0:i.products)||[]},{"item.product_name":t(({item:_})=>[o("div",mo,[l(z,{class:"mr-3",color:"primary",size:"32",variant:"tonal"},{default:t(()=>[l(c,{color:"primary",size:"16"},{default:t(()=>e[136]||(e[136]=[d("mdi-package")])),_:1})]),_:1}),o("div",null,[o("div",fo,n(_.product_name),1),o("div",po," Planned: "+n(_.qty_product)+" units ",1)])])]),"item.produced":t(({item:_})=>[l(w,{color:_.produced_at?"green":"orange",size:"small",variant:"flat"},{default:t(()=>[d(n(_.produced_at?"Produced":"Pending"),1)]),_:2},1032,["color"])]),"item.good_qty":t(({item:_})=>[_.produced_at?(m(),C("div",_o,[o("span",go,n(_.good_qty||0)+" good",1),o("span",yo,n(_.damaged_qty||0)+" damaged",1),o("span",vo,n(_.reject_qty||0)+" reject",1)])):(m(),C("span",bo,"Not produced"))]),"item.actions":t(({item:_})=>[_.production_id?(m(),y(h,{key:0,color:"primary",size:"small",variant:"text",onClick:f=>sl(_.production_id)},{default:t(()=>[l(c,{size:"16"},{default:t(()=>e[137]||(e[137]=[d("mdi-eye")])),_:1}),e[138]||(e[138]=d(" View "))]),_:2},1032,["onClick"])):b("",!0)]),_:1},8,["items"])]}),_:1})]),_:1}),(r=(a=S.value)==null?void 0:a.staff)!=null&&r.length?(m(),y(v,{key:0,class:"rounded-lg mb-4",variant:"outlined"},{default:t(()=>[l(qe,{class:"d-flex align-center"},{default:t(()=>[l(c,{class:"mr-2",color:"blue"},{default:t(()=>e[139]||(e[139]=[d("mdi-account-group")])),_:1}),e[140]||(e[140]=d(" Staff Assignments ")),l(w,{class:"ml-2",color:"blue",size:"small",variant:"flat"},{default:t(()=>[d(n(S.value.staff.length)+" staff ",1)]),_:1})]),_:1}),l(x,{class:"pa-0"},{default:t(()=>[l(_e,{class:"pa-0",lines:"two"},{default:t(()=>[(m(!0),C(T,null,H(S.value.staff,(i,_)=>(m(),y(Y,{key:i.staff_id,class:ne(["px-4",{"bg-grey-lighten-4":_%2===0}])},{prepend:t(()=>[l(z,{class:"mr-3",color:"blue",size:"36"},{default:t(()=>[o("span",xo,n(_+1),1)]),_:2},1024)]),default:t(()=>[l(K,{class:"font-weight-medium"},{default:t(()=>[d(n(i.staff_name)+" ",1),l(w,{class:"ml-2",color:pt(i.role),size:"x-small",variant:"flat"},{default:t(()=>[d(n(i.role),1)]),_:2},1032,["color"])]),_:2},1024),l(L,{class:"mt-1"},{default:t(()=>[i.notes?(m(),C("span",Vo,n(i.notes),1)):(m(),C("span",wo," No notes "))]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})]),_:1})):b("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ne,{modelValue:oe.value,"onUpdate:modelValue":e[20]||(e[20]=a=>oe.value=a),"max-width":"1000",persistent:"",scrollable:""},{default:t(()=>[l(v,{class:"rounded-xl",elevation:"16"},{default:t(()=>[l(Ie,{class:"rounded-t-xl",color:"primary",density:"comfortable"},{default:t(()=>[l(z,{class:"mr-3",color:"white",size:"36"},{default:t(()=>[l(c,{color:"primary"},{default:t(()=>e[141]||(e[141]=[d("mdi-plus-circle")])),_:1})]),_:1}),l(De,{class:"text-h5 font-weight-bold text-white"},{default:t(()=>{var a;return[d(" Add Actual Production - "+n((a=S.value)==null?void 0:a.batch_code),1)]}),_:1}),l(le),l(h,{color:"white",icon:"mdi-close",variant:"text",onClick:Re})]),_:1}),l(x,{class:"pa-6"},{default:t(()=>[l(jt,{onSubmit:At(lt,["prevent"])},{default:t(()=>[l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>[o("div",ko,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[142]||(e[142]=[d("mdi-calendar-clock")])),_:1}),e[143]||(e[143]=o("h4",{class:"text-h6 font-weight-medium"}," Production Information ",-1))]),l(j,{dense:""},{default:t(()=>[l(p,{cols:"12",md:"6"},{default:t(()=>[o("div",qo,[D.produced_at?(m(),C("span",ho," Actual Production Date & Time ")):b("",!0),l(u,{modelValue:D.produced_at,"onUpdate:modelValue":e[18]||(e[18]=a=>D.produced_at=a),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100","enable-time-picker":!0,format:"dd-MM-yyyy HH:mm","model-type":"format",placeholder:"Select Actual Production Date & Time",teleport:!0},null,8,["modelValue"])])]),_:1}),l(p,{cols:"12",md:"6"},{default:t(()=>[l(M,{modelValue:D.notes,"onUpdate:modelValue":e[19]||(e[19]=a=>D.notes=a),color:"primary",label:"Production Notes (optional)","prepend-inner-icon":"mdi-note-text",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>[o("div",zo,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[144]||(e[144]=[d("mdi-scale-balance")])),_:1}),e[145]||(e[145]=o("h4",{class:"text-h6 font-weight-medium"}," Actual Production Quantities ",-1))]),D.products.some(a=>a.hasDiscrepancy)?(m(),y(ae,{key:0,border:"start",class:"mb-4",type:"warning",variant:"tonal"},{default:t(()=>e[146]||(e[146]=[d(" Some products have discrepancies between planned and actual quantities. ")])),_:1})):b("",!0),(m(!0),C(T,null,H(D.products,(a,r)=>(m(),y(v,{key:a.production_id,class:"mb-4",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-4"},{default:t(()=>[o("div",Po,[l(z,{class:"mr-3",color:"primary",size:"32",variant:"tonal"},{default:t(()=>[l(c,{color:"primary",size:"16"},{default:t(()=>e[147]||(e[147]=[d("mdi-package")])),_:1})]),_:1}),o("div",null,[o("div",Co,n(a.product_name),1),o("div",Ao," Planned: "+n(a.planned_qty)+" units ",1)]),l(le),l(w,{color:a.hasDiscrepancy?"orange":"green",size:"small",variant:"flat"},{default:t(()=>[d(n(a.hasDiscrepancy?"Discrepancy":"On Track"),1)]),_:2},1032,["color"])]),l(j,{dense:""},{default:t(()=>[l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.good_qty,"onUpdate:modelValue":i=>a.good_qty=i,modelModifiers:{number:!0},color:"green",density:"compact",label:`Good Quantity (${a.planned_qty} planned)`,type:"number",variant:"outlined",onInput:i=>ke(a)},{"prepend-inner":t(()=>[l(c,{color:"green",size:"20"},{default:t(()=>e[148]||(e[148]=[d("mdi-check-decagram")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","label","onInput"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.damaged_qty,"onUpdate:modelValue":i=>a.damaged_qty=i,modelModifiers:{number:!0},color:"orange",density:"compact",label:"Damaged Quantity",type:"number",variant:"outlined",onInput:i=>ke(a)},{"prepend-inner":t(()=>[l(c,{color:"orange",size:"20"},{default:t(()=>e[149]||(e[149]=[d("mdi-alert-circle-outline")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.reject_qty,"onUpdate:modelValue":i=>a.reject_qty=i,modelModifiers:{number:!0},color:"red",density:"compact",label:"Reject Quantity",type:"number",variant:"outlined",onInput:i=>ke(a)},{"prepend-inner":t(()=>[l(c,{color:"red",size:"20"},{default:t(()=>e[150]||(e[150]=[d("mdi-close-octagon-outline")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.actual_qty,"onUpdate:modelValue":i=>a.actual_qty=i,modelModifiers:{number:!0},color:"primary",density:"compact",label:"Total Actual",readonly:"",type:"number",variant:"outlined"},{"prepend-inner":t(()=>[l(c,{color:"primary",size:"20"},{default:t(()=>e[151]||(e[151]=[d("mdi-counter")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a.hasDiscrepancy?(m(),C(T,{key:0},[l(pe,{class:"my-3"}),o("div",Uo,[l(w,{color:"orange",size:"small",variant:"flat"},{default:t(()=>[d(" Discrepancy: "+n(Math.abs(a.planned_qty-a.good_qty))+" units ",1)]),_:2},1024)]),(m(!0),C(T,null,H(a.discrepancies,(i,_)=>(m(),y(j,{key:_,class:"align-center mb-2"},{default:t(()=>[l(p,{cols:"12",md:"5"},{default:t(()=>[l(ue,{modelValue:i.reason_id,"onUpdate:modelValue":f=>i.reason_id=f,density:"compact","item-title":"name","item-value":"id",items:Me.value,label:"Reason","prepend-inner-icon":"mdi-alert-circle-outline",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(p,{cols:"12",md:"5"},{default:t(()=>[l(M,{modelValue:i.notes,"onUpdate:modelValue":f=>i.notes=f,density:"compact",label:"Notes",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{class:"text-right",cols:"12",md:"2"},{default:t(()=>[l(h,{color:"error",icon:"",size:"small",variant:"text",onClick:f=>tt(a,_)},{default:t(()=>[l(c,null,{default:t(()=>e[152]||(e[152]=[d("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l(h,{color:"primary",size:"small",variant:"outlined",onClick:i=>Fe(a)},{default:t(()=>[l(c,{start:""},{default:t(()=>e[153]||(e[153]=[d("mdi-plus")])),_:1}),e[154]||(e[154]=d(" Add Reason "))]),_:2},1032,["onClick"])],64)):b("",!0)]),_:2},1024)]),_:2},1024))),128))]),_:1}),l(v,{class:"rounded-lg pa-4",variant:"outlined"},{default:t(()=>[o("div",So,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[155]||(e[155]=[d("mdi-chart-box")])),_:1}),e[156]||(e[156]=o("h4",{class:"text-h6 font-weight-medium"},"Batch Summary",-1))]),l(j,null,{default:t(()=>[l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>[o("div",Io,n(Ae.value.good_qty),1),e[157]||(e[157]=o("div",{class:"text-caption text-grey"},"Total Good",-1))]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>[o("div",Do,n(Ae.value.damaged_qty),1),e[158]||(e[158]=o("div",{class:"text-caption text-grey"},"Total Damaged",-1))]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>[o("div",jo,n(Ae.value.reject_qty),1),e[159]||(e[159]=o("div",{class:"text-caption text-grey"},"Total Reject",-1))]),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>[o("div",No,n(Ae.value.actual_qty),1),e[160]||(e[160]=o("div",{class:"text-caption text-grey"},"Total Actual",-1))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Ut,{class:"pa-6 bg-grey-lighten-4 rounded-b-xl"},{default:t(()=>[l(le),l(h,{class:"px-6",color:"grey",variant:"outlined",onClick:Re},{default:t(()=>e[161]||(e[161]=[d(" Cancel ")])),_:1}),l(h,{class:"px-6",color:"success",disabled:!al.value,elevation:"2",loading:R.value,onClick:lt},{default:t(()=>[l(c,{start:""},{default:t(()=>e[162]||(e[162]=[d("mdi-content-save-check")])),_:1}),e[163]||(e[163]=d(" Save Actual Production "))]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ne,{modelValue:te.value,"onUpdate:modelValue":e[29]||(e[29]=a=>te.value=a),"max-width":"1400",persistent:"",scrollable:""},{default:t(()=>[l(v,{class:"rounded-xl",elevation:"16"},{default:t(()=>[l(Ie,{class:"rounded-t-xl",color:"primary",density:"comfortable"},{default:t(()=>[l(z,{class:"mr-3",color:"white",size:"36"},{default:t(()=>[l(c,{color:"primary",icon:Q.value?"mdi-pencil":"mdi-plus"},null,8,["icon"])]),_:1}),l(De,{class:"text-h5 font-weight-bold text-white"},{default:t(()=>[d(n(ce.value?"Add Actual Quantity":Q.value?"Edit Production":"Create New Production (Multiple Products)"),1)]),_:1}),l(le),l(h,{color:"white",icon:"mdi-close",variant:"text",onClick:ct})]),_:1}),l(x,{class:"pa-6"},{default:t(()=>[l(jt,{onSubmit:At(yt,["prevent"])},{default:t(()=>[l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>[o("div",To,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[164]||(e[164]=[d(" mdi-information ")])),_:1}),e[165]||(e[165]=o("h4",{class:"text-h6 font-weight-medium"},"Batch Information",-1))]),l(j,{dense:""},{default:t(()=>[l(p,{cols:"12",md:"4"},{default:t(()=>[o("div",$o,[g.planned_at?(m(),C("span",Bo," Planned Production Date & Time ")):b("",!0),l(u,{modelValue:g.planned_at,"onUpdate:modelValue":e[21]||(e[21]=a=>g.planned_at=a),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100","enable-time-picker":!0,format:"dd-MM-yyyy HH:mm","model-type":"format",placeholder:"Select Planned Production Date & Time",teleport:!0},null,8,["modelValue"])])]),_:1}),xe.value?(m(),y(p,{key:0,cols:"12",md:"4"},{default:t(()=>[o("div",Mo,[g.produced_at?(m(),C("span",Ro," Actual Production Date & Time ")):b("",!0),l(u,{modelValue:g.produced_at,"onUpdate:modelValue":e[22]||(e[22]=a=>g.produced_at=a),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100","enable-time-picker":!0,format:"dd-MM-yyyy HH:mm","model-type":"format",placeholder:"Select Actual Production Date & Time",teleport:!0},null,8,["modelValue"])])]),_:1})):b("",!0),l(p,{cols:"12",md:"4"},{default:t(()=>[l(M,{modelValue:g.notes,"onUpdate:modelValue":e[23]||(e[23]=a=>g.notes=a),color:"primary",label:"Batch Notes (optional)","prepend-inner-icon":"mdi-note-text",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>[o("div",Fo,[o("div",Go,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[166]||(e[166]=[d(" mdi-package-variant ")])),_:1}),e[167]||(e[167]=o("h4",{class:"text-h6 font-weight-medium"}," Products in this Batch ",-1))]),l(h,{color:"primary",size:"small",variant:"outlined",onClick:Ee},{default:t(()=>[l(c,{start:""},{default:t(()=>e[168]||(e[168]=[d("mdi-plus")])),_:1}),e[169]||(e[169]=d(" Add Product "))]),_:1})]),g.products.length?b("",!0):(m(),y(ae,{key:0,border:"start",class:"mb-3",type:"info",variant:"tonal"},{default:t(()=>e[170]||(e[170]=[d(" Add one or more products to this production batch. Each product keeps its own mode and ingredients. ")])),_:1})),(m(!0),C(T,null,H(g.products,(a,r)=>(m(),y(j,{key:a.uid,dense:""},{default:t(()=>[l(p,{cols:"12"},{default:t(()=>[l(v,{class:"mb-3",ripple:!1,variant:"outlined"},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",Eo,[l(w,{class:"mr-2",color:"primary",size:"small",variant:"flat"},{default:t(()=>[d(" Product #"+n(r+1),1)]),_:2},1024),o("span",Oo,n(cl(a)),1),l(le),g.products.length>1?(m(),y(h,{key:0,color:"error",icon:"",size:"x-small",variant:"text",onClick:i=>vl(r)},{default:t(()=>[l(c,null,{default:t(()=>e[171]||(e[171]=[d("mdi-close")])),_:1})]),_:2},1032,["onClick"])):b("",!0)]),l(j,{dense:""},{default:t(()=>[l(p,{cols:"12",md:"5"},{default:t(()=>[l(ge,{modelValue:a.product_id,"onUpdate:modelValue":[i=>a.product_id=i,()=>ut(a)],clearable:"",density:"compact","item-title":"name","item-value":"id",items:we.value,label:"Select Product","prepend-inner-icon":"mdi-package-variant",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(ue,{modelValue:a.mode,"onUpdate:modelValue":[i=>a.mode=i,()=>fe(a)],density:"compact","item-title":"label","item-value":"value",items:Gt,label:"Production Mode","prepend-inner-icon":"mdi-cog",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a.mode==="by_product"?(m(),y(p,{key:0,cols:"12",md:"4"},{default:t(()=>[l(M,{modelValue:a.qty_product_input,"onUpdate:modelValue":i=>a.qty_product_input=i,modelModifiers:{number:!0},density:"compact",label:"Planned Units","prepend-inner-icon":"mdi-counter",type:"number",variant:"outlined",onInput:()=>fe(a)},null,8,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024)):a.mode==="by_ingredient"?(m(),C(T,{key:1},[l(p,{cols:"12",md:"4"},{default:t(()=>[l(ge,{modelValue:a.base_ingredient_id,"onUpdate:modelValue":[i=>a.base_ingredient_id=i,()=>fe(a)],density:"compact",disabled:!a.recipeItems.length,"item-title":"item_name","item-value":"item_id",items:a.recipeItems,label:"Base Ingredient","prepend-inner-icon":"mdi-ingredient",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","disabled","items"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.base_ingredient_qty,"onUpdate:modelValue":i=>a.base_ingredient_qty=i,modelModifiers:{number:!0},density:"compact",disabled:!a.base_ingredient_id,label:`Base Qty (${a.baseUnit||"units"})`,"prepend-inner-icon":"mdi-weight",type:"number",variant:"outlined",onInput:()=>fe(a)},null,8,["modelValue","onUpdate:modelValue","disabled","label","onInput"])]),_:2},1024),l(p,{class:"d-flex align-center",cols:"12",md:"1"},{default:t(()=>[a.computed_qty_product?(m(),y(w,{key:0,color:"blue",size:"small",variant:"flat"},{default:t(()=>[d(" Planned "+n(a.computed_qty_product)+" units ",1)]),_:2},1024)):b("",!0)]),_:2},1024)],64)):b("",!0),xe.value?(m(),y(x,{key:2,class:"pa-4"},{default:t(()=>[o("div",Lo,[l(w,{color:a.hasDiscrepancy?"orange":"green",size:"small",variant:"flat"},{default:t(()=>[d(n(a.hasDiscrepancy?"Discrepancy: "+Math.abs(a.planned_qty-a.good_qty)+" units":"On Track"),1)]),_:2},1032,["color"])]),l(j,{dense:""},{default:t(()=>[l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.good_qty,"onUpdate:modelValue":i=>a.good_qty=i,modelModifiers:{number:!0},color:"green",density:"compact",label:`Good Quantity (${a.planned_qty} planned)`,type:"number",variant:"outlined",onInput:i=>ke(a)},{"prepend-inner":t(()=>[l(c,{color:"green",size:"20"},{default:t(()=>e[172]||(e[172]=[d("mdi-check-decagram")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","label","onInput"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.damaged_qty,"onUpdate:modelValue":i=>a.damaged_qty=i,modelModifiers:{number:!0},color:"orange",density:"compact",label:"Damaged Quantity",type:"number",variant:"outlined",onInput:i=>ke(a)},{"prepend-inner":t(()=>[l(c,{color:"orange",size:"20"},{default:t(()=>e[173]||(e[173]=[d("mdi-alert-circle-outline")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.reject_qty,"onUpdate:modelValue":i=>a.reject_qty=i,modelModifiers:{number:!0},color:"red",density:"compact",label:"Reject Quantity",type:"number",variant:"outlined",onInput:i=>ke(a)},{"prepend-inner":t(()=>[l(c,{color:"red",size:"20"},{default:t(()=>e[174]||(e[174]=[d("mdi-close-octagon-outline")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]),_:2},1024),l(p,{cols:"12",md:"3"},{default:t(()=>[l(M,{modelValue:a.actual_qty,"onUpdate:modelValue":i=>a.actual_qty=i,modelModifiers:{number:!0},color:"primary",density:"compact",label:"Total Actual",readonly:"",type:"number",variant:"outlined"},{"prepend-inner":t(()=>[l(c,{color:"primary",size:"20"},{default:t(()=>e[175]||(e[175]=[d("mdi-counter")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024),a.hasDiscrepancy?(m(),C(T,{key:0},[l(pe,{class:"my-3"}),(m(!0),C(T,null,H(a.discrepancies,(i,_)=>(m(),y(j,{key:_,class:"align-center mb-2"},{default:t(()=>[l(p,{cols:"12",md:"5"},{default:t(()=>[l(ue,{modelValue:i.reason_id,"onUpdate:modelValue":f=>i.reason_id=f,density:"compact","item-title":"name","item-value":"id",items:Me.value,label:"Reason","prepend-inner-icon":"mdi-alert-circle-outline",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),l(p,{cols:"12",md:"5"},{default:t(()=>[l(M,{modelValue:i.notes,"onUpdate:modelValue":f=>i.notes=f,density:"compact",label:"Notes",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),l(p,{class:"text-right",cols:"12",md:"2"},{default:t(()=>[l(h,{color:"error",icon:"",size:"small",variant:"text",onClick:f=>tt(a,_)},{default:t(()=>[l(c,null,{default:t(()=>e[176]||(e[176]=[d("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),l(h,{color:"primary",size:"small",variant:"outlined",onClick:i=>Fe(a)},{default:t(()=>[l(c,{start:""},{default:t(()=>e[177]||(e[177]=[d("mdi-plus")])),_:1}),e[178]||(e[178]=d(" Add Reason "))]),_:2},1032,["onClick"])],64)):b("",!0)]),_:2},1024)):b("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128)),g.products.length?(m(),y(ae,{key:1,border:"start",class:"mt-2",type:"success",variant:"tonal"},{default:t(()=>[e[179]||(e[179]=d(" Total planned units for this batch: ")),o("b",null,n(st.value),1)]),_:1})):b("",!0)]),_:1}),l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>[o("div",Ho,[o("div",Qo,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[180]||(e[180]=[d(" mdi-ingredient ")])),_:1}),e[181]||(e[181]=o("h4",{class:"text-h6 font-weight-medium"}," Ingredients & Groups ",-1))]),de.value.length&&!Ve.value?(m(),y(h,{key:0,color:"warning",onClick:e[24]||(e[24]=a=>_t(!0))},{default:t(()=>e[182]||(e[182]=[d("Ignore Deprecated Ingredients Options")])),_:1})):de.value.length&&Ve.value?(m(),y(h,{key:1,color:"success",onClick:e[25]||(e[25]=a=>_t(!1))},{default:t(()=>e[183]||(e[183]=[d("Use Deprecated Ingredients Options")])),_:1})):b("",!0),l(Gl,{modelValue:G.value,"onUpdate:modelValue":e[26]||(e[26]=a=>G.value=a),color:"primary","hide-details":"",inset:"",label:G.value?"Editing Enabled":"Editing Disabled"},null,8,["modelValue","label"])]),at.value?(m(),y(ae,{key:0,border:"start",class:"mb-3",type:"error",variant:"tonal"},{default:t(()=>e[184]||(e[184]=[d(" Some ingredients exceed available stock. Please adjust quantities before saving. ")])),_:1})):b("",!0),l(Tt,{modelValue:W.value,"onUpdate:modelValue":e[27]||(e[27]=a=>W.value=a),"bg-color":"transparent",color:"primary",density:"comfortable","show-arrows":""},{default:t(()=>[(m(!0),C(T,null,H(g.products,(a,r)=>(m(),y(Te,{key:a.uid,value:r},{default:t(()=>[d(n(ml(a,r)),1)]),_:2},1032,["value"]))),128)),g.products.length?(m(),y(Te,{key:0,value:"summary"},{default:t(()=>e[185]||(e[185]=[d(" All Ingredients Summary ")])),_:1})):b("",!0)]),_:1},8,["modelValue"]),l($t,{modelValue:W.value,"onUpdate:modelValue":e[28]||(e[28]=a=>W.value=a),class:"mt-4"},{default:t(()=>[(m(!0),C(T,null,H(g.products,(a,r)=>(m(),y($e,{key:`win-${a.uid}`,value:r},{default:t(()=>[l(Tt,{modelValue:a.innerTab,"onUpdate:modelValue":i=>a.innerTab=i,class:"mb-2",color:"primary",density:"compact"},{default:t(()=>[l(Te,{value:"ingredients"},{default:t(()=>e[186]||(e[186]=[d("Ingredients")])),_:1}),l(Te,{value:"groups"},{default:t(()=>e[187]||(e[187]=[d(" Ingredient Groups ")])),_:1})]),_:2},1032,["modelValue","onUpdate:modelValue"]),l($t,{modelValue:a.innerTab,"onUpdate:modelValue":i=>a.innerTab=i},{default:t(()=>[l($e,{value:"ingredients"},{default:t(()=>[l(je,{class:"elevation-1 rounded-lg",density:"comfortable",headers:We,items:a.ingredients},{"item.item_name":t(({item:i})=>[o("div",Yo,[i.from_group?(m(),y(c,{key:0,class:"mr-2",color:"purple",size:"16"},{default:t(()=>e[188]||(e[188]=[d(" mdi-cog ")])),_:1})):b("",!0),o("span",null,n(i.item_name),1),i.group_name?(m(),y(w,{key:1,class:"ml-2",color:"purple",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(i.group_name),1)]),_:2},1024)):b("",!0)])]),"item.qty_required":t(({item:i})=>[o("div",Jo,[l(M,{modelValue:i.qty_required,"onUpdate:modelValue":_=>i.qty_required=_,modelModifiers:{number:!0},autocomplete:"off",autocorrect:"off",density:"compact",disabled:!G.value,error:i.exceeds,"error-messages":i.exceeds?["Exceeds available stock across all products"]:[],"hide-details":"",inputmode:"none",spellcheck:"false",style:{"max-width":"140px"},type:"number",variant:"outlined",onInput:ie},{"append-inner":t(()=>[o("span",{class:ne(["text-caption",i.exceeds?"text-error":"text-grey"])},n(i.unit),3)]),_:2},1032,["modelValue","onUpdate:modelValue","disabled","error","error-messages"]),i.exceeds?(m(),y(El,{key:0,location:"top",text:Q.value?`Stock: ${i.available-(i.previously_used||0)} + Previously allocated: ${i.previously_used||0} = ${i.available} available for editing`:`Maximum available: ${i.available} ${i.unit||""} (across all products)`},{activator:t(({props:_})=>[l(h,he({ref_for:!0},_,{class:"ml-1",color:"orange",icon:"",size:"x-small",variant:"text",onClick:f=>hl(i.item_id,i.available)}),{default:t(()=>[l(c,{size:"16"},{default:t(()=>e[189]||(e[189]=[d(" mdi-information-outline ")])),_:1})]),_:2},1040,["onClick"])]),_:2},1032,["text"])):b("",!0)])]),"item.balance":t(({item:i})=>[l(w,{class:"font-weight-medium",color:i.exceeds?"red":"blue",size:"small",variant:"outlined"},{default:t(()=>[d(n(i.balance||0)+" "+n(i.unit),1)]),_:2},1032,["color"])]),"item.unit":t(({item:i})=>[l(w,{color:"blue-grey",size:"small",variant:"outlined"},{default:t(()=>[d(n(i.unit),1)]),_:2},1024)]),"no-data":t(()=>e[190]||(e[190]=[o("div",{class:"text-center py-4 text-grey"}," Configure this product (mode + quantity) to calculate ingredients ",-1)])),_:2},1032,["items"]),a.computed_qty_product?(m(),y(ae,{key:0,border:"start",class:"mt-3",type:"success",variant:"tonal"},{default:t(()=>[e[191]||(e[191]=d(" Planned units for ")),o("b",null,n(Ue(a.product_id)),1),e[192]||(e[192]=d(": ")),o("b",null,n(a.computed_qty_product),1),e[193]||(e[193]=d(". Ingredients above are specific to this product. "))]),_:2},1024)):b("",!0)]),_:2},1024),l($e,{value:"groups"},{default:t(()=>[a.productGroups&&a.productGroups.length?(m(),y(v,{key:0,class:"rounded-lg",variant:"outlined"},{default:t(()=>[l(x,{class:"pa-4"},{default:t(()=>[o("div",Ko,[l(c,{class:"mr-2",color:"purple"},{default:t(()=>e[194]||(e[194]=[d(" mdi-cog ")])),_:1}),o("h5",Wo," Ingredient Groups for "+n(Ue(a.product_id)),1),l(w,{class:"ml-2",color:"purple",size:"small",variant:"flat"},{default:t(()=>[d(n(a.productGroups.length)+" groups ",1)]),_:2},1024)]),l(ae,{class:"mb-4",type:"info",variant:"tonal"},{default:t(()=>e[195]||(e[195]=[d(" Select combinations per group to update ingredients for this product. ")])),_:1}),l(Ol,{modelValue:a.expandedGroups,"onUpdate:modelValue":i=>a.expandedGroups=i,multiple:""},{default:t(()=>[(m(!0),C(T,null,H(a.productGroups,(i,_)=>(m(),y(Ll,{key:i.id,class:"mb-2"},{default:t(()=>[l(Hl,{class:"font-weight-medium"},{default:t(()=>[o("div",Zo,[o("div",Xo,[l(c,{class:"mr-2",color:"purple"},{default:t(()=>e[196]||(e[196]=[d(" mdi-cog ")])),_:1}),o("span",null,n(i.name),1),i.is_mandatory?(m(),y(w,{key:0,class:"ml-2",color:"red",size:"x-small",variant:"flat"},{default:t(()=>e[197]||(e[197]=[d(" Required ")])),_:1})):(m(),y(w,{key:1,class:"ml-2",color:"grey",size:"x-small",variant:"outlined"},{default:t(()=>e[198]||(e[198]=[d(" Optional ")])),_:1})),i.deprecated?(m(),y(w,{key:2,class:"ml-2",color:"warning",size:"x-small",variant:"flat"},{default:t(()=>e[199]||(e[199]=[d(" Deprecated ")])),_:1})):b("",!0)]),o("div",ed,[l(w,{class:"mr-2",color:"blue",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(i.selection_mode),1)]),_:2},1024),a.group_choices[i.id]?(m(),y(w,{key:0,color:"green",size:"x-small",variant:"flat"},{default:t(()=>e[200]||(e[200]=[d(" Selected ")])),_:1})):(m(),y(w,{key:1,color:"orange",size:"x-small",variant:"outlined"},{default:t(()=>e[201]||(e[201]=[d(" Not Selected ")])),_:1}))])])]),_:2},1024),l(Ql,null,{default:t(()=>[o("p",td,n(i.description),1),l(Wl,{modelValue:a.group_choices[i.id],"onUpdate:modelValue":[f=>a.group_choices[i.id]=f,()=>fe(a)],"hide-details":""},{default:t(()=>[l(j,null,{default:t(()=>[(m(!0),C(T,null,H(i.combinations,f=>(m(),y(p,{key:f.id,cols:"12",md:"6"},{default:t(()=>[l(v,{class:ne(["combination-card",{selected:a.group_choices[i.id]===f.id}]),variant:"outlined",onClick:U=>{a.group_choices[i.id]=f.id,fe(a)}},{default:t(()=>[l(x,{class:"pa-3"},{default:t(()=>[o("div",ld,[l(Jl,{"hide-details":"",value:f.id},null,8,["value"]),o("div",ad,[o("div",od,n(f.name),1),f.notes?(m(),C("div",dd,n(f.notes),1)):b("",!0),o("div",sd,[(m(!0),C(T,null,H(f.options,U=>(m(),y(w,{key:U.option_id,class:"mr-1 mb-1",color:"green",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(U.item_name)+": "+n(U.quantity_per_unit)+" "+n(U.unit),1)]),_:2},1024))),128))])]),f.is_default?(m(),y(w,{key:0,color:"orange",size:"x-small",variant:"flat"},{default:t(()=>e[202]||(e[202]=[d(" Default ")])),_:1})):b("",!0)])]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1024)]),_:2},1024)):(m(),y(ae,{key:1,border:"start",type:"info",variant:"tonal"},{default:t(()=>e[203]||(e[203]=[d(" No ingredient groups configured for this product. ")])),_:1}))]),_:2},1024)]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["value"]))),128)),l($e,{value:"summary"},{default:t(()=>[l(je,{class:"elevation-1 rounded-lg",density:"comfortable",headers:We,items:it.value},{"item.item_name":t(({item:a})=>[o("div",id,[l(z,{class:"mr-2",color:"primary",size:"22",variant:"tonal"},{default:t(()=>[l(c,{color:"primary",size:"14"},{default:t(()=>e[204]||(e[204]=[d(" mdi-ingredient ")])),_:1})]),_:1}),o("span",null,n(a.item_name),1)])]),"item.qty_required":t(({item:a})=>[l(w,{color:a.exceeds?"red":"green",size:"small",variant:"outlined"},{default:t(()=>[d(n(a.qty_required)+" "+n(a.unit),1)]),_:2},1032,["color"])]),"item.available":t(({item:a})=>[l(w,{color:a.exceeds?"red":"blue",size:"small",variant:"outlined"},{default:t(()=>[d(n(a.available||0)+" "+n(a.unit),1)]),_:2},1032,["color"])]),"item.unit":t(({item:a})=>[o("span",null,n(a.unit),1)]),"no-data":t(()=>e[205]||(e[205]=[o("div",{class:"text-center py-4 text-grey"}," Add products and configure ingredients to see a consolidated summary. ",-1)])),_:1},8,["items"]),it.value.length?(m(),y(ae,{key:0,border:"start",class:"mt-3",type:"success",variant:"tonal"},{default:t(()=>e[206]||(e[206]=[d(" Consolidated ingredient requirements across all products in this batch. ")])),_:1})):b("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>[o("div",nd,[o("div",rd,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[207]||(e[207]=[d(" mdi-account-group ")])),_:1}),e[208]||(e[208]=o("h4",{class:"text-h6 font-weight-medium"},"Staff Assignment",-1))]),o("div",ud,[l(h,{color:"primary",disabled:!ot.value.length,size:"small",variant:"outlined",onClick:nt},{default:t(()=>[l(c,{start:""},{default:t(()=>e[209]||(e[209]=[d("mdi-account-plus")])),_:1}),e[210]||(e[210]=d(" Add Staff "))]),_:1},8,["disabled"]),l(h,{color:"secondary",disabled:!g.staff.length,size:"small",variant:"outlined",onClick:gl},{default:t(()=>[l(c,{start:""},{default:t(()=>e[211]||(e[211]=[d("mdi-account-remove")])),_:1}),e[212]||(e[212]=d(" Clear All "))]),_:1},8,["disabled"])])]),l(je,{class:"elevation-1 rounded-lg",density:"comfortable",headers:Yt,items:g.staff},{"item.staff_id":t(({item:a})=>[l(ge,{modelValue:a.staff_id,"onUpdate:modelValue":r=>a.staff_id=r,density:"compact",disabled:!G.value,"hide-details":"","item-title":"name","item-value":"id",items:ze.value,placeholder:"Select Staff",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","disabled","items"])]),"item.role":t(({item:a})=>[l(ue,{modelValue:a.role,"onUpdate:modelValue":r=>a.role=r,density:"compact",disabled:!G.value,"hide-details":"",items:["Team Leader","Assistant","Support"],"prepend-inner-icon":"mdi-account-tie",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.notes":t(({item:a})=>[l(M,{modelValue:a.notes,"onUpdate:modelValue":r=>a.notes=r,density:"compact",disabled:!G.value,"hide-details":"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","disabled"])]),"item.actions":t(({index:a})=>[l(h,{color:"error",disabled:!G.value,icon:"",size:"small",variant:"text",onClick:r=>_l(a)},{default:t(()=>[l(c,null,{default:t(()=>e[213]||(e[213]=[d("mdi-delete")])),_:1})]),_:2},1032,["disabled","onClick"])]),"no-data":t(()=>e[214]||(e[214]=[o("div",{class:"text-center py-4 text-grey"},' No staff assigned. Click "Add Staff" to assign team members. ',-1)])),_:1},8,["items"]),g.staff.length?(m(),y(ae,{key:0,border:"start",class:"mt-4",type:"info",variant:"tonal"},{default:t(()=>[o("div",cd,[o("div",null,[e[215]||(e[215]=o("strong",null,"Team Summary:",-1)),l(w,{class:"ml-2",color:"primary",size:"small",variant:"flat"},{default:t(()=>[d(n(g.staff.length)+" staff members ",1)]),_:1})]),o("div",md,n(dt.value)+" of "+n(ot.value.length+dt.value)+" staff assigned ",1)])]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1}),l(Ut,{class:"pa-6 bg-grey-lighten-4 rounded-b-xl"},{default:t(()=>[l(le),l(h,{class:"px-6",color:"grey",variant:"outlined",onClick:ct},{default:t(()=>e[216]||(e[216]=[d(" Cancel ")])),_:1}),l(h,{class:"px-6",color:"success",disabled:!ul.value,elevation:"2",loading:R.value,onClick:yt},{default:t(()=>[l(c,{start:""},{default:t(()=>e[217]||(e[217]=[d("mdi-content-save-check")])),_:1}),d(" "+n(Q.value?"Update Production":"Create Production"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Ne,{modelValue:ve.value,"onUpdate:modelValue":e[31]||(e[31]=a=>ve.value=a),"max-width":"1000",scrollable:"",transition:"dialog-bottom-transition"},{default:t(()=>[l(v,{class:"rounded-xl",elevation:"16"},{default:t(()=>[l(Ie,{class:"rounded-t-xl",color:"primary",density:"comfortable"},{default:t(()=>[l(z,{class:"mr-3",color:"white",size:"36"},{default:t(()=>[l(c,{color:"primary"},{default:t(()=>e[218]||(e[218]=[d("mdi-eye")])),_:1})]),_:1}),l(De,{class:"text-h5 font-weight-bold text-white"},{default:t(()=>{var a,r;return[d(" Production Details - "+n((r=(a=q.value)==null?void 0:a.production)==null?void 0:r.product_name),1)]}),_:1}),l(le),l(h,{color:"white",icon:"mdi-close",variant:"text",onClick:e[30]||(e[30]=a=>ve.value=!1)})]),_:1}),l(x,{class:"pa-6"},{default:t(()=>{var a,r,i,_,f,U,re,vt,bt,xt,Vt,wt,kt,qt;return[l(v,{class:"rounded-lg pa-4 mb-4",variant:"outlined"},{default:t(()=>{var P,N;return[o("div",fd,[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[219]||(e[219]=[d("mdi-information")])),_:1}),e[220]||(e[220]=o("h4",{class:"text-h6 font-weight-medium"},"Production Information",-1))]),l(j,null,{default:t(()=>[l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[221]||(e[221]=o("div",{class:"text-body-2 text-grey"},"Production ID",-1)),o("div",pd," #"+n((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.id),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[222]||(e[222]=o("div",{class:"text-body-2 text-grey"},"Product",-1)),o("div",_d,n((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.product_name),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[223]||(e[223]=o("div",{class:"text-body-2 text-grey"},"Production Mode",-1)),o("div",gd,n((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.mode),1)]}),_:1})]),_:1}),l(j,{class:"mt-2"},{default:t(()=>[l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[224]||(e[224]=o("div",{class:"text-body-2 text-grey"},"Planned At",-1)),o("div",yd,n(se((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.planned_at)),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[225]||(e[225]=o("div",{class:"text-body-2 text-grey"},"Produced At",-1)),o("div",vd,n(se((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.produced_at)),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[226]||(e[226]=o("div",{class:"text-body-2 text-grey"},"Produced By",-1)),o("div",bd,n((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.produced_by_name),1)]}),_:1})]),_:1}),l(j,{class:"mt-2"},{default:t(()=>[l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[227]||(e[227]=o("div",{class:"text-body-2 text-grey"},"Created",-1)),o("div",xd,n(se((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.created)),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[228]||(e[228]=o("div",{class:"text-body-2 text-grey"},"Last Updated",-1)),o("div",Vd,n(se((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.updated_at)),1)]}),_:1}),l(p,{cols:"12",md:"4"},{default:t(()=>{var V,k;return[e[229]||(e[229]=o("div",{class:"text-body-2 text-grey"},"Batch ID",-1)),o("div",wd,n(((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.batch_id)||"N/A"),1)]}),_:1})]),_:1}),l(j,{class:"mt-4"},{default:t(()=>[l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var V,k;return[o("div",kd,n((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.qty_product),1),e[230]||(e[230]=o("div",{class:"text-caption text-grey"},"Planned Quantity",-1))]}),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"3"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var V,k;return[o("div",qd,n((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.actual_qty),1),e[231]||(e[231]=o("div",{class:"text-caption text-grey"},"Actual Quantity",-1))]}),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"2"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var V,k;return[o("div",hd,n(((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.good_qty)||0),1),e[232]||(e[232]=o("div",{class:"text-caption text-grey"},"Good",-1))]}),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"2"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var V,k;return[o("div",zd,n(((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.damaged_qty)||0),1),e[233]||(e[233]=o("div",{class:"text-caption text-grey"},"Damaged",-1))]}),_:1})]),_:1})]),_:1}),l(p,{cols:"12",md:"2"},{default:t(()=>[l(v,{border:"",class:"text-center",variant:"outlined"},{default:t(()=>[l(x,null,{default:t(()=>{var V,k;return[o("div",Pd,n(((k=(V=q.value)==null?void 0:V.production)==null?void 0:k.reject_qty)||0),1),e[234]||(e[234]=o("div",{class:"text-caption text-grey"},"Reject",-1))]}),_:1})]),_:1})]),_:1})]),_:1}),(N=(P=q.value)==null?void 0:P.production)!=null&&N.notes?(m(),y(j,{key:0,class:"mt-4"},{default:t(()=>[l(p,{cols:"12"},{default:t(()=>[e[235]||(e[235]=o("div",{class:"text-body-2 text-grey"},"Notes",-1)),o("div",Cd,n(q.value.production.notes),1)]),_:1})]),_:1})):b("",!0)]}),_:1}),l(v,{class:"rounded-lg mb-4",variant:"outlined"},{default:t(()=>[l(qe,{class:"d-flex align-center"},{default:t(()=>[l(c,{class:"mr-2",color:"primary"},{default:t(()=>e[236]||(e[236]=[d("mdi-ingredient")])),_:1}),e[237]||(e[237]=d(" Ingredients Used ")),l(w,{class:"ml-2",color:"primary",size:"small",variant:"flat"},{default:t(()=>{var P,N;return[d(n(((N=(P=q.value)==null?void 0:P.items)==null?void 0:N.length)||0)+" items ",1)]}),_:1})]),_:1}),l(x,{class:"pa-0"},{default:t(()=>[l(_e,{class:"pa-0",lines:"two"},{default:t(()=>{var P;return[(m(!0),C(T,null,H(((P=q.value)==null?void 0:P.items)||[],(N,V)=>(m(),y(Y,{key:N.id,class:ne(["px-4",{"bg-grey-lighten-4":V%2===0}])},{prepend:t(()=>[l(z,{class:"mr-3",color:"primary",size:"36"},{default:t(()=>[o("span",Ad,n(V+1),1)]),_:2},1024)]),default:t(()=>[l(K,{class:"font-weight-medium"},{default:t(()=>[d(n(N.item_name)+" ",1),N.group_name?(m(),y(w,{key:0,class:"ml-2",color:"purple",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(N.group_name),1)]),_:2},1024)):b("",!0),N.combination_name?(m(),y(w,{key:1,class:"ml-1",color:"green",size:"x-small",variant:"outlined"},{default:t(()=>[d(n(N.combination_name),1)]),_:2},1024)):b("",!0)]),_:2},1024),l(L,{class:"mt-1"},{default:t(()=>[l(w,{class:"mr-2",color:"primary",size:"small",variant:"outlined"},{default:t(()=>[d(n(N.qty_required)+" "+n(N.unit||""),1)]),_:2},1024),o("span",Ud," Item ID: "+n(N.item_id),1)]),_:2},1024)]),_:2},1032,["class"]))),128))]}),_:1})]),_:1})]),_:1}),(r=(a=q.value)==null?void 0:a.group_choices)!=null&&r.length?(m(),y(v,{key:0,class:"rounded-lg mb-4",variant:"outlined"},{default:t(()=>[l(qe,{class:"d-flex align-center"},{default:t(()=>[l(c,{class:"mr-2",color:"purple"},{default:t(()=>e[238]||(e[238]=[d("mdi-cog")])),_:1}),e[239]||(e[239]=d(" Ingredient Group Choices ")),l(w,{class:"ml-2",color:"purple",size:"small",variant:"flat"},{default:t(()=>[d(n(q.value.group_choices.length)+" groups ",1)]),_:1})]),_:1}),l(x,{class:"pa-0"},{default:t(()=>[l(_e,{class:"pa-0",lines:"two"},{default:t(()=>[(m(!0),C(T,null,H(q.value.group_choices,(P,N)=>(m(),y(Y,{key:P.id,class:ne(["px-4",{"bg-grey-lighten-4":N%2===0}])},{prepend:t(()=>[l(z,{class:"mr-3",color:"purple",size:"36"},{default:t(()=>[l(c,{color:"white",size:"18"},{default:t(()=>e[240]||(e[240]=[d("mdi-cog")])),_:1})]),_:1})]),default:t(()=>[l(K,{class:"font-weight-medium"},{default:t(()=>[d(n(P.group_name),1)]),_:2},1024),l(L,{class:"mt-1"},{default:t(()=>[l(w,{color:"green",size:"small",variant:"outlined"},{default:t(()=>[d(n(P.combination_name),1)]),_:2},1024),P.chosen_by_name?(m(),C("span",Sd," Chosen by: "+n(P.chosen_by_name),1)):b("",!0),o("span",Id," Created: "+n(se(P.created_at)),1)]),_:2},1024),P.notes?(m(),y(L,{key:0,class:"mt-1 text-caption"},{default:t(()=>[e[241]||(e[241]=o("strong",null,"Notes:",-1)),d(" "+n(P.notes),1)]),_:2},1024)):b("",!0)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})]),_:1})):b("",!0),(_=(i=q.value)==null?void 0:i.staff)!=null&&_.length?(m(),y(v,{key:1,class:"rounded-lg mb-4",variant:"outlined"},{default:t(()=>[l(qe,{class:"d-flex align-center"},{default:t(()=>[l(c,{class:"mr-2",color:"blue"},{default:t(()=>e[242]||(e[242]=[d("mdi-account-group")])),_:1}),e[243]||(e[243]=d(" Staff Assignments ")),l(w,{class:"ml-2",color:"blue",size:"small",variant:"flat"},{default:t(()=>[d(n(q.value.staff.length)+" staff ",1)]),_:1})]),_:1}),l(x,{class:"pa-0"},{default:t(()=>[l(_e,{class:"pa-0",lines:"two"},{default:t(()=>[(m(!0),C(T,null,H(q.value.staff,(P,N)=>(m(),y(Y,{key:P.staff_id,class:ne(["px-4",{"bg-grey-lighten-4":N%2===0}])},{prepend:t(()=>[l(z,{class:"mr-3",color:"blue",size:"36"},{default:t(()=>[o("span",Dd,n(N+1),1)]),_:2},1024)]),default:t(()=>[l(K,{class:"font-weight-medium"},{default:t(()=>[d(n(P.staff_name)+" ",1),l(w,{class:"ml-2",color:pt(P.role),size:"x-small",variant:"flat"},{default:t(()=>[d(n(P.role),1)]),_:2},1032,["color"])]),_:2},1024),l(L,{class:"mt-1"},{default:t(()=>[P.notes?(m(),C("span",jd,n(P.notes),1)):(m(),C("span",Nd," No notes "))]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})]),_:1})):b("",!0),(U=(f=q.value)==null?void 0:f.discrepancies)!=null&&U.length?(m(),y(v,{key:2,class:"rounded-lg",variant:"outlined"},{default:t(()=>[l(qe,{class:"d-flex align-center"},{default:t(()=>[l(c,{class:"mr-2",color:"orange"},{default:t(()=>e[244]||(e[244]=[d("mdi-alert-circle")])),_:1}),e[245]||(e[245]=d(" Discrepancies ")),l(w,{class:"ml-2",color:"orange",size:"small",variant:"flat"},{default:t(()=>[d(n(q.value.discrepancies.length)+" issues ",1)]),_:1})]),_:1}),l(x,{class:"pa-0"},{default:t(()=>[l(_e,{class:"pa-0",lines:"two"},{default:t(()=>[(m(!0),C(T,null,H(q.value.discrepancies,(P,N)=>(m(),y(Y,{key:P.id,class:ne(["px-4",{"bg-grey-lighten-4":N%2===0}])},{prepend:t(()=>[l(z,{class:"mr-3",color:"orange",size:"36"},{default:t(()=>[l(c,{color:"white",size:"18"},{default:t(()=>e[246]||(e[246]=[d("mdi-alert")])),_:1})]),_:1})]),default:t(()=>[l(K,{class:"font-weight-medium"},{default:t(()=>[d(n(P.reason_name),1)]),_:2},1024),l(L,{class:"mt-1"},{default:t(()=>[o("span",Td," Reason ID: "+n(P.reason_id),1)]),_:2},1024),P.notes?(m(),y(L,{key:0,class:"mt-1 text-caption"},{default:t(()=>[e[247]||(e[247]=o("strong",null,"Notes:",-1)),d(" "+n(P.notes),1)]),_:2},1024)):b("",!0)]),_:2},1032,["class"]))),128))]),_:1})]),_:1})]),_:1})):b("",!0),!((vt=(re=q.value)==null?void 0:re.items)!=null&&vt.length)&&!((xt=(bt=q.value)==null?void 0:bt.staff)!=null&&xt.length)&&!((wt=(Vt=q.value)==null?void 0:Vt.group_choices)!=null&&wt.length)&&!((qt=(kt=q.value)==null?void 0:kt.discrepancies)!=null&&qt.length)?(m(),y(v,{key:3,class:"rounded-lg text-center py-8",variant:"outlined"},{default:t(()=>[l(c,{class:"mb-2",color:"grey",size:"48"},{default:t(()=>e[248]||(e[248]=[d("mdi-information-outline")])),_:1}),e[249]||(e[249]=o("div",{class:"text-h6 text-grey"},"No Additional Data",-1)),e[250]||(e[250]=o("div",{class:"text-body-2 text-grey mt-2"}," This production record doesn't have any additional items, staff, or discrepancies. ",-1))]),_:1})):b("",!0)]}),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}},ds=Il($d,[["__scopeId","data-v-0c128232"]]);export{ds as default};
