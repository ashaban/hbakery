import"./index-BG4iPnQu.js";import{V as d,b as m,a as c}from"./VCard-kZtgd9b4.js";import{r as g,$ as k,l as $,s as J,v as K,x as t,i as e,O as v,y as o,A as W,B as S,C as r,H as O,I as x}from"./index-DM-_A7PE.js";import{V as n}from"./VCol-y2yuKi6R.js";import{V as X,a as h}from"./VDataTable-BIUAbLMQ.js";import{V as I}from"./VTextField-DUiB6l3E.js";import{V as Y}from"./VContainer-iWuqtKcr.js";import{h as V}from"./install-DoKjw2Sc.js";import"./dialog-transition-KjMsMB9n.js";import"./VChip-Cf2qyGJc.js";import"./VSlideGroup-RbVq-RBL.js";const Z={class:"d-flex align-center"},ee={class:"text-h5 font-weight-bold"},te={class:"text-h5 font-weight-bold"},ae={class:"text-h5 font-weight-bold"},se={class:"text-h5 font-weight-bold"},le={class:"text-h4 font-weight-bold"},ge={__name:"SalesReport",setup(oe){const T=g([]),i=k({outlet_id:"",start_date:new Date(new Date().setDate(new Date().getDate()-30)).toISOString().split("T")[0],end_date:new Date().toISOString().split("T")[0]}),u=k({total_sales:0,total_cogs:0,total_expenditures:0,total_lost_value:0,total_margin:0}),f=k({sales_timeline:[],sales_by_product:[],loss_by_reason:[]}),_=k({products_sales:[],losses:[],expenditures:[]}),L=[{title:"Product",key:"name"},{title:"Qty",key:"qty",align:"end"},{title:"Revenue",key:"revenue",align:"end"},{title:"COGS",key:"cogs",align:"end"},{title:"Margin",key:"margin",align:"end"}],M=[{title:"Date",key:"date"},{title:"Product",key:"product_name"},{title:"Reason",key:"reason"},{title:"Qty",key:"qty",align:"end"},{title:"Value",key:"value",align:"end"}],B=[{title:"Date",key:"date"},{title:"Category",key:"category"},{title:"Remarks",key:"remarks"},{title:"Amount",key:"amount",align:"end"}],G=g(null),z=g(null),A=g(null),P=g(null);let w,C,D,R;function y(p){return Number(p||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function E(){w=V(G.value),C=V(z.value),D=V(A.value),R=V(P.value),window.addEventListener("resize",()=>{w.resize(),C.resize(),D.resize(),R.resize()})}function F(){const p=f.sales_timeline.map(l=>l.date),a=f.sales_timeline.map(l=>l.sales),s=f.sales_timeline.map(l=>l.cogs),U=f.sales_timeline.map(l=>l.margin);w.setOption({tooltip:{trigger:"axis"},legend:{data:["Sales","COGS","Margin"]},xAxis:{type:"category",data:p},yAxis:{type:"value"},series:[{name:"Sales",type:"bar",data:a,stack:"sum"},{name:"COGS",type:"bar",data:s,stack:"sum"},{name:"Margin",type:"line",data:U,smooth:!0}]}),C.setOption({tooltip:{trigger:"item"},series:[{name:"Sales",type:"pie",radius:"70%",data:f.sales_by_product.map(l=>({name:l.name,value:l.revenue})),emphasis:{scale:!0}}]}),D.setOption({tooltip:{trigger:"item"},series:[{type:"pie",radius:["45%","70%"],data:f.loss_by_reason.map(l=>({name:l.reason,value:l.value})),label:{formatter:"{b}: {c}"}}]});const j=_.products_sales.slice(0,12).map(l=>l.name),q=_.products_sales.slice(0,12).map(l=>l.revenue),Q=_.products_sales.slice(0,12).map(l=>l.cogs);R.setOption({tooltip:{trigger:"axis"},legend:{data:["Revenue","COGS"]},xAxis:{type:"category",data:j},yAxis:{type:"value"},series:[{name:"Revenue",type:"bar",data:q},{name:"COGS",type:"bar",data:Q}]})}async function b(){const p=new URLSearchParams;i.outlet_id&&p.append("outlet_id",i.outlet_id),i.start_date&&p.append("start_date",i.start_date),i.end_date&&p.append("end_date",i.end_date);const s=await(await fetch(`/reports/sales-summary?${p.toString()}`)).json();u.total_sales=s.kpis.total_sales||0,u.total_cogs=s.kpis.total_cogs||0,u.total_expenditures=s.kpis.total_expenditures||0,u.total_lost_value=s.kpis.total_lost_value||0,u.total_margin=s.kpis.total_margin||0,f.sales_timeline=s.chartData.sales_timeline||[],f.sales_by_product=s.chartData.sales_by_product||[],f.loss_by_reason=s.chartData.loss_by_reason||[],_.products_sales=s.tables.products_sales||[],_.losses=s.tables.losses||[],_.expenditures=s.tables.expenditures||[],F()}async function H(){const a=await(await fetch("/outlets?limit=1000")).json();T.value=a.data||[]}function N(){i.outlet_id="",i.start_date=new Date(new Date().setDate(new Date().getDate()-30)).toISOString().split("T")[0],i.end_date=new Date().toISOString().split("T")[0],b()}return $(async()=>{await H(),E(),await b()}),(p,a)=>(K(),J(Y,{class:"bg-grey-lighten-4 pa-6",fluid:""},{default:t(()=>[e(d,{class:"mb-6",elevation:"2"},{default:t(()=>[e(m,{class:"pa-6"},{default:t(()=>[e(v,{align:"center"},{default:t(()=>[e(n,{cols:"12",md:"6"},{default:t(()=>[o("div",Z,[e(W,{class:"mr-4",color:"primary",size:"56"},{default:t(()=>[e(S,{color:"white",size:"32"},{default:t(()=>a[3]||(a[3]=[r("mdi-chart-areaspline")])),_:1})]),_:1}),a[4]||(a[4]=o("div",null,[o("h1",{class:"text-h4 font-weight-bold text-primary"}," Sales Dashboard "),o("p",{class:"text-body-1 text-grey mt-1"}," Sales, COGS, expenditures, losses, and margin ")],-1))])]),_:1}),e(n,{class:"text-right",cols:"12",md:"6"},{default:t(()=>[e(O,{color:"primary",size:"large",onClick:b},{default:t(()=>[e(S,{start:""},{default:t(()=>a[5]||(a[5]=[r("mdi-refresh")])),_:1}),a[6]||(a[6]=r(" Refresh "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{class:"mb-6",elevation:"1"},{default:t(()=>[e(m,{class:"pa-4"},{default:t(()=>[e(v,{align:"center",dense:""},{default:t(()=>[e(n,{cols:"12",sm:"3"},{default:t(()=>[e(X,{modelValue:i.outlet_id,"onUpdate:modelValue":a[0]||(a[0]=s=>i.outlet_id=s),clearable:"",density:"comfortable","item-title":"name","item-value":"id",items:T.value,label:"Outlet","prepend-inner-icon":"mdi-store",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),e(n,{cols:"12",sm:"3"},{default:t(()=>[e(I,{modelValue:i.start_date,"onUpdate:modelValue":a[1]||(a[1]=s=>i.start_date=s),density:"comfortable",label:"Start Date","prepend-inner-icon":"mdi-calendar",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(n,{cols:"12",sm:"3"},{default:t(()=>[e(I,{modelValue:i.end_date,"onUpdate:modelValue":a[2]||(a[2]=s=>i.end_date=s),density:"comfortable",label:"End Date","prepend-inner-icon":"mdi-calendar",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),e(n,{class:"d-flex justify-end",cols:"12",sm:"3"},{default:t(()=>[e(O,{class:"mr-2",color:"primary",onClick:b},{default:t(()=>[e(S,{start:""},{default:t(()=>a[7]||(a[7]=[r("mdi-magnify")])),_:1}),a[8]||(a[8]=r(" Apply "))]),_:1}),e(O,{color:"grey",variant:"outlined",onClick:N},{default:t(()=>[e(S,{start:""},{default:t(()=>a[9]||(a[9]=[r("mdi-refresh")])),_:1}),a[10]||(a[10]=r(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(v,{class:"mb-6",dense:""},{default:t(()=>[e(n,{cols:"12",md:"2"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(m,{class:"py-4 text-center"},{default:t(()=>[a[11]||(a[11]=o("div",{class:"text-caption text-grey"},"Sales",-1)),o("div",ee,x(y(u.total_sales)),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"2"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(m,{class:"py-4 text-center"},{default:t(()=>[a[12]||(a[12]=o("div",{class:"text-caption text-grey"},"COGS",-1)),o("div",te,x(y(u.total_cogs)),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"2"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(m,{class:"py-4 text-center"},{default:t(()=>[a[13]||(a[13]=o("div",{class:"text-caption text-grey"},"Expenditures",-1)),o("div",ae,x(y(u.total_expenditures)),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"2"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(m,{class:"py-4 text-center"},{default:t(()=>[a[14]||(a[14]=o("div",{class:"text-caption text-grey"},"Losses",-1)),o("div",se,x(y(u.total_lost_value)),1)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"4"},{default:t(()=>[e(d,{color:u.total_margin>=0?"green-lighten-5":"red-lighten-5",elevation:"2"},{default:t(()=>[e(m,{class:"py-4 text-center"},{default:t(()=>[a[15]||(a[15]=o("div",{class:"text-caption text-grey"},"Margin",-1)),o("div",le,x(y(u.total_margin)),1)]),_:1})]),_:1},8,["color"])]),_:1})]),_:1}),e(v,{class:"mb-6",dense:""},{default:t(()=>[e(n,{cols:"12",md:"7"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(c,{class:"text-subtitle-1"},{default:t(()=>a[16]||(a[16]=[r("Sales vs COGS vs Margin (Daily)")])),_:1}),e(m,null,{default:t(()=>[o("div",{ref_key:"tlRef",ref:G,style:{height:"320px"}},null,512)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"5"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(c,{class:"text-subtitle-1"},{default:t(()=>a[17]||(a[17]=[r("Sales by Product (Top)")])),_:1}),e(m,null,{default:t(()=>[o("div",{ref_key:"pieRef",ref:z,style:{height:"320px"}},null,512)]),_:1})]),_:1})]),_:1})]),_:1}),e(v,{class:"mb-6",dense:""},{default:t(()=>[e(n,{cols:"12",md:"6"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(c,{class:"text-subtitle-1"},{default:t(()=>a[18]||(a[18]=[r("Losses by Reason")])),_:1}),e(m,null,{default:t(()=>[o("div",{ref_key:"donutRef",ref:A,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1}),e(n,{cols:"12",md:"6"},{default:t(()=>[e(d,{elevation:"2"},{default:t(()=>[e(c,{class:"text-subtitle-1"},{default:t(()=>a[19]||(a[19]=[r("Revenue vs COGS (Top Products)")])),_:1}),e(m,null,{default:t(()=>[o("div",{ref_key:"barRef",ref:P,style:{height:"300px"}},null,512)]),_:1})]),_:1})]),_:1})]),_:1}),e(d,{class:"mb-6",elevation:"2"},{default:t(()=>[e(c,{class:"text-subtitle-1"},{default:t(()=>a[20]||(a[20]=[r("Product Performance")])),_:1}),e(h,{class:"elevation-0",headers:L,items:_.products_sales},null,8,["items"])]),_:1}),e(d,{class:"mb-6",elevation:"2"},{default:t(()=>[e(c,{class:"text-subtitle-1"},{default:t(()=>a[21]||(a[21]=[r("Losses")])),_:1}),e(h,{class:"elevation-0",headers:M,items:_.losses},null,8,["items"])]),_:1}),e(d,{class:"mb-6",elevation:"2"},{default:t(()=>[e(c,{class:"text-subtitle-1"},{default:t(()=>a[22]||(a[22]=[r("Expenditures")])),_:1}),e(h,{class:"elevation-0",headers:B,items:_.expenditures},null,8,["items"])]),_:1})]),_:1}))}};export{ge as default};
