import{_ as ue,r as m,$ as Y,k as pe,q as $,v as a,a1 as me,t as w,h as t,x as d,Z as M,G as c,B as i,N as q,H as p,z as B,A as g,a5 as G,O as fe,a2 as ce,a3 as ye,C as H,a4 as _e,D as Z,i as K,S as ve}from"./index-D9cZNx3d.js";import{h as k}from"./moment-C5S46NFB.js";import{V as ge}from"./VContainer-CCsgfsl3.js";import{V as x,b as F,d as Q,c as xe}from"./VCard-BjfRmh3q.js";import{V as y}from"./VCol-CkxF1Ihr.js";import{V as W}from"./VAutocomplete-BsXqMIoH.js";import{a as Ve,b as be}from"./VDataTable-CEOIylXn.js";import{V as X}from"./VTooltip-Bl_1dqax.js";import{V as ee}from"./VChip-BuGryoYn.js";import{V as we}from"./VSkeletonLoader-CxR6xXfl.js";import{V as ke}from"./VDialog-7c1Isxk_.js";import{V as De}from"./VForm-BWpc7Lay.js";import{V as Ce}from"./VTextField-BbL5CjgL.js";import{V as Ye}from"./VTextarea-CxLfI211.js";import"./dialog-transition-DrLwMtH5.js";import"./VSlideGroup-C0nbVrpN.js";const Me={class:"d-flex align-center justify-space-between"},Ee={class:"text-h6 font-weight-bold"},Se={class:"d-flex align-center justify-space-between"},Te={class:"text-h6 font-weight-bold text-blue"},$e={class:"d-flex align-center justify-space-between"},Fe={class:"text-h6 font-weight-bold text-green"},je={class:"d-flex gap-2"},Ue={class:"d-flex gap-2"},Ae={class:"d-flex justify-end mt-4"},Ne={class:"d-flex justify-center"},Pe={class:"text-center py-6 text-grey"},qe={class:"d-flex justify-space-between align-center pa-4"},Be={class:"text-caption text-grey"},Oe={class:"d-flex flex-column"},Re={key:0,class:"text-caption text-error mt-1"},ze={class:"d-flex flex-column"},Le={key:0,class:"text-caption text-error mt-1"},he={__name:"Expenditures",setup(Ie){const j=m([]),U=m([]),te=m(null),r=Y({type_ids:[],start_from:"",start_to:"",end_from:"",end_to:""}),E=Y({total_expenditure:0,total_production_cost:0,total_sale_cost:0}),A=m(1),O=m(1),R=m(0),D=m(!1),V=m(!1),N=m(!1),P=m(!1),s=Y({id:null,type_id:"",start_date:"",end_date:"",amount:"",description:""}),n=Y({type_id:"",start_date:"",end_date:"",amount:""}),_=Y({show:!1,message:"",color:"success"}),ae=[{title:"Cost Type",key:"cost_type"},{title:"Category",key:"cost_category"},{title:"Start Date",key:"start_date"},{title:"End Date",key:"end_date"},{title:"Amount",key:"amount",align:"end"},{title:"Description",key:"description"},{title:"Actions",key:"actions",align:"center",sortable:!1}];function S(o){return Number(o||0).toLocaleString(void 0,{minimumFractionDigits:2})}function z(o){return o?new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function oe(){Object.assign(r,{type_ids:[],start_from:"",start_to:"",end_from:"",end_to:""}),b()}function le(o){return{"Production Cost":"blue-lighten-1","Sale Cost":"green-lighten-1","Administrative Cost":"purple-lighten-4","Other Cost":"orange-lighten-4"}[o]||"grey-lighten-3"}function v(o,e="success"){_.message=o,_.color=e,_.show=!0}function f(o){switch(o){case"type_id":n.type_id=s.type_id?"":"Cost type is required";break;case"start_date":n.start_date=s.start_date?"":"Start date is required";break;case"end_date":n.end_date=s.end_date?"":"End date is required",s.start_date&&s.end_date&&L();break;case"amount":!s.amount&&s.amount!==0?n.amount="Amount is required":Number.isInteger(Number(s.amount))?s.amount<0?n.amount="Amount must be positive":n.amount="":n.amount="Amount must be a whole number";break}}function L(){if(s.start_date&&s.end_date){const o=k(s.start_date,"DD-MM-YYYY");k(s.end_date,"DD-MM-YYYY").isBefore(o)?n.end_date="End date cannot be before start date":T("end_date")}}function T(o){n[o]=""}function re(){return f("type_id"),f("start_date"),f("end_date"),f("amount"),!n.type_id&&!n.start_date&&!n.end_date&&!n.amount}async function de(){try{const e=await(await fetch("/expenditures/types?limit=1000000")).json();U.value=e.data}catch(o){console.error("Failed to load cost types:",o),v("Failed to load cost types","error")}}async function se(){try{const o=new URLSearchParams;r.type_ids.length&&r.type_ids.forEach(l=>o.append("type_id",l)),r.start_from&&o.append("start_date_from",r.start_from),r.start_to&&o.append("start_date_to",r.start_to),r.end_from&&o.append("end_date_from",r.end_from),r.end_to&&o.append("end_date_to",r.end_to);const u=await(await fetch(`/expenditures/summary?${o.toString()}`)).json();Object.assign(E,u)}catch(o){console.error("Failed to load summary:",o)}}async function b(){N.value=!0;try{const o=new URLSearchParams;r.type_ids.length&&r.type_ids.forEach(l=>o.append("type_id",l)),r.start_from&&o.append("start_date_from",r.start_from),r.start_to&&o.append("start_date_to",r.start_to),r.end_from&&o.append("end_date_from",r.end_from),r.end_to&&o.append("end_date_to",r.end_to),o.append("page",A.value),o.append("limit",10);const u=await(await fetch(`/expenditures?${o.toString()}`)).json();j.value=u.data||[],O.value=u.totalPages||1,R.value=u.totalRecords||0,await se()}catch(o){console.error("Failed to load expenditures:",o),v("Failed to load expenditures","error")}finally{N.value=!1}}function h(o=!1,e=null){V.value=o,D.value=!0,Object.keys(n).forEach(u=>n[u]=""),o&&e?Object.assign(s,{id:e.id,type_id:e.type_id,start_date:k(e.start_date,"YYYY-MM-DD").format("DD-MM-YYYY"),end_date:k(e.end_date,"YYYY-MM-DD").format("DD-MM-YYYY"),amount:e.amount,description:e.description}):Object.assign(s,{id:null,type_id:"",start_date:"",end_date:"",amount:"",description:""})}function I(){D.value=!1,Object.keys(n).forEach(o=>n[o]="")}async function J(){if(!re()){v("Please fix the validation errors","error");return}P.value=!0;try{const o=V.value?"PUT":"POST",e=V.value?`/expenditures/${s.id}`:"/expenditures",u={...s,start_date:k(s.start_date,"DD-MM-YYYY").format("YYYY-MM-DD"),end_date:k(s.end_date,"DD-MM-YYYY").format("YYYY-MM-DD")};console.log(JSON.stringify(u,0,2));const l=await fetch(e,{method:o,headers:{"Content-Type":"application/json"},body:JSON.stringify(u)});if(!l.ok){const C=await l.json();throw new Error(C.message||"Save failed")}D.value=!1,v(`Expenditure ${V.value?"updated":"created"} successfully`),await b()}catch(o){console.error("Failed to save expenditure:",o),v(o.message||"Failed to save expenditure","error")}finally{P.value=!1}}async function ne(o){if(confirm(`Are you sure you want to delete expenditure "${o.cost_type}"?`))try{if(!(await fetch(`/expenditures/${o.id}`,{method:"DELETE"})).ok)throw new Error("Delete failed");v("Expenditure deleted successfully"),await b()}catch(e){console.error("Failed to delete expenditure:",e),v("Failed to delete expenditure","error")}}return pe(async()=>{await de(),await b()}),(o,e)=>{const u=me("VueDatePicker");return w(),$(ge,{class:"py-6",fluid:""},{default:a(()=>[t(x,{class:"mb-6",elevation:"2",rounded:"lg"},{default:a(()=>[t(F,{class:"d-flex align-center justify-space-between"},{default:a(()=>[e[23]||(e[23]=d("div",null,[d("h2",{class:"text-h5 font-weight-bold text-primary mb-1"}," Expenditure Management "),d("p",{class:"text-body-2 text-grey"}," Monitor and manage operational and sales costs ")],-1)),o.$store.getters.hasTask("can_add_expenditure")?(w(),$(c,{key:0,color:"primary","prepend-icon":"mdi-plus-circle",onClick:e[0]||(e[0]=l=>h(!1))},{default:a(()=>e[22]||(e[22]=[i(" New Expenditure ")])),_:1})):M("",!0)]),_:1})]),_:1}),t(q,{class:"mb-4"},{default:a(()=>[t(y,{cols:"12",md:"4"},{default:a(()=>[t(x,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[d("div",Me,[d("div",null,[e[24]||(e[24]=d("div",{class:"text-body-2 text-grey"},"Total Expenditure",-1)),d("div",Ee,p(S(E.total_expenditure)),1)]),t(B,{color:"primary",size:"40",variant:"tonal"},{default:a(()=>[t(g,{color:"primary"},{default:a(()=>e[25]||(e[25]=[i("mdi-cash")])),_:1})]),_:1})])]),_:1})]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(x,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[d("div",Se,[d("div",null,[e[26]||(e[26]=d("div",{class:"text-body-2 text-grey"},"Production Costs",-1)),d("div",Te,p(S(E.total_production_cost)),1)]),t(B,{color:"blue",size:"40",variant:"tonal"},{default:a(()=>[t(g,{color:"blue"},{default:a(()=>e[27]||(e[27]=[i("mdi-factory")])),_:1})]),_:1})])]),_:1})]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(x,{class:"pa-4",elevation:"3",rounded:"xl"},{default:a(()=>[d("div",$e,[d("div",null,[e[28]||(e[28]=d("div",{class:"text-body-2 text-grey"},"Sale Costs",-1)),d("div",Fe,p(S(E.total_sale_cost)),1)]),t(B,{color:"green",size:"40",variant:"tonal"},{default:a(()=>[t(g,{color:"green"},{default:a(()=>e[29]||(e[29]=[i("mdi-sale")])),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),t(x,{class:"mb-4",elevation:"2",rounded:"lg"},{default:a(()=>[t(F,null,{default:a(()=>[t(q,{dense:""},{default:a(()=>[t(y,{cols:"12",md:"4"},{default:a(()=>[t(W,{modelValue:r.type_ids,"onUpdate:modelValue":e[1]||(e[1]=l=>r.type_ids=l),autocomplete:"off",autocorrect:"off",chips:"",clearable:"",color:"primary",inputmode:"none","item-title":"name","item-value":"id",items:U.value,label:"Filter by Cost Types",multiple:"",spellcheck:"false",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(Q,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[30]||(e[30]=[i(" Start Date Range ")])),_:1}),d("div",je,[t(u,{modelValue:r.start_from,"onUpdate:modelValue":e[2]||(e[2]=l=>r.start_from=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"From",teleport:!0},null,8,["modelValue"]),t(u,{modelValue:r.start_to,"onUpdate:modelValue":e[3]||(e[3]=l=>r.start_to=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"To",teleport:!0},null,8,["modelValue"])])]),_:1}),t(y,{cols:"12",md:"4"},{default:a(()=>[t(Q,{class:"pl-0 pb-1 text-caption text-grey"},{default:a(()=>e[31]||(e[31]=[i("End Date Range")])),_:1}),d("div",Ue,[t(u,{modelValue:r.end_from,"onUpdate:modelValue":e[4]||(e[4]=l=>r.end_from=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"From",teleport:!0},null,8,["modelValue"]),t(u,{modelValue:r.end_to,"onUpdate:modelValue":e[5]||(e[5]=l=>r.end_to=l),"auto-apply":"",class:"flex-1 border rounded-lg px-2 py-1",format:"dd-MM-yyyy","model-type":"format",placeholder:"To",teleport:!0},null,8,["modelValue"])])]),_:1})]),_:1}),d("div",Ae,[t(c,{color:"primary","prepend-icon":"mdi-filter",onClick:b},{default:a(()=>e[32]||(e[32]=[i(" Apply Filters ")])),_:1}),t(c,{class:"ml-2","prepend-icon":"mdi-close-circle",variant:"outlined",onClick:oe},{default:a(()=>e[33]||(e[33]=[i(" Clear ")])),_:1})])]),_:1})]),_:1}),t(x,{elevation:"2",rounded:"lg"},{default:a(()=>[t(F,{class:"pa-0"},{default:a(()=>[t(Ve,{class:"rounded-lg",density:"comfortable",headers:ae,hover:"",items:j.value,loading:N.value},{loading:a(()=>[t(we,{type:"table-row@10"})]),"item.amount":a(({item:l})=>[t(ee,{color:"green",variant:"flat"},{default:a(()=>[i(p(S(l.amount)),1)]),_:2},1024)]),"item.cost_category":a(({item:l})=>[t(ee,{color:le(l.cost_category),variant:"outlined"},{default:a(()=>[i(p(l.cost_category),1)]),_:2},1032,["color"])]),"item.start_date":a(({item:l})=>[i(p(z(l.start_date)),1)]),"item.end_date":a(({item:l})=>[i(p(z(l.end_date)),1)]),"item.actions":a(({item:l})=>[d("div",Ne,[t(X,{location:"top"},{activator:a(({props:C})=>[o.$store.getters.hasTask("can_edit_expenditure")?(w(),$(c,G({key:0},C,{color:"blue",icon:"",size:"small",variant:"text",onClick:ie=>h(!0,l)}),{default:a(()=>[t(g,null,{default:a(()=>e[34]||(e[34]=[i("mdi-pencil")])),_:1})]),_:2},1040,["onClick"])):M("",!0)]),default:a(()=>[e[35]||(e[35]=d("span",null,"Edit",-1))]),_:2},1024),t(X,{location:"top"},{activator:a(({props:C})=>[o.$store.getters.hasTask("can_delete_expenditure")?(w(),$(c,G({key:0},C,{color:"red",icon:"",size:"small",variant:"text",onClick:ie=>ne(l)}),{default:a(()=>[t(g,null,{default:a(()=>e[36]||(e[36]=[i("mdi-delete")])),_:1})]),_:2},1040,["onClick"])):M("",!0)]),default:a(()=>[e[37]||(e[37]=d("span",null,"Delete",-1))]),_:2},1024)])]),"no-data":a(()=>[d("div",Pe,[t(g,{color:"grey-lighten-2",size:"48"},{default:a(()=>e[38]||(e[38]=[i("mdi-inbox")])),_:1}),e[39]||(e[39]=d("div",null,"No expenditures found",-1))])]),_:1},8,["items","loading"]),t(fe),d("div",qe,[d("span",Be," Showing "+p(j.value.length)+" of "+p(R.value)+" records ",1),t(be,{modelValue:A.value,"onUpdate:modelValue":[e[6]||(e[6]=l=>A.value=l),b],color:"primary",length:O.value,"total-visible":7},null,8,["modelValue","length"])])]),_:1})]),_:1}),t(ke,{modelValue:D.value,"onUpdate:modelValue":e[20]||(e[20]=l=>D.value=l),"max-width":"600px",persistent:""},{default:a(()=>[t(x,null,{default:a(()=>[t(ce,{class:"text-white",color:"primary",density:"comfortable"},{default:a(()=>[t(ye,null,{default:a(()=>[i(p(V.value?"Edit Expenditure":"New Expenditure"),1)]),_:1}),t(H),t(c,{color:"white",icon:"mdi-close",variant:"text",onClick:I})]),_:1}),t(F,{class:"pa-4"},{default:a(()=>[t(De,{ref_key:"formRef",ref:te,onSubmit:_e(J,["prevent"])},{default:a(()=>[t(W,{modelValue:s.type_id,"onUpdate:modelValue":e[7]||(e[7]=l=>s.type_id=l),autocomplete:"off",autocorrect:"off",color:"primary","error-messages":n.type_id,inputmode:"none","item-title":"name","item-value":"id",items:U.value,label:"Cost Type *",required:"",spellcheck:"false",variant:"outlined",onBlur:e[8]||(e[8]=l=>f("type_id")),onInput:e[9]||(e[9]=l=>T("type_id"))},{label:a(()=>e[40]||(e[40]=[d("span",{class:"required-field"},"Cost Type",-1)])),_:1},8,["modelValue","error-messages","items"]),t(q,{dense:""},{default:a(()=>[t(y,{cols:"12",md:"6"},{default:a(()=>[d("div",Oe,[e[41]||(e[41]=d("label",{class:"text-caption text-grey mb-1 required-field"},"Start Date *",-1)),t(u,{modelValue:s.start_date,"onUpdate:modelValue":[e[10]||(e[10]=l=>s.start_date=l),e[12]||(e[12]=l=>T("start_date"))],"auto-apply":"",class:K(["rounded-lg","border","px-4","py-2","w-100",n.start_date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"Start Date",teleport:!0,onBlur:e[11]||(e[11]=l=>f("start_date"))},null,8,["modelValue","class"]),n.start_date?(w(),Z("div",Re,p(n.start_date),1)):M("",!0)])]),_:1}),t(y,{cols:"12",md:"6"},{default:a(()=>[d("div",ze,[e[42]||(e[42]=d("label",{class:"text-caption text-grey mb-1 required-field"},"End Date *",-1)),t(u,{modelValue:s.end_date,"onUpdate:modelValue":[e[13]||(e[13]=l=>s.end_date=l),e[15]||(e[15]=l=>L())],"auto-apply":"",class:K(["rounded-lg","border","px-4","py-2","w-100",n.end_date?"error-field":""]),format:"dd-MM-yyyy","model-type":"format",placeholder:"End Date",teleport:!0,onBlur:e[14]||(e[14]=l=>f("end_date"))},null,8,["modelValue","class"]),n.end_date?(w(),Z("div",Le,p(n.end_date),1)):M("",!0)])]),_:1})]),_:1}),t(Ce,{modelValue:s.amount,"onUpdate:modelValue":e[16]||(e[16]=l=>s.amount=l),modelModifiers:{number:!0},autocomplete:"off",autocorrect:"off",color:"primary","error-messages":n.amount,inputmode:"none",label:"Amount *",prefix:"$",required:"",spellcheck:"false",type:"number",variant:"outlined",onBlur:e[17]||(e[17]=l=>f("amount")),onInput:e[18]||(e[18]=l=>T("amount"))},{label:a(()=>e[43]||(e[43]=[d("span",{class:"required-field"},"Amount",-1)])),_:1},8,["modelValue","error-messages"]),t(Ye,{modelValue:s.description,"onUpdate:modelValue":e[19]||(e[19]=l=>s.description=l),color:"primary",label:"Description",rows:"3",variant:"outlined"},null,8,["modelValue"])]),_:1},512)]),_:1}),t(xe,{class:"pa-4"},{default:a(()=>[t(H),t(c,{color:"grey",variant:"outlined",onClick:I},{default:a(()=>e[44]||(e[44]=[i("Cancel")])),_:1}),t(c,{color:"primary",loading:P.value,onClick:J},{default:a(()=>[t(g,{start:""},{default:a(()=>e[45]||(e[45]=[i("mdi-content-save")])),_:1}),i(" "+p(V.value?"Update":"Save"),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(ve,{modelValue:_.show,"onUpdate:modelValue":e[21]||(e[21]=l=>_.show=l),color:_.color,timeout:"3000"},{default:a(()=>[i(p(_.message),1)]),_:1},8,["modelValue","color"])]),_:1})}}},nt=ue(he,[["__scopeId","data-v-ea5bfd9c"]]);export{nt as default};
