import{_ as ae,a1 as oe,r as c,a0 as _,l as se,s as p,v as d,x as a,i as l,y as v,O as z,H as f,C as s,B as n,E as j,$,I as b,F as re,G as ie,af as ne,aM as ue,a3 as B,D as de,a5 as me,ay as A}from"./index-BEY1_AxZ.js";import{u as fe,r as I}from"./index-BpVqu971.js";import{V as F,b as L,c as R}from"./VCard-BWg2kNvx.js";import{V as y}from"./VCol-D55Xswv8.js";import{V as q}from"./VTextField-CUtfiNtd.js";import{V as H,a as ce,b as pe}from"./VDataTable-XrgRokO0.js";import{V as G}from"./VAlert-B1FPeFl4.js";import{V as J}from"./VChip-B31zWpvD.js";import{V as K}from"./VDialog-BZVGdgk4.js";import{V as ve}from"./VForm-DWJZ0vFn.js";import{V as ye}from"./VTextarea-CV8OKWvr.js";import{V as Q}from"./VCheckbox-Cb12dDK0.js";import{V as ge}from"./VContainer-4YzK1OXF.js";import"./dialog-transition-CW_75ERn.js";import"./VSlideGroup-BBNvX3-_.js";const Ve={class:"d-flex justify-space-between align-center"},be={key:0,class:"d-flex gap-4"},ke={class:"d-flex justify-space-between mb-4"},we={class:"d-flex justify-end align-center mt-4"},Ce={class:"d-flex align-center flex-wrap"},xe={class:"text-white font-weight-bold text-h6"},Oe=10,Ee={__name:"Outlets",setup(_e){const k=oe(),i=c(!1),S=c([]),g=c(!1),V=c(!1),m=c(!1),E=c(null),x=c(1),M=c(1),U=_({total_outlets:""}),T=_({total:0,byType:[]}),u=_({search:"",type:""}),N=[{title:"Main Branch",value:"MAIN"},{title:"Shop",value:"SHOP"},{title:"Car",value:"CAR"}],W=[{title:"Name",key:"name"},{title:"Type",key:"type"},{title:"Location",key:"location"},{title:"Main Outlet",key:"is_main",align:"center"},{title:"Active",key:"is_active",align:"center"},{title:"Created",key:"created_at"},{title:"Actions",key:"actions",sortable:!1}],r=_({name:"",type:"",location:"",is_main:!1,is_active:!0}),w=fe({name:{required:I},type:{required:I}},r),P=o=>({MAIN:"primary",SHOP:"success",CAR:"warning"})[o]||"grey";async function C(){i.value=!0;const o=new URLSearchParams({page:x.value,limit:Oe});u.search&&o.append("search",u.search),u.type&&o.append("type",u.type);try{const e=await fetch(`/outlets?${o}`);if(!e.ok)throw new Error("Failed to fetch outlets");const t=await e.json();S.value=t.data||[],M.value=t.totalPages||1,U.total_outlets=t.totalRecords||0}catch(e){console.error("Error loading outlets:",e),k.commit("setMessage",{type:"error",text:"Failed to load outlets"})}finally{i.value=!1}}async function O(){try{const o=await fetch("/outlets/types/count");if(o.ok){const e=await o.json();Object.assign(T,e)}}catch(o){console.error("Error loading type counts:",o)}}function X(){x.value=1,C(),O()}function Y(){u.search="",u.type="",x.value=1,C(),O()}function Z(){m.value=!1,Object.assign(r,{name:"",type:"",location:"",is_main:!1,is_active:!0}),g.value=!0,w.value.$reset()}async function h(o){m.value=!0,E.value=o.id,i.value=!0;try{const e=await fetch(`/outlets/${o.id}`);if(!e.ok)throw new Error("Failed to fetch outlet");const t=await e.json();Object.assign(r,t.outlet),g.value=!0}catch(e){console.error("Error loading outlet:",e),k.commit("setMessage",{type:"error",text:"Failed to load outlet"})}finally{i.value=!1}}function ee(o){E.value=o.id,r.name=o.name,r.is_main=o.is_main,V.value=!0}async function te(){if(w.value.$touch(),w.value.$invalid)return;i.value=!0;const o=m.value?`/outlets/${E.value}`:"/outlets",e=m.value?"PUT":"POST";try{const t=await fetch(o,{method:e,headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!t.ok){const D=await t.json();throw new Error(D.error||"Failed to save outlet")}g.value=!1,C(),O(),k.commit("setMessage",{type:"success",text:m.value?"Outlet updated!":"Outlet added!"})}catch(t){console.error("Error saving outlet:",t),k.commit("setMessage",{type:"error",text:t.message||"Failed to save outlet"})}finally{i.value=!1}}async function le(){i.value=!0;try{const o=await fetch(`/outlets/${E.value}`,{method:"DELETE"});if(!o.ok){const e=await o.json();throw new Error(e.error||"Failed to delete outlet")}V.value=!1,g.value=!1,C(),O(),k.commit("setMessage",{type:"success",text:"Outlet deleted!"})}catch(o){console.error("Error deleting outlet:",o),k.commit("setMessage",{type:"error",text:o.message||"Failed to delete outlet"})}finally{i.value=!1}}return se(()=>{C(),O()}),(o,e)=>(d(),p(ge,{fluid:""},{default:a(()=>[l(F,{class:"pa-4 mb-4"},{default:a(()=>[l(z,{dense:""},{default:a(()=>[l(y,{cols:"12",sm:"4"},{default:a(()=>[l(q,{modelValue:u.search,"onUpdate:modelValue":e[0]||(e[0]=t=>u.search=t),"append-inner-icon":"mdi-close-circle",clearable:"",label:"Search Outlet Name","onClick:appendInner":e[1]||(e[1]=t=>u.search="")},null,8,["modelValue"])]),_:1}),l(y,{cols:"12",sm:"4"},{default:a(()=>[l(H,{modelValue:u.type,"onUpdate:modelValue":e[2]||(e[2]=t=>u.type=t),clearable:"",items:N,label:"Filter by Type"},null,8,["modelValue"])]),_:1}),l(y,{class:"d-flex justify-end",cols:"12"},{default:a(()=>[l(f,{color:"primary",onClick:X},{default:a(()=>[l(n,{start:""},{default:a(()=>e[16]||(e[16]=[s("mdi-filter")])),_:1}),e[17]||(e[17]=s(" Apply "))]),_:1}),l(f,{class:"ml-2",color:"grey",onClick:Y},{default:a(()=>[l(n,{start:""},{default:a(()=>e[18]||(e[18]=[s("mdi-refresh")])),_:1}),e[19]||(e[19]=s(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),l(G,{border:"start",class:"mb-4",type:"info",variant:"outlined"},{default:a(()=>[v("div",Ve,[v("div",null,[e[20]||(e[20]=v("strong",null,"Total Outlets:",-1)),s(" "+b(U.total_outlets||"0"),1)]),T.byType?(d(),j("div",be,[(d(!0),j(re,null,ie(T.byType,t=>(d(),j("span",{key:t.type,class:"text-caption"},[l(J,{class:"mr-1",color:P(t.type),size:"small"},{default:a(()=>[s(b(t.count),1)]),_:2},1032,["color"]),s(" "+b(t.type),1)]))),128))])):$("",!0)])]),_:1}),v("div",ke,[e[23]||(e[23]=v("h3",null,"Outlets",-1)),o.$store.getters.hasTask("can_add_settings")?(d(),p(f,{key:0,class:"text-white",color:"primary",size:"small",onClick:Z},{default:a(()=>[l(n,{start:""},{default:a(()=>e[21]||(e[21]=[s("mdi-plus")])),_:1}),e[22]||(e[22]=s(" Add Outlet "))]),_:1})):$("",!0)]),l(ne,{active:i.value,indeterminate:i.value},null,8,["active","indeterminate"]),l(ce,{class:"elevation-1",dense:"",headers:W,height:"400",items:S.value,loading:i.value},ue({"item.type":a(({item:t})=>[l(J,{color:P(t.type),size:"small",variant:"flat"},{default:a(()=>[s(b(t.type),1)]),_:2},1032,["color"])]),"item.is_main":a(({item:t})=>[t.is_main?(d(),p(n,{key:0,color:"success",size:"small"},{default:a(()=>e[24]||(e[24]=[s(" mdi-check-circle ")])),_:1})):(d(),p(n,{key:1,color:"grey",size:"small"},{default:a(()=>e[25]||(e[25]=[s(" mdi-circle-outline ")])),_:1}))]),"item.is_active":a(({item:t})=>[t.is_active?(d(),p(n,{key:0,color:"success",size:"small"},{default:a(()=>e[26]||(e[26]=[s(" mdi-check-circle ")])),_:1})):(d(),p(n,{key:1,color:"error",size:"small"},{default:a(()=>e[27]||(e[27]=[s(" mdi-close-circle ")])),_:1}))]),_:2},[o.$store.getters.hasTask("can_add_settings")?{name:"item.actions",fn:a(({item:t})=>[l(n,{class:"mr-2",color:"primary",onClick:D=>h(t)},{default:a(()=>e[28]||(e[28]=[s(" mdi-square-edit-outline ")])),_:2},1032,["onClick"]),l(n,{color:"error",disabled:t.is_main,onClick:D=>ee(t)},{default:a(()=>e[29]||(e[29]=[s(" mdi-delete ")])),_:2},1032,["disabled","onClick"])]),key:"0"}:void 0]),1032,["items","loading"]),v("div",we,[l(pe,{modelValue:x.value,"onUpdate:modelValue":[e[3]||(e[3]=t=>x.value=t),C],length:M.value,"total-visible":"7"},null,8,["modelValue","length"])]),l(K,{modelValue:g.value,"onUpdate:modelValue":e[12]||(e[12]=t=>g.value=t),"max-width":"600",transition:"dialog-top-transition"},{default:a(()=>[l(F,{class:"rounded-xl pa-4",elevation:"10"},{default:a(()=>[l(B,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:a(()=>[v("div",Ce,[l(n,{class:"mr-2 text-white"},{default:a(()=>e[30]||(e[30]=[s("mdi-store")])),_:1}),v("span",xe,b(m.value?"Edit Outlet":"Add Outlet"),1)]),l(de),l(f,{color:"white",icon:"mdi-close",onClick:e[4]||(e[4]=t=>g.value=!1)})]),_:1}),l(L,{class:"pt-6"},{default:a(()=>[l(ve,{onSubmit:e[10]||(e[10]=me(()=>{},["prevent"]))},{default:a(()=>[l(z,{dense:""},{default:a(()=>[l(y,{cols:"12",sm:"6"},{default:a(()=>[l(q,{modelValue:r.name,"onUpdate:modelValue":e[5]||(e[5]=t=>r.name=t),"bg-color":"#E0E0E0","error-messages":A(w).name.$errors.map(t=>t.$message),label:"Outlet Name",required:""},null,8,["modelValue","error-messages"])]),_:1}),l(y,{cols:"12",sm:"6"},{default:a(()=>[l(H,{modelValue:r.type,"onUpdate:modelValue":e[6]||(e[6]=t=>r.type=t),"bg-color":"#E0E0E0","error-messages":A(w).type.$errors.map(t=>t.$message),items:N,label:"Outlet Type",required:""},null,8,["modelValue","error-messages"])]),_:1}),l(y,{cols:"12"},{default:a(()=>[l(ye,{modelValue:r.location,"onUpdate:modelValue":e[7]||(e[7]=t=>r.location=t),"bg-color":"#E0E0E0",label:"Location",rows:"2"},null,8,["modelValue"])]),_:1}),l(y,{cols:"12",sm:"6"},{default:a(()=>[l(Q,{modelValue:r.is_main,"onUpdate:modelValue":e[8]||(e[8]=t=>r.is_main=t),color:"primary",disabled:m.value&&!r.is_main,label:"Main Outlet"},null,8,["modelValue","disabled"])]),_:1}),l(y,{cols:"12",sm:"6"},{default:a(()=>[l(Q,{modelValue:r.is_active,"onUpdate:modelValue":e[9]||(e[9]=t=>r.is_active=t),color:"success",label:"Active"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),l(R,{class:"d-flex justify-end mt-2"},{default:a(()=>[l(f,{color:"success",disabled:A(w).$invalid,loading:i.value,onClick:te},{default:a(()=>[l(n,{start:""},{default:a(()=>e[31]||(e[31]=[s("mdi-content-save")])),_:1}),s(" "+b(m.value?"Save Changes":"Add Outlet"),1)]),_:1},8,["disabled","loading"]),m.value?(d(),p(f,{key:0,color:"error",disabled:r.is_main,onClick:e[11]||(e[11]=t=>V.value=!0)},{default:a(()=>[l(n,{start:""},{default:a(()=>e[32]||(e[32]=[s("mdi-delete")])),_:1}),e[33]||(e[33]=s(" Delete "))]),_:1},8,["disabled"])):$("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(K,{modelValue:V.value,"onUpdate:modelValue":e[15]||(e[15]=t=>V.value=t),persistent:"",width:"400"},{default:a(()=>[l(F,null,{default:a(()=>[l(B,{color:"warning",title:"Confirm Deleting "+r.name},{default:a(()=>[l(f,{color:"white",icon:"mdi-close",onClick:e[13]||(e[13]=t=>V.value=!1)})]),_:1},8,["title"]),l(L,null,{default:a(()=>[s(" Are you sure you want to delete "+b(r.name)+"? ",1),r.is_main?(d(),p(G,{key:0,class:"mt-2",dense:"",type:"error"},{default:a(()=>e[34]||(e[34]=[s(" Cannot delete main outlet. Set another outlet as main first. ")])),_:1})):$("",!0)]),_:1}),l(R,{class:"d-flex justify-end"},{default:a(()=>[l(f,{color:"grey",onClick:e[14]||(e[14]=t=>V.value=!1)},{default:a(()=>e[35]||(e[35]=[s("Cancel")])),_:1}),l(f,{color:"error",disabled:r.is_main,loading:i.value,onClick:le},{default:a(()=>e[36]||(e[36]=[s(" Delete ")])),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},qe=ae(Ee,[["__scopeId","data-v-664d736a"]]);export{qe as default};
