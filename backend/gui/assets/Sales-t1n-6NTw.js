import{g as mt,p as ct,ag as ft,r as k,ah as Ae,ai as vt,aj as pt,a7 as ot,ak as yt,d as z,al as Pe,am as Te,an as gt,c as ke,ao as nt,f as bt,h as t,x as u,A as b,ap as _t,F as se,a5 as Z,K as xt,L as ut,O as Ue,aq as Vt,z as ue,ar as kt,n as ht,i as rt,as as wt,B as s,a9 as Ct,at as St,ab as Dt,au as st,av as It,aw as At,_ as Pt,$ as it,k as Tt,q as ae,v as l,a0 as qt,t as D,N as ce,Z as ne,G as I,ae as Et,H as v,C as Ve,a2 as et,a3 as tt,D as W,E as qe}from"./index-H50W8i2e.js";import{V as Nt}from"./VContainer-DMI-Talr.js";import{V as F,b as K,a as Ee,c as Ge}from"./VCard-C5kPO-IU.js";import{V}from"./VCol-DKsUkiwi.js";import{u as Ut,h as Ft,i as zt,f as Rt,j as Ot,k as $t,l as Mt,n as Lt,o as Bt,V as Ne,a as jt,b as Kt,g as Gt}from"./VDataTable-DzzvSt4O.js";import{u as Ht,V as te,c as Qt}from"./VTextField-DlorsO1F.js";import{V as lt}from"./VTooltip-DwwKazbP.js";import{V as Y}from"./VChip-CknWNZ2i.js";import{V as at}from"./VDialog-CbIFtiIj.js";import{V as Jt}from"./VTextarea-D4NHbpGV.js";import{V as He}from"./VAlert-BPfj7QNO.js";import{V as Wt}from"./VAutocomplete-CV6x0zIW.js";import"./dialog-transition-CzUKY-Zy.js";import"./VSlideGroup-CGGaxYAb.js";const Yt=ct({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...Bt({filterKeys:["title"]}),...Lt({hideNoData:!0,returnObject:!0}),...Dt(Qt({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...St({transition:!1})},"VCombobox"),Zt=mt()({name:"VCombobox",props:Yt(),emits:{"update:focused":i=>!0,"update:modelValue":i=>!0,"update:search":i=>!0,"update:menu":i=>!0},setup(i,R){var Be;let{emit:G,slots:g}=R;const{t:he}=ft(),N=k(),O=Ae(!1),H=Ae(!0),ie=Ae(!1),fe=k(),re=k(),_=Ae(-1);let X=!1;const{items:oe,transformIn:$,transformOut:le}=vt(i),{textColorClasses:A,textColorStyles:Fe}=pt(()=>{var n;return(n=N.value)==null?void 0:n.color}),m=ot(i,"modelValue",[],n=>$(yt(n)),n=>{const p=le(n);return i.multiple?p:p[0]??null}),P=Ht(i),de=z(()=>!!(i.chips||g.chip)),T=z(()=>de.value||!!g.selection),d=Ae(!i.multiple&&!T.value?((Be=m.value[0])==null?void 0:Be.title)??"":""),w=z({get:()=>d.value,set:async n=>{var p;if(d.value=n??"",!i.multiple&&!T.value&&(m.value=[Pe(i,n)],Te(()=>{var h;return(h=re.value)==null?void 0:h.scrollToIndex(0)})),n&&i.multiple&&((p=i.delimiters)!=null&&p.length)){const h=i.delimiters.map(gt).join("|"),f=n.split(new RegExp(`(?:${h})+`));if(f.length>1){for(let x of f)x=x.trim(),x&&(L(Pe(i,x)),await Te());d.value=""}}n||(_.value=-1),H.value=!n}}),me=z(()=>typeof i.counterValue=="function"?i.counterValue(m.value):typeof i.counterValue=="number"?i.counterValue:i.multiple?m.value.length:w.value.length),{filteredItems:ve,getMatches:Qe}=Ut(i,oe,()=>i.alwaysFilter||!H.value?w.value:""),ee=z(()=>i.hideSelected?ve.value.filter(n=>!m.value.some(p=>p.value===n.value)):ve.value),Q=z(()=>i.hideNoData&&!ee.value.length||P.isReadonly.value||P.isDisabled.value),we=ot(i,"menu"),C=z({get:()=>we.value,set:n=>{var p;we.value&&!n&&((p=fe.value)!=null&&p.Î¨openChildren.size)||n&&Q.value||(we.value=n)}}),{menuId:ze,ariaExpanded:Re,ariaControls:M,ariaLabel:q}=Ft(i,C);ke(d,n=>{X?Te(()=>X=!1):O.value&&!C.value&&(C.value=!0),G("update:search",n)}),ke(m,n=>{var p;!i.multiple&&!T.value&&(d.value=((p=n[0])==null?void 0:p.title)??"")});const pe=z(()=>m.value.map(n=>n.value)),ye=z(()=>{var p;return(i.autoSelectFirst===!0||i.autoSelectFirst==="exact"&&w.value===((p=ee.value[0])==null?void 0:p.title))&&ee.value.length>0&&!H.value&&!ie.value}),ge=k(),Ce=zt(ge,N);function Oe(n){X=!0,Te(()=>X=!1),i.openOnClear&&(C.value=!0)}function $e(){Q.value||(C.value=!0)}function Je(n){Q.value||(O.value&&(n.preventDefault(),n.stopPropagation()),C.value=!C.value)}function We(n){var p;(st(n)||n.key==="Backspace")&&((p=N.value)==null||p.focus())}function Me(n){var f,x,S,B;if(It(n)||P.isReadonly.value)return;const p=(f=N.value)==null?void 0:f.selectionStart,h=m.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(n.key)&&n.preventDefault(),["Enter","ArrowDown"].includes(n.key)&&(C.value=!0),["Escape"].includes(n.key)&&(C.value=!1),["Enter","Escape","Tab"].includes(n.key)&&(ye.value&&["Enter","Tab"].includes(n.key)&&!m.value.some(y=>{let{value:U}=y;return U===ee.value[0].value})&&L(ve.value[0]),H.value=!0),n.key==="ArrowDown"&&ye.value&&((x=ge.value)==null||x.focus("next")),n.key==="Enter"&&w.value&&(L(Pe(i,w.value)),T.value&&(d.value="")),["Backspace","Delete"].includes(n.key)){if(!i.multiple&&T.value&&m.value.length>0&&!w.value)return L(m.value[0],!1);if(~_.value){n.preventDefault();const y=_.value;L(m.value[_.value],!1),_.value=y>=h-1?h-2:y}else n.key==="Backspace"&&!w.value&&(_.value=h-1);return}if(i.multiple)if(n.key==="ArrowLeft"){if(_.value<0&&p&&p>0)return;const y=_.value>-1?_.value-1:h-1;m.value[y]?_.value=y:(_.value=-1,(S=N.value)==null||S.setSelectionRange(w.value.length,w.value.length))}else if(n.key==="ArrowRight"){if(_.value<0)return;const y=_.value+1;m.value[y]?_.value=y:(_.value=-1,(B=N.value)==null||B.setSelectionRange(0,0))}else~_.value&&st(n)&&(_.value=-1)}function Se(){var n;i.eager&&((n=re.value)==null||n.calculateVisibleItems())}function Ye(){var n;O.value&&(H.value=!0,(n=N.value)==null||n.focus())}function L(n){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!n||n.props.disabled))if(i.multiple){const h=m.value.findIndex(x=>(i.valueComparator||nt)(x.value,n.value)),f=p??!~h;if(~h){const x=f?[...m.value,n]:[...m.value];x.splice(h,1),m.value=x}else f&&(m.value=[...m.value,n]);i.clearOnSelect&&(w.value="")}else{const h=p!==!1;m.value=h?[n]:[],d.value=h&&!T.value?n.title:"",Te(()=>{C.value=!1,H.value=!0})}}function be(n){O.value=!0,setTimeout(()=>{ie.value=!0})}function Le(n){ie.value=!1}function Ze(n){(n==null||n===""&&!i.multiple&&!T.value)&&(m.value=[])}return ke(O,(n,p)=>{if(!(n||n===p)&&(_.value=-1,C.value=!1,w.value)){if(i.multiple){L(Pe(i,w.value));return}if(!T.value)return;m.value.some(h=>{let{title:f}=h;return f===w.value})?d.value="":L(Pe(i,w.value))}}),ke(C,()=>{if(!i.hideSelected&&C.value&&m.value.length){const n=ee.value.findIndex(p=>m.value.some(h=>(i.valueComparator||nt)(h.value,p.value)));At&&window.requestAnimationFrame(()=>{var p;n>=0&&((p=re.value)==null||p.scrollToIndex(n))})}}),ke(oe,(n,p)=>{C.value||O.value&&!p.length&&n.length&&(C.value=!0)}),bt(()=>{const n=!!(!i.hideNoData||ee.value.length||g["prepend-item"]||g["append-item"]||g["no-data"]),p=m.value.length>0,h=te.filterProps(i);return t(te,Z({ref:N},h,{modelValue:w.value,"onUpdate:modelValue":[f=>w.value=f,Ze],focused:O.value,"onUpdate:focused":f=>O.value=f,validationValue:m.externalValue,counterValue:me.value,dirty:p,class:["v-combobox",{"v-combobox--active-menu":C.value,"v-combobox--chips":!!i.chips,"v-combobox--selection-slot":!!T.value,"v-combobox--selecting-index":_.value>-1,[`v-combobox--${i.multiple?"multiple":"single"}`]:!0},i.class],style:i.style,readonly:P.isReadonly.value,placeholder:p?void 0:i.placeholder,"onClick:clear":Oe,"onMousedown:control":$e,onKeydown:Me,"aria-expanded":Re.value,"aria-controls":M.value}),{...g,default:()=>u(se,null,[t(Rt,Z({id:ze.value,ref:fe,modelValue:C.value,"onUpdate:modelValue":f=>C.value=f,activator:"parent",contentClass:"v-combobox__content",disabled:Q.value,eager:i.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:i.transition,onAfterEnter:Se,onAfterLeave:Ye},i.menuProps),{default:()=>[n&&t(xt,Z({ref:ge,filterable:!0,selected:pe.value,selectStrategy:i.multiple?"independent":"single-independent",onMousedown:f=>f.preventDefault(),selectable:!0,onKeydown:We,onFocusin:be,onFocusout:Le,tabindex:"-1","aria-live":"polite",color:i.itemColor??i.color},Ce,i.listProps),{default:()=>{var f,x,S;return[(f=g["prepend-item"])==null?void 0:f.call(g),!ee.value.length&&!i.hideNoData&&(((x=g["no-data"])==null?void 0:x.call(g))??t(ut,{key:"no-data",title:he(i.noDataText)},null)),t(Ot,{ref:re,renderless:!0,items:ee.value,itemKey:"value"},{default:B=>{var De,je,Ke;let{item:y,index:U,itemRef:E}=B;const _e=Z(y.props,{ref:E,key:y.value,active:ye.value&&U===0?!0:void 0,onClick:()=>L(y,null)});return y.type==="divider"?((De=g.divider)==null?void 0:De.call(g,{props:y.raw,index:U}))??t(Ue,Z(y.props,{key:`divider-${U}`}),null):y.type==="subheader"?((je=g.subheader)==null?void 0:je.call(g,{props:y.raw,index:U}))??t(Vt,Z(y.props,{key:`subheader-${U}`}),null):((Ke=g.item)==null?void 0:Ke.call(g,{item:y,index:U,props:_e}))??t(ut,Z(_e,{role:"option"}),{prepend:xe=>{let{isSelected:Xe}=xe;return u(se,null,[i.multiple&&!i.hideSelected?t(Mt,{key:y.value,modelValue:Xe,ripple:!1,tabindex:"-1"},null):void 0,y.props.prependAvatar&&t(ue,{image:y.props.prependAvatar},null),y.props.prependIcon&&t(b,{icon:y.props.prependIcon},null)])},title:()=>{var xe;return H.value?y.title:$t("v-combobox",y.title,(xe=Qe(y))==null?void 0:xe.title)}})}}),(S=g["append-item"])==null?void 0:S.call(g)]}})]}),m.value.map((f,x)=>{function S(E){E.stopPropagation(),E.preventDefault(),L(f,!1)}const B={"onClick:close":S,onKeydown(E){E.key!=="Enter"&&E.key!==" "||(E.preventDefault(),E.stopPropagation(),S(E))},onMousedown(E){E.preventDefault(),E.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},y=de.value?!!g.chip:!!g.selection,U=y?kt(de.value?g.chip({item:f,index:x,props:B}):g.selection({item:f,index:x})):void 0;if(!(y&&!U))return u("div",{key:f.value,class:rt(["v-combobox__selection",x===_.value&&["v-combobox__selection--selected",A.value]]),style:ht(x===_.value?Fe.value:{})},[de.value?g.chip?t(wt,{key:"chip-defaults",defaults:{VChip:{closable:i.closableChips,size:"small",text:f.title}}},{default:()=>[U]}):t(Y,Z({key:"chip",closable:i.closableChips,size:"small",text:f.title,disabled:f.props.disabled},B),null):U??u("span",{class:"v-combobox__selection-text"},[f.title,i.multiple&&x<m.value.length-1&&u("span",{class:"v-combobox__selection-comma"},[s(",")])])])})]),"append-inner":function(){var B,y;for(var f=arguments.length,x=new Array(f),S=0;S<f;S++)x[S]=arguments[S];return u(se,null,[(B=g["append-inner"])==null?void 0:B.call(g,...x),(!i.hideNoData||i.items.length)&&i.menuIcon?t(b,{class:"v-combobox__menu-icon",color:(y=N.value)==null?void 0:y.fieldIconColor,icon:i.menuIcon,onMousedown:Je,onClick:_t,"aria-label":q.value,title:q.value,tabindex:"-1"},null):void 0])}})}),Ct({isFocused:O,isPristine:H,menu:C,search:w,selectionIndex:_,filteredItems:ve,select:L},N)}}),Xt={class:"d-flex align-center"},el={class:"d-flex align-center"},tl={class:"font-weight-medium"},ll={class:"d-flex align-center"},al={class:"font-weight-medium"},ol={class:"text-right font-weight-bold"},nl={class:"text-right"},ul={class:"d-flex justify-end"},sl={class:"d-flex align-center"},il={class:"text-h6 font-weight-bold text-blue-darken-3"},rl={key:1,class:"text-center py-8"},dl={class:"text-right"},ml={class:"text-h6"},cl={class:"d-flex align-center"},fl={class:"d-flex justify-end"},vl={class:"text-right mr-6"},pl={class:"text-error"},yl={class:"d-flex align-center mb-4"},gl={class:"text-h5 font-weight-bold"},bl={class:"d-flex align-center"},_l={class:"text-body-1 font-weight-medium"},xl={class:"d-flex align-center mb-4"},Vl={class:"text-body-1 font-weight-medium"},kl={class:"d-flex align-center"},hl={class:"text-body-1 font-weight-medium"},wl={class:"text-left"},Cl={class:"text-center"},Sl={class:"text-center"},Dl={class:"text-right"},Il={class:"text-right"},Al={class:"text-right pa-4"},Pl={class:"mb-1"},Tl={class:"text-h6"},ql={class:"text-error mt-1"},El={class:"text-body-1 text-grey mb-4"},Nl={class:"font-weight-bold text-error"},Ul={__name:"Sales",setup(i){const R=qt(),G=k(!1),g=k(!1),he=k(!1),N=k([]),O=k([]),H=k([]),ie=k([]),fe=k(1),re=k(1),_=k(!1),X=k(!1),oe=k(!1),$=k(!1),le=k(null),A=k(null),Fe=k([]),m=it({outlet_id:[],start_date:"",end_date:"",payment_status:""}),P=k(null),de=k(""),T=new Date().toISOString().split("T")[0],d=it({outlet_id:"",sale_date:T,notes:"",items:[],payments:[]}),w=k([]),me=k([]),ve=[{title:"ID",key:"id"},{title:"Date",key:"sale_date"},{title:"Outlet",key:"outlet"},{title:"Customer",key:"customer_name"},{title:"Items",key:"items_count",align:"center"},{title:"Qty",key:"total_qty",align:"center"},{title:"Total",key:"total_amount",align:"end"},{title:"Paid",key:"paid_amount",align:"end"},{title:"Balance",key:"balance",align:"end"},{title:"Actions",key:"actions",sortable:!1}],Qe=[{title:"Good",value:"GOOD"},{title:"Damaged",value:"DAMAGED"},{title:"Reject",value:"REJECT"}],ee=["CASH","MOBILE","CARD","BANK"],Q=k(!0),we=z(()=>d.items.reduce((o,e)=>o+Number(e.quantity||0)*Number(e.unit_price||0),0)),C=z(()=>we.value),ze=z(()=>d.payments.reduce((o,e)=>o+Number(e.amount||0),0)),Re=z(()=>d.outlet_id&&d.sale_date&&d.items.length>0&&w.value.length===0&&me.value.length===0),M=z(()=>{const o=d.items.reduce((c,r)=>c+Me(r),0),e=d.payments.reduce((c,r)=>c+Number(r.amount||0),0),a=Math.max(o-e,0);return{total:o,paid:e,balance:a}});ke(()=>M.value.total,o=>{d.payments.length>0&&Q.value&&(d.payments[0].amount=o)});function q(o){return Number(o||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function pe(o){const e=Number(o||0);return new Intl.NumberFormat().format(e)}function ye(o){return new Date(o).toLocaleDateString()}function ge(o){return{MAIN:"mdi-home",SHOP:"mdi-store",CAR:"mdi-truck"}[o]||"mdi-store"}function Ce(o){return{MAIN:"primary",SHOP:"success",CAR:"warning"}[o]||"grey"}function Oe(o){return{GOOD:"success",DAMAGED:"warning",REJECT:"error"}[o]||"grey"}function $e(){d.items.push({product_id:"",quality:"GOOD",quantity:"",unit_price:"",stockData:null}),f()}function Je(o){d.items.splice(o,1),f()}function We(o){o===0&&(Q.value=!1)}function Me(o){return Number(o.quantity||0)*Number(o.unit_price||0)}function Se(o){return o.stockData&&o.stockData[o.quality]||0}async function Ye(o){const e=ie.value.find(a=>a.id===o.product_id);e&&(o.unit_price===""||o.unit_price==null)&&(o.unit_price=Number(e.price||0)),await be(o),f()}async function L(o){await be(o),f()}async function be(o){if(!d.outlet_id||!o.product_id){o.stockData=null;return}try{const a=await(await fetch(`/stocktransfers/availableByQuality?outlet_id=${d.outlet_id}&product_id=${o.product_id}`)).json();o.stockData=a.stock||{GOOD:0,DAMAGED:0,REJECT:0}}catch(e){console.error("Stock check failed:",e),o.stockData=null}}function Le(o){return!o.product_id||!o.quality||!o.quantity?!1:Number(o.quantity)>Number(Se(o)||0)}function Ze(o){return o.product_id?`Available: ${Se(o)}`:"Pick a product"}function Be(o){o.unit_price===""||o.unit_price==null||(o.unit_price=Number(o.unit_price),(isNaN(o.unit_price)||o.unit_price<0)&&(o.unit_price=0))}function n(o){if(typeof o=="string"){P.value=o.trim()||null;return}if(o&&typeof o=="object"){P.value={id:o.id??null,name:o.name??""};return}P.value=null}function p(){d.payments.push({amount:"",method:"CASH",reference:"",payment_date:T}),d.payments.length===1&&(Q.value=!0,M.value.total>0&&(d.payments[0].amount=M.value.total)),f()}function h(o){d.payments.splice(o,1),o===0&&(Q.value=!0),f()}function f(){const o=[];d.outlet_id||o.push("Outlet is required."),d.sale_date||o.push("Sale date is required.");const e=new Set;d.items.forEach((a,c)=>{const r=c+1;if(a.product_id||o.push(`Item ${r}: product is required.`),a.quality||o.push(`Item ${r}: quality is required.`),(a.quantity===""||Number(a.quantity)<=0)&&o.push(`Item ${r}: quantity is required and must be > 0.`),(a.unit_price===""||Number(a.unit_price)<0)&&o.push(`Item ${r}: unit price is required and cannot be negative.`),Le(a)&&o.push(`Item ${r}: insufficient ${a.quality} stock.`),a.product_id&&a.quality){const j=`${a.product_id}|${a.quality}`;e.has(j)&&o.push(`Duplicate product and quality detected on item ${c+1}.`),e.add(j)}}),w.value=o,x()}function x(){const o=[];let e=0;d.payments.forEach((a,c)=>{a.amount===""||Number(a.amount)<=0?o.push(`Payment ${c+1}: amount is required and must be > 0, or delete the row.`):e+=Number(a.amount)}),e>M.value.total&&o.push("Total payment amount cannot exceed sale total."),me.value=o}async function S(){var e;G.value=!0;const o=new URLSearchParams({page:fe.value,limit:10});(e=m.outlet_id)!=null&&e.length?m.outlet_id.forEach(a=>o.append("outlet_id[]",a)):R.state.auth.outlets.length&&R.state.auth.outlets.forEach(a=>o.append("outlet_id[]",a.outlet_id)),m.start_date&&o.append("start_date",m.start_date),m.end_date&&o.append("end_date",m.end_date),m.payment_status&&o.append("payment_status",m.payment_status);try{const c=await(await fetch(`/sales?${o}`)).json();N.value=c.data||[],re.value=c.totalPages||1}catch{R.commit("setMessage",{type:"error",text:"Failed to load sales"})}finally{G.value=!1}}function B(){m.outlet_id="",m.start_date="",m.end_date="",m.payment_status="",S()}function y(){$.value=!1,le.value=null,De(),_.value=!0}async function U(o){var e;$.value=!0,le.value=o.id,G.value=!0;try{const c=await(await fetch(`/sales/${o.id}`)).json();d.outlet_id=c.sale.outlet_id,d.sale_date=((e=c.sale.sale_date)==null?void 0:e.split("T")[0])||T,d.notes=c.sale.notes||"",P.value=c.sale.customer_id||null,de.value=c.sale.customer_name||"",d.items=(c.items||[]).map(r=>({product_id:r.product_id,quality:r.quality,quantity:String(r.quantity),unit_price:Number(r.unit_price),stockData:null})),d.payments=(c.payments||[]).map(r=>{var j;return{amount:String(r.amount),method:r.method||"CASH",reference:r.reference||"",payment_date:((j=r.payment_date)==null?void 0:j.split("T")[0])||T}}),Q.value=!1;for(const r of d.items)await be(r);f(),_.value=!0}catch{R.commit("setMessage",{type:"error",text:"Failed to load sale"})}finally{G.value=!1}}async function E(o){le.value=o.id,G.value=!0;try{const a=await(await fetch(`/sales/${o.id}`)).json();A.value={...a.sale,outlet:a.sale.outlet_name,outlet_type:a.sale.outlet_type},Fe.value=a.items||[],X.value=!0}catch{R.commit("setMessage",{type:"error",text:"Failed to load sale details"})}finally{G.value=!1}}function _e(){_.value=!1,De()}function De(){d.outlet_id="",d.sale_date=T,d.notes="",d.items=[],d.payments=[],p(),P.value=null,de.value="",w.value=[],me.value=[],Q.value=!0}function je(o){le.value=o.id,oe.value=!0}async function Ke(){he.value=!0;try{if(!(await fetch(`/sales/${le.value}`,{method:"DELETE"})).ok)throw new Error("Failed to delete");R.commit("setMessage",{type:"success",text:"Sale deleted successfully"}),oe.value=!1,S()}catch{R.commit("setMessage",{type:"error",text:"Failed to delete sale"})}finally{he.value=!1}}async function xe(){for(const o of d.items)await be(o);f()}async function Xe(){var c;if(f(),!Re.value)return;g.value=!0;const o={outlet_id:d.outlet_id,sale_date:d.sale_date,notes:d.notes||null,items:d.items.map(r=>({product_id:r.product_id,quality:r.quality,quantity:Number(r.quantity),unit_price:Number(r.unit_price)})),payments:d.payments.map(r=>({amount:Number(r.amount),method:r.method||null,reference:r.reference||null,payment_date:r.payment_date||d.sale_date}))};typeof P.value=="string"?(o.customer_id=null,o.customer_name=P.value):(c=P.value)!=null&&c.id?(o.customer_id=P.value.id,o.customer_name=P.value.name):(o.customer_id=null,o.customer_name=null);const e=$.value?`/sales/${le.value}`:"/sales",a=$.value?"PUT":"POST";try{const r=await fetch(e,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!r.ok)throw new Error("Failed to save sale");const j=await r.json();R.commit("setMessage",{type:"success",text:$.value?"Sale updated successfully":"Sale created successfully"}),_e(),S()}catch{R.commit("setMessage",{type:"error",text:"Failed to save sale"})}finally{g.value=!1}}async function dt(){try{const o=new URLSearchParams({limit:1e3});R.state.auth.outlets.length?R.state.auth.outlets.forEach(r=>o.append("id[]",r.outlet_id)):o.append("id[]",-1);const[e,a,c]=await Promise.all([fetch(`/outlets?${o}`),fetch("/products?limit=1000"),fetch("/customers?limit=1000")]);O.value=(await e.json()).data||[],ie.value=(await a.json()).data||[],H.value=(await c.json()).data||[]}catch(o){console.error("Init data load failed:",o)}}return Tt(()=>{S(),dt()}),(o,e)=>(D(),ae(Nt,{class:"bg-grey-lighten-4 pa-6",fluid:""},{default:l(()=>[t(F,{class:"mb-6",elevation:"2"},{default:l(()=>[t(K,{class:"pa-6"},{default:l(()=>[t(ce,{align:"center"},{default:l(()=>[t(V,{cols:"12",md:"6"},{default:l(()=>[u("div",Xt,[t(ue,{class:"mr-4",color:"primary",size:"56"},{default:l(()=>[t(b,{color:"white",size:"32"},{default:l(()=>e[16]||(e[16]=[s("mdi-receipt-text")])),_:1})]),_:1}),e[17]||(e[17]=u("div",null,[u("h1",{class:"text-h4 font-weight-bold text-primary"},"Sales"),u("p",{class:"text-body-1 text-grey mt-1"}," Create and manage posted sales per outlet with part payments ")],-1))])]),_:1}),t(V,{class:"text-right",cols:"12",md:"6"},{default:l(()=>[o.$store.getters.hasTask("can_add_sale")?(D(),ae(I,{key:0,color:"primary",size:"large",onClick:y},{default:l(()=>[t(b,{start:""},{default:l(()=>e[18]||(e[18]=[s("mdi-plus")])),_:1}),e[19]||(e[19]=s(" New Sale "))]),_:1})):ne("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(F,{class:"mb-6",elevation:"1"},{default:l(()=>[t(K,{class:"pa-4"},{default:l(()=>[t(ce,{align:"center",dense:""},{default:l(()=>[t(V,{cols:"12",sm:"3"},{default:l(()=>[t(Ne,{modelValue:m.outlet_id,"onUpdate:modelValue":e[0]||(e[0]=a=>m.outlet_id=a),clearable:"",density:"comfortable","item-title":"name","item-value":"id",items:O.value,label:"Outlet",multiple:"","prepend-inner-icon":"mdi-store",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(V,{cols:"12",sm:"3"},{default:l(()=>[t(te,{modelValue:m.start_date,"onUpdate:modelValue":e[1]||(e[1]=a=>m.start_date=a),autocomplete:"off",autocorrect:"off",clearable:"",density:"comfortable",inputmode:"none",label:"Start Date","prepend-inner-icon":"mdi-calendar",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",sm:"3"},{default:l(()=>[t(te,{modelValue:m.end_date,"onUpdate:modelValue":e[2]||(e[2]=a=>m.end_date=a),autocomplete:"off",autocorrect:"off",clearable:"",density:"comfortable",inputmode:"none",label:"End Date","prepend-inner-icon":"mdi-calendar",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",sm:"3"},{default:l(()=>[t(Ne,{modelValue:m.payment_status,"onUpdate:modelValue":e[3]||(e[3]=a=>m.payment_status=a),clearable:"",density:"comfortable",items:[{title:"All",value:""},{title:"Fully Paid",value:"PAID"},{title:"Part Paid",value:"PART"}],label:"Payment Status","prepend-inner-icon":"mdi-filter",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(V,{class:"d-flex justify-end",cols:"12"},{default:l(()=>[t(I,{class:"mr-2",color:"primary",variant:"flat",onClick:S},{default:l(()=>[t(b,{start:""},{default:l(()=>e[20]||(e[20]=[s("mdi-magnify")])),_:1}),e[21]||(e[21]=s(" Search "))]),_:1}),t(I,{color:"grey",variant:"outlined",onClick:B},{default:l(()=>[t(b,{start:""},{default:l(()=>e[22]||(e[22]=[s("mdi-refresh")])),_:1}),e[23]||(e[23]=s(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(F,{class:"rounded-lg",elevation:"2"},{default:l(()=>[t(Et,{active:G.value,color:"primary",height:"4",indeterminate:G.value},null,8,["active","indeterminate"]),t(jt,{class:"elevation-0",headers:ve,items:N.value,"items-per-page":10,loading:G.value,"loading-text":"Loading sales...","no-data-text":"No sales found"},{top:l(()=>[t(Ee,{class:"d-flex align-center pt-4"},{default:l(()=>[t(b,{class:"mr-2",color:"primary"},{default:l(()=>e[24]||(e[24]=[s("mdi-format-list-bulleted")])),_:1}),e[25]||(e[25]=s(" Recent Sales ")),t(Y,{class:"ml-3",color:"primary",size:"small",variant:"flat"},{default:l(()=>[s(v(N.value.length)+" total ",1)]),_:1})]),_:1}),t(Ue)]),"item.sale_date":l(({item:a})=>[u("div",el,[t(b,{class:"mr-2",color:"grey",size:"16"},{default:l(()=>e[26]||(e[26]=[s("mdi-calendar")])),_:1}),u("span",tl,v(ye(a.sale_date)),1)])]),"item.outlet":l(({item:a})=>[u("div",ll,[t(ue,{class:"mr-2",color:Ce(a.outlet_type),size:"28"},{default:l(()=>[t(b,{color:"white",size:"14"},{default:l(()=>[s(v(ge(a.outlet_type)),1)]),_:2},1024)]),_:2},1032,["color"]),u("div",al,v(a.outlet),1)])]),"item.customer_name":l(({item:a})=>[t(Y,{color:a.customer_name?"primary":"grey",size:"small",variant:"flat"},{default:l(()=>[s(v(a.customer_name||"Walk-in"),1)]),_:2},1032,["color"])]),"item.total_qty":l(({item:a})=>[t(Y,{color:"green",size:"small",variant:"flat"},{default:l(()=>[s(v(a.total_qty),1)]),_:2},1024)]),"item.total_amount":l(({item:a})=>[u("div",ol,v(q(a.total_amount)),1)]),"item.paid_amount":l(({item:a})=>[u("div",nl,v(q(a.paid_amount)),1)]),"item.balance":l(({item:a})=>[u("div",{class:rt(["text-right",Number(a.balance)>0?"text-error":"text-grey"])},v(q(a.balance)),3)]),"item.actions":l(({item:a})=>[u("div",ul,[t(lt,{location:"top"},{activator:l(({props:c})=>[t(I,Z(c,{color:"info",icon:"",size:"small",variant:"text",onClick:r=>E(a)}),{default:l(()=>[t(b,null,{default:l(()=>e[27]||(e[27]=[s("mdi-eye-outline")])),_:1})]),_:2},1040,["onClick"])]),default:l(()=>[e[28]||(e[28]=u("span",null,"View",-1))]),_:2},1024),t(lt,{location:"top"},{activator:l(({props:c})=>[o.$store.getters.hasTask("can_edit_sale")?(D(),ae(I,Z({key:0},c,{color:"primary",icon:"",size:"small",variant:"text",onClick:r=>U(a)}),{default:l(()=>[t(b,null,{default:l(()=>e[29]||(e[29]=[s("mdi-pencil-outline")])),_:1})]),_:2},1040,["onClick"])):ne("",!0)]),default:l(()=>[e[30]||(e[30]=u("span",null,"Edit",-1))]),_:2},1024),t(lt,{location:"top"},{activator:l(({props:c})=>[o.$store.getters.hasTask("can_delete_sale")?(D(),ae(I,Z({key:0},c,{color:"error",icon:"",size:"small",variant:"text",onClick:r=>je(a)}),{default:l(()=>[t(b,null,{default:l(()=>e[31]||(e[31]=[s("mdi-delete-outline")])),_:1})]),_:2},1040,["onClick"])):ne("",!0)]),default:l(()=>[e[32]||(e[32]=u("span",null,"Delete",-1))]),_:2},1024)])]),_:1},8,["items","loading"]),t(Ge,{class:"px-4 py-3 bg-grey-lighten-3"},{default:l(()=>[t(Ve),t(Kt,{modelValue:fe.value,"onUpdate:modelValue":[e[4]||(e[4]=a=>fe.value=a),S],color:"primary",length:re.value,"total-visible":"7"},null,8,["modelValue","length"])]),_:1})]),_:1}),t(at,{modelValue:_.value,"onUpdate:modelValue":e[10]||(e[10]=a=>_.value=a),"max-width":"1200",persistent:"",scrollable:""},{default:l(()=>[t(F,{class:"rounded-lg"},{default:l(()=>[t(et,{color:$.value?"warning":"primary",density:"comfortable"},{default:l(()=>[t(ue,{class:"mr-3",color:$.value?"warning":"primary",size:"40"},{default:l(()=>[t(b,{color:"white"},{default:l(()=>[s(v($.value?"mdi-pencil":"mdi-plus"),1)]),_:1})]),_:1},8,["color"]),t(tt,{class:"text-h6 font-weight-bold"},{default:l(()=>[s(v($.value?"Edit Sale":"Create New Sale"),1)]),_:1}),t(Ve),t(I,{icon:"",onClick:_e},{default:l(()=>[t(b,null,{default:l(()=>e[33]||(e[33]=[s("mdi-close")])),_:1})]),_:1})]),_:1},8,["color"]),t(K,{class:"pa-6"},{default:l(()=>[t(F,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(Ee,{class:"d-flex align-center bg-blue-lighten-5"},{default:l(()=>[t(b,{class:"mr-2",color:"primary"},{default:l(()=>e[34]||(e[34]=[s("mdi-information")])),_:1}),e[35]||(e[35]=s(" Sale Information "))]),_:1}),t(K,{class:"pa-4"},{default:l(()=>[t(ce,null,{default:l(()=>[t(V,{cols:"12",md:"4"},{default:l(()=>[t(Ne,{modelValue:d.outlet_id,"onUpdate:modelValue":[e[5]||(e[5]=a=>d.outlet_id=a),xe],"item-title":"name","item-value":"id",items:O.value,label:"Outlet","prepend-inner-icon":"mdi-store",required:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(V,{cols:"12",md:"4"},{default:l(()=>[t(Zt,{modelValue:P.value,"onUpdate:modelValue":[e[6]||(e[6]=a=>P.value=a),n],"auto-select-first":"false",clearable:"","hide-no-data":"","item-title":"name","item-value":"id",items:H.value,label:"Customer (optional, type to add)","prepend-inner-icon":"mdi-account","return-object":"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(V,{cols:"12",md:"4"},{default:l(()=>[t(te,{modelValue:d.sale_date,"onUpdate:modelValue":e[7]||(e[7]=a=>d.sale_date=a),autocomplete:"off",autocorrect:"off",inputmode:"none",label:"Sale Date","prepend-inner-icon":"mdi-calendar",required:"",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12"},{default:l(()=>[t(Jt,{modelValue:d.notes,"onUpdate:modelValue":e[8]||(e[8]=a=>d.notes=a),label:"Notes / Description",placeholder:"Add any notes about this saleâ€¦",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(F,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(Ee,{class:"d-flex align-center justify-space-between bg-green-lighten-5"},{default:l(()=>[u("div",sl,[t(b,{class:"mr-2",color:"green"},{default:l(()=>e[36]||(e[36]=[s("mdi-package-variant")])),_:1}),e[37]||(e[37]=s(" Sale Items ")),t(Y,{class:"ml-3",color:"green",size:"small",variant:"flat"},{default:l(()=>[s(v(d.items.length)+" items ",1)]),_:1}),t(Y,{class:"ml-2",color:"indigo",size:"small",variant:"tonal"},{default:l(()=>[s(" Total: "+v(pe(M.value.total)),1)]),_:1}),t(Y,{class:"ml-2",color:"teal",size:"small",variant:"tonal"},{default:l(()=>[s(" Paid: "+v(pe(M.value.paid)),1)]),_:1}),t(Y,{class:"ml-2",color:M.value.balance>0?"warning":"success",size:"small",variant:"tonal"},{default:l(()=>[s(" Balance: "+v(pe(M.value.balance)),1)]),_:1},8,["color"])]),t(I,{color:"green",disabled:!d.outlet_id,size:"small",onClick:$e},{default:l(()=>[t(b,{start:""},{default:l(()=>e[38]||(e[38]=[s("mdi-plus")])),_:1}),e[39]||(e[39]=s(" Add Item "))]),_:1},8,["disabled"])]),_:1}),t(K,{class:"pa-4"},{default:l(()=>[w.value.length?(D(),ae(He,{key:0,class:"mb-4",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:l(()=>[(D(!0),W(se,null,qe(w.value,a=>(D(),W("div",{key:a}," â€¢ "+v(a),1))),128))]),_:1})):ne("",!0),(D(!0),W(se,null,qe(d.items,(a,c)=>(D(),W("div",{key:c,class:"mb-4"},[t(F,{class:"elevation-1"},{default:l(()=>[t(K,{class:"pa-4"},{default:l(()=>[t(ce,{align:"center",dense:""},{default:l(()=>[t(V,{cols:"12",md:"3"},{default:l(()=>[t(Wt,{modelValue:a.product_id,"onUpdate:modelValue":[r=>a.product_id=r,()=>Ye(a)],autocomplete:"off",autocorrect:"off",inputmode:"none","item-title":"name","item-value":"id",items:ie.value,label:"Product","prepend-inner-icon":"mdi-cube-outline",required:"",spellcheck:"false",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"])]),_:2},1024),t(V,{cols:"12",md:"2"},{default:l(()=>[t(Ne,{modelValue:a.quality,"onUpdate:modelValue":[r=>a.quality=r,()=>L(a)],color:Oe(a.quality),"item-title":"title","item-value":"value",items:Qe,label:"Quality",required:"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","color"])]),_:2},1024),t(V,{cols:"12",md:"2"},{default:l(()=>[t(te,{modelValue:a.quantity,"onUpdate:modelValue":r=>a.quantity=r,autocomplete:"off",autocorrect:"off",density:"comfortable",error:Le(a),hint:Ze(a),inputmode:"none",label:"Quantity","persistent-hint":"",spellcheck:"false",type:"number",variant:"outlined",onInput:e[9]||(e[9]=()=>f())},null,8,["modelValue","onUpdate:modelValue","error","hint"])]),_:2},1024),t(V,{cols:"12",md:"2"},{default:l(()=>[t(te,{modelValue:a.unit_price,"onUpdate:modelValue":r=>a.unit_price=r,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Unit Price",spellcheck:"false",type:"number",variant:"outlined",onBlur:r=>Be(a)},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024),t(V,{cols:"12",md:"2"},{default:l(()=>[t(F,{class:"pa-3 text-center",color:"blue-lighten-5",variant:"flat"},{default:l(()=>[e[40]||(e[40]=u("div",{class:"text-caption text-blue-darken-3 font-weight-bold"}," AVAILABLE ",-1)),u("div",il,v(Se(a)),1)]),_:2},1024)]),_:2},1024),t(V,{class:"text-right",cols:"12",md:"1"},{default:l(()=>[t(I,{color:"error",icon:"",size:"small",variant:"text",onClick:r=>Je(c)},{default:l(()=>[t(b,null,{default:l(()=>e[41]||(e[41]=[s("mdi-delete-outline")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),t(ce,{class:"mt-1"},{default:l(()=>[t(V,{class:"text-right text-grey",cols:"12"},{default:l(()=>[e[42]||(e[42]=s(" Line total: ")),u("strong",null,v(q(Me(a))),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),d.items.length===0?(D(),W("div",rl,[t(b,{class:"mb-4",color:"grey",size:"64"},{default:l(()=>e[43]||(e[43]=[s("mdi-package-variant-plus")])),_:1}),e[46]||(e[46]=u("div",{class:"text-h6 text-grey mb-2"},"No Items Added",-1)),e[47]||(e[47]=u("div",{class:"text-body-1 text-grey mb-4"},' Click "Add Item" to start adding products to this sale ',-1)),t(I,{color:"primary",disabled:!d.outlet_id,onClick:$e},{default:l(()=>[t(b,{start:""},{default:l(()=>e[44]||(e[44]=[s("mdi-plus")])),_:1}),e[45]||(e[45]=s(" Add Your First Item "))]),_:1},8,["disabled"])])):ne("",!0),t(Ue,{class:"my-4"}),M.value.balance>0?(D(),ae(He,{key:2,class:"mt-2",color:"warning",icon:"mdi-alert",variant:"tonal"},{default:l(()=>[e[48]||(e[48]=s(" Balance due: ")),u("strong",null,v(pe(M.value.balance)),1)]),_:1})):M.value.total>0?(D(),ae(He,{key:3,class:"mt-2",color:"success",icon:"mdi-check",variant:"tonal"},{default:l(()=>e[49]||(e[49]=[s(" Fully paid ðŸŽ‰ ")])),_:1})):ne("",!0),u("div",dl,[u("div",ml,[e[50]||(e[50]=s(" Total: ")),u("strong",null,v(q(C.value)),1)])])]),_:1})]),_:1}),t(F,{variant:"outlined"},{default:l(()=>[t(Ee,{class:"d-flex align-center justify-space-between bg-purple-lighten-5"},{default:l(()=>[u("div",cl,[t(b,{class:"mr-2",color:"purple"},{default:l(()=>e[51]||(e[51]=[s("mdi-cash")])),_:1}),e[52]||(e[52]=s(" Payments ")),t(Y,{class:"ml-3",color:"purple",size:"small",variant:"flat"},{default:l(()=>[s(v(d.payments.length)+" row(s) ",1)]),_:1})]),t(I,{color:"purple",size:"small",onClick:p},{default:l(()=>[t(b,{start:""},{default:l(()=>e[53]||(e[53]=[s("mdi-plus")])),_:1}),e[54]||(e[54]=s(" Add Payment "))]),_:1})]),_:1}),t(K,{class:"pa-4"},{default:l(()=>[me.value.length?(D(),ae(He,{key:0,class:"mb-4",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:l(()=>[(D(!0),W(se,null,qe(me.value,a=>(D(),W("div",{key:a},"â€¢ "+v(a),1))),128))]),_:1})):ne("",!0),(D(!0),W(se,null,qe(d.payments,(a,c)=>(D(),W("div",{key:c,class:"mb-3"},[t(ce,{dense:""},{default:l(()=>[t(V,{cols:"12",md:"3"},{default:l(()=>[t(te,{modelValue:a.amount,"onUpdate:modelValue":r=>a.amount=r,autocomplete:"off",autocorrect:"off",density:"comfortable",error:!a.amount,hint:"Required",inputmode:"none",label:"Amount","persistent-hint":"",spellcheck:"false",type:"number",variant:"outlined",onInput:()=>{x(),We(c)}},null,8,["modelValue","onUpdate:modelValue","error","onInput"])]),_:2},1024),t(V,{cols:"12",md:"3"},{default:l(()=>[t(Ne,{modelValue:a.method,"onUpdate:modelValue":r=>a.method=r,density:"comfortable",items:ee,label:"Method",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{cols:"12",md:"3"},{default:l(()=>[t(te,{modelValue:a.reference,"onUpdate:modelValue":r=>a.reference=r,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Reference",spellcheck:"false",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{cols:"12",md:"2"},{default:l(()=>[t(te,{modelValue:a.payment_date,"onUpdate:modelValue":r=>a.payment_date=r,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Payment Date",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(V,{class:"text-right",cols:"12",md:"1"},{default:l(()=>[t(I,{color:"error",icon:"",size:"small",variant:"text",onClick:r=>h(c)},{default:l(()=>[t(b,null,{default:l(()=>e[55]||(e[55]=[s("mdi-delete-outline")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),t(Ue,{class:"my-4"}),u("div",fl,[u("div",vl,[u("div",null,[e[56]||(e[56]=s(" Paid: ")),u("strong",null,v(q(ze.value)),1)]),u("div",pl,[e[57]||(e[57]=s(" Balance: ")),u("strong",null,v(q(Math.max(C.value-ze.value,0))),1)])])])]),_:1})]),_:1})]),_:1}),t(Ge,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(Ve),t(I,{size:"large",variant:"outlined",onClick:_e},{default:l(()=>e[58]||(e[58]=[s("Cancel")])),_:1}),t(I,{color:"primary",disabled:!Re.value,loading:g.value,size:"large",variant:"flat",onClick:Xe},{default:l(()=>[t(b,{start:""},{default:l(()=>[s(v($.value?"mdi-content-save":"mdi-check"),1)]),_:1}),s(" "+v($.value?"Update Sale":"Create Sale"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(at,{modelValue:X.value,"onUpdate:modelValue":e[13]||(e[13]=a=>X.value=a),"max-width":"900",scrollable:"",transition:"dialog-bottom-transition"},{default:l(()=>[t(F,{class:"rounded-lg"},{default:l(()=>[t(et,{color:"info",density:"comfortable"},{default:l(()=>[t(ue,{class:"mr-3",color:"info",size:"40"},{default:l(()=>[t(b,{color:"white"},{default:l(()=>e[59]||(e[59]=[s("mdi-eye")])),_:1})]),_:1}),t(tt,{class:"text-h6 font-weight-bold"},{default:l(()=>e[60]||(e[60]=[s("Sale Details")])),_:1}),t(Ve),t(I,{icon:"",onClick:e[11]||(e[11]=a=>X.value=!1)},{default:l(()=>[t(b,null,{default:l(()=>e[61]||(e[61]=[s("mdi-close")])),_:1})]),_:1})]),_:1}),t(K,{class:"pa-6"},{default:l(()=>[t(F,{class:"mb-6 elevation-2"},{default:l(()=>[t(K,{class:"pa-4"},{default:l(()=>[t(ce,null,{default:l(()=>{var a;return[t(V,{class:"border-e",cols:"12",md:"6"},{default:l(()=>{var c,r;return[u("div",yl,[t(ue,{class:"mr-3",color:"primary",size:"48"},{default:l(()=>[t(b,{color:"white"},{default:l(()=>e[62]||(e[62]=[s("mdi-identifier")])),_:1})]),_:1}),u("div",null,[e[63]||(e[63]=u("div",{class:"text-caption text-grey"},"SALE ID",-1)),u("div",gl," #"+v((c=A.value)==null?void 0:c.id),1)])]),u("div",bl,[t(b,{class:"mr-3",color:"grey"},{default:l(()=>e[64]||(e[64]=[s("mdi-calendar")])),_:1}),u("div",null,[e[65]||(e[65]=u("div",{class:"text-caption text-grey"},"DATE",-1)),u("div",_l,v(ye((r=A.value)==null?void 0:r.sale_date)),1)])])]}),_:1}),t(V,{cols:"12",md:"6"},{default:l(()=>{var c,r,j,J;return[u("div",xl,[t(ue,{class:"mr-3",color:Ce((c=A.value)==null?void 0:c.outlet_type),size:"48"},{default:l(()=>[t(b,{color:"white"},{default:l(()=>{var Ie;return[s(v(ge((Ie=A.value)==null?void 0:Ie.outlet_type)),1)]}),_:1})]),_:1},8,["color"]),u("div",null,[e[66]||(e[66]=u("div",{class:"text-caption text-grey"},"OUTLET",-1)),u("div",Vl,v((r=A.value)==null?void 0:r.outlet_name),1),t(Y,{class:"mt-1",color:Ce((j=A.value)==null?void 0:j.outlet_type),size:"small"},{default:l(()=>{var Ie;return[s(v((Ie=A.value)==null?void 0:Ie.outlet_type),1)]}),_:1},8,["color"])])]),u("div",kl,[t(b,{class:"mr-3",color:"grey"},{default:l(()=>e[67]||(e[67]=[s("mdi-account")])),_:1}),u("div",null,[e[68]||(e[68]=u("div",{class:"text-caption text-grey"},"CUSTOMER",-1)),u("div",hl,v(((J=A.value)==null?void 0:J.customer_name)||"Walk-in"),1)])])]}),_:1}),(a=A.value)!=null&&a.notes?(D(),ae(V,{key:0,cols:"12"},{default:l(()=>[t(Ue,{class:"my-3"}),e[69]||(e[69]=u("div",{class:"text-caption text-grey mb-1"},"NOTES",-1)),t(F,{variant:"outlined"},{default:l(()=>[t(K,{class:"pa-3"},{default:l(()=>{var c;return[s(v((c=A.value)==null?void 0:c.notes),1)]}),_:1})]),_:1})]),_:1})):ne("",!0)]}),_:1})]),_:1})]),_:1}),t(F,{class:"mb-6 elevation-2"},{default:l(()=>[t(Ee,{class:"d-flex align-center bg-teal-lighten-5"},{default:l(()=>[t(b,{class:"mr-2",color:"teal"},{default:l(()=>e[70]||(e[70]=[s("mdi-package-variant")])),_:1}),e[71]||(e[71]=s(" Items "))]),_:1}),t(K,{class:"pa-0"},{default:l(()=>{var a,c,r,j;return[t(Gt,{density:"comfortable"},{default:l(()=>[e[72]||(e[72]=u("thead",null,[u("tr",{class:"bg-grey-lighten-4"},[u("th",{class:"text-left font-weight-bold text-grey"}," PRODUCT "),u("th",{class:"text-center font-weight-bold text-grey"}," QUALITY "),u("th",{class:"text-center font-weight-bold text-grey"},"QTY"),u("th",{class:"text-right font-weight-bold text-grey"}," UNIT PRICE "),u("th",{class:"text-right font-weight-bold text-grey"}," TOTAL PRICE ")])],-1)),u("tbody",null,[(D(!0),W(se,null,qe(Fe.value,J=>(D(),W("tr",{key:J.id},[u("td",wl,v(J.product_name),1),u("td",Cl,[t(Y,{color:Oe(J.quality),size:"small",variant:"flat"},{default:l(()=>[s(v(J.quality),1)]),_:2},1032,["color"])]),u("td",Sl,v(parseFloat(J.quantity)),1),u("td",Dl,v(q(J.unit_price)),1),u("td",Il,v(q(J.quantity*J.unit_price)),1)]))),128))])]),_:1}),u("div",Al,[u("div",Pl,[e[73]||(e[73]=s(" Paid: ")),u("strong",null,v(q(((a=A.value)==null?void 0:a.total_paid)||0)),1)]),u("div",Tl,[e[74]||(e[74]=s(" Total: ")),u("strong",null,v(q(((c=A.value)==null?void 0:c.total_amount)||0)),1)]),u("div",ql,[e[75]||(e[75]=s(" Balance: ")),u("strong",null,v(q((((r=A.value)==null?void 0:r.total_amount)||0)-(((j=A.value)==null?void 0:j.total_paid)||0))),1)])])]}),_:1})]),_:1})]),_:1}),t(Ge,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(Ve),t(I,{color:"primary",size:"large",variant:"flat",onClick:e[12]||(e[12]=a=>X.value=!1)},{default:l(()=>[t(b,{start:""},{default:l(()=>e[76]||(e[76]=[s("mdi-close")])),_:1}),e[77]||(e[77]=s(" Close "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(at,{modelValue:oe.value,"onUpdate:modelValue":e[15]||(e[15]=a=>oe.value=a),"max-width":"500"},{default:l(()=>[t(F,{class:"rounded-lg"},{default:l(()=>[t(et,{color:"error",density:"comfortable"},{default:l(()=>[t(ue,{class:"mr-3",color:"error",size:"40"},{default:l(()=>[t(b,{color:"white"},{default:l(()=>e[78]||(e[78]=[s("mdi-alert")])),_:1})]),_:1}),t(tt,{class:"text-h6 font-weight-bold"},{default:l(()=>e[79]||(e[79]=[s("Confirm Deletion")])),_:1})]),_:1}),t(K,{class:"pa-6 text-center"},{default:l(()=>[t(b,{class:"mb-4",color:"error",size:"64"},{default:l(()=>e[80]||(e[80]=[s("mdi-delete-alert")])),_:1}),e[83]||(e[83]=u("div",{class:"text-h5 font-weight-bold mb-2"},"Delete Sale?",-1)),u("div",El,[e[81]||(e[81]=s(" Are you sure you want to delete sale ")),u("span",Nl,"#"+v(le.value),1),e[82]||(e[82]=s("? This cannot be undone. "))])]),_:1}),t(Ge,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(Ve),t(I,{size:"large",variant:"outlined",onClick:e[14]||(e[14]=a=>oe.value=!1)},{default:l(()=>e[84]||(e[84]=[s("Cancel")])),_:1}),t(I,{color:"error",loading:he.value,size:"large",variant:"flat",onClick:Ke},{default:l(()=>[t(b,{start:""},{default:l(()=>e[85]||(e[85]=[s("mdi-delete")])),_:1}),e[86]||(e[86]=s(" Delete Sale "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Wl=Pt(Ul,[["__scopeId","data-v-d3fb0d44"]]);export{Wl as default};
