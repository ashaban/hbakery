import{_ as Ve,W as _e,r as f,U as S,d as Q,k as xe,q as P,t as y,v as s,h as t,x as r,N as T,G as p,B as o,A as m,H as v,Z as be,$ as G,C as H,a1 as we,Y as J,D as E,a2 as g,O as $e,F as W,E as Y,i as ke,z as Z}from"./index-7L47QNVH.js";import{c as K,u as Ce,m as Pe,r as F}from"./index-CZ-HeV5N.js";import{V as q,b as A,c as X}from"./VCard-CcXLJqVt.js";import{V}from"./VCol-5KHLSyB8.js";import{V as k}from"./VTextField-DK2CbxIB.js";import{V as ee}from"./VAlert-7oPTnG7g.js";import{a as qe,b as Ie}from"./VDataTable-Cj5L-oTY.js";import{V as B}from"./VDialog-Cs_EBcHJ.js";import{V as Ee}from"./VForm-6jd5yX24.js";import{V as Ae}from"./VAutocomplete-CYZetpXL.js";import{V as De}from"./VChip-CcN0LJRZ.js";import{V as Ue}from"./VContainer-C70kHoiC.js";import"./dialog-transition-Y_FcWeit.js";import"./VSlideGroup-C-BVKwkJ.js";const je={class:"d-flex justify-space-between mb-4"},ze={class:"d-flex justify-end align-center mt-4"},Ne={class:"d-flex align-center flex-wrap"},Se={class:"text-white font-weight-bold text-h6"},Te={class:"d-flex justify-end mt-2"},Fe={class:"bg-primary pa-6 rounded-t-xl"},Be={class:"d-flex align-center"},he={class:"text-h5 font-weight-bold text-white"},Me={class:"pa-4"},Le={key:0,class:"text-center py-8"},Oe={key:1,class:"ingredients-grid"},Re={class:"d-flex align-center"},Qe={class:"flex-grow-1"},Ge={class:"text-body-1 font-weight-medium"},He={class:"d-flex align-center mt-2"},Je={class:"text-primary text-caption font-weight-bold"},We=10,Ye={__name:"Products",setup(Ze){const D=_e(),c=f(!1),h=f([]),x=f(!1),b=f(!1),I=f(!1),_=f(!1),U=f(null),M=f(null),j=f([]),z=f([]),C=f(1),L=f(1),O=S({total_products:""}),w=S({search:""}),te=[{title:"Name",key:"name"},{title:"Description",key:"description"},{title:"Unit",key:"unit"},{title:"Price",key:"price"},{title:"Actions",key:"actions"}],i=S({name:"",description:"",unit:"",price:"",items:[]}),le=K.withMessage("At least one ingredient is required",a=>Array.isArray(a)&&a.length>0),se=K.withMessage("Each ingredient must have item and quantity",a=>Array.isArray(a)&&a.every(e=>e.item_id&&e.quantity_per_unit&&Number(e.quantity_per_unit)>0)),ae={name:{required:F},unit:{required:F},price:{required:F,minValue:Pe(1)},items:{hasAtLeastOneItem:le,validItems:se}},d=Ce(ae,i),ie=Q(()=>{const a=i.items.length,e=i.items.filter(l=>!l.item_id||!l.quantity_per_unit).length;return a===0?"No ingredients added yet.":e>0?`${a} ingredient(s) added, ${e} incomplete.`:`${a} ingredient(s) added and complete.`}),N=Q(()=>i.items.some(e=>!e.item_id||!e.quantity_per_unit)?"error":"success");function oe(a){const e=i.items.map((l,n)=>n!==a?l.item_id:null).filter(Boolean);return z.value.filter(l=>!e.includes(l.id))}function re(a){d.value.items.$touch();const e=z.value.find(l=>l.id===a.item_id);a.unit=e?e.unit:""}function ne(){i.items.push({item_id:"",quantity_per_unit:"",unit:""}),d.value.items.$touch()}function de(a){i.items.splice(a,1),d.value.items.$touch()}async function ue(){const a=await fetch("/items");z.value=await a.json()}async function $(){c.value=!0;const a=new URLSearchParams({page:C.value,limit:We});w.search&&a.append("search",w.search);try{const l=await(await fetch(`/products?${a}`)).json();h.value=l.data||[],L.value=l.totalPages||1,O.total_products=l.totalRecords||0}finally{c.value=!1}}function me(){C.value=1,$()}function ce(){w.search="",C.value=1,$()}function fe(){_.value=!1,Object.assign(i,{name:"",description:"",unit:"",price:"",items:[]}),x.value=!0,d.value.$reset()}async function pe(a){_.value=!0,U.value=a.id,c.value=!0;try{const l=await(await fetch(`/products/${a.id}`)).json(),n=l.product||l;Object.assign(i,{name:n.name,description:n.description,unit:n.unit,price:n.price,items:(l.items||n.items||[]).map(u=>({item_id:u.item_id,quantity_per_unit:u.quantity_per_unit,unit:u.unit}))}),x.value=!0}finally{c.value=!1}}async function ve(a){M.value=a;const l=await(await fetch(`/products/${a.id}`)).json();j.value=l.items||[],I.value=!0}async function ge(){if(d.value.$touch(),d.value.$invalid)return;c.value=!0;const a=new FormData;a.append("name",i.name),a.append("description",i.description),a.append("unit",i.unit),a.append("price",i.price),a.append("items",JSON.stringify(i.items));const e=_.value?`/products/${U.value}`:"/products",l=_.value?"PUT":"POST";try{if(!(await fetch(e,{method:l,body:a})).ok)throw new Error("Failed to save");x.value=!1,$(),D.commit("setMessage",{type:"success",text:_.value?"Product updated!":"Product added!"})}catch{D.commit("setMessage",{type:"error",text:"Failed to save product"})}finally{c.value=!1}}async function ye(){c.value=!0,await fetch(`/products/${U.value}`,{method:"DELETE"}),b.value=!1,x.value=!1,$(),D.commit("setMessage",{type:"success",text:"Product deleted!"}),c.value=!1}return xe(()=>{$(),ue()}),(a,e)=>(y(),P(Ue,{fluid:""},{default:s(()=>[t(q,{class:"pa-4 mb-4"},{default:s(()=>[t(T,{dense:""},{default:s(()=>[t(V,{cols:"12",sm:"4"},{default:s(()=>[t(k,{modelValue:w.search,"onUpdate:modelValue":e[0]||(e[0]=l=>w.search=l),label:"Search Product Name",clearable:"","append-inner-icon":"mdi-close-circle","onClick:appendInner":e[1]||(e[1]=l=>w.search="")},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",class:"d-flex justify-end"},{default:s(()=>[t(p,{color:"primary",onClick:me},{default:s(()=>[t(m,{start:""},{default:s(()=>e[17]||(e[17]=[o("mdi-filter")])),_:1}),e[18]||(e[18]=o(" Apply "))]),_:1}),t(p,{class:"ml-2",color:"grey",onClick:ce},{default:s(()=>[t(m,{start:""},{default:s(()=>e[19]||(e[19]=[o("mdi-refresh")])),_:1}),e[20]||(e[20]=o(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),t(ee,{type:"info",class:"mb-4",border:"start",variant:"outlined"},{default:s(()=>[e[21]||(e[21]=r("strong",null,"Total Products:",-1)),o(" "+v(O.total_products||"0"),1)]),_:1}),r("div",je,[e[24]||(e[24]=r("h3",null,"Products",-1)),t(p,{color:"primary",class:"text-white",size:"small",onClick:fe},{default:s(()=>[t(m,{start:""},{default:s(()=>e[22]||(e[22]=[o("mdi-plus")])),_:1}),e[23]||(e[23]=o(" Add Product "))]),_:1})]),t(be,{active:c.value,indeterminate:c.value},null,8,["active","indeterminate"]),t(qe,{class:"elevation-1",dense:"",headers:te,items:h.value,loading:c.value,height:"400"},{"item.actions":s(({item:l})=>[t(m,{color:"primary",class:"mr-2",onClick:n=>pe(l)},{default:s(()=>e[25]||(e[25]=[o(" mdi-square-edit-outline ")])),_:2},1032,["onClick"]),t(m,{color:"green",onClick:n=>ve(l)},{default:s(()=>e[26]||(e[26]=[o(" mdi-eye ")])),_:2},1032,["onClick"])]),_:1},8,["items","loading"]),r("div",ze,[t(Ie,{modelValue:C.value,"onUpdate:modelValue":[e[2]||(e[2]=l=>C.value=l),$],length:L.value,"total-visible":"7"},null,8,["modelValue","length"])]),t(B,{modelValue:x.value,"onUpdate:modelValue":e[11]||(e[11]=l=>x.value=l),transition:"dialog-top-transition","max-width":"900"},{default:s(()=>[t(q,{class:"rounded-xl pa-4",elevation:"10"},{default:s(()=>[t(G,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:s(()=>[r("div",Ne,[t(m,{class:"mr-2 text-white"},{default:s(()=>e[27]||(e[27]=[o("mdi-package-variant")])),_:1}),r("span",Se,v(_.value?"Edit Product":"Add Product"),1)]),t(H),t(p,{color:"white",icon:"mdi-close",onClick:e[3]||(e[3]=l=>x.value=!1)})]),_:1}),t(A,{class:"pt-6"},{default:s(()=>[t(Ee,{onSubmit:e[9]||(e[9]=we(()=>{},["prevent"]))},{default:s(()=>[t(T,{dense:""},{default:s(()=>[t(V,{cols:"12",sm:"6"},{default:s(()=>[t(k,{modelValue:i.name,"onUpdate:modelValue":e[4]||(e[4]=l=>i.name=l),label:"Product Name","bg-color":"#E0E0E0",required:"","error-messages":g(d).name.$errors.map(l=>l.$message)},null,8,["modelValue","error-messages"])]),_:1}),t(V,{cols:"12",sm:"6"},{default:s(()=>[t(k,{modelValue:i.unit,"onUpdate:modelValue":e[5]||(e[5]=l=>i.unit=l),label:"Unit (e.g. Loaf, Pack)","bg-color":"#E0E0E0",required:"","error-messages":g(d).unit.$errors.map(l=>l.$message)},null,8,["modelValue","error-messages"])]),_:1}),t(V,{cols:"12"},{default:s(()=>[t(k,{modelValue:i.description,"onUpdate:modelValue":e[6]||(e[6]=l=>i.description=l),label:"Description","bg-color":"#E0E0E0"},null,8,["modelValue"])]),_:1}),t(V,{cols:"12",sm:"4"},{default:s(()=>[t(k,{modelValue:i.price,"onUpdate:modelValue":e[7]||(e[7]=l=>i.price=l),label:"Price",type:"number",prefix:"TSh ","bg-color":"#E0E0E0",required:"","error-messages":g(d).price.$errors.map(l=>l.$message)},null,8,["modelValue","error-messages"])]),_:1})]),_:1}),t($e,{class:"my-4"}),e[33]||(e[33]=r("h4",null,"Product Items (Ingredients)",-1)),g(d).items.$error?(y(),P(ee,{key:0,type:"error",class:"mb-2",border:"start",variant:"outlined"},{default:s(()=>e[28]||(e[28]=[o(" Each ingredient must have Item and Quantity. ")])),_:1})):J("",!0),(y(!0),E(W,null,Y(i.items,(l,n)=>(y(),P(T,{key:n,dense:"",align:"center",class:"mb-2"},{default:s(()=>[t(V,{cols:"12",sm:"6"},{default:s(()=>[t(Ae,{modelValue:l.item_id,"onUpdate:modelValue":[u=>l.item_id=u,u=>re(l)],items:oe(n),"item-title":"name","item-value":"id",label:"Item",dense:"",clearable:"",error:g(d).items.$dirty&&!l.item_id,"error-messages":g(d).items.$dirty&&!l.item_id?["Item required"]:[]},null,8,["modelValue","onUpdate:modelValue","items","error","error-messages"])]),_:2},1024),t(V,{cols:"12",sm:"5"},{default:s(()=>[t(k,{modelValue:l.quantity_per_unit,"onUpdate:modelValue":u=>l.quantity_per_unit=u,type:"number",label:`Item Quantity in ${l.unit||""}`,dense:"",error:g(d).items.$dirty&&(!l.quantity_per_unit||l.quantity_per_unit<=0),"error-messages":g(d).items.$dirty&&(!l.quantity_per_unit||l.quantity_per_unit<=0)?["Quantity > 0 required"]:[],onInput:e[8]||(e[8]=u=>g(d).items.$touch())},null,8,["modelValue","onUpdate:modelValue","label","error","error-messages"])]),_:2},1024),t(V,{cols:"12",sm:"1",class:"d-flex justify-end"},{default:s(()=>[t(p,{icon:"",color:"error",size:"small",onClick:u=>de(n)},{default:s(()=>[t(m,null,{default:s(()=>e[29]||(e[29]=[o("mdi-delete")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128)),r("div",Te,[t(p,{color:"primary",size:"small",onClick:ne},{default:s(()=>[t(m,{start:""},{default:s(()=>e[30]||(e[30]=[o("mdi-plus")])),_:1}),e[31]||(e[31]=o(" Add Ingredient "))]),_:1})]),r("div",{class:ke(["mt-4 text-caption font-weight-medium d-flex align-center",{"text-success":N.value==="success","text-error":N.value==="error"}])},[t(m,{size:"small",color:N.value,class:"mr-1"},{default:s(()=>e[32]||(e[32]=[o(" mdi-information ")])),_:1},8,["color"]),o(" "+v(ie.value),1)],2)]),_:1})]),_:1}),t(X,{class:"d-flex justify-end mt-2"},{default:s(()=>[t(p,{color:"success",loading:c.value,disabled:g(d).$invalid,onClick:ge},{default:s(()=>[t(m,{start:""},{default:s(()=>e[34]||(e[34]=[o("mdi-content-save")])),_:1}),o(" "+v(_.value?"Save Changes":"Add Product"),1)]),_:1},8,["loading","disabled"]),_.value?(y(),P(p,{key:0,color:"error",onClick:e[10]||(e[10]=l=>b.value=!0)},{default:s(()=>[t(m,{start:""},{default:s(()=>e[35]||(e[35]=[o("mdi-delete")])),_:1}),e[36]||(e[36]=o(" Delete "))]),_:1})):J("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:I.value,"onUpdate:modelValue":e[13]||(e[13]=l=>I.value=l),"max-width":"550"},{default:s(()=>[t(q,{border:"",elevation:"0",rounded:"xl"},{default:s(()=>{var l;return[r("div",Fe,[r("div",Be,[t(Z,{color:"white",size:"48",class:"mr-4"},{default:s(()=>[t(m,{icon:"mdi-silverware-fork-knife",color:"primary",size:"24"})]),_:1}),r("div",null,[r("div",he,v((l=M.value)==null?void 0:l.name),1),e[37]||(e[37]=r("div",{class:"text-body-2 text-white mt-1"}," Ingredients Breakdown ",-1))]),t(H),t(p,{icon:"mdi-close",variant:"text",color:"white",size:"small",onClick:e[12]||(e[12]=n=>I.value=!1)})])]),t(A,{class:"pa-0"},{default:s(()=>{var n;return[r("div",Me,[(n=j.value)!=null&&n.length?(y(),E("div",Oe,[(y(!0),E(W,null,Y(j.value,(u,R)=>(y(),P(q,{key:u.id||R,variant:"outlined",border:"",class:"mb-3 rounded-lg",hover:""},{default:s(()=>[t(A,{class:"pa-4"},{default:s(()=>[r("div",Re,[r("div",Qe,[r("div",Ge,v(u.item_name),1),r("div",He,[t(De,{size:"small",color:"primary",variant:"flat",class:"mr-2"},{default:s(()=>[o(v(u.quantity_per_unit)+" "+v(u.unit),1)]),_:2},1024),t(m,{icon:"mdi-scale-balance",size:"16",color:"grey",class:"mr-1"}),e[40]||(e[40]=r("span",{class:"text-caption text-grey"},"Required",-1))])]),t(Z,{color:"primary",size:"32",variant:"tonal"},{default:s(()=>[r("span",Je,v(R+1),1)]),_:2},1024)])]),_:2},1024)]),_:2},1024))),128))])):(y(),E("div",Le,[t(m,{icon:"mdi-food-off",size:"48",color:"grey",class:"mb-3"}),e[38]||(e[38]=r("div",{class:"text-h6 text-grey"},"No Ingredients",-1)),e[39]||(e[39]=r("div",{class:"text-body-2 text-grey mt-1"}," Add ingredients to see them listed here ",-1))]))])]}),_:1})]}),_:1})]),_:1},8,["modelValue"]),t(B,{modelValue:b.value,"onUpdate:modelValue":e[16]||(e[16]=l=>b.value=l),persistent:"",width:"400"},{default:s(()=>[t(q,null,{default:s(()=>[t(G,{color:"warning",title:"Confirm Deleting "+i.name},{default:s(()=>[t(p,{color:"white",icon:"mdi-close",onClick:e[14]||(e[14]=l=>b.value=!1)})]),_:1},8,["title"]),t(A,null,{default:s(()=>[o("Are you sure you want to delete "+v(i.name)+"?",1)]),_:1}),t(X,{class:"d-flex justify-end"},{default:s(()=>[t(p,{color:"grey",onClick:e[15]||(e[15]=l=>b.value=!1)},{default:s(()=>e[41]||(e[41]=[o("Cancel")])),_:1}),t(p,{color:"error",onClick:ye},{default:s(()=>e[42]||(e[42]=[o("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},ct=Ve(Ye,[["__scopeId","data-v-dc54ab5f"]]);export{ct as default};
