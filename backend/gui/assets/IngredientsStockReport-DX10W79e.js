import{_ as E,r as h,d as $,$ as j,k as q,a1 as G,q as D,t as y,v as t,h as l,x as n,G as B,B as i,A as g,N as F,z as H,H as o,ae as Q,D as C,Z as O}from"./index-CvqfsKbz.js";import{V as x,b as U}from"./VCard-BH6mYS9X.js";import{V as w}from"./VCol-_bfXGXKh.js";import{V as Y}from"./VAutocomplete-CcnWSf-M.js";import{V as Z}from"./VSwitch-C1FboRXl.js";import{a as J}from"./VDataTable-CTPdSVK4.js";import{V as k}from"./VChip-DD800yi0.js";import{V as K}from"./VContainer-BBk2FiR3.js";import"./VTextField-Ccwdki6l.js";import"./dialog-transition-4lhr0DM9.js";import"./VSlideGroup-BbGWgYtj.js";const W={class:"d-flex align-center justify-space-between"},X={class:"d-flex gap-2"},ee={class:"d-flex align-center gap-2"},te={class:"d-flex align-center"},ae={class:"text-h6"},le={class:"d-flex align-center"},ne={class:"text-h6 text-success"},se={class:"d-flex align-center"},oe={class:"text-h6 text-error"},ie={class:"d-flex align-center"},re={class:"text-h6"},de={class:"d-flex flex-column"},ue={class:"font-weight-medium"},ce={class:"d-flex align-center mt-1"},me={key:2,class:"text-caption text-grey"},_e={class:"d-flex flex-column align-end"},pe={key:0,class:"text-caption text-grey"},ge={class:"d-flex flex-column align-end"},fe={class:"text-success"},ve={key:0,class:"text-caption text-grey"},be={class:"d-flex flex-column align-end"},ye={class:"text-error"},we={key:0,class:"text-caption text-grey"},xe={class:"d-flex flex-column align-end"},Ve={key:0,class:"text-caption text-grey"},ke={class:"px-4 py-3 d-flex justify-end flex-wrap gap-2"},he={class:"text-center py-8"},Ce={__name:"IngredientsStockReport",setup(Oe){const _=h(!1),S=h(!1),p=h([]),f=h(!0),A=[{title:"Ingredient",key:"item_name",sortable:!0},{title:"Opening",key:"opening_balance",align:"end",sortable:!0},{title:"Inwards",key:"inwards",align:"end",sortable:!0},{title:"Outwards",key:"outwards",align:"end",sortable:!0},{title:"Closing",key:"closing_balance",align:"end",sortable:!0},{title:"Opening Value",key:"total_price_opening",align:"end",sortable:!0},{title:"Inwards Value",key:"total_price_inwards",align:"end",sortable:!0},{title:"Outwards Value",key:"total_price_outwards",align:"end",sortable:!0},{title:"Closing Value",key:"total_price_closing",align:"end",sortable:!0}],L=$(()=>f.value?[{title:"Ingredient",key:"item_name",sortable:!0},{title:"Opening (Base/Human)",key:"opening_balance",align:"end",sortable:!0},{title:"Inwards (Base/Human)",key:"inwards",align:"end",sortable:!0},{title:"Outwards (Base/Human)",key:"outwards",align:"end",sortable:!0},{title:"Closing (Base/Human)",key:"closing_balance",align:"end",sortable:!0},{title:"Opening Value",key:"total_price_opening",align:"end",sortable:!0},{title:"Inwards Value",key:"total_price_inwards",align:"end",sortable:!0},{title:"Outwards Value",key:"total_price_outwards",align:"end",sortable:!0},{title:"Closing Value",key:"total_price_closing",align:"end",sortable:!0}]:A),V=j({items:[]}),m=j({start:null,end:null}),R=h([]),v=$(()=>{const s=a=>p.value.reduce((u,r)=>u+(Number(r[a])||0),0),e=a=>p.value.reduce((u,r)=>u+(Number(r[`${a}_human`])||0),0),d=a=>p.value.reduce((u,r)=>u+(Number(r[`total_price_${a}`])||0),0);return{opening:s("opening_balance"),opening_human:e("opening_balance"),inwards:s("inwards"),inwards_human:e("inwards"),outwards:s("outwards"),outwards_human:e("outwards"),closing:s("closing_balance"),closing_human:e("closing_balance"),opening_value:d("opening"),inwards_value:d("inwards"),outwards_value:d("outwards"),closing_value:d("closing")}});function b(s){return Number(s??0).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:6})}function c(s){return`TSh ${Number(s??0).toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})}`}async function z(){S.value=!0;try{const e=await(await fetch("/items?limit=10000&page=1")).json();R.value=Array.isArray(e)?e:e.data||[]}catch(s){console.error("Failed to load items",s),R.value=[]}finally{S.value=!1}}function M(){const s=new URLSearchParams;if(m.start&&s.append("start_date",N(m.start)),m.end&&s.append("end_date",N(m.end)),V.items&&V.items.length)for(const e of V.items)s.append("items",e);return s.toString()}function N(s){const e=new Date(s),d=e.getFullYear(),a=String(e.getMonth()+1).padStart(2,"0"),u=String(e.getDate()).padStart(2,"0");return`${d}-${a}-${u}`}async function I(){_.value=!0;try{const s=M(),d=await(await fetch(`/reports/stockStatus?${s}`)).json();p.value=d.data||[]}catch(s){console.error("Failed to load report",s),p.value=[]}finally{_.value=!1}}function P(){V.items=[],m.start=null,m.end=null,I()}function T(){if(!p.value.length)return;const e=[["Ingredient","Base Unit","Human Readable Unit","Opening Balance","Opening Balance (Human)","Inwards","Inwards (Human)","Outwards","Outwards (Human)","Closing Balance","Closing Balance (Human)","Opening Value","Inwards Value","Outwards Value","Closing Value"].join(",")];for(const r of p.value)e.push([`"${(r.item_name||"").replace(/"/g,'""')}"`,`"${r.base_unit||""}"`,`"${r.human_readable_unit||""}"`,r.opening_balance??0,r.opening_balance_human??0,r.inwards??0,r.inwards_human??0,r.outwards??0,r.outwards_human??0,r.closing_balance??0,r.closing_balance_human??0,r.total_price_opening??0,r.total_price_inwards??0,r.total_price_outwards??0,r.total_price_closing??0].join(","));const d=new Blob([e.join(`
`)],{type:"text/csv;charset=utf-8;"}),a=URL.createObjectURL(d),u=document.createElement("a");u.href=a,u.download=`stock_status_${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(a)}return q(async()=>{await z(),await I()}),(s,e)=>{const d=G("VueDatePicker");return y(),D(K,{class:"stock-report",fluid:""},{default:t(()=>[l(x,{class:"mb-6",elevation:"2",rounded:"lg"},{default:t(()=>[l(U,{class:"pa-6"},{default:t(()=>[n("div",W,[e[8]||(e[8]=n("div",null,[n("h1",{class:"text-h5 text-primary font-weight-bold mb-1"}," Stock Status Report "),n("div",{class:"text-body-2 text-grey"}," Opening balance, inwards, outwards & closing by ingredient ")],-1)),n("div",X,[l(B,{color:"primary",disabled:!p.value.length||_.value,variant:"outlined",onClick:T},{default:t(()=>[l(g,{start:""},{default:t(()=>e[4]||(e[4]=[i("mdi-file-delimited-outline")])),_:1}),e[5]||(e[5]=i(" Export CSV "))]),_:1},8,["disabled"]),l(B,{color:"primary",loading:_.value,onClick:I},{default:t(()=>[l(g,{start:""},{default:t(()=>e[6]||(e[6]=[i("mdi-filter")])),_:1}),e[7]||(e[7]=i(" Apply "))]),_:1},8,["loading"])])])]),_:1})]),_:1}),l(x,{class:"mb-4",elevation:"1",rounded:"lg"},{default:t(()=>[l(U,null,{default:t(()=>[l(F,{dense:""},{default:t(()=>[l(w,{cols:"12",md:"6"},{default:t(()=>[e[9]||(e[9]=n("div",{class:"text-caption text-grey mb-1"},"Date Range",-1)),n("div",ee,[l(d,{modelValue:m.start,"onUpdate:modelValue":e[0]||(e[0]=a=>m.start=a),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100",format:"dd-MM-yyyy",placeholder:"From date",teleport:!0},null,8,["modelValue"]),l(d,{modelValue:m.end,"onUpdate:modelValue":e[1]||(e[1]=a=>m.end=a),"auto-apply":"",class:"rounded-lg border px-4 py-2 w-100",format:"dd-MM-yyyy",placeholder:"To date",teleport:!0},null,8,["modelValue"])])]),_:1}),l(w,{cols:"12",md:"6"},{default:t(()=>[l(Y,{modelValue:V.items,"onUpdate:modelValue":e[2]||(e[2]=a=>V.items=a),chips:"",clearable:"","closable-chips":"",color:"primary",disabled:S.value,"item-title":"name","item-value":"id",items:R.value,label:"Ingredients",loading:S.value,multiple:"",variant:"outlined"},null,8,["modelValue","disabled","items","loading"])]),_:1}),l(w,{cols:"12",md:"6"},{default:t(()=>[l(Z,{modelValue:f.value,"onUpdate:modelValue":e[3]||(e[3]=a=>f.value=a),color:"primary","hide-details":"",label:"Show Human Readable Units"},null,8,["modelValue"])]),_:1}),l(w,{class:"d-flex justify-end",cols:"12"},{default:t(()=>[l(B,{color:"primary",loading:_.value,onClick:I},{default:t(()=>[l(g,{start:""},{default:t(()=>e[10]||(e[10]=[i("mdi-filter")])),_:1}),e[11]||(e[11]=i(" Apply "))]),_:1},8,["loading"]),l(B,{class:"ml-2",color:"grey",disabled:_.value,variant:"tonal",onClick:P},{default:t(()=>[l(g,{start:""},{default:t(()=>e[12]||(e[12]=[i("mdi-refresh")])),_:1}),e[13]||(e[13]=i(" Reset "))]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:1}),l(F,{class:"mb-4"},{default:t(()=>[l(w,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(x,{border:"",class:"pa-3",elevation:"1"},{default:t(()=>[n("div",te,[l(H,{class:"mr-3",color:"blue-lighten-5",size:"44"},{default:t(()=>[l(g,{color:"blue"},{default:t(()=>e[14]||(e[14]=[i("mdi-database-arrow-left")])),_:1})]),_:1}),n("div",null,[e[15]||(e[15]=n("div",{class:"text-caption text-grey"},"Opening Value",-1)),n("div",ae,o(c(v.value.opening_value)),1)])])]),_:1})]),_:1}),l(w,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(x,{border:"",class:"pa-3",elevation:"1"},{default:t(()=>[n("div",le,[l(H,{class:"mr-3",color:"green-lighten-5",size:"44"},{default:t(()=>[l(g,{color:"green"},{default:t(()=>e[16]||(e[16]=[i("mdi-tray-arrow-down")])),_:1})]),_:1}),n("div",null,[e[17]||(e[17]=n("div",{class:"text-caption text-grey"},"Inwards Value",-1)),n("div",ne,o(c(v.value.inwards_value)),1)])])]),_:1})]),_:1}),l(w,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(x,{border:"",class:"pa-3",elevation:"1"},{default:t(()=>[n("div",se,[l(H,{class:"mr-3",color:"red-lighten-5",size:"44"},{default:t(()=>[l(g,{color:"red"},{default:t(()=>e[18]||(e[18]=[i("mdi-tray-arrow-up")])),_:1})]),_:1}),n("div",null,[e[19]||(e[19]=n("div",{class:"text-caption text-grey"},"Outwards Value",-1)),n("div",oe,o(c(v.value.outwards_value)),1)])])]),_:1})]),_:1}),l(w,{cols:"12",md:"3",sm:"6"},{default:t(()=>[l(x,{border:"",class:"pa-3",elevation:"1"},{default:t(()=>[n("div",ie,[l(H,{class:"mr-3",color:"purple-lighten-5",size:"44"},{default:t(()=>[l(g,{color:"purple"},{default:t(()=>e[20]||(e[20]=[i("mdi-scale-balance")])),_:1})]),_:1}),n("div",null,[e[21]||(e[21]=n("div",{class:"text-caption text-grey"},"Closing Value",-1)),n("div",re,o(c(v.value.closing_value)),1)])])]),_:1})]),_:1})]),_:1}),l(Q,{active:_.value,color:"primary",height:"3",indeterminate:_.value},null,8,["active","indeterminate"]),l(x,{elevation:"1",rounded:"lg"},{default:t(()=>[l(U,{class:"pa-0"},{default:t(()=>[l(J,{class:"elevation-0",density:"comfortable",headers:L.value,"item-key":"item_id",items:p.value,loading:_.value},{"item.item_name":t(({item:a})=>[n("div",de,[n("span",ue,o(a.item_name),1),n("div",ce,[a.human_readable_unit?(y(),D(k,{key:0,class:"mr-1",color:"primary",size:"x-small",variant:"outlined"},{default:t(()=>[i(o(a.base_unit),1)]),_:2},1024)):O("",!0),a.human_readable_unit&&f.value?(y(),D(k,{key:1,color:"green",size:"x-small",variant:"outlined"},{default:t(()=>[i(o(a.human_readable_unit),1)]),_:2},1024)):(y(),C("span",me,o(a.unit_label||a.base_unit),1))])])]),"item.opening_balance":t(({item:a})=>[n("div",_e,[n("span",null,o(b(a.opening_balance)),1),f.value&&a.human_readable_unit?(y(),C("span",pe,o(b(a.opening_balance_human)),1)):O("",!0)])]),"item.inwards":t(({item:a})=>[n("div",ge,[n("span",fe,o(b(a.inwards)),1),f.value&&a.human_readable_unit?(y(),C("span",ve,o(b(a.inwards_human)),1)):O("",!0)])]),"item.outwards":t(({item:a})=>[n("div",be,[n("span",ye,o(b(a.outwards)),1),f.value&&a.human_readable_unit?(y(),C("span",we,o(b(a.outwards_human)),1)):O("",!0)])]),"item.closing_balance":t(({item:a})=>[n("div",xe,[n("strong",null,o(b(a.closing_balance)),1),f.value&&a.human_readable_unit?(y(),C("span",Ve,o(b(a.closing_balance_human)),1)):O("",!0)])]),"item.total_price_opening":t(({item:a})=>[i(o(c(a.total_price_opening)),1)]),"item.total_price_inwards":t(({item:a})=>[i(o(c(a.total_price_inwards)),1)]),"item.total_price_outwards":t(({item:a})=>[i(o(c(a.total_price_outwards)),1)]),"item.total_price_closing":t(({item:a})=>[i(o(c(a.total_price_closing)),1)]),bottom:t(()=>[n("div",ke,[l(k,{class:"mr-2",color:"blue",variant:"tonal"},{default:t(()=>[i(" Opening Value: "+o(c(v.value.opening_value)),1)]),_:1}),l(k,{class:"mr-2",color:"green",variant:"tonal"},{default:t(()=>[i(" Inwards Value: "+o(c(v.value.inwards_value)),1)]),_:1}),l(k,{class:"mr-2",color:"red",variant:"tonal"},{default:t(()=>[i(" Outwards Value: "+o(c(v.value.outwards_value)),1)]),_:1}),l(k,{color:"purple",variant:"tonal"},{default:t(()=>[i(" Closing Value: "+o(c(v.value.closing_value)),1)]),_:1})])]),"no-data":t(()=>[n("div",he,[l(g,{class:"mb-2",color:"grey-lighten-2",size:"64"},{default:t(()=>e[22]||(e[22]=[i("mdi-database-off")])),_:1}),e[23]||(e[23]=n("div",{class:"text-subtitle-1 text-grey"}," No data for selected filters ",-1)),e[24]||(e[24]=n("div",{class:"text-body-2 text-grey"}," Adjust filters and try again. ",-1))])]),_:1},8,["headers","items","loading"])]),_:1})]),_:1})]),_:1})}}},Ae=E(Ce,[["__scopeId","data-v-af2a8bd3"]]);export{Ae as default};
