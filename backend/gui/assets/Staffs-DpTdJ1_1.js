import{_ as Q,r as m,$ as k,l as W,s as U,x as l,a0 as X,v as A,i as t,y as b,O as Y,H as d,C as r,B as v,aH as _,I as S,a3 as F,D as ee,a5 as te,aZ as x,a2 as ae}from"./index-Bm_1tDB1.js";import{u as le,m as se,r as P}from"./index-D1qGXUde.js";import{V as oe}from"./VContainer-BKK7VQkU.js";import{V as E,b as B,c as N}from"./VCard-rPQh7TtY.js";import{V as $}from"./VCol-Cxhy3hua.js";import{V as C}from"./VTextField-CkPOq7cJ.js";import{V as j,a as re,b as ne}from"./VDataTable-BBB9e339.js";import{V as ie}from"./VChip-BaMa1hN2.js";import{V as M}from"./VDialog-DDaebS9v.js";import{V as ue}from"./VForm-DtshrQCn.js";import"./dialog-transition-DpdgYHbX.js";import"./VSlideGroup-BuwiiylY.js";const de={class:"d-flex justify-space-between mb-4"},fe={class:"d-flex justify-end align-center mt-4"},me={class:"d-flex align-center flex-wrap"},pe={class:"text-white font-weight-bold text-h6"},ve=10,Ve={__name:"Staffs",setup(ce){const g=X(),i=m(!1),p=m(!1),V=m(!1),f=m(!1),w=m(null),y=m(1),D=m(1),T=m([]),R=k({total_staff:""}),n=k({search:"",status:""}),q=[{title:"Name",key:"name"},{title:"Phone",key:"phone"},{title:"Position",key:"position"},{title:"Salary",key:"salary"},{title:"Hired Date",key:"hired_at"},{title:"Status",key:"status"},{title:"Edit",key:"edit"}],s=k({name:"",phone:"",position:"",salary:"",status:"Active"}),I={name:{required:P},salary:{required:P,minValue:se(0)}},u=le(I,s),L=o=>o?Number(o).toLocaleString("en-US",{minimumFractionDigits:0})+" TSh":"0 TSh",O=o=>{switch(o){case"Active":return"green";case"Resigned":return"orange";case"Terminated":return"red";default:return"grey"}};async function c(){i.value=!0;const o=new URLSearchParams({page:y.value,limit:ve});n.search&&o.append("search",n.search),n.status&&o.append("status",n.status);try{const a=await(await fetch(`/staffs?${o.toString()}`)).json();T.value=a.data||[],D.value=a.totalPages||1,R.total_staff=a.totalRecords||0}catch(e){console.error(e),g.commit("setMessage",{type:"error",text:"Failed to load staff"})}finally{i.value=!1}}function H(){y.value=1,c()}function h(){n.search="",n.status="",y.value=1,c()}function z(){f.value=!1,Object.assign(s,{name:"",phone:"",position:"",salary:"",status:"Active"}),p.value=!0,u.value.$reset()}function Z(o){f.value=!0,w.value=o.id,Object.assign(s,o),p.value=!0,u.value.$reset()}async function G(){if(u.value.$touch(),u.value.$invalid)return;i.value=!0;const o=new FormData;o.append("name",s.name),o.append("phone",s.phone),o.append("position",s.position),o.append("salary",s.salary),o.append("status",s.status);const e=f.value?`/staffs/${w.value}`:"/staffs",a=f.value?"PUT":"POST";try{if(!(await fetch(e,{method:a,body:o})).ok)throw new Error("Failed to save");p.value=!1,c(),g.commit("setMessage",{type:"success",text:f.value?"Staff updated!":"Staff added!"})}catch{g.commit("setMessage",{type:"error",text:"Failed to save staff"})}finally{i.value=!1}}async function J(){i.value=!0;try{await fetch(`/staffs/${w.value}`,{method:"DELETE"}),V.value=!1,p.value=!1,c(),g.commit("setMessage",{type:"success",text:"Staff deleted!"})}catch{g.commit("setMessage",{type:"error",text:"Failed to delete staff"})}finally{i.value=!1}}return W(()=>c()),(o,e)=>(A(),U(oe,{fluid:""},{default:l(()=>[t(E,{class:"pa-4 mb-4"},{default:l(()=>[t(Y,{dense:""},{default:l(()=>[t($,{cols:"12",sm:"4"},{default:l(()=>[t(C,{modelValue:n.search,"onUpdate:modelValue":e[0]||(e[0]=a=>n.search=a),label:"Search Staff Name",clearable:"","append-inner-icon":"mdi-close-circle","onClick:appendInner":e[1]||(e[1]=a=>n.search="")},null,8,["modelValue"])]),_:1}),t($,{cols:"12",sm:"3"},{default:l(()=>[t(j,{modelValue:n.status,"onUpdate:modelValue":e[2]||(e[2]=a=>n.status=a),items:["Active","Resigned","Terminated"],label:"Filter by Status",clearable:""},null,8,["modelValue"])]),_:1}),t($,{cols:"12",class:"d-flex justify-end"},{default:l(()=>[t(d,{color:"primary",onClick:H},{default:l(()=>[t(v,{start:""},{default:l(()=>e[16]||(e[16]=[r("mdi-filter")])),_:1}),e[17]||(e[17]=r(" Apply "))]),_:1}),t(d,{class:"ml-2",color:"grey",onClick:h},{default:l(()=>[t(v,{start:""},{default:l(()=>e[18]||(e[18]=[r("mdi-refresh")])),_:1}),e[19]||(e[19]=r(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1}),b("div",de,[e[22]||(e[22]=b("h3",null,"Staff Management",-1)),t(d,{color:"primary",class:"text-white",size:"small",onClick:z},{default:l(()=>[t(v,{start:""},{default:l(()=>e[20]||(e[20]=[r("mdi-plus")])),_:1}),e[21]||(e[21]=r(" Add Staff "))]),_:1})]),t(_,{active:i.value,indeterminate:i.value},null,8,["active","indeterminate"]),t(re,{class:"elevation-1",dense:"",headers:q,items:T.value,loading:i.value,height:"420"},{"item.salary":l(({item:a})=>[r(S(L(a.salary)),1)]),"item.status":l(({item:a})=>[t(ie,{color:O(a.status),size:"small",label:""},{default:l(()=>[r(S(a.status),1)]),_:2},1032,["color"])]),"item.edit":l(({item:a})=>[t(v,{color:"primary",onClick:K=>Z(a)},{default:l(()=>e[23]||(e[23]=[r(" mdi-square-edit-outline ")])),_:2},1032,["onClick"])]),_:1},8,["items","loading"]),b("div",fe,[t(ne,{modelValue:y.value,"onUpdate:modelValue":[e[3]||(e[3]=a=>y.value=a),c],length:D.value,"total-visible":"7"},null,8,["modelValue","length"])]),t(M,{modelValue:p.value,"onUpdate:modelValue":e[12]||(e[12]=a=>p.value=a),transition:"dialog-top-transition","max-width":"600"},{default:l(()=>[t(E,{class:"rounded-xl pa-4",elevation:"10"},{default:l(()=>[t(F,{class:"rounded-lg flex-wrap px-4",color:"primary",flat:""},{default:l(()=>[b("div",me,[t(v,{class:"mr-2 text-white"},{default:l(()=>e[24]||(e[24]=[r("mdi-account")])),_:1}),b("span",pe,S(f.value?"Edit Staff":"Add Staff"),1)]),t(ee),t(d,{color:"white",icon:"mdi-close",onClick:e[4]||(e[4]=a=>p.value=!1)})]),_:1}),t(B,{class:"pt-6"},{default:l(()=>[t(ue,{onSubmit:e[10]||(e[10]=te(()=>{},["prevent"]))},{default:l(()=>[t(C,{modelValue:s.name,"onUpdate:modelValue":e[5]||(e[5]=a=>s.name=a),label:"Full Name","bg-color":"#E0E0E0",required:"","error-messages":x(u).name.$errors.map(a=>a.$message),onBlur:x(u).name.$touch},null,8,["modelValue","error-messages","onBlur"]),t(C,{modelValue:s.phone,"onUpdate:modelValue":e[6]||(e[6]=a=>s.phone=a),label:"Phone Number","bg-color":"#E0E0E0"},null,8,["modelValue"]),t(C,{modelValue:s.position,"onUpdate:modelValue":e[7]||(e[7]=a=>s.position=a),label:"Position","bg-color":"#E0E0E0"},null,8,["modelValue"]),t(C,{modelValue:s.salary,"onUpdate:modelValue":e[8]||(e[8]=a=>s.salary=a),label:"Salary (TSh)",type:"number","bg-color":"#E0E0E0",required:"","error-messages":x(u).salary.$errors.map(a=>a.$message),onBlur:x(u).salary.$touch},null,8,["modelValue","error-messages","onBlur"]),t(j,{modelValue:s.status,"onUpdate:modelValue":e[9]||(e[9]=a=>s.status=a),items:["Active","Resigned","Terminated"],label:"Status","bg-color":"#E0E0E0",required:""},null,8,["modelValue"])]),_:1})]),_:1}),t(N,{class:"d-flex justify-end"},{default:l(()=>[t(d,{color:"success",loading:i.value,disabled:x(u).$invalid,onClick:G},{default:l(()=>[t(v,{start:""},{default:l(()=>e[25]||(e[25]=[r("mdi-content-save")])),_:1}),r(" "+S(f.value?"Save Changes":"Add Staff"),1)]),_:1},8,["loading","disabled"]),f.value?(A(),U(d,{key:0,color:"error",onClick:e[11]||(e[11]=a=>V.value=!0)},{default:l(()=>[t(v,{start:""},{default:l(()=>e[26]||(e[26]=[r("mdi-delete")])),_:1}),e[27]||(e[27]=r(" Delete "))]),_:1})):ae("",!0)]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(M,{modelValue:V.value,"onUpdate:modelValue":e[15]||(e[15]=a=>V.value=a),persistent:"",width:"400"},{default:l(()=>[t(E,null,{default:l(()=>[t(F,{color:"warning",title:"Confirm Deleting "+s.name},{default:l(()=>[t(d,{color:"white",icon:"mdi-close",onClick:e[13]||(e[13]=a=>V.value=!1)})]),_:1},8,["title"]),t(B,null,{default:l(()=>[r("Are you sure you want to delete "+S(s.name)+"?",1)]),_:1}),t(N,{class:"d-flex justify-end"},{default:l(()=>[t(d,{color:"grey",onClick:e[14]||(e[14]=a=>V.value=!1)},{default:l(()=>e[28]||(e[28]=[r("Cancel")])),_:1}),t(d,{color:"error",onClick:J},{default:l(()=>e[29]||(e[29]=[r("Delete")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ue=Q(Ve,[["__scopeId","data-v-b8576297"]]);export{Ue as default};
