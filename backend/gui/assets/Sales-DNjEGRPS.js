import{g as Ct,p as St,ag as ht,r as x,ah as ze,ai as Dt,aj as It,a7 as rt,ak as Pt,d as L,al as Fe,am as ce,an as At,c as De,ao as dt,f as qt,h as t,x as s,A as f,ap as Et,F as fe,a5 as te,K as ft,L as Ie,O as Oe,aq as Tt,z as me,ar as Ut,n as Nt,i as vt,as as zt,B as n,a9 as Ft,at as Rt,ab as $t,au as mt,av as Ot,aw as Mt,_ as Bt,$ as ct,k as Lt,q as X,v as l,a0 as jt,t as k,N as be,Z as ne,G as I,ae as Gt,H as c,a2 as Je,a3 as Ye,C as _e,D as F,ax as Ht,Q as Kt,E as Re,M as We,af as Ze}from"./index-C1Tj7Gr4.js";import{V as Qt}from"./VContainer-DjHLodrw.js";import{V as E,b as B,a as Se,c as Xe}from"./VCard-BTVuuPde.js";import{V as w}from"./VCol-DviWLfXs.js";import{u as Jt,g as Yt,h as Wt,d as Zt,i as Xt,j as el,k as tl,l as ll,n as al,V as $e,f as ol}from"./VDataTable-B2-JjakP.js";import{u as nl,V as ee,c as ul}from"./VTextField-ByAT7d5t.js";import{V as sl}from"./VDataTableServer-DX--LLFj.js";import{V as st}from"./VTooltip-BDAA4Qkl.js";import{V as Y}from"./VChip-BoOgafMF.js";import{V as et}from"./VDialog-DXmIvNfP.js";import{V as il}from"./VTextarea-CsNS21lN.js";import{V as he}from"./VAlert-DPUzX-lz.js";import{V as rl}from"./VAutocomplete-DxxHVteM.js";import"./dialog-transition-C6ql0rGP.js";import"./VSlideGroup-CXfqPmJw.js";const dl=St({alwaysFilter:Boolean,autoSelectFirst:{type:[Boolean,String]},clearOnSelect:{type:Boolean,default:!0},delimiters:Array,...al({filterKeys:["title"]}),...ll({hideNoData:!0,returnObject:!0}),...$t(ul({modelValue:null,role:"combobox"}),["validationValue","dirty","appendInnerIcon"]),...Rt({transition:!1})},"VCombobox"),ml=Ct()({name:"VCombobox",props:dl(),emits:{"update:focused":r=>!0,"update:modelValue":r=>!0,"update:search":r=>!0,"update:menu":r=>!0},setup(r,T){var Te;let{emit:Pe,slots:v}=T;const{t:Ae}=ht(),R=x(),j=ze(!1),Q=ze(!0),xe=ze(!1),ve=x(),ie=x(),C=ze(-1);let G=!1;const{items:ue,transformIn:Ve,transformOut:se}=Dt(r),{textColorClasses:pe,textColorStyles:ke}=It(()=>{var i;return(i=R.value)==null?void 0:i.color}),b=rt(r,"modelValue",[],i=>Ve(Pt(i)),i=>{const p=se(i);return r.multiple?p:p[0]??null}),le=nl(r),ae=L(()=>!!(r.chips||v.chip)),P=L(()=>ae.value||!!v.selection),A=ze(!r.multiple&&!P.value?((Te=b.value[0])==null?void 0:Te.title)??"":""),_=L({get:()=>A.value,set:async i=>{var p;if(A.value=i??"",!r.multiple&&!P.value&&(b.value=[Fe(r,i)],ce(()=>{var D;return(D=ie.value)==null?void 0:D.scrollToIndex(0)})),i&&r.multiple&&((p=r.delimiters)!=null&&p.length)){const D=r.delimiters.map(At).join("|"),g=i.split(new RegExp(`(?:${D})+`));if(g.length>1){for(let V of g)V=V.trim(),V&&(K(Fe(r,V)),await ce());A.value=""}}i||(C.value=-1),Q.value=!i}}),Me=L(()=>typeof r.counterValue=="function"?r.counterValue(b.value):typeof r.counterValue=="number"?r.counterValue:r.multiple?b.value.length:_.value.length),{filteredItems:S,getMatches:$}=Jt(r,ue,()=>r.alwaysFilter||!Q.value?_.value:""),W=L(()=>r.hideSelected?S.value.filter(i=>!b.value.some(p=>p.value===i.value)):S.value),oe=L(()=>r.hideNoData&&!W.value.length||le.isReadonly.value||le.isDisabled.value),d=rt(r,"menu"),h=L({get:()=>d.value,set:i=>{var p;d.value&&!i&&((p=ve.value)!=null&&p.Î¨openChildren.size)||i&&oe.value||(d.value=i)}}),{menuId:ye,ariaExpanded:tt,ariaControls:lt,ariaLabel:Be}=Yt(r,h);De(A,i=>{G?ce(()=>G=!1):j.value&&!h.value&&(h.value=!0),Pe("update:search",i)}),De(b,i=>{var p;!r.multiple&&!P.value&&(A.value=((p=i[0])==null?void 0:p.title)??"")});const re=L(()=>b.value.map(i=>i.value)),qe=L(()=>{var p;return(r.autoSelectFirst===!0||r.autoSelectFirst==="exact"&&_.value===((p=W.value[0])==null?void 0:p.title))&&W.value.length>0&&!Q.value&&!xe.value}),we=x(),Le=Wt(we,R);function je(i){G=!0,ce(()=>G=!1),r.openOnClear&&(h.value=!0)}function H(){oe.value||(h.value=!0)}function at(i){oe.value||(j.value&&(i.preventDefault(),i.stopPropagation()),h.value=!h.value)}function ot(i){var p;(mt(i)||i.key==="Backspace")&&((p=R.value)==null||p.focus())}function nt(i){var g,V,U,q;if(Ot(i)||le.isReadonly.value)return;const p=(g=R.value)==null?void 0:g.selectionStart,D=b.value.length;if(["Enter","ArrowDown","ArrowUp"].includes(i.key)&&i.preventDefault(),["Enter","ArrowDown"].includes(i.key)&&(h.value=!0),["Escape"].includes(i.key)&&(h.value=!1),["Enter","Escape","Tab"].includes(i.key)&&(qe.value&&["Enter","Tab"].includes(i.key)&&!b.value.some(y=>{let{value:M}=y;return M===W.value[0].value})&&K(S.value[0]),Q.value=!0),i.key==="ArrowDown"&&qe.value&&((V=we.value)==null||V.focus("next")),i.key==="Enter"&&_.value&&(K(Fe(r,_.value)),P.value&&(A.value="")),["Backspace","Delete"].includes(i.key)){if(!r.multiple&&P.value&&b.value.length>0&&!_.value)return K(b.value[0],!1);if(~C.value){i.preventDefault();const y=C.value;K(b.value[C.value],!1),C.value=y>=D-1?D-2:y}else i.key==="Backspace"&&!_.value&&(C.value=D-1);return}if(r.multiple)if(i.key==="ArrowLeft"){if(C.value<0&&p&&p>0)return;const y=C.value>-1?C.value-1:D-1;b.value[y]?C.value=y:(C.value=-1,(U=R.value)==null||U.setSelectionRange(_.value.length,_.value.length))}else if(i.key==="ArrowRight"){if(C.value<0)return;const y=C.value+1;b.value[y]?C.value=y:(C.value=-1,(q=R.value)==null||q.setSelectionRange(0,0))}else~C.value&&mt(i)&&(C.value=-1)}function O(){var i;r.eager&&((i=ie.value)==null||i.calculateVisibleItems())}function Ce(){var i;j.value&&(Q.value=!0,(i=R.value)==null||i.focus())}function K(i){let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0;if(!(!i||i.props.disabled))if(r.multiple){const D=b.value.findIndex(V=>(r.valueComparator||dt)(V.value,i.value)),g=p??!~D;if(~D){const V=g?[...b.value,i]:[...b.value];V.splice(D,1),b.value=V}else g&&(b.value=[...b.value,i]);r.clearOnSelect&&(_.value="")}else{const D=p!==!1;b.value=D?[i]:[],A.value=D&&!P.value?i.title:"",ce(()=>{h.value=!1,Q.value=!0})}}function Ge(i){j.value=!0,setTimeout(()=>{xe.value=!0})}function Ee(i){xe.value=!1}function He(i){(i==null||i===""&&!r.multiple&&!P.value)&&(b.value=[])}return De(j,(i,p)=>{if(!(i||i===p)&&(C.value=-1,h.value=!1,_.value)){if(r.multiple){K(Fe(r,_.value));return}if(!P.value)return;b.value.some(D=>{let{title:g}=D;return g===_.value})?A.value="":K(Fe(r,_.value))}}),De(h,()=>{if(!r.hideSelected&&h.value&&b.value.length){const i=W.value.findIndex(p=>b.value.some(D=>(r.valueComparator||dt)(D.value,p.value)));Mt&&window.requestAnimationFrame(()=>{var p;i>=0&&((p=ie.value)==null||p.scrollToIndex(i))})}}),De(ue,(i,p)=>{h.value||j.value&&!p.length&&i.length&&(h.value=!0)}),qt(()=>{const i=!!(!r.hideNoData||W.value.length||v["prepend-item"]||v["append-item"]||v["no-data"]),p=b.value.length>0,D=ee.filterProps(r);return t(ee,te({ref:R},D,{modelValue:_.value,"onUpdate:modelValue":[g=>_.value=g,He],focused:j.value,"onUpdate:focused":g=>j.value=g,validationValue:b.externalValue,counterValue:Me.value,dirty:p,class:["v-combobox",{"v-combobox--active-menu":h.value,"v-combobox--chips":!!r.chips,"v-combobox--selection-slot":!!P.value,"v-combobox--selecting-index":C.value>-1,[`v-combobox--${r.multiple?"multiple":"single"}`]:!0},r.class],style:r.style,readonly:le.isReadonly.value,placeholder:p?void 0:r.placeholder,"onClick:clear":je,"onMousedown:control":H,onKeydown:nt,"aria-expanded":tt.value,"aria-controls":lt.value}),{...v,default:()=>s(fe,null,[t(Zt,te({id:ye.value,ref:ve,modelValue:h.value,"onUpdate:modelValue":g=>h.value=g,activator:"parent",contentClass:"v-combobox__content",disabled:oe.value,eager:r.eager,maxHeight:310,openOnClick:!1,closeOnContentClick:!1,transition:r.transition,onAfterEnter:O,onAfterLeave:Ce},r.menuProps),{default:()=>[i&&t(ft,te({ref:we,filterable:!0,selected:re.value,selectStrategy:r.multiple?"independent":"single-independent",onMousedown:g=>g.preventDefault(),selectable:!0,onKeydown:ot,onFocusin:Ge,onFocusout:Ee,tabindex:"-1","aria-live":"polite",color:r.itemColor??r.color},Le,r.listProps),{default:()=>{var g,V,U;return[(g=v["prepend-item"])==null?void 0:g.call(v),!W.value.length&&!r.hideNoData&&(((V=v["no-data"])==null?void 0:V.call(v))??t(Ie,{key:"no-data",title:Ae(r.noDataText)},null)),t(Xt,{ref:ie,renderless:!0,items:W.value,itemKey:"value"},{default:q=>{var Ue,Qe,z;let{item:y,index:M,itemRef:N}=q;const Ke=te(y.props,{ref:N,key:y.value,active:qe.value&&M===0?!0:void 0,onClick:()=>K(y,null)});return y.type==="divider"?((Ue=v.divider)==null?void 0:Ue.call(v,{props:y.raw,index:M}))??t(Oe,te(y.props,{key:`divider-${M}`}),null):y.type==="subheader"?((Qe=v.subheader)==null?void 0:Qe.call(v,{props:y.raw,index:M}))??t(Tt,te(y.props,{key:`subheader-${M}`}),null):((z=v.item)==null?void 0:z.call(v,{item:y,index:M,props:Ke}))??t(Ie,te(Ke,{role:"option"}),{prepend:ge=>{let{isSelected:de}=ge;return s(fe,null,[r.multiple&&!r.hideSelected?t(tl,{key:y.value,modelValue:de,ripple:!1,tabindex:"-1"},null):void 0,y.props.prependAvatar&&t(me,{image:y.props.prependAvatar},null),y.props.prependIcon&&t(f,{icon:y.props.prependIcon},null)])},title:()=>{var ge;return Q.value?y.title:el("v-combobox",y.title,(ge=$(y))==null?void 0:ge.title)}})}}),(U=v["append-item"])==null?void 0:U.call(v)]}})]}),b.value.map((g,V)=>{function U(N){N.stopPropagation(),N.preventDefault(),K(g,!1)}const q={"onClick:close":U,onKeydown(N){N.key!=="Enter"&&N.key!==" "||(N.preventDefault(),N.stopPropagation(),U(N))},onMousedown(N){N.preventDefault(),N.stopPropagation()},modelValue:!0,"onUpdate:modelValue":void 0},y=ae.value?!!v.chip:!!v.selection,M=y?Ut(ae.value?v.chip({item:g,index:V,props:q}):v.selection({item:g,index:V})):void 0;if(!(y&&!M))return s("div",{key:g.value,class:vt(["v-combobox__selection",V===C.value&&["v-combobox__selection--selected",pe.value]]),style:Nt(V===C.value?ke.value:{})},[ae.value?v.chip?t(zt,{key:"chip-defaults",defaults:{VChip:{closable:r.closableChips,size:"small",text:g.title}}},{default:()=>[M]}):t(Y,te({key:"chip",closable:r.closableChips,size:"small",text:g.title,disabled:g.props.disabled},q),null):M??s("span",{class:"v-combobox__selection-text"},[g.title,r.multiple&&V<b.value.length-1&&s("span",{class:"v-combobox__selection-comma"},[n(",")])])])})]),"append-inner":function(){var q,y;for(var g=arguments.length,V=new Array(g),U=0;U<g;U++)V[U]=arguments[U];return s(fe,null,[(q=v["append-inner"])==null?void 0:q.call(v,...V),(!r.hideNoData||r.items.length)&&r.menuIcon?t(f,{class:"v-combobox__menu-icon",color:(y=R.value)==null?void 0:y.fieldIconColor,icon:r.menuIcon,onMousedown:at,onClick:Et,"aria-label":Be.value,title:Be.value,tabindex:"-1"},null):void 0])}})}),Ft({isFocused:j,isPristine:Q,menu:h,search:_,selectionIndex:C,filteredItems:S,select:K},R)}}),cl={class:"d-flex align-center"},fl={class:"d-flex align-center"},vl={class:"font-weight-medium"},pl={class:"d-flex align-center"},yl={class:"font-weight-medium"},gl={class:"text-right font-weight-bold"},bl={class:"text-right"},_l={class:"d-flex justify-end"},xl={class:"d-flex align-center"},Vl={class:"d-flex align-center gap-2"},kl={key:0,class:"scanner-section"},wl={key:0,class:"scan-result mt-2"},Cl={key:1,class:"text-center py-4"},Sl={class:"d-flex align-center"},hl={key:0,class:"text-caption text-grey mt-1"},Dl={class:"text-h6 font-weight-bold text-blue-darken-3"},Il={key:1,class:"text-center py-8"},Pl={class:"text-right"},Al={class:"text-h6"},ql={class:"d-flex align-center"},El={class:"d-flex justify-end"},Tl={class:"text-right mr-6"},Ul={class:"text-error"},Nl={class:"d-flex align-center mb-4"},zl={class:"text-h5 font-weight-bold"},Fl={class:"d-flex align-center"},Rl={class:"text-body-1 font-weight-medium"},$l={class:"d-flex align-center mb-4"},Ol={class:"text-body-1 font-weight-medium"},Ml={class:"d-flex align-center"},Bl={class:"text-body-1 font-weight-medium"},Ll={class:"text-left"},jl={class:"text-center"},Gl={class:"text-center"},Hl={class:"text-right"},Kl={class:"text-right"},Ql={class:"text-right pa-4"},Jl={class:"mb-1"},Yl={class:"text-h6"},Wl={class:"text-error mt-1"},Zl={class:"text-body-1 text-grey mb-4"},Xl={class:"font-weight-bold text-error"},ea={__name:"Sales",setup(r){const T=jt(),Pe=x(10),v=x(!1),Ae=x(!1),R=x(!1),j=x([]),Q=x([]),xe=x([]),ve=x([]),ie=x(1),C=x(0),G=x(!1),ue=x(""),Ve=x(!1),se=x(null),pe=x(!1),ke=x(null),b=x(!1),le=x(!1),ae=x(!1),P=x(!1),A=x(null),_=x(null),Me=x([]),S=ct({outlet_id:[],start_date:"",end_date:"",payment_status:""}),$=x(null),W=x(""),oe=new Date().toISOString().split("T")[0],d=ct({outlet_id:"",sale_date:oe,notes:"",items:[],payments:[]}),h=x([]),ye=x([]),tt=[{title:"ID",key:"id"},{title:"Date",key:"sale_date"},{title:"Outlet",key:"outlet"},{title:"Customer",key:"customer_name"},{title:"Items",key:"items_count",align:"center"},{title:"Qty",key:"total_qty",align:"center"},{title:"Total",key:"total_amount",align:"end"},{title:"Paid",key:"paid_amount",align:"end"},{title:"Balance",key:"balance",align:"end"},{title:"Actions",key:"actions",sortable:!1}],lt=[{title:"Good",value:"GOOD"},{title:"Damaged",value:"DAMAGED"},{title:"Reject",value:"REJECT"}],Be=["CASH","MOBILE","CARD","BANK"],re=x(!0),qe=L(()=>d.items.reduce((o,e)=>o+Number(e.quantity||0)*Number(e.unit_price||0),0)),we=L(()=>qe.value),Le=L(()=>d.payments.reduce((o,e)=>o+Number(e.amount||0),0)),je=L(()=>d.outlet_id&&d.sale_date&&d.items.length>0&&h.value.length===0&&ye.value.length===0),H=L(()=>{const o=d.items.reduce((m,u)=>m+D(u),0),e=d.payments.reduce((m,u)=>m+Number(u.amount||0),0),a=Math.max(o-e,0);return{total:o,paid:e,balance:a}});De(()=>H.value.total,o=>{d.payments.length>0&&re.value&&(d.payments[0].amount=o)});function at(){G.value=!G.value,G.value?ce(()=>{var o;(o=ke.value)==null||o.focus()}):(ue.value="",se.value=null)}async function ot(){var e;const o=(e=ue.value)==null?void 0:e.trim();if(o){Ve.value=!0;try{const a=ve.value.find(u=>u.barcode===o||u.code===o);if(!a){T.commit("setMessage",{type:"error",text:`Product not found for code: ${o}`});return}const m=d.items.findIndex(u=>u.product_id===a.id&&u.quality==="GOOD");if(m!==-1){const u=d.items[m];u.quantity=String(Number(u.quantity)+1),se.value=a}else{const u={product_id:a.id,product_code:a.code,quality:"GOOD",quantity:"1",unit_price:a.price||"",stockData:null};d.items.push(u),se.value=a,await q(u)}ue.value="",ce(()=>{var u;(u=ke.value)==null||u.focus()}),z()}catch(a){console.error("Barcode scan error:",a),T.commit("setMessage",{type:"error",text:"Error processing barcode scan"})}finally{Ve.value=!1}}}function nt(){G.value&&ce(()=>{var o;(o=ke.value)==null||o.focus()})}function O(o){return Number(o||0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})}function Ce(o){const e=Number(o||0);return new Intl.NumberFormat().format(e)}function K(o){return o?new Date(o).toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric"}):""}function Ge(o){return{MAIN:"mdi-home",SHOP:"mdi-store",CAR:"mdi-truck"}[o]||"mdi-store"}function Ee(o){return{MAIN:"primary",SHOP:"success",CAR:"warning"}[o]||"grey"}function He(o){return{GOOD:"success",DAMAGED:"warning",REJECT:"error"}[o]||"grey"}function Te(){d.items.push({product_id:"",quality:"GOOD",quantity:"",unit_price:"",stockData:null}),z()}function i(o){d.items.splice(o,1),z()}function p(o){o===0&&(re.value=!1)}function D(o){return Number(o.quantity||0)*Number(o.unit_price||0)}function g(o){return o.stockData&&o.stockData[o.quality]||0}async function V(o){const e=ve.value.find(a=>a.id===o.product_id);e&&(o.unit_price===""||o.unit_price==null)&&(o.unit_price=Number(e.price||0),o.product_code=e.code),await q(o),z()}async function U(o){await q(o),z()}async function q(o){if(!d.outlet_id||!o.product_id){o.stockData=null;return}try{const a=await(await fetch(`/stocktransfers/availableByQuality?outlet_id=${d.outlet_id}&product_id=${o.product_id}`)).json();o.stockData=a.stock||{GOOD:0,DAMAGED:0,REJECT:0}}catch(e){console.error("Stock check failed:",e),o.stockData=null}}function y(o){return!o.product_id||!o.quality||!o.quantity?!1:Number(o.quantity)>Number(g(o)||0)}function M(o){return o.product_id?`Available: ${g(o)}`:"Pick a product"}function N(o){o.unit_price===""||o.unit_price==null||(o.unit_price=Number(o.unit_price),(isNaN(o.unit_price)||o.unit_price<0)&&(o.unit_price=0))}function Ke(o){if(typeof o=="string"){$.value=o.trim()||null;return}if(o&&typeof o=="object"){$.value={id:o.id??null,name:o.name??""};return}$.value=null}function Ue(){d.payments.push({amount:"",method:"CASH",reference:"",payment_date:oe}),d.payments.length===1&&(re.value=!0,H.value.total>0&&(d.payments[0].amount=H.value.total)),z()}function Qe(o){d.payments.splice(o,1),o===0&&(re.value=!0),z()}function z(){const o=[];d.outlet_id||o.push("Outlet is required."),d.sale_date||o.push("Sale date is required.");const e=new Set;d.items.forEach((a,m)=>{const u=m+1;if(a.product_id||o.push(`Item ${u}: product is required.`),a.quality||o.push(`Item ${u}: quality is required.`),(a.quantity===""||Number(a.quantity)<=0)&&o.push(`Item ${u}: quantity is required and must be > 0.`),(a.unit_price===""||Number(a.unit_price)<0)&&o.push(`Item ${u}: unit price is required and cannot be negative.`),y(a)&&o.push(`Item ${u}: insufficient ${a.quality} stock.`),a.product_id&&a.quality){const J=`${a.product_id}|${a.quality}|${a.unit_price}`;e.has(J)&&o.push(`Duplicate product of same quality and price detected on item ${m+1}.`),e.add(J)}}),h.value=o,ge()}function ge(){const o=[];let e=0;d.payments.forEach((a,m)=>{a.amount===""||Number(a.amount)<=0?o.push(`Payment ${m+1}: amount is required and must be > 0, or delete the row.`):e+=Number(a.amount)}),e>H.value.total&&o.push("Total payment amount cannot exceed sale total."),ye.value=o}async function de(){var e;v.value=!0;const o=new URLSearchParams({page:ie.value,limit:Pe.value});(e=S.outlet_id)!=null&&e.length?S.outlet_id.forEach(a=>o.append("outlet_id[]",a)):T.state.auth.outlets.length&&T.state.auth.outlets.forEach(a=>o.append("outlet_id[]",a.outlet_id)),S.start_date&&o.append("start_date",S.start_date),S.end_date&&o.append("end_date",S.end_date),S.payment_status&&o.append("payment_status",S.payment_status);try{const m=await(await fetch(`/sales?${o}`)).json();j.value=m.data||[],C.value=m.totalRecords||0}catch{T.commit("setMessage",{type:"error",text:"Failed to load sales"})}finally{v.value=!1}}function pt(){S.outlet_id="",S.start_date="",S.end_date="",S.payment_status="",de()}function yt(){P.value=!1,A.value=null,it(),b.value=!0}async function gt(o){var e;P.value=!0,A.value=o.id,v.value=!0;try{const m=await(await fetch(`/sales/${o.id}`)).json();d.outlet_id=m.sale.outlet_id,d.sale_date=((e=m.sale.sale_date)==null?void 0:e.split("T")[0])||oe,d.notes=m.sale.notes||"",$.value=m.sale.customer_id||null,W.value=m.sale.customer_name||"",d.items=(m.items||[]).map(u=>({product_id:u.product_id,quality:u.quality,quantity:String(u.quantity),unit_price:Number(u.unit_price),stockData:null})),d.payments=(m.payments||[]).map(u=>{var J;return{amount:String(u.amount),method:u.method||"CASH",reference:u.reference||"",payment_date:((J=u.payment_date)==null?void 0:J.split("T")[0])||oe}}),re.value=!1;for(const u of d.items)await q(u);z(),b.value=!0}catch{T.commit("setMessage",{type:"error",text:"Failed to load sale"})}finally{v.value=!1}}async function bt(o){A.value=o.id,v.value=!0;try{const a=await(await fetch(`/sales/${o.id}`)).json();_.value={...a.sale,outlet:a.sale.outlet_name,outlet_type:a.sale.outlet_type},Me.value=a.items||[],le.value=!0}catch{T.commit("setMessage",{type:"error",text:"Failed to load sale details"})}finally{v.value=!1}}function ut(){b.value=!1,G.value=!1,it()}function it(){d.outlet_id="",d.sale_date=oe,d.notes="",d.items=[],d.payments=[],Ue(),$.value=null,W.value="",h.value=[],ye.value=[],re.value=!0,ue.value="",se.value=null,Ve.value=!1}function _t(o){A.value=o.id,ae.value=!0}async function xt(){R.value=!0;try{if(!(await fetch(`/sales/${A.value}`,{method:"DELETE"})).ok)throw new Error("Failed to delete");T.commit("setMessage",{type:"success",text:"Sale deleted successfully"}),ae.value=!1,de()}catch{T.commit("setMessage",{type:"error",text:"Failed to delete sale"})}finally{R.value=!1}}async function Vt(){for(const o of d.items)await q(o);z()}async function kt(){var m;if(z(),!je.value)return;Ae.value=!0;const o={outlet_id:d.outlet_id,sale_date:d.sale_date,notes:d.notes||null,items:d.items.map(u=>({product_id:u.product_id,quality:u.quality,quantity:Number(u.quantity),unit_price:Number(u.unit_price)})),payments:d.payments.map(u=>({amount:Number(u.amount),method:u.method||null,reference:u.reference||null,payment_date:u.payment_date||d.sale_date}))};typeof $.value=="string"?(o.customer_id=null,o.customer_name=$.value):(m=$.value)!=null&&m.id?(o.customer_id=$.value.id,o.customer_name=$.value.name):(o.customer_id=null,o.customer_name=null);const e=P.value?`/sales/${A.value}`:"/sales",a=P.value?"PUT":"POST";try{const u=await fetch(e,{method:a,headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!u.ok)throw new Error("Failed to save sale");const J=await u.json();T.commit("setMessage",{type:"success",text:P.value?"Sale updated successfully":"Sale created successfully"}),ut(),de()}catch{T.commit("setMessage",{type:"error",text:"Failed to save sale"})}finally{Ae.value=!1}}async function wt(){try{const o=new URLSearchParams({limit:1e3});T.state.auth.outlets.length?T.state.auth.outlets.forEach(u=>o.append("id[]",u.outlet_id)):o.append("id[]",-1);const[e,a,m]=await Promise.all([fetch(`/outlets?${o}`),fetch("/products?limit=1000"),fetch("/customers?limit=1000")]);Q.value=(await e.json()).data||[],ve.value=(await a.json()).data||[],xe.value=(await m.json()).data||[]}catch(o){console.error("Init data load failed:",o)}}return Lt(()=>{de(),wt()}),(o,e)=>(k(),X(Qt,{class:"bg-grey-lighten-4 pa-6",fluid:""},{default:l(()=>[t(E,{class:"mb-6",elevation:"2"},{default:l(()=>[t(B,{class:"pa-6"},{default:l(()=>[t(be,{align:"center"},{default:l(()=>[t(w,{cols:"12",md:"6"},{default:l(()=>[s("div",cl,[t(me,{class:"mr-4",color:"primary",size:"56"},{default:l(()=>[t(f,{color:"white",size:"32"},{default:l(()=>e[23]||(e[23]=[n("mdi-receipt-text")])),_:1})]),_:1}),e[24]||(e[24]=s("div",null,[s("h1",{class:"text-h4 font-weight-bold text-primary"},"Sales"),s("p",{class:"text-body-1 text-grey mt-1"}," Create and manage posted sales per outlet with part payments ")],-1))])]),_:1}),t(w,{class:"text-right",cols:"12",md:"6"},{default:l(()=>[o.$store.getters.hasTask("can_add_sale")?(k(),X(I,{key:0,color:"primary",size:"large",onClick:yt},{default:l(()=>[t(f,{start:""},{default:l(()=>e[25]||(e[25]=[n("mdi-plus")])),_:1}),e[26]||(e[26]=n(" New Sale "))]),_:1})):ne("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),t(E,{class:"mb-6",elevation:"1"},{default:l(()=>[t(B,{class:"pa-4"},{default:l(()=>[t(be,{align:"center",dense:""},{default:l(()=>[t(w,{cols:"12",sm:"3"},{default:l(()=>[t($e,{modelValue:S.outlet_id,"onUpdate:modelValue":e[0]||(e[0]=a=>S.outlet_id=a),clearable:"",density:"comfortable","item-title":"name","item-value":"id",items:Q.value,label:"Outlet",multiple:"","prepend-inner-icon":"mdi-store",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(w,{cols:"12",sm:"3"},{default:l(()=>[t(ee,{modelValue:S.start_date,"onUpdate:modelValue":e[1]||(e[1]=a=>S.start_date=a),autocomplete:"off",autocorrect:"off",clearable:"",density:"comfortable",inputmode:"none",label:"Start Date","prepend-inner-icon":"mdi-calendar",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(w,{cols:"12",sm:"3"},{default:l(()=>[t(ee,{modelValue:S.end_date,"onUpdate:modelValue":e[2]||(e[2]=a=>S.end_date=a),autocomplete:"off",autocorrect:"off",clearable:"",density:"comfortable",inputmode:"none",label:"End Date","prepend-inner-icon":"mdi-calendar",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(w,{cols:"12",sm:"3"},{default:l(()=>[t($e,{modelValue:S.payment_status,"onUpdate:modelValue":e[3]||(e[3]=a=>S.payment_status=a),clearable:"",density:"comfortable",items:[{title:"All",value:""},{title:"Fully Paid",value:"PAID"},{title:"Part Paid",value:"PART"}],label:"Payment Status","prepend-inner-icon":"mdi-filter",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(w,{class:"d-flex justify-end",cols:"12"},{default:l(()=>[t(I,{class:"mr-2",color:"primary",variant:"flat",onClick:de},{default:l(()=>[t(f,{start:""},{default:l(()=>e[27]||(e[27]=[n("mdi-magnify")])),_:1}),e[28]||(e[28]=n(" Search "))]),_:1}),t(I,{color:"grey",variant:"outlined",onClick:pt},{default:l(()=>[t(f,{start:""},{default:l(()=>e[29]||(e[29]=[n("mdi-refresh")])),_:1}),e[30]||(e[30]=n(" Reset "))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(E,{class:"rounded-lg",elevation:"2"},{default:l(()=>[t(Gt,{active:v.value,color:"primary",height:"4",indeterminate:v.value},null,8,["active","indeterminate"]),t(sl,{"items-per-page":Pe.value,"onUpdate:itemsPerPage":e[4]||(e[4]=a=>Pe.value=a),page:ie.value,"onUpdate:page":e[5]||(e[5]=a=>ie.value=a),class:"elevation-0",headers:tt,items:j.value,"items-length":C.value,"items-per-page-options":[5,10,20,50,100],loading:v.value,"loading-text":"Loading sales...","no-data-text":"No sales found","onUpdate:options":de},{top:l(()=>[t(Se,{class:"d-flex align-center pt-4"},{default:l(()=>[t(f,{class:"mr-2",color:"primary"},{default:l(()=>e[31]||(e[31]=[n("mdi-format-list-bulleted")])),_:1}),e[32]||(e[32]=n(" Recent Sales ")),t(Y,{class:"ml-3",color:"primary",size:"small",variant:"flat"},{default:l(()=>[n(c(j.value.length)+" total ",1)]),_:1})]),_:1}),t(Oe)]),"item.sale_date":l(({item:a})=>[s("div",fl,[t(f,{class:"mr-2",color:"grey",size:"16"},{default:l(()=>e[33]||(e[33]=[n("mdi-calendar")])),_:1}),s("span",vl,c(K(a.sale_date)),1)])]),"item.outlet":l(({item:a})=>[s("div",pl,[t(me,{class:"mr-2",color:Ee(a.outlet_type),size:"28"},{default:l(()=>[t(f,{color:"white",size:"14"},{default:l(()=>[n(c(Ge(a.outlet_type)),1)]),_:2},1024)]),_:2},1032,["color"]),s("div",yl,c(a.outlet),1)])]),"item.customer_name":l(({item:a})=>[t(Y,{color:a.customer_name?"primary":"grey",size:"small",variant:"flat"},{default:l(()=>[n(c(a.customer_name||"Walk-in"),1)]),_:2},1032,["color"])]),"item.total_qty":l(({item:a})=>[t(Y,{color:"green",size:"small",variant:"flat"},{default:l(()=>[n(c(parseFloat(a.total_qty)),1)]),_:2},1024)]),"item.total_amount":l(({item:a})=>[s("div",gl,c(O(a.total_amount)),1)]),"item.paid_amount":l(({item:a})=>[s("div",bl,c(O(a.paid_amount)),1)]),"item.balance":l(({item:a})=>[s("div",{class:vt(["text-right",Number(a.balance)>0?"text-error":"text-grey"])},c(O(a.balance)),3)]),"item.actions":l(({item:a})=>[s("div",_l,[t(st,{location:"top"},{activator:l(({props:m})=>[t(I,te(m,{color:"info",icon:"",size:"small",variant:"text",onClick:u=>bt(a)}),{default:l(()=>[t(f,null,{default:l(()=>e[34]||(e[34]=[n("mdi-eye-outline")])),_:1})]),_:2},1040,["onClick"])]),default:l(()=>[e[35]||(e[35]=s("span",null,"View",-1))]),_:2},1024),t(st,{location:"top"},{activator:l(({props:m})=>[o.$store.getters.hasTask("can_edit_sale")?(k(),X(I,te({key:0},m,{color:"primary",icon:"",size:"small",variant:"text",onClick:u=>gt(a)}),{default:l(()=>[t(f,null,{default:l(()=>e[36]||(e[36]=[n("mdi-pencil-outline")])),_:1})]),_:2},1040,["onClick"])):ne("",!0)]),default:l(()=>[e[37]||(e[37]=s("span",null,"Edit",-1))]),_:2},1024),t(st,{location:"top"},{activator:l(({props:m})=>[o.$store.getters.hasTask("can_delete_sale")?(k(),X(I,te({key:0},m,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>_t(a)}),{default:l(()=>[t(f,null,{default:l(()=>e[38]||(e[38]=[n("mdi-delete-outline")])),_:1})]),_:2},1040,["onClick"])):ne("",!0)]),default:l(()=>[e[39]||(e[39]=s("span",null,"Delete",-1))]),_:2},1024)])]),_:1},8,["items-per-page","page","items","items-length","loading"]),t(et,{modelValue:b.value,"onUpdate:modelValue":e[14]||(e[14]=a=>b.value=a),"max-width":"1200",persistent:"",scrollable:""},{default:l(()=>[t(E,{class:"rounded-lg"},{default:l(()=>[t(Je,{color:P.value?"warning":"primary",density:"comfortable"},{default:l(()=>[t(me,{class:"mr-3",color:P.value?"warning":"primary",size:"40"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>[n(c(P.value?"mdi-pencil":"mdi-plus"),1)]),_:1})]),_:1},8,["color"]),t(Ye,{class:"text-h6 font-weight-bold"},{default:l(()=>[n(c(P.value?"Edit Sale":"Create New Sale"),1)]),_:1}),t(_e),t(I,{icon:"",onClick:ut},{default:l(()=>[t(f,null,{default:l(()=>e[40]||(e[40]=[n("mdi-close")])),_:1})]),_:1})]),_:1},8,["color"]),t(B,{class:"pa-6"},{default:l(()=>[t(E,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(Se,{class:"d-flex align-center bg-blue-lighten-5"},{default:l(()=>[t(f,{class:"mr-2",color:"primary"},{default:l(()=>e[41]||(e[41]=[n("mdi-information")])),_:1}),e[42]||(e[42]=n(" Sale Information "))]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[t(be,null,{default:l(()=>[t(w,{cols:"12",md:"4"},{default:l(()=>[t($e,{modelValue:d.outlet_id,"onUpdate:modelValue":[e[6]||(e[6]=a=>d.outlet_id=a),Vt],"item-title":"name","item-value":"id",items:Q.value,label:"Outlet","prepend-inner-icon":"mdi-store",required:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(w,{cols:"12",md:"4"},{default:l(()=>[t(ml,{modelValue:$.value,"onUpdate:modelValue":[e[7]||(e[7]=a=>$.value=a),Ke],"auto-select-first":"false",clearable:"","hide-no-data":"","item-title":"name","item-value":"id",items:xe.value,label:"Customer (optional, type to add)","prepend-inner-icon":"mdi-account","return-object":"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),t(w,{cols:"12",md:"4"},{default:l(()=>[t(ee,{modelValue:d.sale_date,"onUpdate:modelValue":e[8]||(e[8]=a=>d.sale_date=a),autocomplete:"off",autocorrect:"off",inputmode:"none",label:"Sale Date","prepend-inner-icon":"mdi-calendar",required:"",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue"])]),_:1}),t(w,{cols:"12"},{default:l(()=>[t(il,{modelValue:d.notes,"onUpdate:modelValue":e[9]||(e[9]=a=>d.notes=a),label:"Notes / Description",placeholder:"Add any notes about this saleâ€¦",rows:"2",variant:"outlined"},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1}),t(E,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(Se,{class:"d-flex align-center justify-space-between bg-orange-lighten-5"},{default:l(()=>[s("div",xl,[t(f,{class:"mr-2",color:"orange"},{default:l(()=>e[43]||(e[43]=[n("mdi-barcode-scan")])),_:1}),e[45]||(e[45]=n(" Barcode Scanner ")),t(Y,{class:"ml-3",color:"orange",size:"small",variant:"flat"},{default:l(()=>e[44]||(e[44]=[n(" Quick Product Entry ")])),_:1})]),s("div",Vl,[t(I,{color:"orange",size:"small",variant:"tonal",onClick:at},{default:l(()=>[t(f,{start:""},{default:l(()=>[n(c(G.value?"mdi-stop":"mdi-barcode"),1)]),_:1}),n(" "+c(G.value?"Stop Scanner":"Start Scanner"),1)]),_:1}),t(I,{color:"grey",icon:"",size:"small",variant:"text",onClick:e[10]||(e[10]=a=>pe.value=!0)},{default:l(()=>[t(f,null,{default:l(()=>e[46]||(e[46]=[n("mdi-help-circle")])),_:1})]),_:1})])]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[G.value?(k(),F("div",kl,[t(he,{class:"mb-4",color:"info",icon:"mdi-barcode-scan",variant:"tonal"},{default:l(()=>e[47]||(e[47]=[s("strong",null,"Scanner Active",-1),n(" - Focus on the barcode input field below and scan products ")])),_:1}),t(ee,{ref_key:"barcodeInputRef",ref:ke,modelValue:ue.value,"onUpdate:modelValue":e[11]||(e[11]=a=>ue.value=a),autocomplete:"off",autocorrect:"off",autofocus:"",clearable:"",density:"comfortable",label:"Scan Barcode or Enter Product Code",placeholder:"Scan barcode or type product code and press Enter","prepend-inner-icon":"mdi-barcode",spellcheck:"false",variant:"outlined",onBlur:nt,onKeydown:Ht(ot,["enter"])},{append:l(()=>[Ve.value?(k(),X(Kt,{key:0,indeterminate:"",size:"24",width:"2"})):(k(),X(f,{key:1,color:"green"},{default:l(()=>e[48]||(e[48]=[n("mdi-arrow-right")])),_:1}))]),_:1},8,["modelValue"]),se.value?(k(),F("div",wl,[t(he,{color:"success",density:"compact",icon:"mdi-check",variant:"tonal"},{default:l(()=>[e[49]||(e[49]=n(" Added: ")),s("strong",null,c(se.value.name),1),n(" ("+c(se.value.code)+") ",1)]),_:1})])):ne("",!0)])):(k(),F("div",Cl,[t(f,{class:"mb-2",color:"grey",size:"48"},{default:l(()=>e[50]||(e[50]=[n("mdi-barcode-off")])),_:1}),e[51]||(e[51]=s("div",{class:"text-body-1 text-grey"},' Click "Start Scanner" to enable barcode scanning ',-1))]))]),_:1})]),_:1}),t(E,{class:"mb-6",variant:"outlined"},{default:l(()=>[t(Se,{class:"d-flex align-center justify-space-between bg-green-lighten-5"},{default:l(()=>[s("div",Sl,[t(f,{class:"mr-2",color:"green"},{default:l(()=>e[52]||(e[52]=[n("mdi-package-variant")])),_:1}),e[53]||(e[53]=n(" Sale Items ")),t(Y,{class:"ml-3",color:"green",size:"small",variant:"flat"},{default:l(()=>[n(c(d.items.length)+" items ",1)]),_:1}),t(Y,{class:"ml-2",color:"indigo",size:"small",variant:"tonal"},{default:l(()=>[n(" Total: "+c(Ce(H.value.total)),1)]),_:1}),t(Y,{class:"ml-2",color:"teal",size:"small",variant:"tonal"},{default:l(()=>[n(" Paid: "+c(Ce(H.value.paid)),1)]),_:1}),t(Y,{class:"ml-2",color:H.value.balance>0?"warning":"success",size:"small",variant:"tonal"},{default:l(()=>[n(" Balance: "+c(Ce(H.value.balance)),1)]),_:1},8,["color"])]),t(I,{color:"green",disabled:!d.outlet_id,size:"small",onClick:Te},{default:l(()=>[t(f,{start:""},{default:l(()=>e[54]||(e[54]=[n("mdi-plus")])),_:1}),e[55]||(e[55]=n(" Add Item "))]),_:1},8,["disabled"])]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[h.value.length?(k(),X(he,{key:0,class:"mb-4",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:l(()=>[(k(!0),F(fe,null,Re(h.value,a=>(k(),F("div",{key:a}," â€¢ "+c(a),1))),128))]),_:1})):ne("",!0),(k(!0),F(fe,null,Re(d.items,(a,m)=>(k(),F("div",{key:m,class:"mb-4"},[t(E,{class:"elevation-1"},{default:l(()=>[t(B,{class:"pa-4"},{default:l(()=>[t(be,{align:"center",dense:""},{default:l(()=>[t(w,{cols:"12",md:"3"},{default:l(()=>[t(rl,{modelValue:a.product_id,"onUpdate:modelValue":[u=>a.product_id=u,()=>V(a)],autocomplete:"off",autocorrect:"off",inputmode:"none","item-title":"name","item-value":"id",items:ve.value,label:"Product","prepend-inner-icon":"mdi-cube-outline",required:"",spellcheck:"false",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","items"]),a.product_code?(k(),F("div",hl," Code: "+c(a.product_code),1)):ne("",!0)]),_:2},1024),t(w,{cols:"12",md:"2"},{default:l(()=>[t($e,{modelValue:a.quality,"onUpdate:modelValue":[u=>a.quality=u,()=>U(a)],color:He(a.quality),"item-title":"title","item-value":"value",items:lt,label:"Quality",required:"",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue","color"])]),_:2},1024),t(w,{cols:"12",md:"2"},{default:l(()=>[t(ee,{modelValue:a.quantity,"onUpdate:modelValue":u=>a.quantity=u,autocomplete:"off",autocorrect:"off",density:"comfortable",error:y(a),hint:M(a),inputmode:"none",label:"Quantity","persistent-hint":"",spellcheck:"false",type:"number",variant:"outlined",onInput:e[12]||(e[12]=()=>z())},null,8,["modelValue","onUpdate:modelValue","error","hint"])]),_:2},1024),t(w,{cols:"12",md:"2"},{default:l(()=>[t(ee,{modelValue:a.unit_price,"onUpdate:modelValue":u=>a.unit_price=u,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Unit Price",spellcheck:"false",type:"number",variant:"outlined",onBlur:u=>N(a),onInput:e[13]||(e[13]=()=>z())},null,8,["modelValue","onUpdate:modelValue","onBlur"])]),_:2},1024),t(w,{cols:"12",md:"2"},{default:l(()=>[t(E,{class:"pa-3 text-center",color:"blue-lighten-5",variant:"flat"},{default:l(()=>[e[56]||(e[56]=s("div",{class:"text-caption text-blue-darken-3 font-weight-bold"}," AVAILABLE ",-1)),s("div",Dl,c(g(a)),1)]),_:2},1024)]),_:2},1024),t(w,{class:"text-right",cols:"12",md:"1"},{default:l(()=>[t(I,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>i(m)},{default:l(()=>[t(f,null,{default:l(()=>e[57]||(e[57]=[n("mdi-delete-outline")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024),t(be,{class:"mt-1"},{default:l(()=>[t(w,{class:"text-right text-grey",cols:"12"},{default:l(()=>[e[58]||(e[58]=n(" Line total: ")),s("strong",null,c(O(D(a))),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128)),d.items.length===0?(k(),F("div",Il,[t(f,{class:"mb-4",color:"grey",size:"64"},{default:l(()=>e[59]||(e[59]=[n("mdi-package-variant-plus")])),_:1}),e[62]||(e[62]=s("div",{class:"text-h6 text-grey mb-2"},"No Items Added",-1)),e[63]||(e[63]=s("div",{class:"text-body-1 text-grey mb-4"},' Click "Add Item" or use barcode scanner to add products ',-1)),t(I,{color:"primary",disabled:!d.outlet_id,onClick:Te},{default:l(()=>[t(f,{start:""},{default:l(()=>e[60]||(e[60]=[n("mdi-plus")])),_:1}),e[61]||(e[61]=n(" Add Your First Item "))]),_:1},8,["disabled"])])):ne("",!0),t(Oe,{class:"my-4"}),H.value.balance>0?(k(),X(he,{key:2,class:"mt-2",color:"warning",icon:"mdi-alert",variant:"tonal"},{default:l(()=>[e[64]||(e[64]=n(" Balance due: ")),s("strong",null,c(Ce(H.value.balance)),1)]),_:1})):H.value.total>0?(k(),X(he,{key:3,class:"mt-2",color:"success",icon:"mdi-check",variant:"tonal"},{default:l(()=>e[65]||(e[65]=[n(" Fully paid ðŸŽ‰ ")])),_:1})):ne("",!0),s("div",Pl,[s("div",Al,[e[66]||(e[66]=n(" Total: ")),s("strong",null,c(O(we.value)),1)])])]),_:1})]),_:1}),t(E,{variant:"outlined"},{default:l(()=>[t(Se,{class:"d-flex align-center justify-space-between bg-purple-lighten-5"},{default:l(()=>[s("div",ql,[t(f,{class:"mr-2",color:"purple"},{default:l(()=>e[67]||(e[67]=[n("mdi-cash")])),_:1}),e[68]||(e[68]=n(" Payments ")),t(Y,{class:"ml-3",color:"purple",size:"small",variant:"flat"},{default:l(()=>[n(c(d.payments.length)+" row(s) ",1)]),_:1})]),t(I,{color:"purple",size:"small",onClick:Ue},{default:l(()=>[t(f,{start:""},{default:l(()=>e[69]||(e[69]=[n("mdi-plus")])),_:1}),e[70]||(e[70]=n(" Add Payment "))]),_:1})]),_:1}),t(B,{class:"pa-4"},{default:l(()=>[ye.value.length?(k(),X(he,{key:0,class:"mb-4",color:"error",icon:"mdi-alert-circle",variant:"tonal"},{default:l(()=>[(k(!0),F(fe,null,Re(ye.value,a=>(k(),F("div",{key:a},"â€¢ "+c(a),1))),128))]),_:1})):ne("",!0),(k(!0),F(fe,null,Re(d.payments,(a,m)=>(k(),F("div",{key:m,class:"mb-3"},[t(be,{dense:""},{default:l(()=>[t(w,{cols:"12",md:"3"},{default:l(()=>[t(ee,{modelValue:a.amount,"onUpdate:modelValue":u=>a.amount=u,autocomplete:"off",autocorrect:"off",density:"comfortable",error:!a.amount,hint:"Required",inputmode:"none",label:"Amount","persistent-hint":"",spellcheck:"false",type:"number",variant:"outlined",onInput:()=>{ge(),p(m)}},null,8,["modelValue","onUpdate:modelValue","error","onInput"])]),_:2},1024),t(w,{cols:"12",md:"3"},{default:l(()=>[t($e,{modelValue:a.method,"onUpdate:modelValue":u=>a.method=u,density:"comfortable",items:Be,label:"Method",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(w,{cols:"12",md:"3"},{default:l(()=>[t(ee,{modelValue:a.reference,"onUpdate:modelValue":u=>a.reference=u,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Reference",spellcheck:"false",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(w,{cols:"12",md:"2"},{default:l(()=>[t(ee,{modelValue:a.payment_date,"onUpdate:modelValue":u=>a.payment_date=u,autocomplete:"off",autocorrect:"off",density:"comfortable",inputmode:"none",label:"Payment Date",spellcheck:"false",type:"date",variant:"outlined"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(w,{class:"text-right",cols:"12",md:"1"},{default:l(()=>[t(I,{color:"error",icon:"",size:"small",variant:"text",onClick:u=>Qe(m)},{default:l(()=>[t(f,null,{default:l(()=>e[71]||(e[71]=[n("mdi-delete-outline")])),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]))),128)),t(Oe,{class:"my-4"}),s("div",El,[s("div",Tl,[s("div",null,[e[72]||(e[72]=n(" Paid: ")),s("strong",null,c(O(Le.value)),1)]),s("div",Ul,[e[73]||(e[73]=n(" Balance: ")),s("strong",null,c(O(Math.max(we.value-Le.value,0))),1)])])])]),_:1})]),_:1})]),_:1}),t(Xe,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(_e),t(I,{size:"large",variant:"outlined",onClick:ut},{default:l(()=>e[74]||(e[74]=[n("Cancel")])),_:1}),t(I,{color:"primary",disabled:!je.value,loading:Ae.value,size:"large",variant:"flat",onClick:kt},{default:l(()=>[t(f,{start:""},{default:l(()=>[n(c(P.value?"mdi-content-save":"mdi-check"),1)]),_:1}),n(" "+c(P.value?"Update Sale":"Create Sale"),1)]),_:1},8,["disabled","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(et,{modelValue:pe.value,"onUpdate:modelValue":e[17]||(e[17]=a=>pe.value=a),"max-width":"600"},{default:l(()=>[t(E,null,{default:l(()=>[t(Je,{color:"orange",density:"comfortable"},{default:l(()=>[t(f,{class:"mr-2",color:"white"},{default:l(()=>e[75]||(e[75]=[n("mdi-help-circle")])),_:1}),t(Ye,{class:"text-white"},{default:l(()=>e[76]||(e[76]=[n("Barcode Scanner Help")])),_:1}),t(_e),t(I,{icon:"",onClick:e[15]||(e[15]=a=>pe.value=!1)},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[77]||(e[77]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),t(B,{class:"pa-6"},{default:l(()=>[t(ft,null,{default:l(()=>[t(Ie,null,{prepend:l(()=>[t(f,{color:"orange"},{default:l(()=>e[78]||(e[78]=[n("mdi-barcode")])),_:1})]),default:l(()=>[t(We,null,{default:l(()=>e[79]||(e[79]=[n("How to Use")])),_:1}),t(Ze,null,{default:l(()=>e[80]||(e[80]=[n(' Click "Start Scanner", focus on the barcode field, and scan products. The system will automatically find and add products. ')])),_:1})]),_:1}),t(Ie,null,{prepend:l(()=>[t(f,{color:"green"},{default:l(()=>e[81]||(e[81]=[n("mdi-keyboard")])),_:1})]),default:l(()=>[t(We,null,{default:l(()=>e[82]||(e[82]=[n("Manual Entry")])),_:1}),t(Ze,null,{default:l(()=>e[83]||(e[83]=[n(" You can also type product codes manually and press Enter to add them. ")])),_:1})]),_:1}),t(Ie,null,{prepend:l(()=>[t(f,{color:"blue"},{default:l(()=>e[84]||(e[84]=[n("mdi-autorenew")])),_:1})]),default:l(()=>[t(We,null,{default:l(()=>e[85]||(e[85]=[n("Auto-Increment")])),_:1}),t(Ze,null,{default:l(()=>e[86]||(e[86]=[n(" Scanning the same product multiple times will increase its quantity. ")])),_:1})]),_:1}),t(Ie,null,{prepend:l(()=>[t(f,{color:"red"},{default:l(()=>e[87]||(e[87]=[n("mdi-alert")])),_:1})]),default:l(()=>[t(We,null,{default:l(()=>e[88]||(e[88]=[n("Troubleshooting")])),_:1}),t(Ze,null,{default:l(()=>e[89]||(e[89]=[n(" If a product isn't found, check that the outlet is selected and the product exists in the system. ")])),_:1})]),_:1})]),_:1})]),_:1}),t(Xe,{class:"pa-4"},{default:l(()=>[t(_e),t(I,{color:"orange",onClick:e[16]||(e[16]=a=>pe.value=!1)},{default:l(()=>e[90]||(e[90]=[n(" Got it! ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(et,{modelValue:le.value,"onUpdate:modelValue":e[20]||(e[20]=a=>le.value=a),"max-width":"900",scrollable:"",transition:"dialog-bottom-transition"},{default:l(()=>[t(E,{class:"rounded-lg"},{default:l(()=>[t(Je,{color:"info",density:"comfortable"},{default:l(()=>[t(me,{class:"mr-3",color:"info",size:"40"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[91]||(e[91]=[n("mdi-eye")])),_:1})]),_:1}),t(Ye,{class:"text-h6 font-weight-bold"},{default:l(()=>e[92]||(e[92]=[n("Sale Details")])),_:1}),t(_e),t(I,{icon:"",onClick:e[18]||(e[18]=a=>le.value=!1)},{default:l(()=>[t(f,null,{default:l(()=>e[93]||(e[93]=[n("mdi-close")])),_:1})]),_:1})]),_:1}),t(B,{class:"pa-6"},{default:l(()=>[t(E,{class:"mb-6 elevation-2"},{default:l(()=>[t(B,{class:"pa-4"},{default:l(()=>[t(be,null,{default:l(()=>{var a;return[t(w,{class:"border-e",cols:"12",md:"6"},{default:l(()=>{var m,u;return[s("div",Nl,[t(me,{class:"mr-3",color:"primary",size:"48"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[94]||(e[94]=[n("mdi-identifier")])),_:1})]),_:1}),s("div",null,[e[95]||(e[95]=s("div",{class:"text-caption text-grey"},"SALE ID",-1)),s("div",zl," #"+c((m=_.value)==null?void 0:m.id),1)])]),s("div",Fl,[t(f,{class:"mr-3",color:"grey"},{default:l(()=>e[96]||(e[96]=[n("mdi-calendar")])),_:1}),s("div",null,[e[97]||(e[97]=s("div",{class:"text-caption text-grey"},"DATE",-1)),s("div",Rl,c(K((u=_.value)==null?void 0:u.sale_date)),1)])])]}),_:1}),t(w,{cols:"12",md:"6"},{default:l(()=>{var m,u,J,Z;return[s("div",$l,[t(me,{class:"mr-3",color:Ee((m=_.value)==null?void 0:m.outlet_type),size:"48"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>{var Ne;return[n(c(Ge((Ne=_.value)==null?void 0:Ne.outlet_type)),1)]}),_:1})]),_:1},8,["color"]),s("div",null,[e[98]||(e[98]=s("div",{class:"text-caption text-grey"},"OUTLET",-1)),s("div",Ol,c((u=_.value)==null?void 0:u.outlet_name),1),t(Y,{class:"mt-1",color:Ee((J=_.value)==null?void 0:J.outlet_type),size:"small"},{default:l(()=>{var Ne;return[n(c((Ne=_.value)==null?void 0:Ne.outlet_type),1)]}),_:1},8,["color"])])]),s("div",Ml,[t(f,{class:"mr-3",color:"grey"},{default:l(()=>e[99]||(e[99]=[n("mdi-account")])),_:1}),s("div",null,[e[100]||(e[100]=s("div",{class:"text-caption text-grey"},"CUSTOMER",-1)),s("div",Bl,c(((Z=_.value)==null?void 0:Z.customer_name)||"Walk-in"),1)])])]}),_:1}),(a=_.value)!=null&&a.notes?(k(),X(w,{key:0,cols:"12"},{default:l(()=>[t(Oe,{class:"my-3"}),e[101]||(e[101]=s("div",{class:"text-caption text-grey mb-1"},"NOTES",-1)),t(E,{variant:"outlined"},{default:l(()=>[t(B,{class:"pa-3"},{default:l(()=>{var m;return[n(c((m=_.value)==null?void 0:m.notes),1)]}),_:1})]),_:1})]),_:1})):ne("",!0)]}),_:1})]),_:1})]),_:1}),t(E,{class:"mb-6 elevation-2"},{default:l(()=>[t(Se,{class:"d-flex align-center bg-teal-lighten-5"},{default:l(()=>[t(f,{class:"mr-2",color:"teal"},{default:l(()=>e[102]||(e[102]=[n("mdi-package-variant")])),_:1}),e[103]||(e[103]=n(" Items "))]),_:1}),t(B,{class:"pa-0"},{default:l(()=>{var a,m,u,J;return[t(ol,{density:"comfortable"},{default:l(()=>[e[104]||(e[104]=s("thead",null,[s("tr",{class:"bg-grey-lighten-4"},[s("th",{class:"text-left font-weight-bold text-grey"}," PRODUCT "),s("th",{class:"text-center font-weight-bold text-grey"}," QUALITY "),s("th",{class:"text-center font-weight-bold text-grey"}," QTY "),s("th",{class:"text-right font-weight-bold text-grey"}," UNIT PRICE "),s("th",{class:"text-right font-weight-bold text-grey"}," TOTAL PRICE ")])],-1)),s("tbody",null,[(k(!0),F(fe,null,Re(Me.value,Z=>(k(),F("tr",{key:Z.id},[s("td",Ll,c(Z.product_name),1),s("td",jl,[t(Y,{color:He(Z.quality),size:"small",variant:"flat"},{default:l(()=>[n(c(Z.quality),1)]),_:2},1032,["color"])]),s("td",Gl,c(parseFloat(Z.quantity)),1),s("td",Hl,c(O(Z.unit_price)),1),s("td",Kl,c(O(Z.quantity*Z.unit_price)),1)]))),128))])]),_:1}),s("div",Ql,[s("div",Jl,[e[105]||(e[105]=n(" Paid: ")),s("strong",null,c(O(((a=_.value)==null?void 0:a.total_paid)||0)),1)]),s("div",Yl,[e[106]||(e[106]=n(" Total: ")),s("strong",null,c(O(((m=_.value)==null?void 0:m.total_amount)||0)),1)]),s("div",Wl,[e[107]||(e[107]=n(" Balance: ")),s("strong",null,c(O((((u=_.value)==null?void 0:u.total_amount)||0)-(((J=_.value)==null?void 0:J.total_paid)||0))),1)])])]}),_:1})]),_:1})]),_:1}),t(Xe,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(_e),t(I,{color:"primary",size:"large",variant:"flat",onClick:e[19]||(e[19]=a=>le.value=!1)},{default:l(()=>[t(f,{start:""},{default:l(()=>e[108]||(e[108]=[n("mdi-close")])),_:1}),e[109]||(e[109]=n(" Close "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(et,{modelValue:ae.value,"onUpdate:modelValue":e[22]||(e[22]=a=>ae.value=a),"max-width":"500"},{default:l(()=>[t(E,{class:"rounded-lg"},{default:l(()=>[t(Je,{color:"error",density:"comfortable"},{default:l(()=>[t(me,{class:"mr-3",color:"error",size:"40"},{default:l(()=>[t(f,{color:"white"},{default:l(()=>e[110]||(e[110]=[n("mdi-alert")])),_:1})]),_:1}),t(Ye,{class:"text-h6 font-weight-bold"},{default:l(()=>e[111]||(e[111]=[n("Confirm Deletion")])),_:1})]),_:1}),t(B,{class:"pa-6 text-center"},{default:l(()=>[t(f,{class:"mb-4",color:"error",size:"64"},{default:l(()=>e[112]||(e[112]=[n("mdi-delete-alert")])),_:1}),e[115]||(e[115]=s("div",{class:"text-h5 font-weight-bold mb-2"},"Delete Sale?",-1)),s("div",Zl,[e[113]||(e[113]=n(" Are you sure you want to delete sale ")),s("span",Xl,"#"+c(A.value),1),e[114]||(e[114]=n("? This cannot be undone. "))])]),_:1}),t(Xe,{class:"pa-4 bg-grey-lighten-4"},{default:l(()=>[t(_e),t(I,{size:"large",variant:"outlined",onClick:e[21]||(e[21]=a=>ae.value=!1)},{default:l(()=>e[116]||(e[116]=[n("Cancel")])),_:1}),t(I,{color:"error",loading:R.value,size:"large",variant:"flat",onClick:xt},{default:l(()=>[t(f,{start:""},{default:l(()=>e[117]||(e[117]=[n("mdi-delete")])),_:1}),e[118]||(e[118]=n(" Delete Sale "))]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}))}},ya=Bt(ea,[["__scopeId","data-v-db87bead"]]);export{ya as default};
