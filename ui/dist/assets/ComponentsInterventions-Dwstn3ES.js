import{u as K}from"./projectHierarchy-DKVIpnYt.js";import{_ as W,n as X,r as d,f as V,e as P,q as Y,s as w,x as l,Z as ee,v as p,j as o,z as m,J as i,I as C,D as g,a2 as T,P as te,Q as E,F as b,T as F,G as A,H as B}from"./index-BWC57mqE.js";import{V as ae}from"./VContainer-CSFeTSsk.js";import{V as U,b as le,e as oe}from"./VCard-BI_548n6.js";import{V as ne,a as se,b as re,c as ie}from"./VExpansionPanels-P4Q4FEJy.js";import{V as N}from"./VChip-CEVDHffS.js";import{V as O}from"./VCol-DWZn5MAN.js";import{V as ce,a as ue}from"./VDataTable-BT5jeeYE.js";import"./VSlideGroup-DR6QWFvL.js";import"./VSelect-B3SmRlp7.js";import"./VTextField-BUBZtWvQ.js";const de={class:"text-h5 font-weight-bold white--text"},pe={class:"font-weight-medium"},me={class:"text-subtitle-2 mt-3 mb-2"},ve={key:0,class:"mt-3"},fe={class:"text-subtitle-2 mb-1"},he={class:"d-flex justify-space-between align-center pa-2"},ge={class:"text-caption"},ye={__name:"ComponentsInterventions",setup(Ve){const{t:v}=X(),{getHierarchyAsync:L,loadChildren:H,hierarchies:x}=K(),_=d(!1),$=d([]),f=d(0),c=d(1),u=d(10),k=d([0]),n=d({components:[]}),I=V(()=>Object.values(n.value).filter(e=>e!==""&&e!==null&&(Array.isArray(e)?e.length>0:!0)).length),R=V(()=>Math.ceil(f.value/u.value)),S=V(()=>(c.value-1)*u.value+1),q=V(()=>{const e=c.value*u.value;return e>f.value?f.value:e}),z=[{title:v("subComponentHeader"),key:"name"},{title:v("interventionsHeader"),key:"interventions"}],h=d([]),j=e=>{c.value=e,y()},D=e=>{const t=n.value.components.indexOf(e);t>-1&&n.value.components.splice(t,1);const r=h.value.findIndex(a=>a.id===e);r>-1&&h.value.splice(r,1)},J=()=>{n.value={component:""}};function M(e){const t=h.value.find(r=>r.id===e);return t?t.name:""}function G(e){const a=x.value.find(s=>s.id===e.path[0]).children.find(s=>s.id===e.path[1]).children.find(s=>s.id===e.path[2]);if(e.value)h.value.push(a);else{const s=h.value.findIndex(Z=>Z.id===a.id);s>-1&&h.value.splice(s,1)}}const y=async()=>{_.value=!0;try{let e="";for(const a in n.value){const s=Array.isArray(n.value[a])||typeof n.value[a]=="object"?JSON.stringify(n.value[a]):n.value[a];e&&(e+="&"),e+=`${a}=${s}`}e+=`&page=${c.value}&limit=${u.value}`;const r=await(await fetch(`/reports/componentInterventions?${e}`)).json();$.value=r.items||[],f.value=r.total||r.length||0}catch(e){console.error(v("fetchError"),e)}finally{_.value=!1}},Q=async()=>{let e="";for(const t in n.value){const r=Array.isArray(n.value[t])||typeof n.value[t]=="object"?JSON.stringify(n.value[t]):n.value[t];e&&(e+="&"),e+=`${t}=${r}`}e+="&export=true";try{const t=await fetch(`/reports/projectsOverview?${e}`);if(!t.ok)throw new Error(v("exportFailed"));const r=await t.blob(),a=window.URL.createObjectURL(r),s=document.createElement("a");s.href=a,s.download=v("excelFileName"),s.click(),window.URL.revokeObjectURL(a)}catch(t){console.error(t),alert(v("exportFailedAlert"))}};return P([c,u],y),P(u,()=>{c.value=1,y()}),Y(()=>{y(),L("component")}),(e,t)=>{const r=ee("v-treeview");return p(),w(ae,{class:"pa-6",fluid:""},{default:l(()=>[o(U,{class:"elevation-3"},{default:l(()=>[o(le,{class:"d-flex justify-space-between align-center bg-primary"},{default:l(()=>[m("span",de,i(e.$t("projectsOverviewTitle")),1),o(C,{color:"white","prepend-icon":e.$t("downloadIcon"),variant:"text",onClick:Q},{default:l(()=>[g(i(e.$t("exportExcelButton")),1)]),_:1},8,["prepend-icon"])]),_:1}),o(oe,null,{default:l(()=>[o(ne,{modelValue:k.value,"onUpdate:modelValue":t[1]||(t[1]=a=>k.value=a),class:"mb-6"},{default:l(()=>[o(se,null,{default:l(()=>[o(re,null,{default:l(()=>[o(te,{left:""},{default:l(()=>[g(i(e.$t("filterIcon")),1)]),_:1}),m("span",pe,i(e.$t("filtersTitle")),1),I.value>0?(p(),w(N,{key:0,class:"ml-2",color:"primary",size:"small"},{default:l(()=>[g(i(I.value)+" "+i(e.$t("activeFilters")),1)]),_:1})):T("",!0)]),_:1}),o(ie,null,{default:l(()=>[o(E,null,{default:l(()=>[o(O,{cols:"12",md:"12"},{default:l(()=>[m("div",me,i(e.$t("flagshipComponentsTitle")),1),o(U,{class:"pa-2",style:{"max-height":"200px","overflow-y":"auto"},variant:"outlined"},{default:l(()=>[o(r,{modelValue:n.value.components,"onUpdate:modelValue":t[0]||(t[0]=a=>n.value.components=a),color:"primary","item-title":"name","item-value":"id",items:F(x),"load-children":F(H),"open-on-click":"","select-strategy":"leaf",selectable:"","onClick:select":G},null,8,["modelValue","items","load-children"])]),_:1}),n.value.components.length?(p(),b("div",ve,[m("div",fe,i(e.$t("selectedComponentsTitle"))+":",1),(p(!0),b(A,null,B(n.value.components,a=>(p(),w(N,{key:a,class:"mr-2 mb-2",closable:"",color:"green",size:"small",variant:"elevated","onClick:close":s=>D(a)},{default:l(()=>[g(i(M(a)),1)]),_:2},1032,["onClick:close"]))),128))])):T("",!0)]),_:1})]),_:1}),o(E,{class:"mt-2"},{default:l(()=>[o(O,{class:"text-right",cols:"12"},{default:l(()=>[o(C,{color:"primary","prepend-icon":e.$t("filterIcon"),onClick:y},{default:l(()=>[g(i(e.$t("applyFiltersButton")),1)]),_:1},8,["prepend-icon"]),o(C,{class:"ml-2",color:"secondary","prepend-icon":e.$t("closeIcon"),variant:"text",onClick:J},{default:l(()=>[g(i(e.$t("clearAllButton")),1)]),_:1},8,["prepend-icon"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),o(ce,{"items-per-page":u.value,"onUpdate:itemsPerPage":t[3]||(t[3]=a=>u.value=a),class:"elevation-1 striped-table",density:"comfortable",headers:z,"item-value":"id",items:$.value,"items-length":f.value,loading:_.value,"show-current-page":"","show-first-last-page":"","onUpdate:page":j},{"item.interventions":l(({item:a})=>[m("ul",null,[(p(!0),b(A,null,B(a.interventions,s=>(p(),b("li",{key:s.id},i(s.name),1))),128))])]),bottom:l(()=>[m("div",he,[m("div",ge,i(e.$t("paginationText",{first:S.value,last:q.value,total:f.value})),1),o(ue,{modelValue:c.value,"onUpdate:modelValue":[t[2]||(t[2]=a=>c.value=a),j],length:R.value,"total-visible":5},null,8,["modelValue","length"])])]),_:1},8,["items-per-page","items","items-length","loading"])]),_:1})]),_:1})]),_:1})}}},Ee=W(ye,[["__scopeId","data-v-40346235"]]);export{Ee as default};
